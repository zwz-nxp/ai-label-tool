import{a as Nr,b as Br,d as Vr,g as zr,h as Si,i as qr,j as Wr,k as Rn,l as Ti,m as Ii,n as Ai,o as Nn,p as Yr,q as Xr,r as $r}from"./chunk-UEOTX5DO.js";import{b as kr}from"./chunk-VB7LVLZV.js";import{a as Fr,b as Fn,c as Rr}from"./chunk-FMKU7UOR.js";import{c as Gr,d as Ur,e as jr,f as Hr}from"./chunk-N5M4XZID.js";import{S as Or,T as Dn,d as Ws,e as xi,g as Xs,i as $s,mc as Er,nd as Lr,p as hr,q as mr,sd as Dr}from"./chunk-BAOJ77MB.js";import{$a as V,$c as tr,A as mi,Aa as W,B as Bt,Bb as Bs,Be as Cr,Bf as Sr,Ce as xr,Da as $,Db as Vs,Df as He,E as On,Ea as ui,Ee as fe,Ef as Tr,F as As,Fa as pa,Ff as Ir,G as ca,Ge as En,Ha as Zt,Hb as pe,Hd as or,Ia as R,Id as yi,Ie as Ln,Ja as fi,Jd as ar,Ka as v,Kd as _a,La as Ut,Lb as zs,Le as ie,M as da,Ma as ot,Mc as In,Mf as Ar,Nc as fa,O as z,Oa as Rs,Ob as kt,Oe as vr,Pb as St,Pc as Ks,Pd as sr,Pe as je,Qa as _i,Qb as Gs,Qd as rr,Qe as yr,Rb as Us,Rd as wi,Re as wr,Sb as js,Sd as Mi,Td as Ge,Te as Mr,U as gi,V as pi,Va as g,Vc as Qs,Vd as Pi,Ve as Pr,W as ha,Wa as u,Wc as Zs,Wd as Oi,X as Pe,Xa as tt,Xb as Hs,Xc as Js,Xd as ki,Y as dt,Yd as lr,Zd as ue,_d as cr,ac as qs,ae as ee,ba as qt,bb as T,be as dr,c as Nt,ca as k,cb as y,ce as Dt,da as S,db as ze,de as gr,eb as Jt,fb as ua,ga as le,ge as Ue,ha as ma,hb as bi,hd as ii,ib as Wt,ja as q,jb as Et,ka as kn,kb as Lt,kc as Ci,lb as Ji,le as Yt,m as hi,ma as Sn,mb as x,me as pr,nb as G,ne as ur,oa as Es,ob as et,od as vi,pb as Tn,pd as er,pe as Xt,q as ra,qa as Ls,qe as fr,r as Ss,ra as ga,rd as tn,sd as ir,tb as _t,td as te,ua as Ds,ub as bt,v as la,vb as Ct,w as Ts,wa as _,wb as ei,we as An,xb as Ns,xd as nr,xe as _r,yf as _e,z as Is,za as Fs,zc as Ys,ze as br}from"./chunk-NJA2VFCC.js";import{a as $t,b as Os,d as ks,e as N,f as Zi}from"./chunk-TSRGIXR5.js";var Y=N(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});Ft._registerNode=Ft.Konva=Ft.glob=void 0;var qm=Math.PI/180;function Wm(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}Ft.glob=typeof global<"u"?global:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{};Ft.Konva={_global:Ft.glob,version:"9.3.22",isBrowser:Wm(),isUnminified:/param/.test(function(o){}.toString()),dblClickWindow:400,getAngle(o){return Ft.Konva.angleDeg?o*qm:o},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return Ft.Konva.DD.isDragging},isTransforming(){var o;return(o=Ft.Konva.Transformer)===null||o===void 0?void 0:o.isTransforming()},isDragReady(){return!!Ft.Konva.DD.node},releaseCanvasOnDestroy:!0,document:Ft.glob.document,_injectGlobal(o){Ft.glob.Konva=o}};var Ym=o=>{Ft.Konva[o.prototype.getClassName()]=o};Ft._registerNode=Ym;Ft.Konva._injectGlobal(Ft.Konva)});var xt=N(gt=>{"use strict";Object.defineProperty(gt,"__esModule",{value:!0});gt.Util=gt.Transform=void 0;var Ma=Y(),ka=class o{constructor(e=[1,0,0,1,0,0]){this.dirty=!1,this.m=e&&e.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new o(this.m)}copyInto(e){e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5]}point(e){let t=this.m;return{x:t[0]*e.x+t[2]*e.y+t[4],y:t[1]*e.x+t[3]*e.y+t[5]}}translate(e,t){return this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t,this}scale(e,t){return this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t,this}rotate(e){let t=Math.cos(e),i=Math.sin(e),n=this.m[0]*t+this.m[2]*i,a=this.m[1]*t+this.m[3]*i,s=this.m[0]*-i+this.m[2]*t,r=this.m[1]*-i+this.m[3]*t;return this.m[0]=n,this.m[1]=a,this.m[2]=s,this.m[3]=r,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(e,t){let i=this.m[0]+this.m[2]*t,n=this.m[1]+this.m[3]*t,a=this.m[2]+this.m[0]*e,s=this.m[3]+this.m[1]*e;return this.m[0]=i,this.m[1]=n,this.m[2]=a,this.m[3]=s,this}multiply(e){let t=this.m[0]*e.m[0]+this.m[2]*e.m[1],i=this.m[1]*e.m[0]+this.m[3]*e.m[1],n=this.m[0]*e.m[2]+this.m[2]*e.m[3],a=this.m[1]*e.m[2]+this.m[3]*e.m[3],s=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],r=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];return this.m[0]=t,this.m[1]=i,this.m[2]=n,this.m[3]=a,this.m[4]=s,this.m[5]=r,this}invert(){let e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,i=-this.m[1]*e,n=-this.m[2]*e,a=this.m[0]*e,s=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),r=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=t,this.m[1]=i,this.m[2]=n,this.m[3]=a,this.m[4]=s,this.m[5]=r,this}getMatrix(){return this.m}decompose(){let e=this.m[0],t=this.m[1],i=this.m[2],n=this.m[3],a=this.m[4],s=this.m[5],r=e*n-t*i,l={x:a,y:s,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(e!=0||t!=0){let c=Math.sqrt(e*e+t*t);l.rotation=t>0?Math.acos(e/c):-Math.acos(e/c),l.scaleX=c,l.scaleY=r/c,l.skewX=(e*i+t*n)/r,l.skewY=0}else if(i!=0||n!=0){let c=Math.sqrt(i*i+n*n);l.rotation=Math.PI/2-(n>0?Math.acos(-i/c):-Math.acos(i/c)),l.scaleX=r/c,l.scaleY=c,l.skewX=0,l.skewY=(e*i+t*n)/r}return l.rotation=gt.Util._getRotation(l.rotation),l}};gt.Transform=ka;var Xm="[object Array]",$m="[object Number]",Km="[object String]",Qm="[object Boolean]",Zm=Math.PI/180,Jm=180/Math.PI,Pa="#",tg="",eg="0",ig="Konva warning: ",ul="Konva error: ",ng="rgb(",Oa={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},og=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,Hn=[],ag=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(o){setTimeout(o,60)};gt.Util={_isElement(o){return!!(o&&o.nodeType==1)},_isFunction(o){return!!(o&&o.constructor&&o.call&&o.apply)},_isPlainObject(o){return!!o&&o.constructor===Object},_isArray(o){return Object.prototype.toString.call(o)===Xm},_isNumber(o){return Object.prototype.toString.call(o)===$m&&!isNaN(o)&&isFinite(o)},_isString(o){return Object.prototype.toString.call(o)===Km},_isBoolean(o){return Object.prototype.toString.call(o)===Qm},isObject(o){return o instanceof Object},isValidSelector(o){if(typeof o!="string")return!1;let e=o[0];return e==="#"||e==="."||e===e.toUpperCase()},_sign(o){return o===0||o>0?1:-1},requestAnimFrame(o){Hn.push(o),Hn.length===1&&ag(function(){let e=Hn;Hn=[],e.forEach(function(t){t()})})},createCanvasElement(){let o=document.createElement("canvas");try{o.style=o.style||{}}catch{}return o},createImageElement(){return document.createElement("img")},_isInDocument(o){for(;o=o.parentNode;)if(o==document)return!0;return!1},_urlToImage(o,e){let t=gt.Util.createImageElement();t.onload=function(){e(t)},t.src=o},_rgbToHex(o,e,t){return((1<<24)+(o<<16)+(e<<8)+t).toString(16).slice(1)},_hexToRgb(o){o=o.replace(Pa,tg);let e=parseInt(o,16);return{r:e>>16&255,g:e>>8&255,b:e&255}},getRandomColor(){let o=(Math.random()*16777215<<0).toString(16);for(;o.length<6;)o=eg+o;return Pa+o},getRGB(o){let e;return o in Oa?(e=Oa[o],{r:e[0],g:e[1],b:e[2]}):o[0]===Pa?this._hexToRgb(o.substring(1)):o.substr(0,4)===ng?(e=og.exec(o.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA(o){return o=o||"black",gt.Util._namedColorToRBA(o)||gt.Util._hex3ColorToRGBA(o)||gt.Util._hex4ColorToRGBA(o)||gt.Util._hex6ColorToRGBA(o)||gt.Util._hex8ColorToRGBA(o)||gt.Util._rgbColorToRGBA(o)||gt.Util._rgbaColorToRGBA(o)||gt.Util._hslColorToRGBA(o)},_namedColorToRBA(o){let e=Oa[o.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA(o){if(o.indexOf("rgb(")===0){o=o.match(/rgb\(([^)]+)\)/)[1];let e=o.split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA(o){if(o.indexOf("rgba(")===0){o=o.match(/rgba\(([^)]+)\)/)[1];let e=o.split(/ *, */).map((t,i)=>t.slice(-1)==="%"?i===3?parseInt(t)/100:parseInt(t)/100*255:Number(t));return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex8ColorToRGBA(o){if(o[0]==="#"&&o.length===9)return{r:parseInt(o.slice(1,3),16),g:parseInt(o.slice(3,5),16),b:parseInt(o.slice(5,7),16),a:parseInt(o.slice(7,9),16)/255}},_hex6ColorToRGBA(o){if(o[0]==="#"&&o.length===7)return{r:parseInt(o.slice(1,3),16),g:parseInt(o.slice(3,5),16),b:parseInt(o.slice(5,7),16),a:1}},_hex4ColorToRGBA(o){if(o[0]==="#"&&o.length===5)return{r:parseInt(o[1]+o[1],16),g:parseInt(o[2]+o[2],16),b:parseInt(o[3]+o[3],16),a:parseInt(o[4]+o[4],16)/255}},_hex3ColorToRGBA(o){if(o[0]==="#"&&o.length===4)return{r:parseInt(o[1]+o[1],16),g:parseInt(o[2]+o[2],16),b:parseInt(o[3]+o[3],16),a:1}},_hslColorToRGBA(o){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(o)){let[e,...t]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(o),i=Number(t[0])/360,n=Number(t[1])/100,a=Number(t[2])/100,s,r,l;if(n===0)return l=a*255,{r:Math.round(l),g:Math.round(l),b:Math.round(l),a:1};a<.5?s=a*(1+n):s=a+n-a*n;let c=2*a-s,d=[0,0,0];for(let h=0;h<3;h++)r=i+1/3*-(h-1),r<0&&r++,r>1&&r--,6*r<1?l=c+(s-c)*6*r:2*r<1?l=s:3*r<2?l=c+(s-c)*(2/3-r)*6:l=c,d[h]=l*255;return{r:Math.round(d[0]),g:Math.round(d[1]),b:Math.round(d[2]),a:1}}},haveIntersection(o,e){return!(e.x>o.x+o.width||e.x+e.width<o.x||e.y>o.y+o.height||e.y+e.height<o.y)},cloneObject(o){let e={};for(let t in o)this._isPlainObject(o[t])?e[t]=this.cloneObject(o[t]):this._isArray(o[t])?e[t]=this.cloneArray(o[t]):e[t]=o[t];return e},cloneArray(o){return o.slice(0)},degToRad(o){return o*Zm},radToDeg(o){return o*Jm},_degToRad(o){return gt.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),gt.Util.degToRad(o)},_radToDeg(o){return gt.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),gt.Util.radToDeg(o)},_getRotation(o){return Ma.Konva.angleDeg?gt.Util.radToDeg(o):o},_capitalize(o){return o.charAt(0).toUpperCase()+o.slice(1)},throw(o){throw new Error(ul+o)},error(o){console.error(ul+o)},warn(o){Ma.Konva.showWarnings&&console.warn(ig+o)},each(o,e){for(let t in o)e(t,o[t])},_inRange(o,e,t){return e<=o&&o<t},_getProjectionToSegment(o,e,t,i,n,a){let s,r,l,c=(o-t)*(o-t)+(e-i)*(e-i);if(c==0)s=o,r=e,l=(n-t)*(n-t)+(a-i)*(a-i);else{let d=((n-o)*(t-o)+(a-e)*(i-e))/c;d<0?(s=o,r=e,l=(o-n)*(o-n)+(e-a)*(e-a)):d>1?(s=t,r=i,l=(t-n)*(t-n)+(i-a)*(i-a)):(s=o+d*(t-o),r=e+d*(i-e),l=(s-n)*(s-n)+(r-a)*(r-a))}return[s,r,l]},_getProjectionToLine(o,e,t){let i=gt.Util.cloneObject(o),n=Number.MAX_VALUE;return e.forEach(function(a,s){if(!t&&s===e.length-1)return;let r=e[(s+1)%e.length],l=gt.Util._getProjectionToSegment(a.x,a.y,r.x,r.y,o.x,o.y),c=l[0],d=l[1],h=l[2];h<n&&(i.x=c,i.y=d,n=h)}),i},_prepareArrayForTween(o,e,t){let i=[],n=[];if(o.length>e.length){let s=e;e=o,o=s}for(let s=0;s<o.length;s+=2)i.push({x:o[s],y:o[s+1]});for(let s=0;s<e.length;s+=2)n.push({x:e[s],y:e[s+1]});let a=[];return n.forEach(function(s){let r=gt.Util._getProjectionToLine(s,i,t);a.push(r.x),a.push(r.y)}),a},_prepareToStringify(o){let e;o.visitedByCircularReferenceRemoval=!0;for(let t in o)if(o.hasOwnProperty(t)&&o[t]&&typeof o[t]=="object"){if(e=Object.getOwnPropertyDescriptor(o,t),o[t].visitedByCircularReferenceRemoval||gt.Util._isElement(o[t]))if(e.configurable)delete o[t];else return null;else if(gt.Util._prepareToStringify(o[t])===null)if(e.configurable)delete o[t];else return null}return delete o.visitedByCircularReferenceRemoval,o},_assign(o,e){for(let t in e)o[t]=e[t];return o},_getFirstPointerId(o){return o.touches?o.changedTouches[0].identifier:o.pointerId||999},releaseCanvas(...o){Ma.Konva.releaseCanvasOnDestroy&&o.forEach(e=>{e.width=0,e.height=0})},drawRoundedRectPath(o,e,t,i){let n=0,a=0,s=0,r=0;typeof i=="number"?n=a=s=r=Math.min(i,e/2,t/2):(n=Math.min(i[0]||0,e/2,t/2),a=Math.min(i[1]||0,e/2,t/2),r=Math.min(i[2]||0,e/2,t/2),s=Math.min(i[3]||0,e/2,t/2)),o.moveTo(n,0),o.lineTo(e-a,0),o.arc(e-a,a,a,Math.PI*3/2,0,!1),o.lineTo(e,t-r),o.arc(e-r,t-r,r,0,Math.PI/2,!1),o.lineTo(s,t),o.arc(s,t-s,s,Math.PI/2,Math.PI,!1),o.lineTo(0,n),o.arc(n,n,n,Math.PI,Math.PI*3/2,!1)}}});var Ia=N(We=>{"use strict";Object.defineProperty(We,"__esModule",{value:!0});We.HitContext=We.SceneContext=We.Context=void 0;var bl=xt(),sg=Y();function rg(o){let e=[],t=o.length,i=bl.Util;for(let n=0;n<t;n++){let a=o[n];i._isNumber(a)?a=Math.round(a*1e3)/1e3:i._isString(a)||(a=a+""),e.push(a)}return e}var fl=",",lg="(",cg=")",dg="([",hg="])",mg=";",gg="()",pg="=",_l=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],ug=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],fg=100,Di=class{constructor(e){this.canvas=e,sg.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(e){e.fillEnabled()&&this._fill(e)}_fill(e){}strokeShape(e){e.hasStroke()&&this._stroke(e)}_stroke(e){}fillStrokeShape(e){e.attrs.fillAfterStrokeEnabled?(this.strokeShape(e),this.fillShape(e)):(this.fillShape(e),this.strokeShape(e))}getTrace(e,t){let i=this.traceArr,n=i.length,a="",s,r,l,c;for(s=0;s<n;s++)r=i[s],l=r.method,l?(c=r.args,a+=l,e?a+=gg:bl.Util._isArray(c[0])?a+=dg+c.join(fl)+hg:(t&&(c=c.map(d=>typeof d=="number"?Math.floor(d):d)),a+=lg+c.join(fl)+cg)):(a+=r.property,e||(a+=pg+r.val)),a+=mg;return a}clearTrace(){this.traceArr=[]}_trace(e){let t=this.traceArr,i;t.push(e),i=t.length,i>=fg&&t.shift()}reset(){let e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)}getCanvas(){return this.canvas}clear(e){let t=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,t.getWidth()/t.pixelRatio,t.getHeight()/t.pixelRatio)}_applyLineCap(e){let t=e.attrs.lineCap;t&&this.setAttr("lineCap",t)}_applyOpacity(e){let t=e.getAbsoluteOpacity();t!==1&&this.setAttr("globalAlpha",t)}_applyLineJoin(e){let t=e.attrs.lineJoin;t&&this.setAttr("lineJoin",t)}setAttr(e,t){this._context[e]=t}arc(e,t,i,n,a,s){this._context.arc(e,t,i,n,a,s)}arcTo(e,t,i,n,a){this._context.arcTo(e,t,i,n,a)}beginPath(){this._context.beginPath()}bezierCurveTo(e,t,i,n,a,s){this._context.bezierCurveTo(e,t,i,n,a,s)}clearRect(e,t,i,n){this._context.clearRect(e,t,i,n)}clip(...e){this._context.clip.apply(this._context,e)}closePath(){this._context.closePath()}createImageData(e,t){let i=arguments;if(i.length===2)return this._context.createImageData(e,t);if(i.length===1)return this._context.createImageData(e)}createLinearGradient(e,t,i,n){return this._context.createLinearGradient(e,t,i,n)}createPattern(e,t){return this._context.createPattern(e,t)}createRadialGradient(e,t,i,n,a,s){return this._context.createRadialGradient(e,t,i,n,a,s)}drawImage(e,t,i,n,a,s,r,l,c){let d=arguments,h=this._context;d.length===3?h.drawImage(e,t,i):d.length===5?h.drawImage(e,t,i,n,a):d.length===9&&h.drawImage(e,t,i,n,a,s,r,l,c)}ellipse(e,t,i,n,a,s,r,l){this._context.ellipse(e,t,i,n,a,s,r,l)}isPointInPath(e,t,i,n){return i?this._context.isPointInPath(i,e,t,n):this._context.isPointInPath(e,t,n)}fill(...e){this._context.fill.apply(this._context,e)}fillRect(e,t,i,n){this._context.fillRect(e,t,i,n)}strokeRect(e,t,i,n){this._context.strokeRect(e,t,i,n)}fillText(e,t,i,n){n?this._context.fillText(e,t,i,n):this._context.fillText(e,t,i)}measureText(e){return this._context.measureText(e)}getImageData(e,t,i,n){return this._context.getImageData(e,t,i,n)}lineTo(e,t){this._context.lineTo(e,t)}moveTo(e,t){this._context.moveTo(e,t)}rect(e,t,i,n){this._context.rect(e,t,i,n)}roundRect(e,t,i,n,a){this._context.roundRect(e,t,i,n,a)}putImageData(e,t,i){this._context.putImageData(e,t,i)}quadraticCurveTo(e,t,i,n){this._context.quadraticCurveTo(e,t,i,n)}restore(){this._context.restore()}rotate(e){this._context.rotate(e)}save(){this._context.save()}scale(e,t){this._context.scale(e,t)}setLineDash(e){this._context.setLineDash?this._context.setLineDash(e):"mozDash"in this._context?this._context.mozDash=e:"webkitLineDash"in this._context&&(this._context.webkitLineDash=e)}getLineDash(){return this._context.getLineDash()}setTransform(e,t,i,n,a,s){this._context.setTransform(e,t,i,n,a,s)}stroke(e){e?this._context.stroke(e):this._context.stroke()}strokeText(e,t,i,n){this._context.strokeText(e,t,i,n)}transform(e,t,i,n,a,s){this._context.transform(e,t,i,n,a,s)}translate(e,t){this._context.translate(e,t)}_enableTrace(){let e=this,t=_l.length,i=this.setAttr,n,a,s=function(r){let l=e[r],c;e[r]=function(){return a=rg(Array.prototype.slice.call(arguments,0)),c=l.apply(e,arguments),e._trace({method:r,args:a}),c}};for(n=0;n<t;n++)s(_l[n]);e.setAttr=function(){i.apply(e,arguments);let r=arguments[0],l=arguments[1];(r==="shadowOffsetX"||r==="shadowOffsetY"||r==="shadowBlur")&&(l=l/this.canvas.getPixelRatio()),e._trace({property:r,val:l})}}_applyGlobalCompositeOperation(e){let t=e.attrs.globalCompositeOperation;!t||t==="source-over"||this.setAttr("globalCompositeOperation",t)}};We.Context=Di;ug.forEach(function(o){Object.defineProperty(Di.prototype,o,{get(){return this._context[o]},set(e){this._context[o]=e}})});var Sa=class extends Di{constructor(e,{willReadFrequently:t=!1}={}){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:t})}_fillColor(e){let t=e.fill();this.setAttr("fillStyle",t),e._fillFunc(this)}_fillPattern(e){this.setAttr("fillStyle",e._getFillPattern()),e._fillFunc(this)}_fillLinearGradient(e){let t=e._getLinearGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fillRadialGradient(e){let t=e._getRadialGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fill(e){let t=e.fill(),i=e.getFillPriority();if(t&&i==="color"){this._fillColor(e);return}let n=e.getFillPatternImage();if(n&&i==="pattern"){this._fillPattern(e);return}let a=e.getFillLinearGradientColorStops();if(a&&i==="linear-gradient"){this._fillLinearGradient(e);return}let s=e.getFillRadialGradientColorStops();if(s&&i==="radial-gradient"){this._fillRadialGradient(e);return}t?this._fillColor(e):n?this._fillPattern(e):a?this._fillLinearGradient(e):s&&this._fillRadialGradient(e)}_strokeLinearGradient(e){let t=e.getStrokeLinearGradientStartPoint(),i=e.getStrokeLinearGradientEndPoint(),n=e.getStrokeLinearGradientColorStops(),a=this.createLinearGradient(t.x,t.y,i.x,i.y);if(n){for(let s=0;s<n.length;s+=2)a.addColorStop(n[s],n[s+1]);this.setAttr("strokeStyle",a)}}_stroke(e){let t=e.dash(),i=e.getStrokeScaleEnabled();if(e.hasStroke()){if(!i){this.save();let a=this.getCanvas().getPixelRatio();this.setTransform(a,0,0,a,0,0)}this._applyLineCap(e),t&&e.dashEnabled()&&(this.setLineDash(t),this.setAttr("lineDashOffset",e.dashOffset())),this.setAttr("lineWidth",e.strokeWidth()),e.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),e.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(e):this.setAttr("strokeStyle",e.stroke()),e._strokeFunc(this),i||this.restore()}}_applyShadow(e){var t,i,n;let a=(t=e.getShadowRGBA())!==null&&t!==void 0?t:"black",s=(i=e.getShadowBlur())!==null&&i!==void 0?i:5,r=(n=e.getShadowOffset())!==null&&n!==void 0?n:{x:0,y:0},l=e.getAbsoluteScale(),c=this.canvas.getPixelRatio(),d=l.x*c,h=l.y*c;this.setAttr("shadowColor",a),this.setAttr("shadowBlur",s*Math.min(Math.abs(d),Math.abs(h))),this.setAttr("shadowOffsetX",r.x*d),this.setAttr("shadowOffsetY",r.y*h)}};We.SceneContext=Sa;var Ta=class extends Di{constructor(e){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:!0})}_fill(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()}strokeShape(e){e.hasHitStroke()&&this._stroke(e)}_stroke(e){if(e.hasHitStroke()){let t=e.getStrokeScaleEnabled();if(!t){this.save();let a=this.getCanvas().getPixelRatio();this.setTransform(a,0,0,a,0,0)}this._applyLineCap(e);let i=e.hitStrokeWidth(),n=i==="auto"?e.strokeWidth():i;this.setAttr("lineWidth",n),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this),t||this.restore()}}};We.HitContext=Ta});var an=N(Ye=>{"use strict";Object.defineProperty(Ye,"__esModule",{value:!0});Ye.HitCanvas=Ye.SceneCanvas=Ye.Canvas=void 0;var Wn=xt(),Cl=Ia(),xl=Y(),qn;function _g(){if(qn)return qn;let o=Wn.Util.createCanvasElement(),e=o.getContext("2d");return qn=function(){let t=xl.Konva._global.devicePixelRatio||1,i=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return t/i}(),Wn.Util.releaseCanvas(o),qn}var on=class{constructor(e){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;let i=(e||{}).pixelRatio||xl.Konva.pixelRatio||_g();this.pixelRatio=i,this._canvas=Wn.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(e){let t=this.pixelRatio;this.pixelRatio=e,this.setSize(this.getWidth()/t,this.getHeight()/t)}setWidth(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px";let t=this.pixelRatio;this.getContext()._context.scale(t,t)}setHeight(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px";let t=this.pixelRatio;this.getContext()._context.scale(t,t)}getWidth(){return this.width}getHeight(){return this.height}setSize(e,t){this.setWidth(e||0),this.setHeight(t||0)}toDataURL(e,t){try{return this._canvas.toDataURL(e,t)}catch{try{return this._canvas.toDataURL()}catch(n){return Wn.Util.error("Unable to get data URL. "+n.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};Ye.Canvas=on;var Aa=class extends on{constructor(e={width:0,height:0,willReadFrequently:!1}){super(e),this.context=new Cl.SceneContext(this,{willReadFrequently:e.willReadFrequently}),this.setSize(e.width,e.height)}};Ye.SceneCanvas=Aa;var Ea=class extends on{constructor(e={width:0,height:0}){super(e),this.hitCanvas=!0,this.context=new Cl.HitContext(this),this.setSize(e.width,e.height)}};Ye.HitCanvas=Ea});var Yn=N(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.DD=void 0;var sn=Y(),bg=xt();It.DD={get isDragging(){let o=!1;return It.DD._dragElements.forEach(e=>{e.dragStatus==="dragging"&&(o=!0)}),o},justDragged:!1,get node(){let o;return It.DD._dragElements.forEach(e=>{o=e.node}),o},_dragElements:new Map,_drag(o){let e=[];It.DD._dragElements.forEach((t,i)=>{let{node:n}=t,a=n.getStage();a.setPointersPositions(o),t.pointerId===void 0&&(t.pointerId=bg.Util._getFirstPointerId(o));let s=a._changedPointerPositions.find(r=>r.id===t.pointerId);if(s){if(t.dragStatus!=="dragging"){let r=n.dragDistance();if(Math.max(Math.abs(s.x-t.startPointerPos.x),Math.abs(s.y-t.startPointerPos.y))<r||(n.startDrag({evt:o}),!n.isDragging()))return}n._setDragPosition(o,t),e.push(n)}}),e.forEach(t=>{t.fire("dragmove",{type:"dragmove",target:t,evt:o},!0)})},_endDragBefore(o){let e=[];It.DD._dragElements.forEach(t=>{let{node:i}=t,n=i.getStage();if(o&&n.setPointersPositions(o),!n._changedPointerPositions.find(r=>r.id===t.pointerId))return;(t.dragStatus==="dragging"||t.dragStatus==="stopped")&&(It.DD.justDragged=!0,sn.Konva._mouseListenClick=!1,sn.Konva._touchListenClick=!1,sn.Konva._pointerListenClick=!1,t.dragStatus="stopped");let s=t.node.getLayer()||t.node instanceof sn.Konva.Stage&&t.node;s&&e.indexOf(s)===-1&&e.push(s)}),e.forEach(t=>{t.draw()})},_endDragAfter(o){It.DD._dragElements.forEach((e,t)=>{e.dragStatus==="stopped"&&e.node.fire("dragend",{type:"dragend",target:e.node,evt:o},!0),e.dragStatus!=="dragging"&&It.DD._dragElements.delete(t)})}};sn.Konva.isBrowser&&(window.addEventListener("mouseup",It.DD._endDragBefore,!0),window.addEventListener("touchend",It.DD._endDragBefore,!0),window.addEventListener("touchcancel",It.DD._endDragBefore,!0),window.addEventListener("mousemove",It.DD._drag),window.addEventListener("touchmove",It.DD._drag),window.addEventListener("mouseup",It.DD._endDragAfter,!1),window.addEventListener("touchend",It.DD._endDragAfter,!1),window.addEventListener("touchcancel",It.DD._endDragAfter,!1))});var Z=N(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.RGBComponent=Cg;Kt.alphaComponent=xg;Kt.getNumberValidator=vg;Kt.getNumberOrArrayOfNumbersValidator=yg;Kt.getNumberOrAutoValidator=wg;Kt.getStringValidator=Mg;Kt.getStringOrGradientValidator=Pg;Kt.getFunctionValidator=Og;Kt.getNumberArrayValidator=kg;Kt.getBooleanValidator=Sg;Kt.getComponentValidator=Tg;var ke=Y(),vt=xt();function Se(o){return vt.Util._isString(o)?'"'+o+'"':Object.prototype.toString.call(o)==="[object Number]"||vt.Util._isBoolean(o)?o:Object.prototype.toString.call(o)}function Cg(o){return o>255?255:o<0?0:Math.round(o)}function xg(o){return o>1?1:o<1e-4?1e-4:o}function vg(){if(ke.Konva.isUnminified)return function(o,e){return vt.Util._isNumber(o)||vt.Util.warn(Se(o)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),o}}function yg(o){if(ke.Konva.isUnminified)return function(e,t){let i=vt.Util._isNumber(e),n=vt.Util._isArray(e)&&e.length==o;return!i&&!n&&vt.Util.warn(Se(e)+' is a not valid value for "'+t+'" attribute. The value should be a number or Array<number>('+o+")"),e}}function wg(){if(ke.Konva.isUnminified)return function(o,e){return vt.Util._isNumber(o)||o==="auto"||vt.Util.warn(Se(o)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),o}}function Mg(){if(ke.Konva.isUnminified)return function(o,e){return vt.Util._isString(o)||vt.Util.warn(Se(o)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),o}}function Pg(){if(ke.Konva.isUnminified)return function(o,e){let t=vt.Util._isString(o),i=Object.prototype.toString.call(o)==="[object CanvasGradient]"||o&&o.addColorStop;return t||i||vt.Util.warn(Se(o)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),o}}function Og(){if(ke.Konva.isUnminified)return function(o,e){return vt.Util._isFunction(o)||vt.Util.warn(Se(o)+' is a not valid value for "'+e+'" attribute. The value should be a function.'),o}}function kg(){if(ke.Konva.isUnminified)return function(o,e){let t=Int8Array?Object.getPrototypeOf(Int8Array):null;return t&&o instanceof t||(vt.Util._isArray(o)?o.forEach(function(i){vt.Util._isNumber(i)||vt.Util.warn('"'+e+'" attribute has non numeric element '+i+". Make sure that all elements are numbers.")}):vt.Util.warn(Se(o)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),o}}function Sg(){if(ke.Konva.isUnminified)return function(o,e){return o===!0||o===!1||vt.Util.warn(Se(o)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),o}}function Tg(o){if(ke.Konva.isUnminified)return function(e,t){return e==null||vt.Util.isObject(e)||vt.Util.warn(Se(e)+' is a not valid value for "'+t+'" attribute. The value should be an object with properties '+o),e}}});var K=N(ce=>{"use strict";Object.defineProperty(ce,"__esModule",{value:!0});ce.Factory=void 0;var Qt=xt(),Ig=Z(),rn="get",ln="set";ce.Factory={addGetterSetter(o,e,t,i,n){ce.Factory.addGetter(o,e,t),ce.Factory.addSetter(o,e,i,n),ce.Factory.addOverloadedGetterSetter(o,e)},addGetter(o,e,t){let i=rn+Qt.Util._capitalize(e);o.prototype[i]=o.prototype[i]||function(){let n=this.attrs[e];return n===void 0?t:n}},addSetter(o,e,t,i){let n=ln+Qt.Util._capitalize(e);o.prototype[n]||ce.Factory.overWriteSetter(o,e,t,i)},overWriteSetter(o,e,t,i){let n=ln+Qt.Util._capitalize(e);o.prototype[n]=function(a){return t&&a!==void 0&&a!==null&&(a=t.call(this,a,e)),this._setAttr(e,a),i&&i.call(this),this}},addComponentsGetterSetter(o,e,t,i,n){let a=t.length,s=Qt.Util._capitalize,r=rn+s(e),l=ln+s(e);o.prototype[r]=function(){let d={};for(let h=0;h<a;h++){let m=t[h];d[m]=this.getAttr(e+s(m))}return d};let c=(0,Ig.getComponentValidator)(t);o.prototype[l]=function(d){let h=this.attrs[e];i&&(d=i.call(this,d,e)),c&&c.call(this,d,e);for(let m in d)d.hasOwnProperty(m)&&this._setAttr(e+s(m),d[m]);return d||t.forEach(m=>{this._setAttr(e+s(m),void 0)}),this._fireChangeEvent(e,h,d),n&&n.call(this),this},ce.Factory.addOverloadedGetterSetter(o,e)},addOverloadedGetterSetter(o,e){let t=Qt.Util._capitalize(e),i=ln+t,n=rn+t;o.prototype[e]=function(){return arguments.length?(this[i](arguments[0]),this):this[n]()}},addDeprecatedGetterSetter(o,e,t,i){Qt.Util.error("Adding deprecated "+e);let n=rn+Qt.Util._capitalize(e),a=e+" property is deprecated and will be removed soon. Look at Konva change log for more information.";o.prototype[n]=function(){Qt.Util.error(a);let s=this.attrs[e];return s===void 0?t:s},ce.Factory.addSetter(o,e,i,function(){Qt.Util.error(a)}),ce.Factory.addOverloadedGetterSetter(o,e)},backCompat(o,e){Qt.Util.each(e,function(t,i){let n=o.prototype[i],a=rn+Qt.Util._capitalize(t),s=ln+Qt.Util._capitalize(t);function r(){n.apply(this,arguments),Qt.Util.error('"'+t+'" method is deprecated and will be removed soon. Use ""'+i+'" instead.')}o.prototype[t]=r,o.prototype[a]=r,o.prototype[s]=r})},afterSetFilter(){this._filterUpToDate=!1}}});var yt=N(Qn=>{"use strict";Object.defineProperty(Qn,"__esModule",{value:!0});Qn.Node=void 0;var Fi=an(),ne=Yn(),cn=K(),Xe=Y(),it=xt(),Mt=Z(),$n="absoluteOpacity",Xn="allEventListeners",Te="absoluteTransform",vl="absoluteScale",oi="canvas",Ag="Change",Eg="children",Lg="konva",La="listening",Dg="mouseenter",Fg="mouseleave",Rg="pointerenter",Ng="pointerleave",Bg="touchenter",Vg="touchleave",yl="set",wl="Shape",Kn=" ",Ml="stage",$e="transform",zg="Stage",Da="visible",Gg=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(Kn),Ug=1,U=class o{constructor(e){this._id=Ug++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(e),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(e){(e===$e||e===Te)&&this._cache.get(e)?this._cache.get(e).dirty=!0:e?this._cache.delete(e):this._cache.clear()}_getCache(e,t){let i=this._cache.get(e);return(i===void 0||(e===$e||e===Te)&&i.dirty===!0)&&(i=t.call(this),this._cache.set(e,i)),i}_calculate(e,t,i){if(!this._attachedDepsListeners.get(e)){let n=t.map(a=>a+"Change.konva").join(Kn);this.on(n,()=>{this._clearCache(e)}),this._attachedDepsListeners.set(e,!0)}return this._getCache(e,i)}_getCanvasCache(){return this._cache.get(oi)}_clearSelfAndDescendantCache(e){this._clearCache(e),e===Te&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(oi)){let{scene:e,filter:t,hit:i,buffer:n}=this._cache.get(oi);it.Util.releaseCanvas(e,t,i,n),this._cache.delete(oi)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(e){let t=e||{},i={};(t.x===void 0||t.y===void 0||t.width===void 0||t.height===void 0)&&(i=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let n=Math.ceil(t.width||i.width),a=Math.ceil(t.height||i.height),s=t.pixelRatio,r=t.x===void 0?Math.floor(i.x):t.x,l=t.y===void 0?Math.floor(i.y):t.y,c=t.offset||0,d=t.drawBorder||!1,h=t.hitCanvasPixelRatio||1;if(!n||!a){it.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}let m=Math.abs(Math.round(i.x)-r)>.5?1:0,p=Math.abs(Math.round(i.y)-l)>.5?1:0;n+=c*2+m,a+=c*2+p,r-=c,l-=c;let f=new Fi.SceneCanvas({pixelRatio:s,width:n,height:a}),b=new Fi.SceneCanvas({pixelRatio:s,width:0,height:0,willReadFrequently:!0}),C=new Fi.HitCanvas({pixelRatio:h,width:n,height:a}),M=f.getContext(),w=C.getContext(),P=new Fi.SceneCanvas({width:f.width/f.pixelRatio+Math.abs(r),height:f.height/f.pixelRatio+Math.abs(l),pixelRatio:f.pixelRatio}),O=P.getContext();return C.isCache=!0,f.isCache=!0,this._cache.delete(oi),this._filterUpToDate=!1,t.imageSmoothingEnabled===!1&&(f.getContext()._context.imageSmoothingEnabled=!1,b.getContext()._context.imageSmoothingEnabled=!1),M.save(),w.save(),O.save(),M.translate(-r,-l),w.translate(-r,-l),O.translate(-r,-l),P.x=r,P.y=l,this._isUnderCache=!0,this._clearSelfAndDescendantCache($n),this._clearSelfAndDescendantCache(vl),this.drawScene(f,this,P),this.drawHit(C,this),this._isUnderCache=!1,M.restore(),w.restore(),d&&(M.save(),M.beginPath(),M.rect(0,0,n,a),M.closePath(),M.setAttr("strokeStyle","red"),M.setAttr("lineWidth",5),M.stroke(),M.restore()),this._cache.set(oi,{scene:f,filter:b,hit:C,buffer:P,x:r,y:l}),this._requestDraw(),this}isCached(){return this._cache.has(oi)}getClientRect(e){throw new Error('abstract "getClientRect" method call')}_transformedRect(e,t){let i=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}],n=1/0,a=1/0,s=-1/0,r=-1/0,l=this.getAbsoluteTransform(t);return i.forEach(function(c){let d=l.point(c);n===void 0&&(n=s=d.x,a=r=d.y),n=Math.min(n,d.x),a=Math.min(a,d.y),s=Math.max(s,d.x),r=Math.max(r,d.y)}),{x:n,y:a,width:s-n,height:r-a}}_drawCachedSceneCanvas(e){e.save(),e._applyOpacity(this),e._applyGlobalCompositeOperation(this);let t=this._getCanvasCache();e.translate(t.x,t.y);let i=this._getCachedSceneCanvas(),n=i.pixelRatio;e.drawImage(i._canvas,0,0,i.width/n,i.height/n),e.restore()}_drawCachedHitCanvas(e){let t=this._getCanvasCache(),i=t.hit;e.save(),e.translate(t.x,t.y),e.drawImage(i._canvas,0,0,i.width/i.pixelRatio,i.height/i.pixelRatio),e.restore()}_getCachedSceneCanvas(){let e=this.filters(),t=this._getCanvasCache(),i=t.scene,n=t.filter,a=n.getContext(),s,r,l,c;if(e){if(!this._filterUpToDate){let d=i.pixelRatio;n.setSize(i.width/i.pixelRatio,i.height/i.pixelRatio);try{for(s=e.length,a.clear(),a.drawImage(i._canvas,0,0,i.getWidth()/d,i.getHeight()/d),r=a.getImageData(0,0,n.getWidth(),n.getHeight()),l=0;l<s;l++){if(c=e[l],typeof c!="function"){it.Util.error("Filter should be type of function, but got "+typeof c+" instead. Please check correct filters");continue}c.call(this,r),a.putImageData(r,0,0)}}catch(h){it.Util.error("Unable to apply filter. "+h.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return n}return i}on(e,t){if(this._cache&&this._cache.delete(Xn),arguments.length===3)return this._delegate.apply(this,arguments);let i=e.split(Kn);for(let n=0;n<i.length;n++){let s=i[n].split("."),r=s[0],l=s[1]||"";this.eventListeners[r]||(this.eventListeners[r]=[]),this.eventListeners[r].push({name:l,handler:t})}return this}off(e,t){let i=(e||"").split(Kn),n=i.length,a,s,r,l,c,d;if(this._cache&&this._cache.delete(Xn),!e)for(s in this.eventListeners)this._off(s);for(a=0;a<n;a++)if(r=i[a],l=r.split("."),c=l[0],d=l[1],c)this.eventListeners[c]&&this._off(c,d,t);else for(s in this.eventListeners)this._off(s,d,t);return this}dispatchEvent(e){let t={target:this,type:e.type,evt:e};return this.fire(e.type,t),this}addEventListener(e,t){return this.on(e,function(i){t.call(this,i.evt)}),this}removeEventListener(e){return this.off(e),this}_delegate(e,t,i){let n=this;this.on(e,function(a){let s=a.target.findAncestors(t,!0,n);for(let r=0;r<s.length;r++)a=it.Util.cloneObject(a),a.currentTarget=s[r],i.call(s[r],a)})}remove(){return this.isDragging()&&this.stopDrag(),ne.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(Te),this._clearSelfAndDescendantCache($n),this._clearSelfAndDescendantCache(vl),this._clearSelfAndDescendantCache(Ml),this._clearSelfAndDescendantCache(Da),this._clearSelfAndDescendantCache(La)}_remove(){this._clearCaches();let e=this.getParent();e&&e.children&&(e.children.splice(this.index,1),e._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(e){let t="get"+it.Util._capitalize(e);return it.Util._isFunction(this[t])?this[t]():this.attrs[e]}getAncestors(){let e=this.getParent(),t=[];for(;e;)t.push(e),e=e.getParent();return t}getAttrs(){return this.attrs||{}}setAttrs(e){return this._batchTransformChanges(()=>{let t,i;if(!e)return this;for(t in e)t!==Eg&&(i=yl+it.Util._capitalize(t),it.Util._isFunction(this[i])?this[i](e[t]):this._setAttr(t,e[t]))}),this}isListening(){return this._getCache(La,this._isListening)}_isListening(e){if(!this.listening())return!1;let i=this.getParent();return i&&i!==e&&this!==e?i._isListening(e):!0}isVisible(){return this._getCache(Da,this._isVisible)}_isVisible(e){if(!this.visible())return!1;let i=this.getParent();return i&&i!==e&&this!==e?i._isVisible(e):!0}shouldDrawHit(e,t=!1){if(e)return this._isVisible(e)&&this._isListening(e);let i=this.getLayer(),n=!1;ne.DD._dragElements.forEach(s=>{s.dragStatus==="dragging"&&(s.node.nodeType==="Stage"||s.node.getLayer()===i)&&(n=!0)});let a=!t&&!Xe.Konva.hitOnDragEnabled&&(n||Xe.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!a}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let e=this.getDepth(),t=this,i=0,n,a,s,r;function l(d){for(n=[],a=d.length,s=0;s<a;s++)r=d[s],i++,r.nodeType!==wl&&(n=n.concat(r.getChildren().slice())),r._id===t._id&&(s=a);n.length>0&&n[0].getDepth()<=e&&l(n)}let c=this.getStage();return t.nodeType!==zg&&c&&l(c.getChildren()),i}getDepth(){let e=0,t=this.parent;for(;t;)e++,t=t.parent;return e}_batchTransformChanges(e){this._batchingTransformChange=!0,e(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache($e),this._clearSelfAndDescendantCache(Te)),this._needClearTransformCache=!1}setPosition(e){return this._batchTransformChanges(()=>{this.x(e.x),this.y(e.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){let e=this.getStage();if(!e)return null;let t=e.getPointerPosition();if(!t)return null;let i=this.getAbsoluteTransform().copy();return i.invert(),i.point(t)}getAbsolutePosition(e){let t=!1,i=this.parent;for(;i;){if(i.isCached()){t=!0;break}i=i.parent}t&&!e&&(e=!0);let n=this.getAbsoluteTransform(e).getMatrix(),a=new it.Transform,s=this.offset();return a.m=n.slice(),a.translate(s.x,s.y),a.getTranslation()}setAbsolutePosition(e){let s=this._clearTransform(),{x:t,y:i}=s,n=ks(s,["x","y"]);this.attrs.x=t,this.attrs.y=i,this._clearCache($e);let a=this._getAbsoluteTransform().copy();return a.invert(),a.translate(e.x,e.y),e={x:this.attrs.x+a.getTranslation().x,y:this.attrs.y+a.getTranslation().y},this._setTransform(n),this.setPosition({x:e.x,y:e.y}),this._clearCache($e),this._clearSelfAndDescendantCache(Te),this}_setTransform(e){let t;for(t in e)this.attrs[t]=e[t]}_clearTransform(){let e={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,e}move(e){let t=e.x,i=e.y,n=this.x(),a=this.y();return t!==void 0&&(n+=t),i!==void 0&&(a+=i),this.setPosition({x:n,y:a}),this}_eachAncestorReverse(e,t){let i=[],n=this.getParent(),a,s;if(!(t&&t._id===this._id)){for(i.unshift(this);n&&(!t||n._id!==t._id);)i.unshift(n),n=n.parent;for(a=i.length,s=0;s<a;s++)e(i[s])}}rotate(e){return this.rotation(this.rotation()+e),this}moveToTop(){if(!this.parent)return it.Util.warn("Node has no parent. moveToTop function is ignored."),!1;let e=this.index,t=this.parent.getChildren().length;return e<t-1?(this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return it.Util.warn("Node has no parent. moveUp function is ignored."),!1;let e=this.index,t=this.parent.getChildren().length;return e<t-1?(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return it.Util.warn("Node has no parent. moveDown function is ignored."),!1;let e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return it.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;let e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(e){if(!this.parent)return it.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(e<0||e>=this.parent.children.length)&&it.Util.warn("Unexpected value "+e+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");let t=this.index;return this.parent.children.splice(t,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache($n,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let e=this.opacity(),t=this.getParent();return t&&!t._isUnderCache&&(e*=t.getAbsoluteOpacity()),e}moveTo(e){return this.getParent()!==e&&(this._remove(),e.add(this)),this}toObject(){let e=this.getAttrs(),t,i,n,a,s,r={attrs:{},className:this.getClassName()};for(t in e)i=e[t],s=it.Util.isObject(i)&&!it.Util._isPlainObject(i)&&!it.Util._isArray(i),!s&&(n=typeof this[t]=="function"&&this[t],delete e[t],a=n?n.call(this):null,e[t]=i,a!==i&&(r.attrs[t]=i));return it.Util._prepareToStringify(r)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(e,t,i){let n=[];t&&this._isMatch(e)&&n.push(this);let a=this.parent;for(;a;){if(a===i)return n;a._isMatch(e)&&n.push(a),a=a.parent}return n}isAncestorOf(e){return!1}findAncestor(e,t,i){return this.findAncestors(e,t,i)[0]}_isMatch(e){if(!e)return!1;if(typeof e=="function")return e(this);let t=e.replace(/ /g,"").split(","),i=t.length,n,a;for(n=0;n<i;n++)if(a=t[n],it.Util.isValidSelector(a)||(it.Util.warn('Selector "'+a+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),it.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),it.Util.warn("Konva is awesome, right?")),a.charAt(0)==="#"){if(this.id()===a.slice(1))return!0}else if(a.charAt(0)==="."){if(this.hasName(a.slice(1)))return!0}else if(this.className===a||this.nodeType===a)return!0;return!1}getLayer(){let e=this.getParent();return e?e.getLayer():null}getStage(){return this._getCache(Ml,this._getStage)}_getStage(){let e=this.getParent();return e?e.getStage():null}fire(e,t={},i){return t.target=t.target||this,i?this._fireAndBubble(e,t):this._fire(e,t),this}getAbsoluteTransform(e){return e?this._getAbsoluteTransform(e):this._getCache(Te,this._getAbsoluteTransform)}_getAbsoluteTransform(e){let t;if(e)return t=new it.Transform,this._eachAncestorReverse(function(i){let n=i.transformsEnabled();n==="all"?t.multiply(i.getTransform()):n==="position"&&t.translate(i.x()-i.offsetX(),i.y()-i.offsetY())},e),t;{t=this._cache.get(Te)||new it.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(t):t.reset();let i=this.transformsEnabled();if(i==="all")t.multiply(this.getTransform());else if(i==="position"){let n=this.attrs.x||0,a=this.attrs.y||0,s=this.attrs.offsetX||0,r=this.attrs.offsetY||0;t.translate(n-s,a-r)}return t.dirty=!1,t}}getAbsoluteScale(e){let t=this;for(;t;)t._isUnderCache&&(e=t),t=t.getParent();let n=this.getAbsoluteTransform(e).decompose();return{x:n.scaleX,y:n.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache($e,this._getTransform)}_getTransform(){var e,t;let i=this._cache.get($e)||new it.Transform;i.reset();let n=this.x(),a=this.y(),s=Xe.Konva.getAngle(this.rotation()),r=(e=this.attrs.scaleX)!==null&&e!==void 0?e:1,l=(t=this.attrs.scaleY)!==null&&t!==void 0?t:1,c=this.attrs.skewX||0,d=this.attrs.skewY||0,h=this.attrs.offsetX||0,m=this.attrs.offsetY||0;return(n!==0||a!==0)&&i.translate(n,a),s!==0&&i.rotate(s),(c!==0||d!==0)&&i.skew(c,d),(r!==1||l!==1)&&i.scale(r,l),(h!==0||m!==0)&&i.translate(-1*h,-1*m),i.dirty=!1,i}clone(e){let t=it.Util.cloneObject(this.attrs),i,n,a,s,r;for(i in e)t[i]=e[i];let l=new this.constructor(t);for(i in this.eventListeners)for(n=this.eventListeners[i],a=n.length,s=0;s<a;s++)r=n[s],r.name.indexOf(Lg)<0&&(l.eventListeners[i]||(l.eventListeners[i]=[]),l.eventListeners[i].push(r));return l}_toKonvaCanvas(e){e=e||{};let t=this.getClientRect(),i=this.getStage(),n=e.x!==void 0?e.x:Math.floor(t.x),a=e.y!==void 0?e.y:Math.floor(t.y),s=e.pixelRatio||1,r=new Fi.SceneCanvas({width:e.width||Math.ceil(t.width)||(i?i.width():0),height:e.height||Math.ceil(t.height)||(i?i.height():0),pixelRatio:s}),l=r.getContext(),c=new Fi.SceneCanvas({width:r.width/r.pixelRatio+Math.abs(n),height:r.height/r.pixelRatio+Math.abs(a),pixelRatio:r.pixelRatio});return e.imageSmoothingEnabled===!1&&(l._context.imageSmoothingEnabled=!1),l.save(),(n||a)&&l.translate(-1*n,-1*a),this.drawScene(r,void 0,c),l.restore(),r}toCanvas(e){return this._toKonvaCanvas(e)._canvas}toDataURL(e){e=e||{};let t=e.mimeType||null,i=e.quality||null,n=this._toKonvaCanvas(e).toDataURL(t,i);return e.callback&&e.callback(n),n}toImage(e){return new Promise((t,i)=>{try{let n=e?.callback;n&&delete e.callback,it.Util._urlToImage(this.toDataURL(e),function(a){t(a),n?.(a)})}catch(n){i(n)}})}toBlob(e){return new Promise((t,i)=>{try{let n=e?.callback;n&&delete e.callback,this.toCanvas(e).toBlob(a=>{t(a),n?.(a)},e?.mimeType,e?.quality)}catch(n){i(n)}})}setSize(e){return this.width(e.width),this.height(e.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Xe.Konva.dragDistance}_off(e,t,i){let n=this.eventListeners[e],a,s,r;for(a=0;a<n.length;a++)if(s=n[a].name,r=n[a].handler,(s!=="konva"||t==="konva")&&(!t||s===t)&&(!i||i===r)){if(n.splice(a,1),n.length===0){delete this.eventListeners[e];break}a--}}_fireChangeEvent(e,t,i){this._fire(e+Ag,{oldVal:t,newVal:i})}addName(e){if(!this.hasName(e)){let t=this.name(),i=t?t+" "+e:e;this.name(i)}return this}hasName(e){if(!e)return!1;let t=this.name();return t?(t||"").split(/\s/g).indexOf(e)!==-1:!1}removeName(e){let t=(this.name()||"").split(/\s/g),i=t.indexOf(e);return i!==-1&&(t.splice(i,1),this.name(t.join(" "))),this}setAttr(e,t){let i=this[yl+it.Util._capitalize(e)];return it.Util._isFunction(i)?i.call(this,t):this._setAttr(e,t),this}_requestDraw(){if(Xe.Konva.autoDrawEnabled){let e=this.getLayer()||this.getStage();e?.batchDraw()}}_setAttr(e,t){let i=this.attrs[e];i===t&&!it.Util.isObject(t)||(t==null?delete this.attrs[e]:this.attrs[e]=t,this._shouldFireChangeEvents&&this._fireChangeEvent(e,i,t),this._requestDraw())}_setComponentAttr(e,t,i){let n;i!==void 0&&(n=this.attrs[e],n||(this.attrs[e]=this.getAttr(e)),this.attrs[e][t]=i,this._fireChangeEvent(e,n,i))}_fireAndBubble(e,t,i){t&&this.nodeType===wl&&(t.target=this);let n=[Dg,Fg,Rg,Ng,Bg,Vg];if(!(n.indexOf(e)!==-1&&(i&&(this===i||this.isAncestorOf&&this.isAncestorOf(i))||this.nodeType==="Stage"&&!i))){this._fire(e,t);let s=n.indexOf(e)!==-1&&i&&i.isAncestorOf&&i.isAncestorOf(this)&&!i.isAncestorOf(this.parent);(t&&!t.cancelBubble||!t)&&this.parent&&this.parent.isListening()&&!s&&(i&&i.parent?this._fireAndBubble.call(this.parent,e,t,i):this._fireAndBubble.call(this.parent,e,t))}}_getProtoListeners(e){var t,i,n;let a=(t=this._cache.get(Xn))!==null&&t!==void 0?t:{},s=a?.[e];if(s===void 0){s=[];let r=Object.getPrototypeOf(this);for(;r;){let l=(n=(i=r.eventListeners)===null||i===void 0?void 0:i[e])!==null&&n!==void 0?n:[];s.push(...l),r=Object.getPrototypeOf(r)}a[e]=s,this._cache.set(Xn,a)}return s}_fire(e,t){t=t||{},t.currentTarget=this,t.type=e;let i=this._getProtoListeners(e);if(i)for(let a=0;a<i.length;a++)i[a].handler.call(this,t);let n=this.eventListeners[e];if(n)for(let a=0;a<n.length;a++)n[a].handler.call(this,t)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(e){let t=e?e.pointerId:void 0,i=this.getStage(),n=this.getAbsolutePosition();if(!i)return;let a=i._getPointerById(t)||i._changedPointerPositions[0]||n;ne.DD._dragElements.set(this._id,{node:this,startPointerPos:a,offset:{x:a.x-n.x,y:a.y-n.y},dragStatus:"ready",pointerId:t})}startDrag(e,t=!0){ne.DD._dragElements.has(this._id)||this._createDragElement(e);let i=ne.DD._dragElements.get(this._id);i.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:e&&e.evt},t)}_setDragPosition(e,t){let i=this.getStage()._getPointerById(t.pointerId);if(!i)return;let n={x:i.x-t.offset.x,y:i.y-t.offset.y},a=this.dragBoundFunc();if(a!==void 0){let s=a.call(this,n,e);s?n=s:it.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==n.x||this._lastPos.y!==n.y)&&(this.setAbsolutePosition(n),this._requestDraw()),this._lastPos=n}stopDrag(e){let t=ne.DD._dragElements.get(this._id);t&&(t.dragStatus="stopped"),ne.DD._endDragBefore(e),ne.DD._endDragAfter(e)}setDraggable(e){this._setAttr("draggable",e),this._dragChange()}isDragging(){let e=ne.DD._dragElements.get(this._id);return e?e.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(e){if(!(!(e.evt.button!==void 0)||Xe.Konva.dragButtons.indexOf(e.evt.button)>=0)||this.isDragging())return;let n=!1;ne.DD._dragElements.forEach(a=>{this.isAncestorOf(a.node)&&(n=!0)}),n||this._createDragElement(e)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;let t=ne.DD._dragElements.get(this._id),i=t&&t.dragStatus==="dragging",n=t&&t.dragStatus==="ready";i?this.stopDrag():n&&ne.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(e={x:0,y:0}){let t=this.getStage();if(!t)return!1;let i={x:-e.x,y:-e.y,width:t.width()+2*e.x,height:t.height()+2*e.y};return it.Util.haveIntersection(i,this.getClientRect())}static create(e,t){return it.Util._isString(e)&&(e=JSON.parse(e)),this._createNode(e,t)}static _createNode(e,t){let i=o.prototype.getClassName.call(e),n=e.children,a,s,r;t&&(e.attrs.container=t),Xe.Konva[i]||(it.Util.warn('Can not find a node with class name "'+i+'". Fallback to "Shape".'),i="Shape");let l=Xe.Konva[i];if(a=new l(e.attrs),n)for(s=n.length,r=0;r<s;r++)a.add(o._createNode(n[r]));return a}};Qn.Node=U;U.prototype.nodeType="Node";U.prototype._attrsAffectingSize=[];U.prototype.eventListeners={};U.prototype.on.call(U.prototype,Gg,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache($e),this._clearSelfAndDescendantCache(Te)});U.prototype.on.call(U.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(Da)});U.prototype.on.call(U.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(La)});U.prototype.on.call(U.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache($n)});var mt=cn.Factory.addGetterSetter;mt(U,"zIndex");mt(U,"absolutePosition");mt(U,"position");mt(U,"x",0,(0,Mt.getNumberValidator)());mt(U,"y",0,(0,Mt.getNumberValidator)());mt(U,"globalCompositeOperation","source-over",(0,Mt.getStringValidator)());mt(U,"opacity",1,(0,Mt.getNumberValidator)());mt(U,"name","",(0,Mt.getStringValidator)());mt(U,"id","",(0,Mt.getStringValidator)());mt(U,"rotation",0,(0,Mt.getNumberValidator)());cn.Factory.addComponentsGetterSetter(U,"scale",["x","y"]);mt(U,"scaleX",1,(0,Mt.getNumberValidator)());mt(U,"scaleY",1,(0,Mt.getNumberValidator)());cn.Factory.addComponentsGetterSetter(U,"skew",["x","y"]);mt(U,"skewX",0,(0,Mt.getNumberValidator)());mt(U,"skewY",0,(0,Mt.getNumberValidator)());cn.Factory.addComponentsGetterSetter(U,"offset",["x","y"]);mt(U,"offsetX",0,(0,Mt.getNumberValidator)());mt(U,"offsetY",0,(0,Mt.getNumberValidator)());mt(U,"dragDistance",void 0,(0,Mt.getNumberValidator)());mt(U,"width",0,(0,Mt.getNumberValidator)());mt(U,"height",0,(0,Mt.getNumberValidator)());mt(U,"listening",!0,(0,Mt.getBooleanValidator)());mt(U,"preventDefault",!0,(0,Mt.getBooleanValidator)());mt(U,"filters",void 0,function(o){return this._filterUpToDate=!1,o});mt(U,"visible",!0,(0,Mt.getBooleanValidator)());mt(U,"transformsEnabled","all",(0,Mt.getStringValidator)());mt(U,"size");mt(U,"dragBoundFunc");mt(U,"draggable",!1,(0,Mt.getBooleanValidator)());cn.Factory.backCompat(U,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"})});var dn=N(Jn=>{"use strict";Object.defineProperty(Jn,"__esModule",{value:!0});Jn.Container=void 0;var Ri=K(),Fa=yt(),Zn=Z(),Ie=class extends Fa.Node{constructor(){super(...arguments),this.children=[]}getChildren(e){let t=this.children||[];return e?t.filter(e):t}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.destroy()}),this.children=[],this._requestDraw(),this}add(...e){if(e.length===0)return this;if(e.length>1){for(let i=0;i<e.length;i++)this.add(e[i]);return this}let t=e[0];return t.getParent()?(t.moveTo(this),this):(this._validateAdd(t),t.index=this.getChildren().length,t.parent=this,t._clearCaches(),this.getChildren().push(t),this._fire("add",{child:t}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(e){return this._generalFind(e,!1)}findOne(e){let t=this._generalFind(e,!0);return t.length>0?t[0]:void 0}_generalFind(e,t){let i=[];return this._descendants(n=>{let a=n._isMatch(e);return a&&i.push(n),!!(a&&t)}),i}_descendants(e){let t=!1,i=this.getChildren();for(let n of i){if(t=e(n),t)return!0;if(n.hasChildren()&&(t=n._descendants(e),t))return!0}return!1}toObject(){let e=Fa.Node.prototype.toObject.call(this);return e.children=[],this.getChildren().forEach(t=>{e.children.push(t.toObject())}),e}isAncestorOf(e){let t=e.getParent();for(;t;){if(t._id===this._id)return!0;t=t.getParent()}return!1}clone(e){let t=Fa.Node.prototype.clone.call(this,e);return this.getChildren().forEach(function(i){t.add(i.clone())}),t}getAllIntersections(e){let t=[];return this.find("Shape").forEach(i=>{i.isVisible()&&i.intersects(e)&&t.push(i)}),t}_clearSelfAndDescendantCache(e){var t;super._clearSelfAndDescendantCache(e),!this.isCached()&&((t=this.children)===null||t===void 0||t.forEach(function(i){i._clearSelfAndDescendantCache(e)}))}_setChildrenIndices(){var e;(e=this.children)===null||e===void 0||e.forEach(function(t,i){t.index=i}),this._requestDraw()}drawScene(e,t,i){let n=this.getLayer(),a=e||n&&n.getCanvas(),s=a&&a.getContext(),r=this._getCanvasCache(),l=r&&r.scene,c=a&&a.isCache;if(!this.isVisible()&&!c)return this;if(l){s.save();let d=this.getAbsoluteTransform(t).getMatrix();s.transform(d[0],d[1],d[2],d[3],d[4],d[5]),this._drawCachedSceneCanvas(s),s.restore()}else this._drawChildren("drawScene",a,t,i);return this}drawHit(e,t){if(!this.shouldDrawHit(t))return this;let i=this.getLayer(),n=e||i&&i.hitCanvas,a=n&&n.getContext(),s=this._getCanvasCache();if(s&&s.hit){a.save();let l=this.getAbsoluteTransform(t).getMatrix();a.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedHitCanvas(a),a.restore()}else this._drawChildren("drawHit",n,t);return this}_drawChildren(e,t,i,n){var a;let s=t&&t.getContext(),r=this.clipWidth(),l=this.clipHeight(),c=this.clipFunc(),d=typeof r=="number"&&typeof l=="number"||c,h=i===this;if(d){s.save();let p=this.getAbsoluteTransform(i),f=p.getMatrix();s.transform(f[0],f[1],f[2],f[3],f[4],f[5]),s.beginPath();let b;if(c)b=c.call(this,s,this);else{let C=this.clipX(),M=this.clipY();s.rect(C||0,M||0,r,l)}s.clip.apply(s,b),f=p.copy().invert().getMatrix(),s.transform(f[0],f[1],f[2],f[3],f[4],f[5])}let m=!h&&this.globalCompositeOperation()!=="source-over"&&e==="drawScene";m&&(s.save(),s._applyGlobalCompositeOperation(this)),(a=this.children)===null||a===void 0||a.forEach(function(p){p[e](t,i,n)}),m&&s.restore(),d&&s.restore()}getClientRect(e={}){var t;let i=e.skipTransform,n=e.relativeTo,a,s,r,l,c={x:1/0,y:1/0,width:0,height:0},d=this;(t=this.children)===null||t===void 0||t.forEach(function(p){if(!p.visible())return;let f=p.getClientRect({relativeTo:d,skipShadow:e.skipShadow,skipStroke:e.skipStroke});f.width===0&&f.height===0||(a===void 0?(a=f.x,s=f.y,r=f.x+f.width,l=f.y+f.height):(a=Math.min(a,f.x),s=Math.min(s,f.y),r=Math.max(r,f.x+f.width),l=Math.max(l,f.y+f.height)))});let h=this.find("Shape"),m=!1;for(let p=0;p<h.length;p++)if(h[p]._isVisible(this)){m=!0;break}return m&&a!==void 0?c={x:a,y:s,width:r-a,height:l-s}:c={x:0,y:0,width:0,height:0},i?c:this._transformedRect(c,n)}};Jn.Container=Ie;Ri.Factory.addComponentsGetterSetter(Ie,"clip",["x","y","width","height"]);Ri.Factory.addGetterSetter(Ie,"clipX",void 0,(0,Zn.getNumberValidator)());Ri.Factory.addGetterSetter(Ie,"clipY",void 0,(0,Zn.getNumberValidator)());Ri.Factory.addGetterSetter(Ie,"clipWidth",void 0,(0,Zn.getNumberValidator)());Ri.Factory.addGetterSetter(Ie,"clipHeight",void 0,(0,Zn.getNumberValidator)());Ri.Factory.addGetterSetter(Ie,"clipFunc")});var Na=N(ai=>{"use strict";Object.defineProperty(ai,"__esModule",{value:!0});ai.getCapturedShape=Hg;ai.createEvent=Ra;ai.hasPointerCapture=qg;ai.setPointerCapture=Wg;ai.releaseCapture=Ol;var jg=Y(),hn=new Map,Pl=jg.Konva._global.PointerEvent!==void 0;function Hg(o){return hn.get(o)}function Ra(o){return{evt:o,pointerId:o.pointerId}}function qg(o,e){return hn.get(o)===e}function Wg(o,e){Ol(o),e.getStage()&&(hn.set(o,e),Pl&&e._fire("gotpointercapture",Ra(new PointerEvent("gotpointercapture"))))}function Ol(o,e){let t=hn.get(o);if(!t)return;let i=t.getStage();i&&i.content,hn.delete(o),Pl&&t._fire("lostpointercapture",Ra(new PointerEvent("lostpointercapture")))}});var zl=N(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.Stage=Ce.stages=void 0;var be=xt(),Yg=K(),kl=dn(),Pt=Y(),Ba=an(),Va=Yn(),Xg=Y(),Ae=Na(),$g="Stage",Kg="string",Sl="px",Qg="mouseout",Il="mouseleave",Al="mouseover",El="mouseenter",Ll="mousemove",Dl="mousedown",Fl="mouseup",mn="pointermove",gn="pointerdown",Bi="pointerup",pn="pointercancel",Zg="lostpointercapture",to="pointerout",un="pointerleave",eo="pointerover",io="pointerenter",Ga="contextmenu",Rl="touchstart",Nl="touchend",Bl="touchmove",Vl="touchcancel",Ua="wheel",Jg=5,tp=[[El,"_pointerenter"],[Dl,"_pointerdown"],[Ll,"_pointermove"],[Fl,"_pointerup"],[Il,"_pointerleave"],[Rl,"_pointerdown"],[Bl,"_pointermove"],[Nl,"_pointerup"],[Vl,"_pointercancel"],[Al,"_pointerover"],[Ua,"_wheel"],[Ga,"_contextmenu"],[gn,"_pointerdown"],[mn,"_pointermove"],[Bi,"_pointerup"],[pn,"_pointercancel"],[un,"_pointerleave"],[Zg,"_lostpointercapture"]],za={mouse:{[to]:Qg,[un]:Il,[eo]:Al,[io]:El,[mn]:Ll,[gn]:Dl,[Bi]:Fl,[pn]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[to]:"touchout",[un]:"touchleave",[eo]:"touchover",[io]:"touchenter",[mn]:Bl,[gn]:Rl,[Bi]:Nl,[pn]:Vl,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[to]:to,[un]:un,[eo]:eo,[io]:io,[mn]:mn,[gn]:gn,[Bi]:Bi,[pn]:pn,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},fn=o=>o.indexOf("pointer")>=0?"pointer":o.indexOf("touch")>=0?"touch":"mouse",Ni=o=>{let e=fn(o);if(e==="pointer")return Pt.Konva.pointerEventsEnabled&&za.pointer;if(e==="touch")return za.touch;if(e==="mouse")return za.mouse};function Tl(o={}){return(o.clipFunc||o.clipWidth||o.clipHeight)&&be.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),o}var ep="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";Ce.stages=[];var Vi=class extends kl.Container{constructor(e){super(Tl(e)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),Ce.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{Tl(this.attrs)}),this._checkVisibility()}_validateAdd(e){let t=e.getType()==="Layer",i=e.getType()==="FastLayer";t||i||be.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;let e=this.visible()?"":"none";this.content.style.display=e}setContainer(e){if(typeof e===Kg){let t;if(e.charAt(0)==="."){let i=e.slice(1);e=document.getElementsByClassName(i)[0]}else e.charAt(0)!=="#"?t=e:t=e.slice(1),e=document.getElementById(t);if(!e)throw"Can not find container in document with id "+t}return this._setAttr("container",e),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),e.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){let e=this.children,t=e.length;for(let i=0;i<t;i++)e[i].clear();return this}clone(e){return e||(e={}),e.container=typeof document<"u"&&document.createElement("div"),kl.Container.prototype.clone.call(this,e)}destroy(){super.destroy();let e=this.content;e&&be.Util._isInDocument(e)&&this.container().removeChild(e);let t=Ce.stages.indexOf(this);return t>-1&&Ce.stages.splice(t,1),be.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){let e=this._pointerPositions[0]||this._changedPointerPositions[0];return e?{x:e.x,y:e.y}:(be.Util.warn(ep),null)}_getPointerById(e){return this._pointerPositions.find(t=>t.id===e)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(e){e=e||{},e.x=e.x||0,e.y=e.y||0,e.width=e.width||this.width(),e.height=e.height||this.height();let t=new Ba.SceneCanvas({width:e.width,height:e.height,pixelRatio:e.pixelRatio||1}),i=t.getContext()._context,n=this.children;return(e.x||e.y)&&i.translate(-1*e.x,-1*e.y),n.forEach(function(a){if(!a.isVisible())return;let s=a._toKonvaCanvas(e);i.drawImage(s._canvas,e.x,e.y,s.getWidth()/s.getPixelRatio(),s.getHeight()/s.getPixelRatio())}),t}getIntersection(e){if(!e)return null;let t=this.children,i=t.length,n=i-1;for(let a=n;a>=0;a--){let s=t[a].getIntersection(e);if(s)return s}return null}_resizeDOM(){let e=this.width(),t=this.height();this.content&&(this.content.style.width=e+Sl,this.content.style.height=t+Sl),this.bufferCanvas.setSize(e,t),this.bufferHitCanvas.setSize(e,t),this.children.forEach(i=>{i.setSize({width:e,height:t}),i.draw()})}add(e,...t){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}super.add(e);let i=this.children.length;return i>Jg&&be.Util.warn("The stage has "+i+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),e.setSize({width:this.width(),height:this.height()}),e.draw(),Pt.Konva.isBrowser&&this.content.appendChild(e.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(e){return Ae.hasPointerCapture(e,this)}setPointerCapture(e){Ae.setPointerCapture(e,this)}releaseCapture(e){Ae.releaseCapture(e,this)}getLayers(){return this.children}_bindContentEvents(){Pt.Konva.isBrowser&&tp.forEach(([e,t])=>{this.content.addEventListener(e,i=>{this[t](i)},{passive:!1})})}_pointerenter(e){this.setPointersPositions(e);let t=Ni(e.type);t&&this._fire(t.pointerenter,{evt:e,target:this,currentTarget:this})}_pointerover(e){this.setPointersPositions(e);let t=Ni(e.type);t&&this._fire(t.pointerover,{evt:e,target:this,currentTarget:this})}_getTargetShape(e){let t=this[e+"targetShape"];return t&&!t.getStage()&&(t=null),t}_pointerleave(e){let t=Ni(e.type),i=fn(e.type);if(!t)return;this.setPointersPositions(e);let n=this._getTargetShape(i),a=!(Pt.Konva.isDragging()||Pt.Konva.isTransforming())||Pt.Konva.hitOnDragEnabled;n&&a?(n._fireAndBubble(t.pointerout,{evt:e}),n._fireAndBubble(t.pointerleave,{evt:e}),this._fire(t.pointerleave,{evt:e,target:this,currentTarget:this}),this[i+"targetShape"]=null):a&&(this._fire(t.pointerleave,{evt:e,target:this,currentTarget:this}),this._fire(t.pointerout,{evt:e,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(e){let t=Ni(e.type),i=fn(e.type);if(!t)return;this.setPointersPositions(e);let n=!1;this._changedPointerPositions.forEach(a=>{let s=this.getIntersection(a);if(Va.DD.justDragged=!1,Pt.Konva["_"+i+"ListenClick"]=!0,!s||!s.isListening()){this[i+"ClickStartShape"]=void 0;return}Pt.Konva.capturePointerEventsEnabled&&s.setPointerCapture(a.id),this[i+"ClickStartShape"]=s,s._fireAndBubble(t.pointerdown,{evt:e,pointerId:a.id}),n=!0;let r=e.type.indexOf("touch")>=0;s.preventDefault()&&e.cancelable&&r&&e.preventDefault()}),n||this._fire(t.pointerdown,{evt:e,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(e){let t=Ni(e.type),i=fn(e.type);if(!t||(Pt.Konva.isDragging()&&Va.DD.node.preventDefault()&&e.cancelable&&e.preventDefault(),this.setPointersPositions(e),!(!(Pt.Konva.isDragging()||Pt.Konva.isTransforming())||Pt.Konva.hitOnDragEnabled)))return;let a={},s=!1,r=this._getTargetShape(i);this._changedPointerPositions.forEach(l=>{let c=Ae.getCapturedShape(l.id)||this.getIntersection(l),d=l.id,h={evt:e,pointerId:d},m=r!==c;if(m&&r&&(r._fireAndBubble(t.pointerout,$t({},h),c),r._fireAndBubble(t.pointerleave,$t({},h),c)),c){if(a[c._id])return;a[c._id]=!0}c&&c.isListening()?(s=!0,m&&(c._fireAndBubble(t.pointerover,$t({},h),r),c._fireAndBubble(t.pointerenter,$t({},h),r),this[i+"targetShape"]=c),c._fireAndBubble(t.pointermove,$t({},h))):r&&(this._fire(t.pointerover,{evt:e,target:this,currentTarget:this,pointerId:d}),this[i+"targetShape"]=null)}),s||this._fire(t.pointermove,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(e){let t=Ni(e.type),i=fn(e.type);if(!t)return;this.setPointersPositions(e);let n=this[i+"ClickStartShape"],a=this[i+"ClickEndShape"],s={},r=!1;this._changedPointerPositions.forEach(l=>{let c=Ae.getCapturedShape(l.id)||this.getIntersection(l);if(c){if(c.releaseCapture(l.id),s[c._id])return;s[c._id]=!0}let d=l.id,h={evt:e,pointerId:d},m=!1;Pt.Konva["_"+i+"InDblClickWindow"]?(m=!0,clearTimeout(this[i+"DblTimeout"])):Va.DD.justDragged||(Pt.Konva["_"+i+"InDblClickWindow"]=!0,clearTimeout(this[i+"DblTimeout"])),this[i+"DblTimeout"]=setTimeout(function(){Pt.Konva["_"+i+"InDblClickWindow"]=!1},Pt.Konva.dblClickWindow),c&&c.isListening()?(r=!0,this[i+"ClickEndShape"]=c,c._fireAndBubble(t.pointerup,$t({},h)),Pt.Konva["_"+i+"ListenClick"]&&n&&n===c&&(c._fireAndBubble(t.pointerclick,$t({},h)),m&&a&&a===c&&c._fireAndBubble(t.pointerdblclick,$t({},h)))):(this[i+"ClickEndShape"]=null,Pt.Konva["_"+i+"ListenClick"]&&this._fire(t.pointerclick,{evt:e,target:this,currentTarget:this,pointerId:d}),m&&this._fire(t.pointerdblclick,{evt:e,target:this,currentTarget:this,pointerId:d}))}),r||this._fire(t.pointerup,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),Pt.Konva["_"+i+"ListenClick"]=!1,e.cancelable&&i!=="touch"&&i!=="pointer"&&e.preventDefault()}_contextmenu(e){this.setPointersPositions(e);let t=this.getIntersection(this.getPointerPosition());t&&t.isListening()?t._fireAndBubble(Ga,{evt:e}):this._fire(Ga,{evt:e,target:this,currentTarget:this})}_wheel(e){this.setPointersPositions(e);let t=this.getIntersection(this.getPointerPosition());t&&t.isListening()?t._fireAndBubble(Ua,{evt:e}):this._fire(Ua,{evt:e,target:this,currentTarget:this})}_pointercancel(e){this.setPointersPositions(e);let t=Ae.getCapturedShape(e.pointerId)||this.getIntersection(this.getPointerPosition());t&&t._fireAndBubble(Bi,Ae.createEvent(e)),Ae.releaseCapture(e.pointerId)}_lostpointercapture(e){Ae.releaseCapture(e.pointerId)}setPointersPositions(e){let t=this._getContentPosition(),i=null,n=null;e=e||window.event,e.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(e.touches,a=>{this._pointerPositions.push({id:a.identifier,x:(a.clientX-t.left)/t.scaleX,y:(a.clientY-t.top)/t.scaleY})}),Array.prototype.forEach.call(e.changedTouches||e.touches,a=>{this._changedPointerPositions.push({id:a.identifier,x:(a.clientX-t.left)/t.scaleX,y:(a.clientY-t.top)/t.scaleY})})):(i=(e.clientX-t.left)/t.scaleX,n=(e.clientY-t.top)/t.scaleY,this.pointerPos={x:i,y:n},this._pointerPositions=[{x:i,y:n,id:be.Util._getFirstPointerId(e)}],this._changedPointerPositions=[{x:i,y:n,id:be.Util._getFirstPointerId(e)}])}_setPointerPosition(e){be.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(e)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};let e=this.content.getBoundingClientRect();return{top:e.top,left:e.left,scaleX:e.width/this.content.clientWidth||1,scaleY:e.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new Ba.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new Ba.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!Pt.Konva.isBrowser)return;let e=this.container();if(!e)throw"Stage has no container. A container is required.";e.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),e.appendChild(this.content),this._resizeDOM()}cache(){return be.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(e){e.batchDraw()}),this}};Ce.Stage=Vi;Vi.prototype.nodeType=$g;(0,Xg._registerNode)(Vi);Yg.Factory.addGetterSetter(Vi,"container");Pt.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{Ce.stages.forEach(o=>{o.batchDraw()})})});var At=N(Ee=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});Ee.Shape=Ee.shapes=void 0;var ip=Y(),xe=xt(),L=K(),Gl=yt(),Tt=Z(),np=Y(),ja=Na(),Ul="hasShadow",jl="shadowRGBA",Hl="patternImage",ql="linearGradient",Wl="radialGradient",no;function Ha(){return no||(no=xe.Util.createCanvasElement().getContext("2d"),no)}Ee.shapes={};function op(o){let e=this.attrs.fillRule;e?o.fill(e):o.fill()}function ap(o){o.stroke()}function sp(o){let e=this.attrs.fillRule;e?o.fill(e):o.fill()}function rp(o){o.stroke()}function lp(){this._clearCache(Ul)}function cp(){this._clearCache(jl)}function dp(){this._clearCache(Hl)}function hp(){this._clearCache(ql)}function mp(){this._clearCache(Wl)}var I=class extends Gl.Node{constructor(e){super(e);let t;for(;t=xe.Util.getRandomColor(),!(t&&!(t in Ee.shapes)););this.colorKey=t,Ee.shapes[t]=this}getContext(){return xe.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return xe.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(Ul,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(Hl,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){let t=Ha().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(t&&t.setTransform){let i=new xe.Transform;i.translate(this.fillPatternX(),this.fillPatternY()),i.rotate(ip.Konva.getAngle(this.fillPatternRotation())),i.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),i.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());let n=i.getMatrix(),a=typeof DOMMatrix>"u"?{a:n[0],b:n[1],c:n[2],d:n[3],e:n[4],f:n[5]}:new DOMMatrix(n);t.setTransform(a)}return t}}_getLinearGradient(){return this._getCache(ql,this.__getLinearGradient)}__getLinearGradient(){let e=this.fillLinearGradientColorStops();if(e){let t=Ha(),i=this.fillLinearGradientStartPoint(),n=this.fillLinearGradientEndPoint(),a=t.createLinearGradient(i.x,i.y,n.x,n.y);for(let s=0;s<e.length;s+=2)a.addColorStop(e[s],e[s+1]);return a}}_getRadialGradient(){return this._getCache(Wl,this.__getRadialGradient)}__getRadialGradient(){let e=this.fillRadialGradientColorStops();if(e){let t=Ha(),i=this.fillRadialGradientStartPoint(),n=this.fillRadialGradientEndPoint(),a=t.createRadialGradient(i.x,i.y,this.fillRadialGradientStartRadius(),n.x,n.y,this.fillRadialGradientEndRadius());for(let s=0;s<e.length;s+=2)a.addColorStop(e[s],e[s+1]);return a}}getShadowRGBA(){return this._getCache(jl,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;let e=xe.Util.colorToRGBA(this.shadowColor());if(e)return"rgba("+e.r+","+e.g+","+e.b+","+e.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){let e=this.hitStrokeWidth();return e==="auto"?this.hasStroke():this.strokeEnabled()&&!!e}intersects(e){let t=this.getStage();if(!t)return!1;let i=t.bufferHitCanvas;return i.getContext().clear(),this.drawHit(i,void 0,!0),i.context.getImageData(Math.round(e.x),Math.round(e.y),1,1).data[3]>0}destroy(){return Gl.Node.prototype.destroy.call(this),delete Ee.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(e){var t;if(!((t=this.attrs.perfectDrawEnabled)!==null&&t!==void 0?t:!0))return!1;let n=e||this.hasFill(),a=this.hasStroke(),s=this.getAbsoluteOpacity()!==1;if(n&&a&&s)return!0;let r=this.hasShadow(),l=this.shadowForStrokeEnabled();return!!(n&&a&&r&&l)}setStrokeHitEnabled(e){xe.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),e?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){let e=this.size();return{x:this._centroid?-e.width/2:0,y:this._centroid?-e.height/2:0,width:e.width,height:e.height}}getClientRect(e={}){let t=!1,i=this.getParent();for(;i;){if(i.isCached()){t=!0;break}i=i.getParent()}let n=e.skipTransform,a=e.relativeTo||t&&this.getStage()||void 0,s=this.getSelfRect(),l=!e.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,c=s.width+l,d=s.height+l,h=!e.skipShadow&&this.hasShadow(),m=h?this.shadowOffsetX():0,p=h?this.shadowOffsetY():0,f=c+Math.abs(m),b=d+Math.abs(p),C=h&&this.shadowBlur()||0,M=f+C*2,w=b+C*2,P={width:M,height:w,x:-(l/2+C)+Math.min(m,0)+s.x,y:-(l/2+C)+Math.min(p,0)+s.y};return n?P:this._transformedRect(P,a)}drawScene(e,t,i){let n=this.getLayer(),a=e||n.getCanvas(),s=a.getContext(),r=this._getCanvasCache(),l=this.getSceneFunc(),c=this.hasShadow(),d,h=!1,m=t===this;if(!this.isVisible()&&!m)return this;if(r){s.save();let p=this.getAbsoluteTransform(t).getMatrix();return s.transform(p[0],p[1],p[2],p[3],p[4],p[5]),this._drawCachedSceneCanvas(s),s.restore(),this}if(!l)return this;if(s.save(),this._useBufferCanvas()&&!h){d=this.getStage();let p=i||d.bufferCanvas,f=p.getContext();f.clear(),f.save(),f._applyLineJoin(this);let b=this.getAbsoluteTransform(t).getMatrix();f.transform(b[0],b[1],b[2],b[3],b[4],b[5]),l.call(this,f,this),f.restore();let C=p.pixelRatio;c&&s._applyShadow(this),s._applyOpacity(this),s._applyGlobalCompositeOperation(this),s.drawImage(p._canvas,p.x||0,p.y||0,p.width/C,p.height/C)}else{if(s._applyLineJoin(this),!m){let p=this.getAbsoluteTransform(t).getMatrix();s.transform(p[0],p[1],p[2],p[3],p[4],p[5]),s._applyOpacity(this),s._applyGlobalCompositeOperation(this)}c&&s._applyShadow(this),l.call(this,s,this)}return s.restore(),this}drawHit(e,t,i=!1){if(!this.shouldDrawHit(t,i))return this;let n=this.getLayer(),a=e||n.hitCanvas,s=a&&a.getContext(),r=this.hitFunc()||this.sceneFunc(),l=this._getCanvasCache(),c=l&&l.hit;if(this.colorKey||xe.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),c){s.save();let h=this.getAbsoluteTransform(t).getMatrix();return s.transform(h[0],h[1],h[2],h[3],h[4],h[5]),this._drawCachedHitCanvas(s),s.restore(),this}if(!r)return this;if(s.save(),s._applyLineJoin(this),!(this===t)){let h=this.getAbsoluteTransform(t).getMatrix();s.transform(h[0],h[1],h[2],h[3],h[4],h[5])}return r.call(this,s,this),s.restore(),this}drawHitFromCache(e=0){let t=this._getCanvasCache(),i=this._getCachedSceneCanvas(),n=t.hit,a=n.getContext(),s=n.getWidth(),r=n.getHeight();a.clear(),a.drawImage(i._canvas,0,0,s,r);try{let l=a.getImageData(0,0,s,r),c=l.data,d=c.length,h=xe.Util._hexToRgb(this.colorKey);for(let m=0;m<d;m+=4)c[m+3]>e?(c[m]=h.r,c[m+1]=h.g,c[m+2]=h.b,c[m+3]=255):c[m+3]=0;a.putImageData(l,0,0)}catch(l){xe.Util.error("Unable to draw hit graph from cached scene canvas. "+l.message)}return this}hasPointerCapture(e){return ja.hasPointerCapture(e,this)}setPointerCapture(e){ja.setPointerCapture(e,this)}releaseCapture(e){ja.releaseCapture(e,this)}};Ee.Shape=I;I.prototype._fillFunc=op;I.prototype._strokeFunc=ap;I.prototype._fillFuncHit=sp;I.prototype._strokeFuncHit=rp;I.prototype._centroid=!1;I.prototype.nodeType="Shape";(0,np._registerNode)(I);I.prototype.eventListeners={};I.prototype.on.call(I.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",lp);I.prototype.on.call(I.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",cp);I.prototype.on.call(I.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",dp);I.prototype.on.call(I.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",hp);I.prototype.on.call(I.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",mp);L.Factory.addGetterSetter(I,"stroke",void 0,(0,Tt.getStringOrGradientValidator)());L.Factory.addGetterSetter(I,"strokeWidth",2,(0,Tt.getNumberValidator)());L.Factory.addGetterSetter(I,"fillAfterStrokeEnabled",!1);L.Factory.addGetterSetter(I,"hitStrokeWidth","auto",(0,Tt.getNumberOrAutoValidator)());L.Factory.addGetterSetter(I,"strokeHitEnabled",!0,(0,Tt.getBooleanValidator)());L.Factory.addGetterSetter(I,"perfectDrawEnabled",!0,(0,Tt.getBooleanValidator)());L.Factory.addGetterSetter(I,"shadowForStrokeEnabled",!0,(0,Tt.getBooleanValidator)());L.Factory.addGetterSetter(I,"lineJoin");L.Factory.addGetterSetter(I,"lineCap");L.Factory.addGetterSetter(I,"sceneFunc");L.Factory.addGetterSetter(I,"hitFunc");L.Factory.addGetterSetter(I,"dash");L.Factory.addGetterSetter(I,"dashOffset",0,(0,Tt.getNumberValidator)());L.Factory.addGetterSetter(I,"shadowColor",void 0,(0,Tt.getStringValidator)());L.Factory.addGetterSetter(I,"shadowBlur",0,(0,Tt.getNumberValidator)());L.Factory.addGetterSetter(I,"shadowOpacity",1,(0,Tt.getNumberValidator)());L.Factory.addComponentsGetterSetter(I,"shadowOffset",["x","y"]);L.Factory.addGetterSetter(I,"shadowOffsetX",0,(0,Tt.getNumberValidator)());L.Factory.addGetterSetter(I,"shadowOffsetY",0,(0,Tt.getNumberValidator)());L.Factory.addGetterSetter(I,"fillPatternImage");L.Factory.addGetterSetter(I,"fill",void 0,(0,Tt.getStringOrGradientValidator)());L.Factory.addGetterSetter(I,"fillPatternX",0,(0,Tt.getNumberValidator)());L.Factory.addGetterSetter(I,"fillPatternY",0,(0,Tt.getNumberValidator)());L.Factory.addGetterSetter(I,"fillLinearGradientColorStops");L.Factory.addGetterSetter(I,"strokeLinearGradientColorStops");L.Factory.addGetterSetter(I,"fillRadialGradientStartRadius",0);L.Factory.addGetterSetter(I,"fillRadialGradientEndRadius",0);L.Factory.addGetterSetter(I,"fillRadialGradientColorStops");L.Factory.addGetterSetter(I,"fillPatternRepeat","repeat");L.Factory.addGetterSetter(I,"fillEnabled",!0);L.Factory.addGetterSetter(I,"strokeEnabled",!0);L.Factory.addGetterSetter(I,"shadowEnabled",!0);L.Factory.addGetterSetter(I,"dashEnabled",!0);L.Factory.addGetterSetter(I,"strokeScaleEnabled",!0);L.Factory.addGetterSetter(I,"fillPriority","color");L.Factory.addComponentsGetterSetter(I,"fillPatternOffset",["x","y"]);L.Factory.addGetterSetter(I,"fillPatternOffsetX",0,(0,Tt.getNumberValidator)());L.Factory.addGetterSetter(I,"fillPatternOffsetY",0,(0,Tt.getNumberValidator)());L.Factory.addComponentsGetterSetter(I,"fillPatternScale",["x","y"]);L.Factory.addGetterSetter(I,"fillPatternScaleX",1,(0,Tt.getNumberValidator)());L.Factory.addGetterSetter(I,"fillPatternScaleY",1,(0,Tt.getNumberValidator)());L.Factory.addComponentsGetterSetter(I,"fillLinearGradientStartPoint",["x","y"]);L.Factory.addComponentsGetterSetter(I,"strokeLinearGradientStartPoint",["x","y"]);L.Factory.addGetterSetter(I,"fillLinearGradientStartPointX",0);L.Factory.addGetterSetter(I,"strokeLinearGradientStartPointX",0);L.Factory.addGetterSetter(I,"fillLinearGradientStartPointY",0);L.Factory.addGetterSetter(I,"strokeLinearGradientStartPointY",0);L.Factory.addComponentsGetterSetter(I,"fillLinearGradientEndPoint",["x","y"]);L.Factory.addComponentsGetterSetter(I,"strokeLinearGradientEndPoint",["x","y"]);L.Factory.addGetterSetter(I,"fillLinearGradientEndPointX",0);L.Factory.addGetterSetter(I,"strokeLinearGradientEndPointX",0);L.Factory.addGetterSetter(I,"fillLinearGradientEndPointY",0);L.Factory.addGetterSetter(I,"strokeLinearGradientEndPointY",0);L.Factory.addComponentsGetterSetter(I,"fillRadialGradientStartPoint",["x","y"]);L.Factory.addGetterSetter(I,"fillRadialGradientStartPointX",0);L.Factory.addGetterSetter(I,"fillRadialGradientStartPointY",0);L.Factory.addComponentsGetterSetter(I,"fillRadialGradientEndPoint",["x","y"]);L.Factory.addGetterSetter(I,"fillRadialGradientEndPointX",0);L.Factory.addGetterSetter(I,"fillRadialGradientEndPointY",0);L.Factory.addGetterSetter(I,"fillPatternRotation",0);L.Factory.addGetterSetter(I,"fillRule",void 0,(0,Tt.getStringValidator)());L.Factory.backCompat(I,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})});var Ya=N(oo=>{"use strict";Object.defineProperty(oo,"__esModule",{value:!0});oo.Layer=void 0;var Le=xt(),qa=dn(),zi=yt(),Wa=K(),Yl=an(),gp=Z(),pp=At(),up=Y(),fp="#",_p="beforeDraw",bp="draw",Xl=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],Cp=Xl.length,Ke=class extends qa.Container{constructor(e){super(e),this.canvas=new Yl.SceneCanvas,this.hitCanvas=new Yl.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(e){return this.getContext().clear(e),this.getHitCanvas().getContext().clear(e),this}setZIndex(e){super.setZIndex(e);let t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),e<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[e+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){zi.Node.prototype.moveToTop.call(this);let e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!zi.Node.prototype.moveUp.call(this))return!1;let t=this.getStage();return!t||!t.content?!1:(t.content.removeChild(this.getNativeCanvasElement()),this.index<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(zi.Node.prototype.moveDown.call(this)){let e=this.getStage();if(e){let t=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),t[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(zi.Node.prototype.moveToBottom.call(this)){let e=this.getStage();if(e){let t=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),t[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){let e=this.getNativeCanvasElement();return zi.Node.prototype.remove.call(this),e&&e.parentNode&&Le.Util._isInDocument(e)&&e.parentNode.removeChild(e),this}getStage(){return this.parent}setSize({width:e,height:t}){return this.canvas.setSize(e,t),this.hitCanvas.setSize(e,t),this._setSmoothEnabled(),this}_validateAdd(e){let t=e.getType();t!=="Group"&&t!=="Shape"&&Le.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(e){return e=e||{},e.width=e.width||this.getWidth(),e.height=e.height||this.getHeight(),e.x=e.x!==void 0?e.x:this.x(),e.y=e.y!==void 0?e.y:this.y(),zi.Node.prototype._toKonvaCanvas.call(this,e)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){Le.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){Le.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,Le.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(e){if(!this.isListening()||!this.isVisible())return null;let t=1,i=!1;for(;;){for(let n=0;n<Cp;n++){let a=Xl[n],s=this._getIntersection({x:e.x+a.x*t,y:e.y+a.y*t}),r=s.shape;if(r)return r;if(i=!!s.antialiased,!s.antialiased)break}if(i)t+=1;else return null}}_getIntersection(e){let t=this.hitCanvas.pixelRatio,i=this.hitCanvas.context.getImageData(Math.round(e.x*t),Math.round(e.y*t),1,1).data,n=i[3];if(n===255){let a=Le.Util._rgbToHex(i[0],i[1],i[2]),s=pp.shapes[fp+a];return s?{shape:s}:{antialiased:!0}}else if(n>0)return{antialiased:!0};return{}}drawScene(e,t,i){let n=this.getLayer(),a=e||n&&n.getCanvas();return this._fire(_p,{node:this}),this.clearBeforeDraw()&&a.getContext().clear(),qa.Container.prototype.drawScene.call(this,a,t,i),this._fire(bp,{node:this}),this}drawHit(e,t){let i=this.getLayer(),n=e||i&&i.hitCanvas;return i&&i.clearBeforeDraw()&&i.getHitCanvas().getContext().clear(),qa.Container.prototype.drawHit.call(this,n,t),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(e){Le.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(e)}getHitGraphEnabled(e){return Le.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;let e=this.parent;!!this.hitCanvas._canvas.parentNode?e.content.removeChild(this.hitCanvas._canvas):e.content.appendChild(this.hitCanvas._canvas)}destroy(){return Le.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}};oo.Layer=Ke;Ke.prototype.nodeType="Layer";(0,up._registerNode)(Ke);Wa.Factory.addGetterSetter(Ke,"imageSmoothingEnabled",!0);Wa.Factory.addGetterSetter(Ke,"clearBeforeDraw",!0);Wa.Factory.addGetterSetter(Ke,"hitGraphEnabled",!0,(0,gp.getBooleanValidator)())});var $l=N(ao=>{"use strict";Object.defineProperty(ao,"__esModule",{value:!0});ao.FastLayer=void 0;var xp=xt(),vp=Ya(),yp=Y(),_n=class extends vp.Layer{constructor(e){super(e),this.listening(!1),xp.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};ao.FastLayer=_n;_n.prototype.nodeType="FastLayer";(0,yp._registerNode)(_n)});var ro=N(so=>{"use strict";Object.defineProperty(so,"__esModule",{value:!0});so.Group=void 0;var wp=xt(),Mp=dn(),Pp=Y(),bn=class extends Mp.Container{_validateAdd(e){let t=e.getType();t!=="Group"&&t!=="Shape"&&wp.Util.throw("You may only add groups and shapes to groups.")}};so.Group=bn;bn.prototype.nodeType="Group";(0,Pp._registerNode)(bn)});var co=N(lo=>{"use strict";Object.defineProperty(lo,"__esModule",{value:!0});lo.Animation=void 0;var Xa=Y(),Kl=xt(),$a=function(){return Xa.glob.performance&&Xa.glob.performance.now?function(){return Xa.glob.performance.now()}:function(){return new Date().getTime()}}(),Gi=class o{constructor(e,t){this.id=o.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:$a(),frameRate:0},this.func=e,this.setLayers(t)}setLayers(e){let t=[];return e&&(t=Array.isArray(e)?e:[e]),this.layers=t,this}getLayers(){return this.layers}addLayer(e){let t=this.layers,i=t.length;for(let n=0;n<i;n++)if(t[n]._id===e._id)return!1;return this.layers.push(e),!0}isRunning(){let t=o.animations,i=t.length;for(let n=0;n<i;n++)if(t[n].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=$a(),o._addAnimation(this),this}stop(){return o._removeAnimation(this),this}_updateFrameObject(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(e){this.animations.push(e),this._handleAnimation()}static _removeAnimation(e){let t=e.id,i=this.animations,n=i.length;for(let a=0;a<n;a++)if(i[a].id===t){this.animations.splice(a,1);break}}static _runFrames(){let e={},t=this.animations;for(let i=0;i<t.length;i++){let n=t[i],a=n.layers,s=n.func;n._updateFrameObject($a());let r=a.length,l;if(s?l=s.call(n,n.frame)!==!1:l=!0,!!l)for(let c=0;c<r;c++){let d=a[c];d._id!==void 0&&(e[d._id]=d)}}for(let i in e)e.hasOwnProperty(i)&&e[i].batchDraw()}static _animationLoop(){let e=o;e.animations.length?(e._runFrames(),Kl.Util.requestAnimFrame(e._animationLoop)):e.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,Kl.Util.requestAnimFrame(this._animationLoop))}};lo.Animation=Gi;Gi.animations=[];Gi.animIdCounter=0;Gi.animRunning=!1});var tc=N(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.Easings=ve.Tween=void 0;var De=xt(),Op=co(),kp=yt(),Sp=Y(),Tp={node:1,duration:1,easing:1,onFinish:1,yoyo:1},Ip=1,Ql=2,Zl=3,Jl=["fill","stroke","shadowColor"],Ap=0,Ka=class{constructor(e,t,i,n,a,s,r){this.prop=e,this.propFunc=t,this.begin=n,this._pos=n,this.duration=s,this._change=0,this.prevPos=0,this.yoyo=r,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=i,this._change=a-this.begin,this.pause()}fire(e){let t=this[e];t&&t()}setTime(e){e>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():e<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=e,this.update())}getTime(){return this._time}setPosition(e){this.prevPos=this._pos,this.propFunc(e),this._pos=e}getPosition(e){return e===void 0&&(e=this._time),this.func(e,this.begin,this._change,this.duration)}play(){this.state=Ql,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=Zl,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(e){this.pause(),this._time=e,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){let e=this.getTimer()-this._startTime;this.state===Ql?this.setTime(e):this.state===Zl&&this.setTime(this.duration-e)}pause(){this.state=Ip,this.fire("onPause")}getTimer(){return new Date().getTime()}},Ui=class o{constructor(e){let t=this,i=e.node,n=i._id,a=e.easing||ve.Easings.Linear,s=!!e.yoyo,r,l;typeof e.duration>"u"?r=.3:e.duration===0?r=.001:r=e.duration,this.node=i,this._id=Ap++;let c=i.getLayer()||(i instanceof Sp.Konva.Stage?i.getLayers():null);c||De.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new Op.Animation(function(){t.tween.onEnterFrame()},c),this.tween=new Ka(l,function(d){t._tweenFunc(d)},a,0,1,r*1e3,s),this._addListeners(),o.attrs[n]||(o.attrs[n]={}),o.attrs[n][this._id]||(o.attrs[n][this._id]={}),o.tweens[n]||(o.tweens[n]={});for(l in e)Tp[l]===void 0&&this._addAttr(l,e[l]);this.reset(),this.onFinish=e.onFinish,this.onReset=e.onReset,this.onUpdate=e.onUpdate}_addAttr(e,t){let i=this.node,n=i._id,a,s,r,l,c,d=o.tweens[n][e];d&&delete o.attrs[n][d][e];let h=i.getAttr(e);if(De.Util._isArray(t))if(a=[],s=Math.max(t.length,h.length),e==="points"&&t.length!==h.length&&(t.length>h.length?(l=h,h=De.Util._prepareArrayForTween(h,t,i.closed())):(r=t,t=De.Util._prepareArrayForTween(t,h,i.closed()))),e.indexOf("fill")===0)for(let m=0;m<s;m++)if(m%2===0)a.push(t[m]-h[m]);else{let p=De.Util.colorToRGBA(h[m]);c=De.Util.colorToRGBA(t[m]),h[m]=p,a.push({r:c.r-p.r,g:c.g-p.g,b:c.b-p.b,a:c.a-p.a})}else for(let m=0;m<s;m++)a.push(t[m]-h[m]);else Jl.indexOf(e)!==-1?(h=De.Util.colorToRGBA(h),c=De.Util.colorToRGBA(t),a={r:c.r-h.r,g:c.g-h.g,b:c.b-h.b,a:c.a-h.a}):a=t-h;o.attrs[n][this._id][e]={start:h,diff:a,end:t,trueEnd:r,trueStart:l},o.tweens[n][e]=this._id}_tweenFunc(e){let t=this.node,i=o.attrs[t._id][this._id],n,a,s,r,l,c,d,h;for(n in i){if(a=i[n],s=a.start,r=a.diff,h=a.end,De.Util._isArray(s))if(l=[],d=Math.max(s.length,h.length),n.indexOf("fill")===0)for(c=0;c<d;c++)c%2===0?l.push((s[c]||0)+r[c]*e):l.push("rgba("+Math.round(s[c].r+r[c].r*e)+","+Math.round(s[c].g+r[c].g*e)+","+Math.round(s[c].b+r[c].b*e)+","+(s[c].a+r[c].a*e)+")");else for(c=0;c<d;c++)l.push((s[c]||0)+r[c]*e);else Jl.indexOf(n)!==-1?l="rgba("+Math.round(s.r+r.r*e)+","+Math.round(s.g+r.g*e)+","+Math.round(s.b+r.b*e)+","+(s.a+r.a*e)+")":l=s+r*e;t.setAttr(n,l)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{let e=this.node,t=o.attrs[e._id][this._id];t.points&&t.points.trueEnd&&e.setAttr("points",t.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{let e=this.node,t=o.attrs[e._id][this._id];t.points&&t.points.trueStart&&e.points(t.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(e){return this.tween.seek(e*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){let e=this.node._id,t=this._id,i=o.tweens[e];this.pause(),this.anim&&this.anim.stop();for(let n in i)delete o.tweens[e][n];delete o.attrs[e][t],o.tweens[e]&&(Object.keys(o.tweens[e]).length===0&&delete o.tweens[e],Object.keys(o.attrs[e]).length===0&&delete o.attrs[e])}};ve.Tween=Ui;Ui.attrs={};Ui.tweens={};kp.Node.prototype.to=function(o){let e=o.onFinish;o.node=this,o.onFinish=function(){this.destroy(),e&&e()},new Ui(o).play()};ve.Easings={BackEaseIn(o,e,t,i){return t*(o/=i)*o*((1.70158+1)*o-1.70158)+e},BackEaseOut(o,e,t,i){return t*((o=o/i-1)*o*((1.70158+1)*o+1.70158)+1)+e},BackEaseInOut(o,e,t,i){let n=1.70158;return(o/=i/2)<1?t/2*(o*o*(((n*=1.525)+1)*o-n))+e:t/2*((o-=2)*o*(((n*=1.525)+1)*o+n)+2)+e},ElasticEaseIn(o,e,t,i,n,a){let s=0;return o===0?e:(o/=i)===1?e+t:(a||(a=i*.3),!n||n<Math.abs(t)?(n=t,s=a/4):s=a/(2*Math.PI)*Math.asin(t/n),-(n*Math.pow(2,10*(o-=1))*Math.sin((o*i-s)*(2*Math.PI)/a))+e)},ElasticEaseOut(o,e,t,i,n,a){let s=0;return o===0?e:(o/=i)===1?e+t:(a||(a=i*.3),!n||n<Math.abs(t)?(n=t,s=a/4):s=a/(2*Math.PI)*Math.asin(t/n),n*Math.pow(2,-10*o)*Math.sin((o*i-s)*(2*Math.PI)/a)+t+e)},ElasticEaseInOut(o,e,t,i,n,a){let s=0;return o===0?e:(o/=i/2)===2?e+t:(a||(a=i*(.3*1.5)),!n||n<Math.abs(t)?(n=t,s=a/4):s=a/(2*Math.PI)*Math.asin(t/n),o<1?-.5*(n*Math.pow(2,10*(o-=1))*Math.sin((o*i-s)*(2*Math.PI)/a))+e:n*Math.pow(2,-10*(o-=1))*Math.sin((o*i-s)*(2*Math.PI)/a)*.5+t+e)},BounceEaseOut(o,e,t,i){return(o/=i)<1/2.75?t*(7.5625*o*o)+e:o<2/2.75?t*(7.5625*(o-=1.5/2.75)*o+.75)+e:o<2.5/2.75?t*(7.5625*(o-=2.25/2.75)*o+.9375)+e:t*(7.5625*(o-=2.625/2.75)*o+.984375)+e},BounceEaseIn(o,e,t,i){return t-ve.Easings.BounceEaseOut(i-o,0,t,i)+e},BounceEaseInOut(o,e,t,i){return o<i/2?ve.Easings.BounceEaseIn(o*2,0,t,i)*.5+e:ve.Easings.BounceEaseOut(o*2-i,0,t,i)*.5+t*.5+e},EaseIn(o,e,t,i){return t*(o/=i)*o+e},EaseOut(o,e,t,i){return-t*(o/=i)*(o-2)+e},EaseInOut(o,e,t,i){return(o/=i/2)<1?t/2*o*o+e:-t/2*(--o*(o-2)-1)+e},StrongEaseIn(o,e,t,i){return t*(o/=i)*o*o*o*o+e},StrongEaseOut(o,e,t,i){return t*((o=o/i-1)*o*o*o*o+1)+e},StrongEaseInOut(o,e,t,i){return(o/=i/2)<1?t/2*o*o*o*o*o+e:t/2*((o-=2)*o*o*o*o+2)+e},Linear(o,e,t,i){return t*o/i+e}}});var oc=N(ji=>{"use strict";Object.defineProperty(ji,"__esModule",{value:!0});ji.Konva=void 0;var Ep=Y(),Qa=xt(),Lp=yt(),Dp=dn(),ec=zl(),Fp=Ya(),Rp=$l(),Np=ro(),Bp=Yn(),ic=At(),Vp=co(),nc=tc(),zp=Ia(),Gp=an();ji.Konva=Qa.Util._assign(Ep.Konva,{Util:Qa.Util,Transform:Qa.Transform,Node:Lp.Node,Container:Dp.Container,Stage:ec.Stage,stages:ec.stages,Layer:Fp.Layer,FastLayer:Rp.FastLayer,Group:Np.Group,DD:Bp.DD,Shape:ic.Shape,shapes:ic.shapes,Animation:Vp.Animation,Tween:nc.Tween,Easings:nc.Easings,Context:zp.Context,Canvas:Gp.Canvas});ji.default=ji.Konva});var sc=N(go=>{"use strict";Object.defineProperty(go,"__esModule",{value:!0});go.Arc=void 0;var ho=K(),Up=At(),ac=Y(),mo=Z(),jp=Y(),de=class extends Up.Shape{_sceneFunc(e){let t=ac.Konva.getAngle(this.angle()),i=this.clockwise();e.beginPath(),e.arc(0,0,this.outerRadius(),0,t,i),e.arc(0,0,this.innerRadius(),t,0,!i),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}getSelfRect(){let e=this.innerRadius(),t=this.outerRadius(),i=this.clockwise(),n=ac.Konva.getAngle(i?360-this.angle():this.angle()),a=Math.cos(Math.min(n,Math.PI)),s=1,r=Math.sin(Math.min(Math.max(Math.PI,n),3*Math.PI/2)),l=Math.sin(Math.min(n,Math.PI/2)),c=a*(a>0?e:t),d=s*(s>0?t:e),h=r*(r>0?e:t),m=l*(l>0?t:e);return{x:c,y:i?-1*m:h,width:d-c,height:m-h}}};go.Arc=de;de.prototype._centroid=!0;de.prototype.className="Arc";de.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"];(0,jp._registerNode)(de);ho.Factory.addGetterSetter(de,"innerRadius",0,(0,mo.getNumberValidator)());ho.Factory.addGetterSetter(de,"outerRadius",0,(0,mo.getNumberValidator)());ho.Factory.addGetterSetter(de,"angle",0,(0,mo.getNumberValidator)());ho.Factory.addGetterSetter(de,"clockwise",!1,(0,mo.getBooleanValidator)())});var Ja=N(uo=>{"use strict";Object.defineProperty(uo,"__esModule",{value:!0});uo.Line=void 0;var po=K(),Hp=Y(),qp=At(),lc=Z();function Za(o,e,t,i,n,a,s){let r=Math.sqrt(Math.pow(t-o,2)+Math.pow(i-e,2)),l=Math.sqrt(Math.pow(n-t,2)+Math.pow(a-i,2)),c=s*r/(r+l),d=s*l/(r+l),h=t-c*(n-o),m=i-c*(a-e),p=t+d*(n-o),f=i+d*(a-e);return[h,m,p,f]}function rc(o,e){let t=o.length,i=[];for(let n=2;n<t-2;n+=2){let a=Za(o[n-2],o[n-1],o[n],o[n+1],o[n+2],o[n+3],e);isNaN(a[0])||(i.push(a[0]),i.push(a[1]),i.push(o[n]),i.push(o[n+1]),i.push(a[2]),i.push(a[3]))}return i}var ye=class extends qp.Shape{constructor(e){super(e),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(e){let t=this.points(),i=t.length,n=this.tension(),a=this.closed(),s=this.bezier();if(!i)return;let r=0;if(e.beginPath(),e.moveTo(t[0],t[1]),n!==0&&i>4){let l=this.getTensionPoints(),c=l.length;for(r=a?0:4,a||e.quadraticCurveTo(l[0],l[1],l[2],l[3]);r<c-2;)e.bezierCurveTo(l[r++],l[r++],l[r++],l[r++],l[r++],l[r++]);a||e.quadraticCurveTo(l[c-2],l[c-1],t[i-2],t[i-1])}else if(s)for(r=2;r<i;)e.bezierCurveTo(t[r++],t[r++],t[r++],t[r++],t[r++],t[r++]);else for(r=2;r<i;r+=2)e.lineTo(t[r],t[r+1]);a?(e.closePath(),e.fillStrokeShape(this)):e.strokeShape(this)}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():rc(this.points(),this.tension())}_getTensionPointsClosed(){let e=this.points(),t=e.length,i=this.tension(),n=Za(e[t-2],e[t-1],e[0],e[1],e[2],e[3],i),a=Za(e[t-4],e[t-3],e[t-2],e[t-1],e[0],e[1],i),s=rc(e,i);return[n[2],n[3]].concat(s).concat([a[0],a[1],e[t-2],e[t-1],a[2],a[3],n[0],n[1],e[0],e[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let e=this.points();if(e.length<4)return{x:e[0]||0,y:e[1]||0,width:0,height:0};this.tension()!==0?e=[e[0],e[1],...this._getTensionPoints(),e[e.length-2],e[e.length-1]]:e=this.points();let t=e[0],i=e[0],n=e[1],a=e[1],s,r;for(let l=0;l<e.length/2;l++)s=e[l*2],r=e[l*2+1],t=Math.min(t,s),i=Math.max(i,s),n=Math.min(n,r),a=Math.max(a,r);return{x:t,y:n,width:i-t,height:a-n}}};uo.Line=ye;ye.prototype.className="Line";ye.prototype._attrsAffectingSize=["points","bezier","tension"];(0,Hp._registerNode)(ye);po.Factory.addGetterSetter(ye,"closed",!1);po.Factory.addGetterSetter(ye,"bezier",!1);po.Factory.addGetterSetter(ye,"tension",0,(0,lc.getNumberValidator)());po.Factory.addGetterSetter(ye,"points",[],(0,lc.getNumberArrayValidator)())});var cc=N(Vt=>{"use strict";Object.defineProperty(Vt,"__esModule",{value:!0});Vt.t2length=Vt.getQuadraticArcLength=Vt.getCubicArcLength=Vt.binomialCoefficients=Vt.cValues=Vt.tValues=void 0;Vt.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]];Vt.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]];Vt.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];var Wp=(o,e,t)=>{let i,n,s=t/2;i=0;for(let r=0;r<20;r++)n=s*Vt.tValues[20][r]+s,i+=Vt.cValues[20][r]*Xp(o,e,n);return s*i};Vt.getCubicArcLength=Wp;var Yp=(o,e,t)=>{t===void 0&&(t=1);let i=o[0]-2*o[1]+o[2],n=e[0]-2*e[1]+e[2],a=2*o[1]-2*o[0],s=2*e[1]-2*e[0],r=4*(i*i+n*n),l=4*(i*a+n*s),c=a*a+s*s;if(r===0)return t*Math.sqrt(Math.pow(o[2]-o[0],2)+Math.pow(e[2]-e[0],2));let d=l/(2*r),h=c/r,m=t+d,p=h-d*d,f=m*m+p>0?Math.sqrt(m*m+p):0,b=d*d+p>0?Math.sqrt(d*d+p):0,C=d+Math.sqrt(d*d+p)!==0?p*Math.log(Math.abs((m+f)/(d+b))):0;return Math.sqrt(r)/2*(m*f-d*b+C)};Vt.getQuadraticArcLength=Yp;function Xp(o,e,t){let i=ts(1,t,o),n=ts(1,t,e),a=i*i+n*n;return Math.sqrt(a)}var ts=(o,e,t)=>{let i=t.length-1,n,a;if(i===0)return 0;if(o===0){a=0;for(let s=0;s<=i;s++)a+=Vt.binomialCoefficients[i][s]*Math.pow(1-e,i-s)*Math.pow(e,s)*t[s];return a}else{n=new Array(i);for(let s=0;s<i;s++)n[s]=i*(t[s+1]-t[s]);return ts(o-1,e,n)}},$p=(o,e,t)=>{let i=1,n=o/e,a=(o-t(n))/e,s=0;for(;i>.001;){let r=t(n+a),l=Math.abs(o-r)/e;if(l<i)i=l,n+=a;else{let c=t(n-a),d=Math.abs(o-c)/e;d<i?(i=d,n-=a):a/=2}if(s++,s>500)break}return n};Vt.t2length=$p});var _o=N(fo=>{"use strict";Object.defineProperty(fo,"__esModule",{value:!0});fo.Path=void 0;var Kp=K(),Qp=Y(),Zp=At(),Hi=cc(),si=class o extends Zp.Shape{constructor(e){super(e),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=o.parsePathData(this.data()),this.pathLength=o.getPathLength(this.dataArray)}_sceneFunc(e){let t=this.dataArray;e.beginPath();let i=!1;for(let n=0;n<t.length;n++){let a=t[n].command,s=t[n].points;switch(a){case"L":e.lineTo(s[0],s[1]);break;case"M":e.moveTo(s[0],s[1]);break;case"C":e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case"Q":e.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case"A":let r=s[0],l=s[1],c=s[2],d=s[3],h=s[4],m=s[5],p=s[6],f=s[7],b=c>d?c:d,C=c>d?1:c/d,M=c>d?d/c:1;e.translate(r,l),e.rotate(p),e.scale(C,M),e.arc(0,0,b,h,h+m,1-f),e.scale(1/C,1/M),e.rotate(-p),e.translate(-r,-l);break;case"z":i=!0,e.closePath();break}}!i&&!this.hasFill()?e.strokeShape(this):e.fillStrokeShape(this)}getSelfRect(){let e=[];this.dataArray.forEach(function(l){if(l.command==="A"){let c=l.points[4],d=l.points[5],h=l.points[4]+d,m=Math.PI/180;if(Math.abs(c-h)<m&&(m=Math.abs(c-h)),d<0)for(let p=c-m;p>h;p-=m){let f=o.getPointOnEllipticalArc(l.points[0],l.points[1],l.points[2],l.points[3],p,0);e.push(f.x,f.y)}else for(let p=c+m;p<h;p+=m){let f=o.getPointOnEllipticalArc(l.points[0],l.points[1],l.points[2],l.points[3],p,0);e.push(f.x,f.y)}}else if(l.command==="C")for(let c=0;c<=1;c+=.01){let d=o.getPointOnCubicBezier(c,l.start.x,l.start.y,l.points[0],l.points[1],l.points[2],l.points[3],l.points[4],l.points[5]);e.push(d.x,d.y)}else e=e.concat(l.points)});let t=e[0],i=e[0],n=e[1],a=e[1],s,r;for(let l=0;l<e.length/2;l++)s=e[l*2],r=e[l*2+1],isNaN(s)||(t=Math.min(t,s),i=Math.max(i,s)),isNaN(r)||(n=Math.min(n,r),a=Math.max(a,r));return{x:t,y:n,width:i-t,height:a-n}}getLength(){return this.pathLength}getPointAtLength(e){return o.getPointAtLengthOfDataArray(e,this.dataArray)}static getLineLength(e,t,i,n){return Math.sqrt((i-e)*(i-e)+(n-t)*(n-t))}static getPathLength(e){let t=0;for(let i=0;i<e.length;++i)t+=e[i].pathLength;return t}static getPointAtLengthOfDataArray(e,t){let i,n=0,a=t.length;if(!a)return null;for(;n<a&&e>t[n].pathLength;)e-=t[n].pathLength,++n;if(n===a)return i=t[n-1].points.slice(-2),{x:i[0],y:i[1]};if(e<.01)return t[n].command==="M"?(i=t[n].points.slice(0,2),{x:i[0],y:i[1]}):{x:t[n].start.x,y:t[n].start.y};let s=t[n],r=s.points;switch(s.command){case"L":return o.getPointOnLine(e,s.start.x,s.start.y,r[0],r[1]);case"C":return o.getPointOnCubicBezier((0,Hi.t2length)(e,o.getPathLength(t),b=>(0,Hi.getCubicArcLength)([s.start.x,r[0],r[2],r[4]],[s.start.y,r[1],r[3],r[5]],b)),s.start.x,s.start.y,r[0],r[1],r[2],r[3],r[4],r[5]);case"Q":return o.getPointOnQuadraticBezier((0,Hi.t2length)(e,o.getPathLength(t),b=>(0,Hi.getQuadraticArcLength)([s.start.x,r[0],r[2]],[s.start.y,r[1],r[3]],b)),s.start.x,s.start.y,r[0],r[1],r[2],r[3]);case"A":let l=r[0],c=r[1],d=r[2],h=r[3],m=r[5],p=r[6],f=r[4];return f+=m*e/s.pathLength,o.getPointOnEllipticalArc(l,c,d,h,f,p)}return null}static getPointOnLine(e,t,i,n,a,s,r){s=s??t,r=r??i;let l=this.getLineLength(t,i,n,a);if(l<1e-10)return{x:t,y:i};if(n===t)return{x:s,y:r+(a>i?e:-e)};let c=(a-i)/(n-t),d=Math.sqrt(e*e/(1+c*c))*(n<t?-1:1),h=c*d;if(Math.abs(r-i-c*(s-t))<1e-10)return{x:s+d,y:r+h};let m=((s-t)*(n-t)+(r-i)*(a-i))/(l*l),p=t+m*(n-t),f=i+m*(a-i),b=this.getLineLength(s,r,p,f),C=Math.sqrt(e*e-b*b),M=Math.sqrt(C*C/(1+c*c))*(n<t?-1:1),w=c*M;return{x:p+M,y:f+w}}static getPointOnCubicBezier(e,t,i,n,a,s,r,l,c){function d(C){return C*C*C}function h(C){return 3*C*C*(1-C)}function m(C){return 3*C*(1-C)*(1-C)}function p(C){return(1-C)*(1-C)*(1-C)}let f=l*d(e)+s*h(e)+n*m(e)+t*p(e),b=c*d(e)+r*h(e)+a*m(e)+i*p(e);return{x:f,y:b}}static getPointOnQuadraticBezier(e,t,i,n,a,s,r){function l(p){return p*p}function c(p){return 2*p*(1-p)}function d(p){return(1-p)*(1-p)}let h=s*l(e)+n*c(e)+t*d(e),m=r*l(e)+a*c(e)+i*d(e);return{x:h,y:m}}static getPointOnEllipticalArc(e,t,i,n,a,s){let r=Math.cos(s),l=Math.sin(s),c={x:i*Math.cos(a),y:n*Math.sin(a)};return{x:e+(c.x*r-c.y*l),y:t+(c.x*l+c.y*r)}}static parsePathData(e){if(!e)return[];let t=e,i=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];t=t.replace(new RegExp(" ","g"),",");for(let h=0;h<i.length;h++)t=t.replace(new RegExp(i[h],"g"),"|"+i[h]);let n=t.split("|"),a=[],s=[],r=0,l=0,c=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,d;for(let h=1;h<n.length;h++){let m=n[h],p=m.charAt(0);for(m=m.slice(1),s.length=0;d=c.exec(m);)s.push(d[0]);let f=[];for(let b=0,C=s.length;b<C;b++){if(s[b]==="00"){f.push(0,0);continue}let M=parseFloat(s[b]);isNaN(M)?f.push(0):f.push(M)}for(;f.length>0&&!isNaN(f[0]);){let b="",C=[],M=r,w=l,P,O,E,A,D,H,nt,B,X,F;switch(p){case"l":r+=f.shift(),l+=f.shift(),b="L",C.push(r,l);break;case"L":r=f.shift(),l=f.shift(),C.push(r,l);break;case"m":let j=f.shift(),st=f.shift();if(r+=j,l+=st,b="M",a.length>2&&a[a.length-1].command==="z"){for(let rt=a.length-2;rt>=0;rt--)if(a[rt].command==="M"){r=a[rt].points[0]+j,l=a[rt].points[1]+st;break}}C.push(r,l),p="l";break;case"M":r=f.shift(),l=f.shift(),b="M",C.push(r,l),p="L";break;case"h":r+=f.shift(),b="L",C.push(r,l);break;case"H":r=f.shift(),b="L",C.push(r,l);break;case"v":l+=f.shift(),b="L",C.push(r,l);break;case"V":l=f.shift(),b="L",C.push(r,l);break;case"C":C.push(f.shift(),f.shift(),f.shift(),f.shift()),r=f.shift(),l=f.shift(),C.push(r,l);break;case"c":C.push(r+f.shift(),l+f.shift(),r+f.shift(),l+f.shift()),r+=f.shift(),l+=f.shift(),b="C",C.push(r,l);break;case"S":O=r,E=l,P=a[a.length-1],P.command==="C"&&(O=r+(r-P.points[2]),E=l+(l-P.points[3])),C.push(O,E,f.shift(),f.shift()),r=f.shift(),l=f.shift(),b="C",C.push(r,l);break;case"s":O=r,E=l,P=a[a.length-1],P.command==="C"&&(O=r+(r-P.points[2]),E=l+(l-P.points[3])),C.push(O,E,r+f.shift(),l+f.shift()),r+=f.shift(),l+=f.shift(),b="C",C.push(r,l);break;case"Q":C.push(f.shift(),f.shift()),r=f.shift(),l=f.shift(),C.push(r,l);break;case"q":C.push(r+f.shift(),l+f.shift()),r+=f.shift(),l+=f.shift(),b="Q",C.push(r,l);break;case"T":O=r,E=l,P=a[a.length-1],P.command==="Q"&&(O=r+(r-P.points[0]),E=l+(l-P.points[1])),r=f.shift(),l=f.shift(),b="Q",C.push(O,E,r,l);break;case"t":O=r,E=l,P=a[a.length-1],P.command==="Q"&&(O=r+(r-P.points[0]),E=l+(l-P.points[1])),r+=f.shift(),l+=f.shift(),b="Q",C.push(O,E,r,l);break;case"A":A=f.shift(),D=f.shift(),H=f.shift(),nt=f.shift(),B=f.shift(),X=r,F=l,r=f.shift(),l=f.shift(),b="A",C=this.convertEndpointToCenterParameterization(X,F,r,l,nt,B,A,D,H);break;case"a":A=f.shift(),D=f.shift(),H=f.shift(),nt=f.shift(),B=f.shift(),X=r,F=l,r+=f.shift(),l+=f.shift(),b="A",C=this.convertEndpointToCenterParameterization(X,F,r,l,nt,B,A,D,H);break}a.push({command:b||p,points:C,start:{x:M,y:w},pathLength:this.calcLength(M,w,b||p,C)})}(p==="z"||p==="Z")&&a.push({command:"z",points:[],start:void 0,pathLength:0})}return a}static calcLength(e,t,i,n){let a,s,r,l,c=o;switch(i){case"L":return c.getLineLength(e,t,n[0],n[1]);case"C":return(0,Hi.getCubicArcLength)([e,n[0],n[2],n[4]],[t,n[1],n[3],n[5]],1);case"Q":return(0,Hi.getQuadraticArcLength)([e,n[0],n[2]],[t,n[1],n[3]],1);case"A":a=0;let d=n[4],h=n[5],m=n[4]+h,p=Math.PI/180;if(Math.abs(d-m)<p&&(p=Math.abs(d-m)),s=c.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],d,0),h<0)for(l=d-p;l>m;l-=p)r=c.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],l,0),a+=c.getLineLength(s.x,s.y,r.x,r.y),s=r;else for(l=d+p;l<m;l+=p)r=c.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],l,0),a+=c.getLineLength(s.x,s.y,r.x,r.y),s=r;return r=c.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],m,0),a+=c.getLineLength(s.x,s.y,r.x,r.y),a}return 0}static convertEndpointToCenterParameterization(e,t,i,n,a,s,r,l,c){let d=c*(Math.PI/180),h=Math.cos(d)*(e-i)/2+Math.sin(d)*(t-n)/2,m=-1*Math.sin(d)*(e-i)/2+Math.cos(d)*(t-n)/2,p=h*h/(r*r)+m*m/(l*l);p>1&&(r*=Math.sqrt(p),l*=Math.sqrt(p));let f=Math.sqrt((r*r*(l*l)-r*r*(m*m)-l*l*(h*h))/(r*r*(m*m)+l*l*(h*h)));a===s&&(f*=-1),isNaN(f)&&(f=0);let b=f*r*m/l,C=f*-l*h/r,M=(e+i)/2+Math.cos(d)*b-Math.sin(d)*C,w=(t+n)/2+Math.sin(d)*b+Math.cos(d)*C,P=function(B){return Math.sqrt(B[0]*B[0]+B[1]*B[1])},O=function(B,X){return(B[0]*X[0]+B[1]*X[1])/(P(B)*P(X))},E=function(B,X){return(B[0]*X[1]<B[1]*X[0]?-1:1)*Math.acos(O(B,X))},A=E([1,0],[(h-b)/r,(m-C)/l]),D=[(h-b)/r,(m-C)/l],H=[(-1*h-b)/r,(-1*m-C)/l],nt=E(D,H);return O(D,H)<=-1&&(nt=Math.PI),O(D,H)>=1&&(nt=0),s===0&&nt>0&&(nt=nt-2*Math.PI),s===1&&nt<0&&(nt=nt+2*Math.PI),[M,w,r,l,A,nt,d,s]}};fo.Path=si;si.prototype.className="Path";si.prototype._attrsAffectingSize=["data"];(0,Qp._registerNode)(si);Kp.Factory.addGetterSetter(si,"data")});var mc=N(Co=>{"use strict";Object.defineProperty(Co,"__esModule",{value:!0});Co.Arrow=void 0;var bo=K(),Jp=Ja(),hc=Z(),t0=Y(),dc=_o(),Fe=class extends Jp.Line{_sceneFunc(e){super._sceneFunc(e);let t=Math.PI*2,i=this.points(),n=i,a=this.tension()!==0&&i.length>4;a&&(n=this.getTensionPoints());let s=this.pointerLength(),r=i.length,l,c;if(a){let m=[n[n.length-4],n[n.length-3],n[n.length-2],n[n.length-1],i[r-2],i[r-1]],p=dc.Path.calcLength(n[n.length-4],n[n.length-3],"C",m),f=dc.Path.getPointOnQuadraticBezier(Math.min(1,1-s/p),m[0],m[1],m[2],m[3],m[4],m[5]);l=i[r-2]-f.x,c=i[r-1]-f.y}else l=i[r-2]-i[r-4],c=i[r-1]-i[r-3];let d=(Math.atan2(c,l)+t)%t,h=this.pointerWidth();this.pointerAtEnding()&&(e.save(),e.beginPath(),e.translate(i[r-2],i[r-1]),e.rotate(d),e.moveTo(0,0),e.lineTo(-s,h/2),e.lineTo(-s,-h/2),e.closePath(),e.restore(),this.__fillStroke(e)),this.pointerAtBeginning()&&(e.save(),e.beginPath(),e.translate(i[0],i[1]),a?(l=(n[0]+n[2])/2-i[0],c=(n[1]+n[3])/2-i[1]):(l=i[2]-i[0],c=i[3]-i[1]),e.rotate((Math.atan2(-c,-l)+t)%t),e.moveTo(0,0),e.lineTo(-s,h/2),e.lineTo(-s,-h/2),e.closePath(),e.restore(),this.__fillStroke(e))}__fillStroke(e){let t=this.dashEnabled();t&&(this.attrs.dashEnabled=!1,e.setLineDash([])),e.fillStrokeShape(this),t&&(this.attrs.dashEnabled=!0)}getSelfRect(){let e=super.getSelfRect(),t=this.pointerWidth()/2;return{x:e.x,y:e.y-t,width:e.width,height:e.height+t*2}}};Co.Arrow=Fe;Fe.prototype.className="Arrow";(0,t0._registerNode)(Fe);bo.Factory.addGetterSetter(Fe,"pointerLength",10,(0,hc.getNumberValidator)());bo.Factory.addGetterSetter(Fe,"pointerWidth",10,(0,hc.getNumberValidator)());bo.Factory.addGetterSetter(Fe,"pointerAtBeginning",!1);bo.Factory.addGetterSetter(Fe,"pointerAtEnding",!0)});var gc=N(xo=>{"use strict";Object.defineProperty(xo,"__esModule",{value:!0});xo.Circle=void 0;var e0=K(),i0=At(),n0=Z(),o0=Y(),Qe=class extends i0.Shape{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius()!==e/2&&this.radius(e/2)}setHeight(e){this.radius()!==e/2&&this.radius(e/2)}};xo.Circle=Qe;Qe.prototype._centroid=!0;Qe.prototype.className="Circle";Qe.prototype._attrsAffectingSize=["radius"];(0,o0._registerNode)(Qe);e0.Factory.addGetterSetter(Qe,"radius",0,(0,n0.getNumberValidator)())});var uc=N(vo=>{"use strict";Object.defineProperty(vo,"__esModule",{value:!0});vo.Ellipse=void 0;var es=K(),a0=At(),pc=Z(),s0=Y(),we=class extends a0.Shape{_sceneFunc(e){let t=this.radiusX(),i=this.radiusY();e.beginPath(),e.save(),t!==i&&e.scale(1,i/t),e.arc(0,0,t,0,Math.PI*2,!1),e.restore(),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(e){this.radiusX(e/2)}setHeight(e){this.radiusY(e/2)}};vo.Ellipse=we;we.prototype.className="Ellipse";we.prototype._centroid=!0;we.prototype._attrsAffectingSize=["radiusX","radiusY"];(0,s0._registerNode)(we);es.Factory.addComponentsGetterSetter(we,"radius",["x","y"]);es.Factory.addGetterSetter(we,"radiusX",0,(0,pc.getNumberValidator)());es.Factory.addGetterSetter(we,"radiusY",0,(0,pc.getNumberValidator)())});var fc=N(yo=>{"use strict";Object.defineProperty(yo,"__esModule",{value:!0});yo.Image=void 0;var is=xt(),ri=K(),r0=At(),l0=Y(),Cn=Z(),oe=class o extends r0.Shape{constructor(e){super(e),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",t=>{this._removeImageLoad(t.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){let e=this.image();e&&e.complete||e&&e.readyState===4||e&&e.addEventListener&&e.addEventListener("load",this._loadListener)}_removeImageLoad(e){e&&e.removeEventListener&&e.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){let e=!!this.cornerRadius(),t=this.hasShadow();return e&&t?!0:super._useBufferCanvas(!0)}_sceneFunc(e){let t=this.getWidth(),i=this.getHeight(),n=this.cornerRadius(),a=this.attrs.image,s;if(a){let r=this.attrs.cropWidth,l=this.attrs.cropHeight;r&&l?s=[a,this.cropX(),this.cropY(),r,l,0,0,t,i]:s=[a,0,0,t,i]}(this.hasFill()||this.hasStroke()||n)&&(e.beginPath(),n?is.Util.drawRoundedRectPath(e,t,i,n):e.rect(0,0,t,i),e.closePath(),e.fillStrokeShape(this)),a&&(n&&e.clip(),e.drawImage.apply(e,s))}_hitFunc(e){let t=this.width(),i=this.height(),n=this.cornerRadius();e.beginPath(),n?is.Util.drawRoundedRectPath(e,t,i,n):e.rect(0,0,t,i),e.closePath(),e.fillStrokeShape(this)}getWidth(){var e,t;return(e=this.attrs.width)!==null&&e!==void 0?e:(t=this.image())===null||t===void 0?void 0:t.width}getHeight(){var e,t;return(e=this.attrs.height)!==null&&e!==void 0?e:(t=this.image())===null||t===void 0?void 0:t.height}static fromURL(e,t,i=null){let n=is.Util.createImageElement();n.onload=function(){let a=new o({image:n});t(a)},n.onerror=i,n.crossOrigin="Anonymous",n.src=e}};yo.Image=oe;oe.prototype.className="Image";(0,l0._registerNode)(oe);ri.Factory.addGetterSetter(oe,"cornerRadius",0,(0,Cn.getNumberOrArrayOfNumbersValidator)(4));ri.Factory.addGetterSetter(oe,"image");ri.Factory.addComponentsGetterSetter(oe,"crop",["x","y","width","height"]);ri.Factory.addGetterSetter(oe,"cropX",0,(0,Cn.getNumberValidator)());ri.Factory.addGetterSetter(oe,"cropY",0,(0,Cn.getNumberValidator)());ri.Factory.addGetterSetter(oe,"cropWidth",0,(0,Cn.getNumberValidator)());ri.Factory.addGetterSetter(oe,"cropHeight",0,(0,Cn.getNumberValidator)())});var Cc=N(qi=>{"use strict";Object.defineProperty(qi,"__esModule",{value:!0});qi.Tag=qi.Label=void 0;var wo=K(),c0=At(),d0=ro(),rs=Z(),_c=Y(),bc=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],h0="Change.konva",m0="none",ns="up",os="right",as="down",ss="left",g0=bc.length,xn=class extends d0.Group{constructor(e){super(e),this.on("add.konva",function(t){this._addListeners(t.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(e){let t=this,i,n=function(){t._sync()};for(i=0;i<g0;i++)e.on(bc[i]+h0,n)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let e=this.getText(),t=this.getTag(),i,n,a,s,r,l,c;if(e&&t){switch(i=e.width(),n=e.height(),a=t.pointerDirection(),s=t.pointerWidth(),c=t.pointerHeight(),r=0,l=0,a){case ns:r=i/2,l=-1*c;break;case os:r=i+s,l=n/2;break;case as:r=i/2,l=n+c;break;case ss:r=-1*s,l=n/2;break}t.setAttrs({x:-1*r,y:-1*l,width:i,height:n}),e.setAttrs({x:-1*r,y:-1*l})}}};qi.Label=xn;xn.prototype.className="Label";(0,_c._registerNode)(xn);var Re=class extends c0.Shape{_sceneFunc(e){let t=this.width(),i=this.height(),n=this.pointerDirection(),a=this.pointerWidth(),s=this.pointerHeight(),r=this.cornerRadius(),l=0,c=0,d=0,h=0;typeof r=="number"?l=c=d=h=Math.min(r,t/2,i/2):(l=Math.min(r[0]||0,t/2,i/2),c=Math.min(r[1]||0,t/2,i/2),h=Math.min(r[2]||0,t/2,i/2),d=Math.min(r[3]||0,t/2,i/2)),e.beginPath(),e.moveTo(l,0),n===ns&&(e.lineTo((t-a)/2,0),e.lineTo(t/2,-1*s),e.lineTo((t+a)/2,0)),e.lineTo(t-c,0),e.arc(t-c,c,c,Math.PI*3/2,0,!1),n===os&&(e.lineTo(t,(i-s)/2),e.lineTo(t+a,i/2),e.lineTo(t,(i+s)/2)),e.lineTo(t,i-h),e.arc(t-h,i-h,h,0,Math.PI/2,!1),n===as&&(e.lineTo((t+a)/2,i),e.lineTo(t/2,i+s),e.lineTo((t-a)/2,i)),e.lineTo(d,i),e.arc(d,i-d,d,Math.PI/2,Math.PI,!1),n===ss&&(e.lineTo(0,(i+s)/2),e.lineTo(-1*a,i/2),e.lineTo(0,(i-s)/2)),e.lineTo(0,l),e.arc(l,l,l,Math.PI,Math.PI*3/2,!1),e.closePath(),e.fillStrokeShape(this)}getSelfRect(){let e=0,t=0,i=this.pointerWidth(),n=this.pointerHeight(),a=this.pointerDirection(),s=this.width(),r=this.height();return a===ns?(t-=n,r+=n):a===as?r+=n:a===ss?(e-=i*1.5,s+=i):a===os&&(s+=i*1.5),{x:e,y:t,width:s,height:r}}};qi.Tag=Re;Re.prototype.className="Tag";(0,_c._registerNode)(Re);wo.Factory.addGetterSetter(Re,"pointerDirection",m0);wo.Factory.addGetterSetter(Re,"pointerWidth",0,(0,rs.getNumberValidator)());wo.Factory.addGetterSetter(Re,"pointerHeight",0,(0,rs.getNumberValidator)());wo.Factory.addGetterSetter(Re,"cornerRadius",0,(0,rs.getNumberOrArrayOfNumbersValidator)(4))});var ls=N(Mo=>{"use strict";Object.defineProperty(Mo,"__esModule",{value:!0});Mo.Rect=void 0;var p0=K(),u0=At(),f0=Y(),_0=xt(),b0=Z(),Wi=class extends u0.Shape{_sceneFunc(e){let t=this.cornerRadius(),i=this.width(),n=this.height();e.beginPath(),t?_0.Util.drawRoundedRectPath(e,i,n,t):e.rect(0,0,i,n),e.closePath(),e.fillStrokeShape(this)}};Mo.Rect=Wi;Wi.prototype.className="Rect";(0,f0._registerNode)(Wi);p0.Factory.addGetterSetter(Wi,"cornerRadius",0,(0,b0.getNumberOrArrayOfNumbersValidator)(4))});var yc=N(Po=>{"use strict";Object.defineProperty(Po,"__esModule",{value:!0});Po.RegularPolygon=void 0;var xc=K(),C0=At(),vc=Z(),x0=Y(),Ne=class extends C0.Shape{_sceneFunc(e){let t=this._getPoints();e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let i=1;i<t.length;i++)e.lineTo(t[i].x,t[i].y);e.closePath(),e.fillStrokeShape(this)}_getPoints(){let e=this.attrs.sides,t=this.attrs.radius||0,i=[];for(let n=0;n<e;n++)i.push({x:t*Math.sin(n*2*Math.PI/e),y:-1*t*Math.cos(n*2*Math.PI/e)});return i}getSelfRect(){let e=this._getPoints(),t=e[0].x,i=e[0].y,n=e[0].x,a=e[0].y;return e.forEach(s=>{t=Math.min(t,s.x),i=Math.max(i,s.x),n=Math.min(n,s.y),a=Math.max(a,s.y)}),{x:t,y:n,width:i-t,height:a-n}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}};Po.RegularPolygon=Ne;Ne.prototype.className="RegularPolygon";Ne.prototype._centroid=!0;Ne.prototype._attrsAffectingSize=["radius"];(0,x0._registerNode)(Ne);xc.Factory.addGetterSetter(Ne,"radius",0,(0,vc.getNumberValidator)());xc.Factory.addGetterSetter(Ne,"sides",0,(0,vc.getNumberValidator)())});var Oc=N(Oo=>{"use strict";Object.defineProperty(Oo,"__esModule",{value:!0});Oo.Ring=void 0;var Mc=K(),v0=At(),Pc=Z(),y0=Y(),wc=Math.PI*2,Be=class extends v0.Shape{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.innerRadius(),0,wc,!1),e.moveTo(this.outerRadius(),0),e.arc(0,0,this.outerRadius(),wc,0,!0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}};Oo.Ring=Be;Be.prototype.className="Ring";Be.prototype._centroid=!0;Be.prototype._attrsAffectingSize=["innerRadius","outerRadius"];(0,y0._registerNode)(Be);Mc.Factory.addGetterSetter(Be,"innerRadius",0,(0,Pc.getNumberValidator)());Mc.Factory.addGetterSetter(Be,"outerRadius",0,(0,Pc.getNumberValidator)())});var Sc=N(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0});ko.Sprite=void 0;var li=K(),w0=At(),M0=co(),kc=Z(),P0=Y(),ae=class extends w0.Shape{constructor(e){super(e),this._updated=!0,this.anim=new M0.Animation(()=>{let t=this._updated;return this._updated=!1,t}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(e){let t=this.animation(),i=this.frameIndex(),n=i*4,a=this.animations()[t],s=this.frameOffsets(),r=a[n+0],l=a[n+1],c=a[n+2],d=a[n+3],h=this.image();if((this.hasFill()||this.hasStroke())&&(e.beginPath(),e.rect(0,0,c,d),e.closePath(),e.fillStrokeShape(this)),h)if(s){let m=s[t],p=i*2;e.drawImage(h,r,l,c,d,m[p+0],m[p+1],c,d)}else e.drawImage(h,r,l,c,d,0,0,c,d)}_hitFunc(e){let t=this.animation(),i=this.frameIndex(),n=i*4,a=this.animations()[t],s=this.frameOffsets(),r=a[n+2],l=a[n+3];if(e.beginPath(),s){let c=s[t],d=i*2;e.rect(c[d+0],c[d+1],r,l)}else e.rect(0,0,r,l);e.closePath(),e.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){let e=this;this.interval=setInterval(function(){e._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;let e=this.getLayer();this.anim.setLayers(e),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){let e=this.frameIndex(),t=this.animation(),i=this.animations(),n=i[t],a=n.length/4;e<a-1?this.frameIndex(e+1):this.frameIndex(0)}};ko.Sprite=ae;ae.prototype.className="Sprite";(0,P0._registerNode)(ae);li.Factory.addGetterSetter(ae,"animation");li.Factory.addGetterSetter(ae,"animations");li.Factory.addGetterSetter(ae,"frameOffsets");li.Factory.addGetterSetter(ae,"image");li.Factory.addGetterSetter(ae,"frameIndex",0,(0,kc.getNumberValidator)());li.Factory.addGetterSetter(ae,"frameRate",17,(0,kc.getNumberValidator)());li.Factory.backCompat(ae,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"})});var Tc=N(So=>{"use strict";Object.defineProperty(So,"__esModule",{value:!0});So.Star=void 0;var cs=K(),O0=At(),ds=Z(),k0=Y(),Me=class extends O0.Shape{_sceneFunc(e){let t=this.innerRadius(),i=this.outerRadius(),n=this.numPoints();e.beginPath(),e.moveTo(0,0-i);for(let a=1;a<n*2;a++){let s=a%2===0?i:t,r=s*Math.sin(a*Math.PI/n),l=-1*s*Math.cos(a*Math.PI/n);e.lineTo(r,l)}e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}};So.Star=Me;Me.prototype.className="Star";Me.prototype._centroid=!0;Me.prototype._attrsAffectingSize=["innerRadius","outerRadius"];(0,k0._registerNode)(Me);cs.Factory.addGetterSetter(Me,"numPoints",5,(0,ds.getNumberValidator)());cs.Factory.addGetterSetter(Me,"innerRadius",0,(0,ds.getNumberValidator)());cs.Factory.addGetterSetter(Me,"outerRadius",0,(0,ds.getNumberValidator)())});var us=N(yn=>{"use strict";Object.defineProperty(yn,"__esModule",{value:!0});yn.Text=void 0;yn.stringToArray=ci;var ps=xt(),jt=K(),S0=At(),hs=Y(),Ze=Z(),T0=Y();function ci(o){return[...o].reduce((e,t,i,n)=>{if(new RegExp("\\p{Emoji}","u").test(t)){let a=n[i+1];a&&new RegExp("\\p{Emoji_Modifier}|\\u200D","u").test(a)?(e.push(t+a),n[i+1]=""):e.push(t)}else new RegExp("\\p{Regional_Indicator}{2}","u").test(t+(n[i+1]||""))?e.push(t+n[i+1]):i>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(t)?e[e.length-1]+=t:t&&e.push(t);return e},[])}var Yi="auto",I0="center",Dc="inherit",vn="justify",A0="Change.konva",E0="2d",Ic="-",Fc="left",L0="text",D0="Text",F0="top",R0="bottom",Ac="middle",Rc="normal",N0="px ",To=" ",B0="right",Ec="rtl",V0="word",z0="char",Lc="none",ms="\u2026",Nc=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],G0=Nc.length;function U0(o){return o.split(",").map(e=>{e=e.trim();let t=e.indexOf(" ")>=0,i=e.indexOf('"')>=0||e.indexOf("'")>=0;return t&&!i&&(e=`"${e}"`),e}).join(", ")}var Io;function gs(){return Io||(Io=ps.Util.createCanvasElement().getContext(E0),Io)}function j0(o){o.fillText(this._partialText,this._partialTextX,this._partialTextY)}function H0(o){o.setAttr("miterLimit",2),o.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function q0(o){return o=o||{},!o.fillLinearGradientColorStops&&!o.fillRadialGradientColorStops&&!o.fillPatternImage&&(o.fill=o.fill||"black"),o}var ft=class extends S0.Shape{constructor(e){super(q0(e)),this._partialTextX=0,this._partialTextY=0;for(let t=0;t<G0;t++)this.on(Nc[t]+A0,this._setTextData);this._setTextData()}_sceneFunc(e){let t=this.textArr,i=t.length;if(!this.text())return;let n=this.padding(),a=this.fontSize(),s=this.lineHeight()*a,r=this.verticalAlign(),l=this.direction(),c=0,d=this.align(),h=this.getWidth(),m=this.letterSpacing(),p=this.fill(),f=this.textDecoration(),b=f.indexOf("underline")!==-1,C=f.indexOf("line-through")!==-1,M;l=l===Dc?e.direction:l;let w=s/2,P=Ac;if(hs.Konva._fixTextRendering){let O=this.measureSize("M");P="alphabetic",w=(O.fontBoundingBoxAscent-O.fontBoundingBoxDescent)/2+s/2}for(l===Ec&&e.setAttr("direction",l),e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",P),e.setAttr("textAlign",Fc),r===Ac?c=(this.getHeight()-i*s-n*2)/2:r===R0&&(c=this.getHeight()-i*s-n*2),e.translate(n,c+n),M=0;M<i;M++){let O=0,E=0,A=t[M],D=A.text,H=A.width,nt=A.lastInParagraph;if(e.save(),d===B0?O+=h-H-n*2:d===I0&&(O+=(h-H-n*2)/2),b){e.save(),e.beginPath();let B=hs.Konva._fixTextRendering?Math.round(a/4):Math.round(a/2),X=O,F=w+E+B;e.moveTo(X,F);let j=d===vn&&!nt?h-n*2:H;e.lineTo(X+Math.round(j),F),e.lineWidth=a/15;let st=this._getLinearGradient();e.strokeStyle=st||p,e.stroke(),e.restore()}if(C){e.save(),e.beginPath();let B=hs.Konva._fixTextRendering?-Math.round(a/4):0;e.moveTo(O,w+E+B);let X=d===vn&&!nt?h-n*2:H;e.lineTo(O+Math.round(X),w+E+B),e.lineWidth=a/15;let F=this._getLinearGradient();e.strokeStyle=F||p,e.stroke(),e.restore()}if(l!==Ec&&(m!==0||d===vn)){let B=D.split(" ").length-1,X=ci(D);for(let F=0;F<X.length;F++){let j=X[F];j===" "&&!nt&&d===vn&&(O+=(h-n*2-H)/B),this._partialTextX=O,this._partialTextY=w+E,this._partialText=j,e.fillStrokeShape(this),O+=this.measureSize(j).width+m}}else m!==0&&e.setAttr("letterSpacing",`${m}px`),this._partialTextX=O,this._partialTextY=w+E,this._partialText=D,e.fillStrokeShape(this);e.restore(),i>1&&(w+=s)}}_hitFunc(e){let t=this.getWidth(),i=this.getHeight();e.beginPath(),e.rect(0,0,t,i),e.closePath(),e.fillStrokeShape(this)}setText(e){let t=ps.Util._isString(e)?e:e==null?"":e+"";return this._setAttr(L0,t),this}getWidth(){return this.attrs.width===Yi||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===Yi||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return ps.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(e){var t,i,n,a,s,r,l,c,d,h,m;let p=gs(),f=this.fontSize(),b;p.save(),p.font=this._getContextFont(),b=p.measureText(e),p.restore();let C=f/100;return{actualBoundingBoxAscent:(t=b.actualBoundingBoxAscent)!==null&&t!==void 0?t:71.58203125*C,actualBoundingBoxDescent:(i=b.actualBoundingBoxDescent)!==null&&i!==void 0?i:0,actualBoundingBoxLeft:(n=b.actualBoundingBoxLeft)!==null&&n!==void 0?n:-7.421875*C,actualBoundingBoxRight:(a=b.actualBoundingBoxRight)!==null&&a!==void 0?a:75.732421875*C,alphabeticBaseline:(s=b.alphabeticBaseline)!==null&&s!==void 0?s:0,emHeightAscent:(r=b.emHeightAscent)!==null&&r!==void 0?r:100*C,emHeightDescent:(l=b.emHeightDescent)!==null&&l!==void 0?l:-20*C,fontBoundingBoxAscent:(c=b.fontBoundingBoxAscent)!==null&&c!==void 0?c:91*C,fontBoundingBoxDescent:(d=b.fontBoundingBoxDescent)!==null&&d!==void 0?d:21*C,hangingBaseline:(h=b.hangingBaseline)!==null&&h!==void 0?h:72.80000305175781*C,ideographicBaseline:(m=b.ideographicBaseline)!==null&&m!==void 0?m:-21*C,width:b.width,height:f}}_getContextFont(){return this.fontStyle()+To+this.fontVariant()+To+(this.fontSize()+N0)+U0(this.fontFamily())}_addTextLine(e){this.align()===vn&&(e=e.trim());let i=this._getTextWidth(e);return this.textArr.push({text:e,width:i,lastInParagraph:!1})}_getTextWidth(e){let t=this.letterSpacing(),i=e.length;return gs().measureText(e).width+t*i}_setTextData(){let e=this.text().split(`
`),t=+this.fontSize(),i=0,n=this.lineHeight()*t,a=this.attrs.width,s=this.attrs.height,r=a!==Yi&&a!==void 0,l=s!==Yi&&s!==void 0,c=this.padding(),d=a-c*2,h=s-c*2,m=0,p=this.wrap(),f=p!==Lc,b=p!==z0&&f,C=this.ellipsis();this.textArr=[],gs().font=this._getContextFont();let M=C?this._getTextWidth(ms):0;for(let w=0,P=e.length;w<P;++w){let O=e[w],E=this._getTextWidth(O);if(r&&E>d)for(;O.length>0;){let A=0,D=ci(O).length,H="",nt=0;for(;A<D;){let B=A+D>>>1,X=ci(O),F=X.slice(0,B+1).join(""),j=this._getTextWidth(F);(C&&l&&m+n>h?j+M:j)<=d?(A=B+1,H=F,nt=j):D=B}if(H){if(b){let F=ci(O),j=ci(H),st=F[j.length],rt=st===To||st===Ic,ut;if(rt&&nt<=d)ut=j.length;else{let zt=j.lastIndexOf(To),Q=j.lastIndexOf(Ic);ut=Math.max(zt,Q)+1}ut>0&&(A=ut,H=F.slice(0,A).join(""),nt=this._getTextWidth(H))}if(H=H.trimRight(),this._addTextLine(H),i=Math.max(i,nt),m+=n,this._shouldHandleEllipsis(m)){this._tryToAddEllipsisToLastLine();break}if(O=ci(O).slice(A).join("").trimLeft(),O.length>0&&(E=this._getTextWidth(O),E<=d)){this._addTextLine(O),m+=n,i=Math.max(i,E);break}}else break}else this._addTextLine(O),m+=n,i=Math.max(i,E),this._shouldHandleEllipsis(m)&&w<P-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),l&&m+n>h)break}this.textHeight=t,this.textWidth=i}_shouldHandleEllipsis(e){let t=+this.fontSize(),i=this.lineHeight()*t,n=this.attrs.height,a=n!==Yi&&n!==void 0,s=this.padding(),r=n-s*2;return!(this.wrap()!==Lc)||a&&e+i>r}_tryToAddEllipsisToLastLine(){let e=this.attrs.width,t=e!==Yi&&e!==void 0,i=this.padding(),n=e-i*2,a=this.ellipsis(),s=this.textArr[this.textArr.length-1];!s||!a||(t&&(this._getTextWidth(s.text+ms)<n||(s.text=s.text.slice(0,s.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(s.text+ms))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){let e=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,t=this.hasShadow();return e&&t?!0:super._useBufferCanvas()}};yn.Text=ft;ft.prototype._fillFunc=j0;ft.prototype._strokeFunc=H0;ft.prototype.className=D0;ft.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"];(0,T0._registerNode)(ft);jt.Factory.overWriteSetter(ft,"width",(0,Ze.getNumberOrAutoValidator)());jt.Factory.overWriteSetter(ft,"height",(0,Ze.getNumberOrAutoValidator)());jt.Factory.addGetterSetter(ft,"direction",Dc);jt.Factory.addGetterSetter(ft,"fontFamily","Arial");jt.Factory.addGetterSetter(ft,"fontSize",12,(0,Ze.getNumberValidator)());jt.Factory.addGetterSetter(ft,"fontStyle",Rc);jt.Factory.addGetterSetter(ft,"fontVariant",Rc);jt.Factory.addGetterSetter(ft,"padding",0,(0,Ze.getNumberValidator)());jt.Factory.addGetterSetter(ft,"align",Fc);jt.Factory.addGetterSetter(ft,"verticalAlign",F0);jt.Factory.addGetterSetter(ft,"lineHeight",1,(0,Ze.getNumberValidator)());jt.Factory.addGetterSetter(ft,"wrap",V0);jt.Factory.addGetterSetter(ft,"ellipsis",!1,(0,Ze.getBooleanValidator)());jt.Factory.addGetterSetter(ft,"letterSpacing",0,(0,Ze.getNumberValidator)());jt.Factory.addGetterSetter(ft,"text","",(0,Ze.getStringValidator)());jt.Factory.addGetterSetter(ft,"textDecoration","")});var Uc=N(Ao=>{"use strict";Object.defineProperty(Ao,"__esModule",{value:!0});Ao.TextPath=void 0;var fs=xt(),he=K(),W0=At(),wn=_o(),_s=us(),Bc=Z(),Y0=Y(),X0="",Vc="normal";function zc(o){o.fillText(this.partialText,0,0)}function Gc(o){o.strokeText(this.partialText,0,0)}var Ot=class extends W0.Shape{constructor(e){super(e),this.dummyCanvas=fs.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return wn.Path.getPathLength(this.dataArray)}_getPointAtLength(e){if(!this.attrs.data)return null;let t=this.pathLength;return e-1>t?null:wn.Path.getPointAtLengthOfDataArray(e,this.dataArray)}_readDataAttribute(){this.dataArray=wn.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(e){e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",this.textBaseline()),e.setAttr("textAlign","left"),e.save();let t=this.textDecoration(),i=this.fill(),n=this.fontSize(),a=this.glyphInfo;t==="underline"&&e.beginPath();for(let s=0;s<a.length;s++){e.save();let r=a[s].p0;e.translate(r.x,r.y),e.rotate(a[s].rotation),this.partialText=a[s].text,e.fillStrokeShape(this),t==="underline"&&(s===0&&e.moveTo(0,n/2+1),e.lineTo(n,n/2+1)),e.restore()}t==="underline"&&(e.strokeStyle=i,e.lineWidth=n/20,e.stroke()),e.restore()}_hitFunc(e){e.beginPath();let t=this.glyphInfo;if(t.length>=1){let i=t[0].p0;e.moveTo(i.x,i.y)}for(let i=0;i<t.length;i++){let n=t[i].p1;e.lineTo(n.x,n.y)}e.setAttr("lineWidth",this.fontSize()),e.setAttr("strokeStyle",this.colorKey),e.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return fs.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(e){return _s.Text.prototype.setText.call(this,e)}_getContextFont(){return _s.Text.prototype._getContextFont.call(this)}_getTextSize(e){let i=this.dummyCanvas.getContext("2d");i.save(),i.font=this._getContextFont();let n=i.measureText(e);return i.restore(),{width:n.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){let{width:e,height:t}=this._getTextSize(this.attrs.text);if(this.textWidth=e,this.textHeight=t,this.glyphInfo=[],!this.attrs.data)return null;let i=this.letterSpacing(),n=this.align(),a=this.kerningFunc(),s=Math.max(this.textWidth+((this.attrs.text||"").length-1)*i,0),r=0;n==="center"&&(r=Math.max(0,this.pathLength/2-s/2)),n==="right"&&(r=Math.max(0,this.pathLength-s));let l=(0,_s.stringToArray)(this.text()),c=r;for(let d=0;d<l.length;d++){let h=this._getPointAtLength(c);if(!h)return;let m=this._getTextSize(l[d]).width+i;if(l[d]===" "&&n==="justify"){let w=this.text().split(" ").length-1;m+=(this.pathLength-s)/w}let p=this._getPointAtLength(c+m);if(!p)return;let f=wn.Path.getLineLength(h.x,h.y,p.x,p.y),b=0;if(a)try{b=a(l[d-1],l[d])*this.fontSize()}catch{b=0}h.x+=b,p.x+=b,this.textWidth+=b;let C=wn.Path.getPointOnLine(b+f/2,h.x,h.y,p.x,p.y),M=Math.atan2(p.y-h.y,p.x-h.x);this.glyphInfo.push({transposeX:C.x,transposeY:C.y,text:l[d],rotation:M,p0:h,p1:p}),c+=m}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};let e=[];this.glyphInfo.forEach(function(c){e.push(c.p0.x),e.push(c.p0.y),e.push(c.p1.x),e.push(c.p1.y)});let t=e[0]||0,i=e[0]||0,n=e[1]||0,a=e[1]||0,s,r;for(let c=0;c<e.length/2;c++)s=e[c*2],r=e[c*2+1],t=Math.min(t,s),i=Math.max(i,s),n=Math.min(n,r),a=Math.max(a,r);let l=this.fontSize();return{x:t-l/2,y:n-l/2,width:i-t+l,height:a-n+l}}destroy(){return fs.Util.releaseCanvas(this.dummyCanvas),super.destroy()}};Ao.TextPath=Ot;Ot.prototype._fillFunc=zc;Ot.prototype._strokeFunc=Gc;Ot.prototype._fillFuncHit=zc;Ot.prototype._strokeFuncHit=Gc;Ot.prototype.className="TextPath";Ot.prototype._attrsAffectingSize=["text","fontSize","data"];(0,Y0._registerNode)(Ot);he.Factory.addGetterSetter(Ot,"data");he.Factory.addGetterSetter(Ot,"fontFamily","Arial");he.Factory.addGetterSetter(Ot,"fontSize",12,(0,Bc.getNumberValidator)());he.Factory.addGetterSetter(Ot,"fontStyle",Vc);he.Factory.addGetterSetter(Ot,"align","left");he.Factory.addGetterSetter(Ot,"letterSpacing",0,(0,Bc.getNumberValidator)());he.Factory.addGetterSetter(Ot,"textBaseline","middle");he.Factory.addGetterSetter(Ot,"fontVariant",Vc);he.Factory.addGetterSetter(Ot,"text",X0);he.Factory.addGetterSetter(Ot,"textDecoration","");he.Factory.addGetterSetter(Ot,"kerningFunc",void 0)});var $c=N(Lo=>{"use strict";Object.defineProperty(Lo,"__esModule",{value:!0});Lo.Transformer=void 0;var lt=xt(),at=K(),jc=yt(),$0=At(),K0=ls(),Hc=ro(),me=Y(),Je=Z(),Q0=Y(),Yc="tr-konva",Z0=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(o=>o+`.${Yc}`).join(" "),qc="nodesRect",J0=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],tu={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},eu="ontouchstart"in me.Konva._global;function iu(o,e,t){if(o==="rotater")return t;e+=lt.Util.degToRad(tu[o]||0);let i=(lt.Util.radToDeg(e)%360+360)%360;return lt.Util._inRange(i,315+22.5,360)||lt.Util._inRange(i,0,22.5)?"ns-resize":lt.Util._inRange(i,45-22.5,45+22.5)?"nesw-resize":lt.Util._inRange(i,90-22.5,90+22.5)?"ew-resize":lt.Util._inRange(i,135-22.5,135+22.5)?"nwse-resize":lt.Util._inRange(i,180-22.5,180+22.5)?"ns-resize":lt.Util._inRange(i,225-22.5,225+22.5)?"nesw-resize":lt.Util._inRange(i,270-22.5,270+22.5)?"ew-resize":lt.Util._inRange(i,315-22.5,315+22.5)?"nwse-resize":(lt.Util.error("Transformer has unknown angle for cursor detection: "+i),"pointer")}var Eo=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],Wc=1e8;function nu(o){return{x:o.x+o.width/2*Math.cos(o.rotation)+o.height/2*Math.sin(-o.rotation),y:o.y+o.height/2*Math.cos(o.rotation)+o.width/2*Math.sin(o.rotation)}}function Xc(o,e,t){let i=t.x+(o.x-t.x)*Math.cos(e)-(o.y-t.y)*Math.sin(e),n=t.y+(o.x-t.x)*Math.sin(e)+(o.y-t.y)*Math.cos(e);return Os($t({},o),{rotation:o.rotation+e,x:i,y:n})}function ou(o,e){let t=nu(o);return Xc(o,e,t)}function au(o,e,t){let i=e;for(let n=0;n<o.length;n++){let a=me.Konva.getAngle(o[n]),s=Math.abs(a-e)%(Math.PI*2);Math.min(s,Math.PI*2-s)<t&&(i=a)}return i}var bs=0,J=class extends Hc.Group{constructor(e){super(e),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(Z0,this.update),this.getNode()&&this.update()}attachTo(e){return this.setNode(e),this}setNode(e){return lt.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([e])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return Yc+this._id}setNodes(e=[]){this._nodes&&this._nodes.length&&this.detach();let t=e.filter(n=>n.isAncestorOf(this)?(lt.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=e=t,e.length===1&&this.useSingleNodeRotation()?this.rotation(e[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(n=>{let a=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()};if(n._attrsAffectingSize.length){let s=n._attrsAffectingSize.map(r=>r+"Change."+this._getEventNamespace()).join(" ");n.on(s,a)}n.on(J0.map(s=>s+`.${this._getEventNamespace()}`).join(" "),a),n.on(`absoluteTransformChange.${this._getEventNamespace()}`,a),this._proxyDrag(n)}),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(e){let t;e.on(`dragstart.${this._getEventNamespace()}`,i=>{t=e.getAbsolutePosition(),!this.isDragging()&&e!==this.findOne(".back")&&this.startDrag(i,!1)}),e.on(`dragmove.${this._getEventNamespace()}`,i=>{if(!t)return;let n=e.getAbsolutePosition(),a=n.x-t.x,s=n.y-t.y;this.nodes().forEach(r=>{if(r===e||r.isDragging())return;let l=r.getAbsolutePosition();r.setAbsolutePosition({x:l.x+a,y:l.y+s}),r.startDrag(i)}),t=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(e=>{e.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(qc),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(qc,this.__getNodeRect)}__getNodeShape(e,t=this.rotation(),i){let n=e.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),a=e.getAbsoluteScale(i),s=e.getAbsolutePosition(i),r=n.x*a.x-e.offsetX()*a.x,l=n.y*a.y-e.offsetY()*a.y,c=(me.Konva.getAngle(e.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),d={x:s.x+r*Math.cos(c)+l*Math.sin(-c),y:s.y+l*Math.cos(c)+r*Math.sin(c),width:n.width*a.x,height:n.height*a.y,rotation:c};return Xc(d,-me.Konva.getAngle(t),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-Wc,y:-Wc,width:0,height:0,rotation:0};let t=[];this.nodes().map(c=>{let d=c.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),h=[{x:d.x,y:d.y},{x:d.x+d.width,y:d.y},{x:d.x+d.width,y:d.y+d.height},{x:d.x,y:d.y+d.height}],m=c.getAbsoluteTransform();h.forEach(function(p){let f=m.point(p);t.push(f)})});let i=new lt.Transform;i.rotate(-me.Konva.getAngle(this.rotation()));let n=1/0,a=1/0,s=-1/0,r=-1/0;t.forEach(function(c){let d=i.point(c);n===void 0&&(n=s=d.x,a=r=d.y),n=Math.min(n,d.x),a=Math.min(a,d.y),s=Math.max(s,d.x),r=Math.max(r,d.y)}),i.invert();let l=i.point({x:n,y:a});return{x:l.x,y:l.y,width:s-n,height:r-a,rotation:me.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),Eo.forEach(e=>{this._createAnchor(e)}),this._createAnchor("rotater")}_createAnchor(e){let t=new K0.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:e+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:eu?10:"auto"}),i=this;t.on("mousedown touchstart",function(n){i._handleMouseDown(n)}),t.on("dragstart",n=>{t.stopDrag(),n.cancelBubble=!0}),t.on("dragend",n=>{n.cancelBubble=!0}),t.on("mouseenter",()=>{let n=me.Konva.getAngle(this.rotation()),a=this.rotateAnchorCursor(),s=iu(e,n,a);t.getStage().content&&(t.getStage().content.style.cursor=s),this._cursorChange=!0}),t.on("mouseout",()=>{t.getStage().content&&(t.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(t)}_createBack(){let e=new $0.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(t,i){let n=i.getParent(),a=n.padding();t.beginPath(),t.rect(-a,-a,i.width()+a*2,i.height()+a*2),t.moveTo(i.width()/2,-a),n.rotateEnabled()&&n.rotateLineVisible()&&t.lineTo(i.width()/2,-n.rotateAnchorOffset()*lt.Util._sign(i.height())-a),t.fillStrokeShape(i)},hitFunc:(t,i)=>{if(!this.shouldOverdrawWholeArea())return;let n=this.padding();t.beginPath(),t.rect(-n,-n,i.width()+n*2,i.height()+n*2),t.fillStrokeShape(i)}});this.add(e),this._proxyDrag(e),e.on("dragstart",t=>{t.cancelBubble=!0}),e.on("dragmove",t=>{t.cancelBubble=!0}),e.on("dragend",t=>{t.cancelBubble=!0}),this.on("dragmove",t=>{this.update()})}_handleMouseDown(e){if(this._transforming)return;this._movingAnchorName=e.target.name().split(" ")[0];let t=this._getNodeRect(),i=t.width,n=t.height,a=Math.sqrt(Math.pow(i,2)+Math.pow(n,2));this.sin=Math.abs(n/a),this.cos=Math.abs(i/a),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;let s=e.target.getAbsolutePosition(),r=e.target.getStage().getPointerPosition();this._anchorDragOffset={x:r.x-s.x,y:r.y-s.y},bs++,this._fire("transformstart",{evt:e.evt,target:this.getNode()}),this._nodes.forEach(l=>{l._fire("transformstart",{evt:e.evt,target:l})})}_handleMouseMove(e){let t,i,n,a=this.findOne("."+this._movingAnchorName),s=a.getStage();s.setPointersPositions(e);let r=s.getPointerPosition(),l={x:r.x-this._anchorDragOffset.x,y:r.y-this._anchorDragOffset.y},c=a.getAbsolutePosition();this.anchorDragBoundFunc()&&(l=this.anchorDragBoundFunc()(c,l,e)),a.setAbsolutePosition(l);let d=a.getAbsolutePosition();if(c.x===d.x&&c.y===d.y)return;if(this._movingAnchorName==="rotater"){let w=this._getNodeRect();t=a.x()-w.width/2,i=-a.y()+w.height/2;let P=Math.atan2(-i,t)+Math.PI/2;w.height<0&&(P-=Math.PI);let E=me.Konva.getAngle(this.rotation())+P,A=me.Konva.getAngle(this.rotationSnapTolerance()),H=au(this.rotationSnaps(),E,A)-w.rotation,nt=ou(w,H);this._fitNodesInto(nt,e);return}let h=this.shiftBehavior(),m;h==="inverted"?m=this.keepRatio()&&!e.shiftKey:h==="none"?m=this.keepRatio():m=this.keepRatio()||e.shiftKey;let p=this.centeredScaling()||e.altKey;if(this._movingAnchorName==="top-left"){if(m){let w=p?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};n=Math.sqrt(Math.pow(w.x-a.x(),2)+Math.pow(w.y-a.y(),2));let P=this.findOne(".top-left").x()>w.x?-1:1,O=this.findOne(".top-left").y()>w.y?-1:1;t=n*this.cos*P,i=n*this.sin*O,this.findOne(".top-left").x(w.x-t),this.findOne(".top-left").y(w.y-i)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(a.y());else if(this._movingAnchorName==="top-right"){if(m){let w=p?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};n=Math.sqrt(Math.pow(a.x()-w.x,2)+Math.pow(w.y-a.y(),2));let P=this.findOne(".top-right").x()<w.x?-1:1,O=this.findOne(".top-right").y()>w.y?-1:1;t=n*this.cos*P,i=n*this.sin*O,this.findOne(".top-right").x(w.x+t),this.findOne(".top-right").y(w.y-i)}var f=a.position();this.findOne(".top-left").y(f.y),this.findOne(".bottom-right").x(f.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(a.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(a.x());else if(this._movingAnchorName==="bottom-left"){if(m){let w=p?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};n=Math.sqrt(Math.pow(w.x-a.x(),2)+Math.pow(a.y()-w.y,2));let P=w.x<a.x()?-1:1,O=a.y()<w.y?-1:1;t=n*this.cos*P,i=n*this.sin*O,a.x(w.x-t),a.y(w.y+i)}f=a.position(),this.findOne(".top-left").x(f.x),this.findOne(".bottom-right").y(f.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(a.y());else if(this._movingAnchorName==="bottom-right"){if(m){let w=p?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};n=Math.sqrt(Math.pow(a.x()-w.x,2)+Math.pow(a.y()-w.y,2));let P=this.findOne(".bottom-right").x()<w.x?-1:1,O=this.findOne(".bottom-right").y()<w.y?-1:1;t=n*this.cos*P,i=n*this.sin*O,this.findOne(".bottom-right").x(w.x+t),this.findOne(".bottom-right").y(w.y+i)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));if(p=this.centeredScaling()||e.altKey,p){let w=this.findOne(".top-left"),P=this.findOne(".bottom-right"),O=w.x(),E=w.y(),A=this.getWidth()-P.x(),D=this.getHeight()-P.y();P.move({x:-O,y:-E}),w.move({x:A,y:D})}let b=this.findOne(".top-left").getAbsolutePosition();t=b.x,i=b.y;let C=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),M=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:t,y:i,width:C,height:M,rotation:me.Konva.getAngle(this.rotation())},e)}_handleMouseUp(e){this._removeEvents(e)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(e){var t;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));let i=this.getNode();bs--,this._fire("transformend",{evt:e,target:i}),(t=this.getLayer())===null||t===void 0||t.batchDraw(),i&&this._nodes.forEach(n=>{var a;n._fire("transformend",{evt:e,target:n}),(a=n.getLayer())===null||a===void 0||a.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(e,t){let i=this._getNodeRect(),n=1;if(lt.Util._inRange(e.width,-this.padding()*2-n,n)){this.update();return}if(lt.Util._inRange(e.height,-this.padding()*2-n,n)){this.update();return}let a=new lt.Transform;if(a.rotate(me.Konva.getAngle(this.rotation())),this._movingAnchorName&&e.width<0&&this._movingAnchorName.indexOf("left")>=0){let m=a.point({x:-this.padding()*2,y:0});e.x+=m.x,e.y+=m.y,e.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=m.x,this._anchorDragOffset.y-=m.y}else if(this._movingAnchorName&&e.width<0&&this._movingAnchorName.indexOf("right")>=0){let m=a.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=m.x,this._anchorDragOffset.y-=m.y,e.width+=this.padding()*2}if(this._movingAnchorName&&e.height<0&&this._movingAnchorName.indexOf("top")>=0){let m=a.point({x:0,y:-this.padding()*2});e.x+=m.x,e.y+=m.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=m.x,this._anchorDragOffset.y-=m.y,e.height+=this.padding()*2}else if(this._movingAnchorName&&e.height<0&&this._movingAnchorName.indexOf("bottom")>=0){let m=a.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=m.x,this._anchorDragOffset.y-=m.y,e.height+=this.padding()*2}if(this.boundBoxFunc()){let m=this.boundBoxFunc()(i,e);m?e=m:lt.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}let s=1e7,r=new lt.Transform;r.translate(i.x,i.y),r.rotate(i.rotation),r.scale(i.width/s,i.height/s);let l=new lt.Transform,c=e.width/s,d=e.height/s;this.flipEnabled()===!1?(l.translate(e.x,e.y),l.rotate(e.rotation),l.translate(e.width<0?e.width:0,e.height<0?e.height:0),l.scale(Math.abs(c),Math.abs(d))):(l.translate(e.x,e.y),l.rotate(e.rotation),l.scale(c,d));let h=l.multiply(r.invert());this._nodes.forEach(m=>{var p;let f=m.getParent().getAbsoluteTransform(),b=m.getTransform().copy();b.translate(m.offsetX(),m.offsetY());let C=new lt.Transform;C.multiply(f.copy().invert()).multiply(h).multiply(f).multiply(b);let M=C.decompose();m.setAttrs(M),(p=m.getLayer())===null||p===void 0||p.batchDraw()}),this.rotation(lt.Util._getRotation(e.rotation)),this._nodes.forEach(m=>{this._fire("transform",{evt:t,target:m}),m._fire("transform",{evt:t,target:m})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(e,t){this.findOne(e).setAttrs(t)}update(){var e;let t=this._getNodeRect();this.rotation(lt.Util._getRotation(t.rotation));let i=t.width,n=t.height,a=this.enabledAnchors(),s=this.resizeEnabled(),r=this.padding(),l=this.anchorSize(),c=this.find("._anchor");c.forEach(h=>{h.setAttrs({width:l,height:l,offsetX:l/2,offsetY:l/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:l/2+r,offsetY:l/2+r,visible:s&&a.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:i/2,y:0,offsetY:l/2+r,visible:s&&a.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:i,y:0,offsetX:l/2-r,offsetY:l/2+r,visible:s&&a.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:n/2,offsetX:l/2+r,visible:s&&a.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:i,y:n/2,offsetX:l/2-r,visible:s&&a.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:n,offsetX:l/2+r,offsetY:l/2-r,visible:s&&a.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:i/2,y:n,offsetY:l/2-r,visible:s&&a.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:i,y:n,offsetX:l/2-r,offsetY:l/2-r,visible:s&&a.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:i/2,y:-this.rotateAnchorOffset()*lt.Util._sign(n)-r,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:i,height:n,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});let d=this.anchorStyleFunc();d&&c.forEach(h=>{d(h)}),(e=this.getLayer())===null||e===void 0||e.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();let e=this.findOne("."+this._movingAnchorName);e&&e.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),Hc.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return jc.Node.prototype.toObject.call(this)}clone(e){return jc.Node.prototype.clone.call(this,e)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}};Lo.Transformer=J;J.isTransforming=()=>bs>0;function su(o){return o instanceof Array||lt.Util.warn("enabledAnchors value should be an array"),o instanceof Array&&o.forEach(function(e){Eo.indexOf(e)===-1&&lt.Util.warn("Unknown anchor name: "+e+". Available names are: "+Eo.join(", "))}),o||[]}J.prototype.className="Transformer";(0,Q0._registerNode)(J);at.Factory.addGetterSetter(J,"enabledAnchors",Eo,su);at.Factory.addGetterSetter(J,"flipEnabled",!0,(0,Je.getBooleanValidator)());at.Factory.addGetterSetter(J,"resizeEnabled",!0);at.Factory.addGetterSetter(J,"anchorSize",10,(0,Je.getNumberValidator)());at.Factory.addGetterSetter(J,"rotateEnabled",!0);at.Factory.addGetterSetter(J,"rotateLineVisible",!0);at.Factory.addGetterSetter(J,"rotationSnaps",[]);at.Factory.addGetterSetter(J,"rotateAnchorOffset",50,(0,Je.getNumberValidator)());at.Factory.addGetterSetter(J,"rotateAnchorCursor","crosshair");at.Factory.addGetterSetter(J,"rotationSnapTolerance",5,(0,Je.getNumberValidator)());at.Factory.addGetterSetter(J,"borderEnabled",!0);at.Factory.addGetterSetter(J,"anchorStroke","rgb(0, 161, 255)");at.Factory.addGetterSetter(J,"anchorStrokeWidth",1,(0,Je.getNumberValidator)());at.Factory.addGetterSetter(J,"anchorFill","white");at.Factory.addGetterSetter(J,"anchorCornerRadius",0,(0,Je.getNumberValidator)());at.Factory.addGetterSetter(J,"borderStroke","rgb(0, 161, 255)");at.Factory.addGetterSetter(J,"borderStrokeWidth",1,(0,Je.getNumberValidator)());at.Factory.addGetterSetter(J,"borderDash");at.Factory.addGetterSetter(J,"keepRatio",!0);at.Factory.addGetterSetter(J,"shiftBehavior","default");at.Factory.addGetterSetter(J,"centeredScaling",!1);at.Factory.addGetterSetter(J,"ignoreStroke",!1);at.Factory.addGetterSetter(J,"padding",0,(0,Je.getNumberValidator)());at.Factory.addGetterSetter(J,"nodes");at.Factory.addGetterSetter(J,"node");at.Factory.addGetterSetter(J,"boundBoxFunc");at.Factory.addGetterSetter(J,"anchorDragBoundFunc");at.Factory.addGetterSetter(J,"anchorStyleFunc");at.Factory.addGetterSetter(J,"shouldOverdrawWholeArea",!1);at.Factory.addGetterSetter(J,"useSingleNodeRotation",!0);at.Factory.backCompat(J,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"})});var Qc=N(Fo=>{"use strict";Object.defineProperty(Fo,"__esModule",{value:!0});Fo.Wedge=void 0;var Do=K(),ru=At(),lu=Y(),Kc=Z(),cu=Y(),ge=class extends ru.Shape{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.radius(),0,lu.Konva.getAngle(this.angle()),this.clockwise()),e.lineTo(0,0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}};Fo.Wedge=ge;ge.prototype.className="Wedge";ge.prototype._centroid=!0;ge.prototype._attrsAffectingSize=["radius"];(0,cu._registerNode)(ge);Do.Factory.addGetterSetter(ge,"radius",0,(0,Kc.getNumberValidator)());Do.Factory.addGetterSetter(ge,"angle",0,(0,Kc.getNumberValidator)());Do.Factory.addGetterSetter(ge,"clockwise",!1);Do.Factory.backCompat(ge,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"})});var td=N(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});Ro.Blur=void 0;var Zc=K(),du=yt(),hu=Z();function Jc(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var mu=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],gu=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function pu(o,e){let t=o.data,i=o.width,n=o.height,a,s,r,l,c,d,h,m,p,f,b,C,M,w,P,O,E,A,D,H,nt=e+e+1,B=i-1,X=n-1,F=e+1,j=F*(F+1)/2,st=new Jc,rt=mu[e],ut=gu[e],zt=null,Q=st,ct=null,Rt=null;for(let Gt=1;Gt<nt;Gt++)Q=Q.next=new Jc,Gt===F&&(zt=Q);Q.next=st,r=s=0;for(let Gt=0;Gt<n;Gt++){C=M=w=P=l=c=d=h=0,m=F*(O=t[s]),p=F*(E=t[s+1]),f=F*(A=t[s+2]),b=F*(D=t[s+3]),l+=j*O,c+=j*E,d+=j*A,h+=j*D,Q=st;for(let Ht=0;Ht<F;Ht++)Q.r=O,Q.g=E,Q.b=A,Q.a=D,Q=Q.next;for(let Ht=1;Ht<F;Ht++)a=s+((B<Ht?B:Ht)<<2),l+=(Q.r=O=t[a])*(H=F-Ht),c+=(Q.g=E=t[a+1])*H,d+=(Q.b=A=t[a+2])*H,h+=(Q.a=D=t[a+3])*H,C+=O,M+=E,w+=A,P+=D,Q=Q.next;ct=st,Rt=zt;for(let Ht=0;Ht<i;Ht++)t[s+3]=D=h*rt>>ut,D!==0?(D=255/D,t[s]=(l*rt>>ut)*D,t[s+1]=(c*rt>>ut)*D,t[s+2]=(d*rt>>ut)*D):t[s]=t[s+1]=t[s+2]=0,l-=m,c-=p,d-=f,h-=b,m-=ct.r,p-=ct.g,f-=ct.b,b-=ct.a,a=r+((a=Ht+e+1)<B?a:B)<<2,C+=ct.r=t[a],M+=ct.g=t[a+1],w+=ct.b=t[a+2],P+=ct.a=t[a+3],l+=C,c+=M,d+=w,h+=P,ct=ct.next,m+=O=Rt.r,p+=E=Rt.g,f+=A=Rt.b,b+=D=Rt.a,C-=O,M-=E,w-=A,P-=D,Rt=Rt.next,s+=4;r+=i}for(let Gt=0;Gt<i;Gt++){M=w=P=C=c=d=h=l=0,s=Gt<<2,m=F*(O=t[s]),p=F*(E=t[s+1]),f=F*(A=t[s+2]),b=F*(D=t[s+3]),l+=j*O,c+=j*E,d+=j*A,h+=j*D,Q=st;for(let re=0;re<F;re++)Q.r=O,Q.g=E,Q.b=A,Q.a=D,Q=Q.next;let Ht=i;for(let re=1;re<=e;re++)s=Ht+Gt<<2,l+=(Q.r=O=t[s])*(H=F-re),c+=(Q.g=E=t[s+1])*H,d+=(Q.b=A=t[s+2])*H,h+=(Q.a=D=t[s+3])*H,C+=O,M+=E,w+=A,P+=D,Q=Q.next,re<X&&(Ht+=i);s=Gt,ct=st,Rt=zt;for(let re=0;re<n;re++)a=s<<2,t[a+3]=D=h*rt>>ut,D>0?(D=255/D,t[a]=(l*rt>>ut)*D,t[a+1]=(c*rt>>ut)*D,t[a+2]=(d*rt>>ut)*D):t[a]=t[a+1]=t[a+2]=0,l-=m,c-=p,d-=f,h-=b,m-=ct.r,p-=ct.g,f-=ct.b,b-=ct.a,a=Gt+((a=re+F)<X?a:X)*i<<2,l+=C+=ct.r=t[a],c+=M+=ct.g=t[a+1],d+=w+=ct.b=t[a+2],h+=P+=ct.a=t[a+3],ct=ct.next,m+=O=Rt.r,p+=E=Rt.g,f+=A=Rt.b,b+=D=Rt.a,C-=O,M-=E,w-=A,P-=D,Rt=Rt.next,s+=i}}var uu=function(e){let t=Math.round(this.blurRadius());t>0&&pu(e,t)};Ro.Blur=uu;Zc.Factory.addGetterSetter(du.Node,"blurRadius",0,(0,hu.getNumberValidator)(),Zc.Factory.afterSetFilter)});var id=N(No=>{"use strict";Object.defineProperty(No,"__esModule",{value:!0});No.Brighten=void 0;var ed=K(),fu=yt(),_u=Z(),bu=function(o){let e=this.brightness()*255,t=o.data,i=t.length;for(let n=0;n<i;n+=4)t[n]+=e,t[n+1]+=e,t[n+2]+=e};No.Brighten=bu;ed.Factory.addGetterSetter(fu.Node,"brightness",0,(0,_u.getNumberValidator)(),ed.Factory.afterSetFilter)});var od=N(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.Contrast=void 0;var nd=K(),Cu=yt(),xu=Z(),vu=function(o){let e=Math.pow((this.contrast()+100)/100,2),t=o.data,i=t.length,n=150,a=150,s=150;for(let r=0;r<i;r+=4)n=t[r],a=t[r+1],s=t[r+2],n/=255,n-=.5,n*=e,n+=.5,n*=255,a/=255,a-=.5,a*=e,a+=.5,a*=255,s/=255,s-=.5,s*=e,s+=.5,s*=255,n=n<0?0:n>255?255:n,a=a<0?0:a>255?255:a,s=s<0?0:s>255?255:s,t[r]=n,t[r+1]=a,t[r+2]=s};Bo.Contrast=vu;nd.Factory.addGetterSetter(Cu.Node,"contrast",0,(0,xu.getNumberValidator)(),nd.Factory.afterSetFilter)});var sd=N(zo=>{"use strict";Object.defineProperty(zo,"__esModule",{value:!0});zo.Emboss=void 0;var ti=K(),Vo=yt(),yu=xt(),ad=Z(),wu=function(o){let e=this.embossStrength()*10,t=this.embossWhiteLevel()*255,i=this.embossDirection(),n=this.embossBlend(),a=o.data,s=o.width,r=o.height,l=s*4,c=0,d=0,h=r;switch(i){case"top-left":c=-1,d=-1;break;case"top":c=-1,d=0;break;case"top-right":c=-1,d=1;break;case"right":c=0,d=1;break;case"bottom-right":c=1,d=1;break;case"bottom":c=1,d=0;break;case"bottom-left":c=1,d=-1;break;case"left":c=0,d=-1;break;default:yu.Util.error("Unknown emboss direction: "+i)}do{let m=(h-1)*l,p=c;h+p<1&&(p=0),h+p>r&&(p=0);let f=(h-1+p)*s*4,b=s;do{let C=m+(b-1)*4,M=d;b+M<1&&(M=0),b+M>s&&(M=0);let w=f+(b-1+M)*4,P=a[C]-a[w],O=a[C+1]-a[w+1],E=a[C+2]-a[w+2],A=P,D=A>0?A:-A,H=O>0?O:-O,nt=E>0?E:-E;if(H>D&&(A=O),nt>D&&(A=E),A*=e,n){let B=a[C]+A,X=a[C+1]+A,F=a[C+2]+A;a[C]=B>255?255:B<0?0:B,a[C+1]=X>255?255:X<0?0:X,a[C+2]=F>255?255:F<0?0:F}else{let B=t-A;B<0?B=0:B>255&&(B=255),a[C]=a[C+1]=a[C+2]=B}}while(--b)}while(--h)};zo.Emboss=wu;ti.Factory.addGetterSetter(Vo.Node,"embossStrength",.5,(0,ad.getNumberValidator)(),ti.Factory.afterSetFilter);ti.Factory.addGetterSetter(Vo.Node,"embossWhiteLevel",.5,(0,ad.getNumberValidator)(),ti.Factory.afterSetFilter);ti.Factory.addGetterSetter(Vo.Node,"embossDirection","top-left",void 0,ti.Factory.afterSetFilter);ti.Factory.addGetterSetter(Vo.Node,"embossBlend",!1,void 0,ti.Factory.afterSetFilter)});var ld=N(Go=>{"use strict";Object.defineProperty(Go,"__esModule",{value:!0});Go.Enhance=void 0;var rd=K(),Mu=yt(),Pu=Z();function Cs(o,e,t,i,n){let a=t-e,s=n-i;if(a===0)return i+s/2;if(s===0)return i;let r=(o-e)/a;return r=s*r+i,r}var Ou=function(o){let e=o.data,t=e.length,i=e[0],n=i,a,s=e[1],r=s,l,c=e[2],d=c,h,m=this.enhance();if(m===0)return;for(let P=0;P<t;P+=4)a=e[P+0],a<i?i=a:a>n&&(n=a),l=e[P+1],l<s?s=l:l>r&&(r=l),h=e[P+2],h<c?c=h:h>d&&(d=h);n===i&&(n=255,i=0),r===s&&(r=255,s=0),d===c&&(d=255,c=0);let p,f,b,C,M,w;if(m>0)p=n+m*(255-n),f=i-m*(i-0),b=r+m*(255-r),C=s-m*(s-0),M=d+m*(255-d),w=c-m*(c-0);else{let P=(n+i)*.5;p=n+m*(n-P),f=i+m*(i-P);let O=(r+s)*.5;b=r+m*(r-O),C=s+m*(s-O);let E=(d+c)*.5;M=d+m*(d-E),w=c+m*(c-E)}for(let P=0;P<t;P+=4)e[P+0]=Cs(e[P+0],i,n,f,p),e[P+1]=Cs(e[P+1],s,r,C,b),e[P+2]=Cs(e[P+2],c,d,w,M)};Go.Enhance=Ou;rd.Factory.addGetterSetter(Mu.Node,"enhance",0,(0,Pu.getNumberValidator)(),rd.Factory.afterSetFilter)});var cd=N(Uo=>{"use strict";Object.defineProperty(Uo,"__esModule",{value:!0});Uo.Grayscale=void 0;var ku=function(o){let e=o.data,t=e.length;for(let i=0;i<t;i+=4){let n=.34*e[i]+.5*e[i+1]+.16*e[i+2];e[i]=n,e[i+1]=n,e[i+2]=n}};Uo.Grayscale=ku});var dd=N(jo=>{"use strict";Object.defineProperty(jo,"__esModule",{value:!0});jo.HSL=void 0;var Xi=K(),xs=yt(),vs=Z();Xi.Factory.addGetterSetter(xs.Node,"hue",0,(0,vs.getNumberValidator)(),Xi.Factory.afterSetFilter);Xi.Factory.addGetterSetter(xs.Node,"saturation",0,(0,vs.getNumberValidator)(),Xi.Factory.afterSetFilter);Xi.Factory.addGetterSetter(xs.Node,"luminance",0,(0,vs.getNumberValidator)(),Xi.Factory.afterSetFilter);var Su=function(o){let e=o.data,t=e.length,i=1,n=Math.pow(2,this.saturation()),a=Math.abs(this.hue()+360)%360,s=this.luminance()*127,r=i*n*Math.cos(a*Math.PI/180),l=i*n*Math.sin(a*Math.PI/180),c=.299*i+.701*r+.167*l,d=.587*i-.587*r+.33*l,h=.114*i-.114*r-.497*l,m=.299*i-.299*r-.328*l,p=.587*i+.413*r+.035*l,f=.114*i-.114*r+.293*l,b=.299*i-.3*r+1.25*l,C=.587*i-.586*r-1.05*l,M=.114*i+.886*r-.2*l,w,P,O,E;for(let A=0;A<t;A+=4)w=e[A+0],P=e[A+1],O=e[A+2],E=e[A+3],e[A+0]=c*w+d*P+h*O+s,e[A+1]=m*w+p*P+f*O+s,e[A+2]=b*w+C*P+M*O+s,e[A+3]=E};jo.HSL=Su});var hd=N(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.HSV=void 0;var $i=K(),ys=yt(),ws=Z(),Tu=function(o){let e=o.data,t=e.length,i=Math.pow(2,this.value()),n=Math.pow(2,this.saturation()),a=Math.abs(this.hue()+360)%360,s=i*n*Math.cos(a*Math.PI/180),r=i*n*Math.sin(a*Math.PI/180),l=.299*i+.701*s+.167*r,c=.587*i-.587*s+.33*r,d=.114*i-.114*s-.497*r,h=.299*i-.299*s-.328*r,m=.587*i+.413*s+.035*r,p=.114*i-.114*s+.293*r,f=.299*i-.3*s+1.25*r,b=.587*i-.586*s-1.05*r,C=.114*i+.886*s-.2*r;for(let M=0;M<t;M+=4){let w=e[M+0],P=e[M+1],O=e[M+2],E=e[M+3];e[M+0]=l*w+c*P+d*O,e[M+1]=h*w+m*P+p*O,e[M+2]=f*w+b*P+C*O,e[M+3]=E}};Ho.HSV=Tu;$i.Factory.addGetterSetter(ys.Node,"hue",0,(0,ws.getNumberValidator)(),$i.Factory.afterSetFilter);$i.Factory.addGetterSetter(ys.Node,"saturation",0,(0,ws.getNumberValidator)(),$i.Factory.afterSetFilter);$i.Factory.addGetterSetter(ys.Node,"value",0,(0,ws.getNumberValidator)(),$i.Factory.afterSetFilter)});var md=N(qo=>{"use strict";Object.defineProperty(qo,"__esModule",{value:!0});qo.Invert=void 0;var Iu=function(o){let e=o.data,t=e.length;for(let i=0;i<t;i+=4)e[i]=255-e[i],e[i+1]=255-e[i+1],e[i+2]=255-e[i+2]};qo.Invert=Iu});var fd=N(Yo=>{"use strict";Object.defineProperty(Yo,"__esModule",{value:!0});Yo.Kaleidoscope=void 0;var Wo=K(),pd=yt(),gd=xt(),ud=Z(),Au=function(o,e,t){let i=o.data,n=e.data,a=o.width,s=o.height,r=t.polarCenterX||a/2,l=t.polarCenterY||s/2,c=Math.sqrt(r*r+l*l),d=a-r,h=s-l,m=Math.sqrt(d*d+h*h);c=m>c?m:c;let p=s,f=a,b=360/f*Math.PI/180;for(let C=0;C<f;C+=1){let M=Math.sin(C*b),w=Math.cos(C*b);for(let P=0;P<p;P+=1){d=Math.floor(r+c*P/p*w),h=Math.floor(l+c*P/p*M);let O=(h*a+d)*4,E=i[O+0],A=i[O+1],D=i[O+2],H=i[O+3];O=(C+P*a)*4,n[O+0]=E,n[O+1]=A,n[O+2]=D,n[O+3]=H}}},Eu=function(o,e,t){let i=o.data,n=e.data,a=o.width,s=o.height,r=t.polarCenterX||a/2,l=t.polarCenterY||s/2,c=Math.sqrt(r*r+l*l),d=a-r,h=s-l,m=Math.sqrt(d*d+h*h);c=m>c?m:c;let p=s,f=a,b=t.polarRotation||0,C,M;for(d=0;d<a;d+=1)for(h=0;h<s;h+=1){let w=d-r,P=h-l,O=Math.sqrt(w*w+P*P)*p/c,E=(Math.atan2(P,w)*180/Math.PI+360+b)%360;E=E*f/360,C=Math.floor(E),M=Math.floor(O);let A=(M*a+C)*4,D=i[A+0],H=i[A+1],nt=i[A+2],B=i[A+3];A=(h*a+d)*4,n[A+0]=D,n[A+1]=H,n[A+2]=nt,n[A+3]=B}},Lu=function(o){let e=o.width,t=o.height,i,n,a,s,r,l,c,d,h,m,p=Math.round(this.kaleidoscopePower()),f=Math.round(this.kaleidoscopeAngle()),b=Math.floor(e*(f%360)/360);if(p<1)return;let C=gd.Util.createCanvasElement();C.width=e,C.height=t;let M=C.getContext("2d").getImageData(0,0,e,t);gd.Util.releaseCanvas(C),Au(o,M,{polarCenterX:e/2,polarCenterY:t/2});let w=e/Math.pow(2,p);for(;w<=8;)w=w*2,p-=1;w=Math.ceil(w);let P=w,O=0,E=P,A=1;for(b+w>e&&(O=P,E=0,A=-1),n=0;n<t;n+=1)for(i=O;i!==E;i+=A)a=Math.round(i+b)%e,h=(e*n+a)*4,r=M.data[h+0],l=M.data[h+1],c=M.data[h+2],d=M.data[h+3],m=(e*n+i)*4,M.data[m+0]=r,M.data[m+1]=l,M.data[m+2]=c,M.data[m+3]=d;for(n=0;n<t;n+=1)for(P=Math.floor(w),s=0;s<p;s+=1){for(i=0;i<P+1;i+=1)h=(e*n+i)*4,r=M.data[h+0],l=M.data[h+1],c=M.data[h+2],d=M.data[h+3],m=(e*n+P*2-i-1)*4,M.data[m+0]=r,M.data[m+1]=l,M.data[m+2]=c,M.data[m+3]=d;P*=2}Eu(M,o,{polarRotation:0})};Yo.Kaleidoscope=Lu;Wo.Factory.addGetterSetter(pd.Node,"kaleidoscopePower",2,(0,ud.getNumberValidator)(),Wo.Factory.afterSetFilter);Wo.Factory.addGetterSetter(pd.Node,"kaleidoscopeAngle",0,(0,ud.getNumberValidator)(),Wo.Factory.afterSetFilter)});var bd=N($o=>{"use strict";Object.defineProperty($o,"__esModule",{value:!0});$o.Mask=void 0;var _d=K(),Du=yt(),Fu=Z();function Xo(o,e,t){let i=(t*o.width+e)*4,n=[];return n.push(o.data[i++],o.data[i++],o.data[i++],o.data[i++]),n}function Mn(o,e){return Math.sqrt(Math.pow(o[0]-e[0],2)+Math.pow(o[1]-e[1],2)+Math.pow(o[2]-e[2],2))}function Ru(o){let e=[0,0,0];for(let t=0;t<o.length;t++)e[0]+=o[t][0],e[1]+=o[t][1],e[2]+=o[t][2];return e[0]/=o.length,e[1]/=o.length,e[2]/=o.length,e}function Nu(o,e){let t=Xo(o,0,0),i=Xo(o,o.width-1,0),n=Xo(o,0,o.height-1),a=Xo(o,o.width-1,o.height-1),s=e||10;if(Mn(t,i)<s&&Mn(i,a)<s&&Mn(a,n)<s&&Mn(n,t)<s){let r=Ru([i,t,a,n]),l=[];for(let c=0;c<o.width*o.height;c++){let d=Mn(r,[o.data[c*4],o.data[c*4+1],o.data[c*4+2]]);l[c]=d<s?0:255}return l}}function Bu(o,e){for(let t=0;t<o.width*o.height;t++)o.data[4*t+3]=e[t]}function Vu(o,e,t){let i=[1,1,1,1,0,1,1,1,1],n=Math.round(Math.sqrt(i.length)),a=Math.floor(n/2),s=[];for(let r=0;r<t;r++)for(let l=0;l<e;l++){let c=r*e+l,d=0;for(let h=0;h<n;h++)for(let m=0;m<n;m++){let p=r+h-a,f=l+m-a;if(p>=0&&p<t&&f>=0&&f<e){let b=p*e+f,C=i[h*n+m];d+=o[b]*C}}s[c]=d===255*8?255:0}return s}function zu(o,e,t){let i=[1,1,1,1,1,1,1,1,1],n=Math.round(Math.sqrt(i.length)),a=Math.floor(n/2),s=[];for(let r=0;r<t;r++)for(let l=0;l<e;l++){let c=r*e+l,d=0;for(let h=0;h<n;h++)for(let m=0;m<n;m++){let p=r+h-a,f=l+m-a;if(p>=0&&p<t&&f>=0&&f<e){let b=p*e+f,C=i[h*n+m];d+=o[b]*C}}s[c]=d>=255*4?255:0}return s}function Gu(o,e,t){let i=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],n=Math.round(Math.sqrt(i.length)),a=Math.floor(n/2),s=[];for(let r=0;r<t;r++)for(let l=0;l<e;l++){let c=r*e+l,d=0;for(let h=0;h<n;h++)for(let m=0;m<n;m++){let p=r+h-a,f=l+m-a;if(p>=0&&p<t&&f>=0&&f<e){let b=p*e+f,C=i[h*n+m];d+=o[b]*C}}s[c]=d}return s}var Uu=function(o){let e=this.threshold(),t=Nu(o,e);return t&&(t=Vu(t,o.width,o.height),t=zu(t,o.width,o.height),t=Gu(t,o.width,o.height),Bu(o,t)),o};$o.Mask=Uu;_d.Factory.addGetterSetter(Du.Node,"threshold",0,(0,Fu.getNumberValidator)(),_d.Factory.afterSetFilter)});var xd=N(Ko=>{"use strict";Object.defineProperty(Ko,"__esModule",{value:!0});Ko.Noise=void 0;var Cd=K(),ju=yt(),Hu=Z(),qu=function(o){let e=this.noise()*255,t=o.data,i=t.length,n=e/2;for(let a=0;a<i;a+=4)t[a+0]+=n-2*n*Math.random(),t[a+1]+=n-2*n*Math.random(),t[a+2]+=n-2*n*Math.random()};Ko.Noise=qu;Cd.Factory.addGetterSetter(ju.Node,"noise",.2,(0,Hu.getNumberValidator)(),Cd.Factory.afterSetFilter)});var yd=N(Qo=>{"use strict";Object.defineProperty(Qo,"__esModule",{value:!0});Qo.Pixelate=void 0;var vd=K(),Wu=xt(),Yu=yt(),Xu=Z(),$u=function(o){let e=Math.ceil(this.pixelSize()),t=o.width,i=o.height,n=Math.ceil(t/e),a=Math.ceil(i/e),s=o.data;if(e<=0){Wu.Util.error("pixelSize value can not be <= 0");return}for(let r=0;r<n;r+=1)for(let l=0;l<a;l+=1){let c=0,d=0,h=0,m=0,p=r*e,f=p+e,b=l*e,C=b+e,M=0;for(let w=p;w<f;w+=1)if(!(w>=t))for(let P=b;P<C;P+=1){if(P>=i)continue;let O=(t*P+w)*4;c+=s[O+0],d+=s[O+1],h+=s[O+2],m+=s[O+3],M+=1}c=c/M,d=d/M,h=h/M,m=m/M;for(let w=p;w<f;w+=1)if(!(w>=t))for(let P=b;P<C;P+=1){if(P>=i)continue;let O=(t*P+w)*4;s[O+0]=c,s[O+1]=d,s[O+2]=h,s[O+3]=m}}};Qo.Pixelate=$u;vd.Factory.addGetterSetter(Yu.Node,"pixelSize",8,(0,Xu.getNumberValidator)(),vd.Factory.afterSetFilter)});var Md=N(Zo=>{"use strict";Object.defineProperty(Zo,"__esModule",{value:!0});Zo.Posterize=void 0;var wd=K(),Ku=yt(),Qu=Z(),Zu=function(o){let e=Math.round(this.levels()*254)+1,t=o.data,i=t.length,n=255/e;for(let a=0;a<i;a+=1)t[a]=Math.floor(t[a]/n)*n};Zo.Posterize=Zu;wd.Factory.addGetterSetter(Ku.Node,"levels",.5,(0,Qu.getNumberValidator)(),wd.Factory.afterSetFilter)});var Pd=N(ta=>{"use strict";Object.defineProperty(ta,"__esModule",{value:!0});ta.RGB=void 0;var Jo=K(),Ms=yt(),Ju=Z(),tf=function(o){let e=o.data,t=e.length,i=this.red(),n=this.green(),a=this.blue();for(let s=0;s<t;s+=4){let r=(.34*e[s]+.5*e[s+1]+.16*e[s+2])/255;e[s]=r*i,e[s+1]=r*n,e[s+2]=r*a,e[s+3]=e[s+3]}};ta.RGB=tf;Jo.Factory.addGetterSetter(Ms.Node,"red",0,function(o){return this._filterUpToDate=!1,o>255?255:o<0?0:Math.round(o)});Jo.Factory.addGetterSetter(Ms.Node,"green",0,function(o){return this._filterUpToDate=!1,o>255?255:o<0?0:Math.round(o)});Jo.Factory.addGetterSetter(Ms.Node,"blue",0,Ju.RGBComponent,Jo.Factory.afterSetFilter)});var Od=N(ia=>{"use strict";Object.defineProperty(ia,"__esModule",{value:!0});ia.RGBA=void 0;var Pn=K(),ea=yt(),ef=Z(),nf=function(o){let e=o.data,t=e.length,i=this.red(),n=this.green(),a=this.blue(),s=this.alpha();for(let r=0;r<t;r+=4){let l=1-s;e[r]=i*s+e[r]*l,e[r+1]=n*s+e[r+1]*l,e[r+2]=a*s+e[r+2]*l}};ia.RGBA=nf;Pn.Factory.addGetterSetter(ea.Node,"red",0,function(o){return this._filterUpToDate=!1,o>255?255:o<0?0:Math.round(o)});Pn.Factory.addGetterSetter(ea.Node,"green",0,function(o){return this._filterUpToDate=!1,o>255?255:o<0?0:Math.round(o)});Pn.Factory.addGetterSetter(ea.Node,"blue",0,ef.RGBComponent,Pn.Factory.afterSetFilter);Pn.Factory.addGetterSetter(ea.Node,"alpha",1,function(o){return this._filterUpToDate=!1,o>1?1:o<0?0:o})});var kd=N(na=>{"use strict";Object.defineProperty(na,"__esModule",{value:!0});na.Sepia=void 0;var of=function(o){let e=o.data,t=e.length;for(let i=0;i<t;i+=4){let n=e[i+0],a=e[i+1],s=e[i+2];e[i+0]=Math.min(255,n*.393+a*.769+s*.189),e[i+1]=Math.min(255,n*.349+a*.686+s*.168),e[i+2]=Math.min(255,n*.272+a*.534+s*.131)}};na.Sepia=of});var Sd=N(oa=>{"use strict";Object.defineProperty(oa,"__esModule",{value:!0});oa.Solarize=void 0;var af=function(o){let e=o.data,t=o.width,i=o.height,n=t*4,a=i;do{let s=(a-1)*n,r=t;do{let l=s+(r-1)*4,c=e[l],d=e[l+1],h=e[l+2];c>127&&(c=255-c),d>127&&(d=255-d),h>127&&(h=255-h),e[l]=c,e[l+1]=d,e[l+2]=h}while(--r)}while(--a)};oa.Solarize=af});var Id=N(aa=>{"use strict";Object.defineProperty(aa,"__esModule",{value:!0});aa.Threshold=void 0;var Td=K(),sf=yt(),rf=Z(),lf=function(o){let e=this.threshold()*255,t=o.data,i=t.length;for(let n=0;n<i;n+=1)t[n]=t[n]<e?0:255};aa.Threshold=lf;Td.Factory.addGetterSetter(sf.Node,"threshold",.5,(0,rf.getNumberValidator)(),Td.Factory.afterSetFilter)});var Ld=N(sa=>{"use strict";Object.defineProperty(sa,"__esModule",{value:!0});sa.Konva=void 0;var Ad=oc(),cf=sc(),df=mc(),hf=gc(),mf=uc(),gf=fc(),Ed=Cc(),pf=Ja(),uf=_o(),ff=ls(),_f=yc(),bf=Oc(),Cf=Sc(),xf=Tc(),vf=us(),yf=Uc(),wf=$c(),Mf=Qc(),Pf=td(),Of=id(),kf=od(),Sf=sd(),Tf=ld(),If=cd(),Af=dd(),Ef=hd(),Lf=md(),Df=fd(),Ff=bd(),Rf=xd(),Nf=yd(),Bf=Md(),Vf=Pd(),zf=Od(),Gf=kd(),Uf=Sd(),jf=Id();sa.Konva=Ad.Konva.Util._assign(Ad.Konva,{Arc:cf.Arc,Arrow:df.Arrow,Circle:hf.Circle,Ellipse:mf.Ellipse,Image:gf.Image,Label:Ed.Label,Tag:Ed.Tag,Line:pf.Line,Path:uf.Path,Rect:ff.Rect,RegularPolygon:_f.RegularPolygon,Ring:bf.Ring,Sprite:Cf.Sprite,Star:xf.Star,Text:vf.Text,TextPath:yf.TextPath,Transformer:wf.Transformer,Wedge:Mf.Wedge,Filters:{Blur:Pf.Blur,Brighten:Of.Brighten,Contrast:kf.Contrast,Emboss:Sf.Emboss,Enhance:Tf.Enhance,Grayscale:If.Grayscale,HSL:Af.HSL,HSV:Ef.HSV,Invert:Lf.Invert,Kaleidoscope:Df.Kaleidoscope,Mask:Ff.Mask,Noise:Rf.Noise,Pixelate:Nf.Pixelate,Posterize:Bf.Posterize,RGB:Vf.RGB,RGBA:zf.RGBA,Sepia:Gf.Sepia,Solarize:Uf.Solarize,Threshold:jf.Threshold}})});var Ki=N((Dd,Fd)=>{"use strict";Object.defineProperty(Dd,"__esModule",{value:!0});var Hf=Ld();Fd.exports=Hf.Konva});var zn=["*"],Gd=["content"],Ud=[[["mat-drawer"]],[["mat-drawer-content"]],"*"],jd=["mat-drawer","mat-drawer-content","*"];function Hd(o,e){if(o&1){let t=V();g(0,"div",1),T("click",function(){k(t);let n=y();return S(n._onBackdropClicked())}),u()}if(o&2){let t=y();ot("mat-drawer-shown",t._isShowingBackdrop())}}function qd(o,e){o&1&&(g(0,"mat-drawer-content"),Jt(1,2),u())}var Wd=[[["mat-sidenav"]],[["mat-sidenav-content"]],"*"],Yd=["mat-sidenav","mat-sidenav-content","*"];function Xd(o,e){if(o&1){let t=V();g(0,"div",1),T("click",function(){k(t);let n=y();return S(n._onBackdropClicked())}),u()}if(o&2){let t=y();ot("mat-drawer-shown",t._isShowingBackdrop())}}function $d(o,e){o&1&&(g(0,"mat-sidenav-content"),Jt(1,2),u())}var Kd=`.mat-drawer-container{position:relative;z-index:1;color:var(--mat-sidenav-content-text-color, var(--mat-sys-on-background));background-color:var(--mat-sidenav-content-background-color, var(--mat-sys-background));box-sizing:border-box;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible;background-color:var(--mat-sidenav-scrim-color, color-mix(in srgb, var(--mat-sys-neutral-variant20) 40%, transparent))}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}@media(forced-colors: active){.mat-drawer-backdrop{opacity:.5}}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-content.mat-drawer-content-hidden{opacity:0}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;color:var(--mat-sidenav-container-text-color, var(--mat-sys-on-surface-variant));box-shadow:var(--mat-sidenav-container-elevation-shadow, none);background-color:var(--mat-sidenav-container-background-color, var(--mat-sys-surface));border-top-right-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-bottom-right-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));width:var(--mat-sidenav-container-width, 360px);display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}@media(forced-colors: active){.mat-drawer,[dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}}@media(forced-colors: active){[dir=rtl] .mat-drawer,.mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0);border-top-left-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-bottom-left-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-top-right-radius:0;border-bottom-right-radius:0}[dir=rtl] .mat-drawer{border-top-left-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-bottom-left-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-top-right-radius:0;border-bottom-right-radius:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{border-top-right-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-bottom-right-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-top-left-radius:0;border-bottom-left-radius:0;left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer-transition .mat-drawer{transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-drawer:not(.mat-drawer-opened):not(.mat-drawer-animating){visibility:hidden;box-shadow:none}.mat-drawer:not(.mat-drawer-opened):not(.mat-drawer-animating) .mat-drawer-inner-container{display:none}.mat-drawer.mat-drawer-opened.mat-drawer-opened{transform:none}.mat-drawer-side{box-shadow:none;border-right-color:var(--mat-sidenav-container-divider-color, transparent);border-right-width:1px;border-right-style:solid}.mat-drawer-side.mat-drawer-end{border-left-color:var(--mat-sidenav-container-divider-color, transparent);border-left-width:1px;border-left-style:solid;border-right:none}[dir=rtl] .mat-drawer-side{border-left-color:var(--mat-sidenav-container-divider-color, transparent);border-left-width:1px;border-left-style:solid;border-right:none}[dir=rtl] .mat-drawer-side.mat-drawer-end{border-right-color:var(--mat-sidenav-container-divider-color, transparent);border-right-width:1px;border-right-style:solid;border-left:none}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto}.mat-sidenav-fixed{position:fixed}
`;var Qd=new ha("MAT_DRAWER_DEFAULT_AUTOSIZE",{providedIn:"root",factory:Zd}),xa=new ha("MAT_DRAWER_CONTAINER");function Zd(){return!1}var Bn=(()=>{class o extends yi{_platform=dt(In);_changeDetectorRef=dt(pe);_container=dt(Ca);constructor(){let t=dt(Sn),i=dt(or),n=dt(kn);super(t,i,n)}ngAfterContentInit(){this._container._contentMarginChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})}_shouldBeHidden(){if(this._platform.isBrowser)return!1;let{start:t,end:i}=this._container;return t!=null&&t.mode!=="over"&&t.opened||i!=null&&i.mode!=="over"&&i.opened}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=$({type:o,selectors:[["mat-drawer-content"]],hostAttrs:[1,"mat-drawer-content"],hostVars:6,hostBindings:function(i,n){i&2&&(Ut("margin-left",n._container._contentMargins.left,"px")("margin-right",n._container._contentMargins.right,"px"),ot("mat-drawer-content-hidden",n._shouldBeHidden()))},features:[ei([{provide:yi,useExisting:o}]),Zt],ngContentSelectors:zn,decls:1,vars:0,template:function(i,n){i&1&&(ze(),Jt(0))},encapsulation:2,changeDetection:0})}return o})(),ba=(()=>{class o{_elementRef=dt(Sn);_focusTrapFactory=dt(Js);_focusMonitor=dt(Ks);_platform=dt(In);_ngZone=dt(kn);_renderer=dt(Fs);_interactivityChecker=dt(Zs);_doc=dt(zs,{optional:!0});_container=dt(xa,{optional:!0});_focusTrap=null;_elementFocusedBeforeDrawerWasOpened=null;_eventCleanups;_isAttached;_anchor;get position(){return this._position}set position(t){t=t==="end"?"end":"start",t!==this._position&&(this._isAttached&&this._updatePositionInParent(t),this._position=t,this.onPositionChanged.emit())}_position="start";get mode(){return this._mode}set mode(t){this._mode=t,this._updateFocusTrapState(),this._modeChanged.next()}_mode="over";get disableClose(){return this._disableClose}set disableClose(t){this._disableClose=ii(t)}_disableClose=!1;get autoFocus(){let t=this._autoFocus;return t??(this.mode==="side"?"dialog":"first-tabbable")}set autoFocus(t){(t==="true"||t==="false"||t==null)&&(t=ii(t)),this._autoFocus=t}_autoFocus;get opened(){return this._opened}set opened(t){this.toggle(ii(t))}_opened=!1;_openedVia;_animationStarted=new Nt;_animationEnd=new Nt;openedChange=new q(!0);_openedStream=this.openedChange.pipe(mi(t=>t),ra(()=>{}));openedStart=this._animationStarted.pipe(mi(()=>this.opened),ca(void 0));_closedStream=this.openedChange.pipe(mi(t=>!t),ra(()=>{}));closedStart=this._animationStarted.pipe(mi(()=>!this.opened),ca(void 0));_destroyed=new Nt;onPositionChanged=new q;_content;_modeChanged=new Nt;_injector=dt(ma);_changeDetectorRef=dt(pe);constructor(){this.openedChange.pipe(z(this._destroyed)).subscribe(t=>{t?(this._doc&&(this._elementFocusedBeforeDrawerWasOpened=this._doc.activeElement),this._takeFocus()):this._isFocusWithinDrawer()&&this._restoreFocus(this._openedVia||"program")}),this._ngZone.runOutsideAngular(()=>{let t=this._elementRef.nativeElement;Ts(t,"keydown").pipe(mi(i=>i.keyCode===27&&!this.disableClose&&!tr(i)),z(this._destroyed)).subscribe(i=>this._ngZone.run(()=>{this.close(),i.stopPropagation(),i.preventDefault()})),this._eventCleanups=[this._renderer.listen(t,"transitionrun",this._handleTransitionEvent),this._renderer.listen(t,"transitionend",this._handleTransitionEvent),this._renderer.listen(t,"transitioncancel",this._handleTransitionEvent)]}),this._animationEnd.subscribe(()=>{this.openedChange.emit(this._opened)})}_forceFocus(t,i){this._interactivityChecker.isFocusable(t)||(t.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let n=()=>{a(),s(),t.removeAttribute("tabindex")},a=this._renderer.listen(t,"blur",n),s=this._renderer.listen(t,"mousedown",n)})),t.focus(i)}_focusByCssSelector(t,i){let n=this._elementRef.nativeElement.querySelector(t);n&&this._forceFocus(n,i)}_takeFocus(){if(!this._focusTrap)return;let t=this._elementRef.nativeElement;switch(this.autoFocus){case!1:case"dialog":return;case!0:case"first-tabbable":ga(()=>{!this._focusTrap.focusInitialElement()&&typeof t.focus=="function"&&t.focus()},{injector:this._injector});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this.autoFocus);break}}_restoreFocus(t){this.autoFocus!=="dialog"&&(this._elementFocusedBeforeDrawerWasOpened?this._focusMonitor.focusVia(this._elementFocusedBeforeDrawerWasOpened,t):this._elementRef.nativeElement.blur(),this._elementFocusedBeforeDrawerWasOpened=null)}_isFocusWithinDrawer(){let t=this._doc.activeElement;return!!t&&this._elementRef.nativeElement.contains(t)}ngAfterViewInit(){this._isAttached=!0,this._position==="end"&&this._updatePositionInParent("end"),this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._updateFocusTrapState())}ngOnDestroy(){this._eventCleanups.forEach(t=>t()),this._focusTrap?.destroy(),this._anchor?.remove(),this._anchor=null,this._animationStarted.complete(),this._animationEnd.complete(),this._modeChanged.complete(),this._destroyed.next(),this._destroyed.complete()}open(t){return this.toggle(!0,t)}close(){return this.toggle(!1)}_closeViaBackdropClick(){return this._setOpen(!1,!0,"mouse")}toggle(t=!this.opened,i){t&&i&&(this._openedVia=i);let n=this._setOpen(t,!t&&this._isFocusWithinDrawer(),this._openedVia||"program");return t||(this._openedVia=null),n}_setOpen(t,i,n){return t===this._opened?Promise.resolve(t?"open":"close"):(this._opened=t,this._container?._transitionsEnabled?this._setIsAnimating(!0):setTimeout(()=>{this._animationStarted.next(),this._animationEnd.next()}),this._elementRef.nativeElement.classList.toggle("mat-drawer-opened",t),!t&&i&&this._restoreFocus(n),this._changeDetectorRef.markForCheck(),this._updateFocusTrapState(),new Promise(a=>{this.openedChange.pipe(As(1)).subscribe(s=>a(s?"open":"close"))}))}_setIsAnimating(t){this._elementRef.nativeElement.classList.toggle("mat-drawer-animating",t)}_getWidth(){return this._elementRef.nativeElement.offsetWidth||0}_updateFocusTrapState(){this._focusTrap&&(this._focusTrap.enabled=!!this._container?.hasBackdrop&&this.opened)}_updatePositionInParent(t){if(!this._platform.isBrowser)return;let i=this._elementRef.nativeElement,n=i.parentNode;t==="end"?(this._anchor||(this._anchor=this._doc.createComment("mat-drawer-anchor"),n.insertBefore(this._anchor,i)),n.appendChild(i)):this._anchor&&this._anchor.parentNode.insertBefore(i,this._anchor)}_handleTransitionEvent=t=>{let i=this._elementRef.nativeElement;t.target===i&&this._ngZone.run(()=>{t.type==="transitionrun"?this._animationStarted.next(t):(t.type==="transitionend"&&this._setIsAnimating(!1),this._animationEnd.next(t))})};static \u0275fac=function(i){return new(i||o)};static \u0275cmp=$({type:o,selectors:[["mat-drawer"]],viewQuery:function(i,n){if(i&1&&Wt(Gd,5),i&2){let a;Et(a=Lt())&&(n._content=a.first)}},hostAttrs:[1,"mat-drawer"],hostVars:12,hostBindings:function(i,n){i&2&&(fi("align",null)("tabIndex",n.mode!=="side"?"-1":null),Ut("visibility",!n._container&&!n.opened?"hidden":null),ot("mat-drawer-end",n.position==="end")("mat-drawer-over",n.mode==="over")("mat-drawer-push",n.mode==="push")("mat-drawer-side",n.mode==="side"))},inputs:{position:"position",mode:"mode",disableClose:"disableClose",autoFocus:"autoFocus",opened:"opened"},outputs:{openedChange:"openedChange",_openedStream:"opened",openedStart:"openedStart",_closedStream:"closed",closedStart:"closedStart",onPositionChanged:"positionChanged"},exportAs:["matDrawer"],ngContentSelectors:zn,decls:3,vars:0,consts:[["content",""],["cdkScrollable","",1,"mat-drawer-inner-container"]],template:function(i,n){i&1&&(ze(),g(0,"div",1,0),Jt(2),u())},dependencies:[yi],encapsulation:2,changeDetection:0})}return o})(),Ca=(()=>{class o{_dir=dt(er,{optional:!0});_element=dt(Sn);_ngZone=dt(kn);_changeDetectorRef=dt(pe);_animationMode=dt(Ls,{optional:!0});_transitionsEnabled=!1;_allDrawers;_drawers=new Es;_content;_userContent;get start(){return this._start}get end(){return this._end}get autosize(){return this._autosize}set autosize(t){this._autosize=ii(t)}_autosize=dt(Qd);get hasBackdrop(){return this._drawerHasBackdrop(this._start)||this._drawerHasBackdrop(this._end)}set hasBackdrop(t){this._backdropOverride=t==null?null:ii(t)}_backdropOverride;backdropClick=new q;_start;_end;_left;_right;_destroyed=new Nt;_doCheckSubject=new Nt;_contentMargins={left:null,right:null};_contentMarginChanges=new Nt;get scrollable(){return this._userContent||this._content}_injector=dt(ma);constructor(){let t=dt(In),i=dt(ar);this._dir?.change.pipe(z(this._destroyed)).subscribe(()=>{this._validateDrawers(),this.updateContentMargins()}),i.change().pipe(z(this._destroyed)).subscribe(()=>this.updateContentMargins()),this._animationMode!=="NoopAnimations"&&t.isBrowser&&this._ngZone.runOutsideAngular(()=>{setTimeout(()=>{this._element.nativeElement.classList.add("mat-drawer-transition"),this._transitionsEnabled=!0},200)})}ngAfterContentInit(){this._allDrawers.changes.pipe(da(this._allDrawers),z(this._destroyed)).subscribe(t=>{this._drawers.reset(t.filter(i=>!i._container||i._container===this)),this._drawers.notifyOnChanges()}),this._drawers.changes.pipe(da(null)).subscribe(()=>{this._validateDrawers(),this._drawers.forEach(t=>{this._watchDrawerToggle(t),this._watchDrawerPosition(t),this._watchDrawerMode(t)}),(!this._drawers.length||this._isDrawerOpen(this._start)||this._isDrawerOpen(this._end))&&this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),this._ngZone.runOutsideAngular(()=>{this._doCheckSubject.pipe(On(10),z(this._destroyed)).subscribe(()=>this.updateContentMargins())})}ngOnDestroy(){this._contentMarginChanges.complete(),this._doCheckSubject.complete(),this._drawers.destroy(),this._destroyed.next(),this._destroyed.complete()}open(){this._drawers.forEach(t=>t.open())}close(){this._drawers.forEach(t=>t.close())}updateContentMargins(){let t=0,i=0;if(this._left&&this._left.opened){if(this._left.mode=="side")t+=this._left._getWidth();else if(this._left.mode=="push"){let n=this._left._getWidth();t+=n,i-=n}}if(this._right&&this._right.opened){if(this._right.mode=="side")i+=this._right._getWidth();else if(this._right.mode=="push"){let n=this._right._getWidth();i+=n,t-=n}}t=t||null,i=i||null,(t!==this._contentMargins.left||i!==this._contentMargins.right)&&(this._contentMargins={left:t,right:i},this._ngZone.run(()=>this._contentMarginChanges.next(this._contentMargins)))}ngDoCheck(){this._autosize&&this._isPushed()&&this._ngZone.runOutsideAngular(()=>this._doCheckSubject.next())}_watchDrawerToggle(t){t._animationStarted.pipe(z(this._drawers.changes)).subscribe(()=>{this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),t.mode!=="side"&&t.openedChange.pipe(z(this._drawers.changes)).subscribe(()=>this._setContainerClass(t.opened))}_watchDrawerPosition(t){t.onPositionChanged.pipe(z(this._drawers.changes)).subscribe(()=>{ga({read:()=>this._validateDrawers()},{injector:this._injector})})}_watchDrawerMode(t){t._modeChanged.pipe(z(Is(this._drawers.changes,this._destroyed))).subscribe(()=>{this.updateContentMargins(),this._changeDetectorRef.markForCheck()})}_setContainerClass(t){let i=this._element.nativeElement.classList,n="mat-drawer-container-has-open";t?i.add(n):i.remove(n)}_validateDrawers(){this._start=this._end=null,this._drawers.forEach(t=>{t.position=="end"?(this._end!=null,this._end=t):(this._start!=null,this._start=t)}),this._right=this._left=null,this._dir&&this._dir.value==="rtl"?(this._left=this._end,this._right=this._start):(this._left=this._start,this._right=this._end)}_isPushed(){return this._isDrawerOpen(this._start)&&this._start.mode!="over"||this._isDrawerOpen(this._end)&&this._end.mode!="over"}_onBackdropClicked(){this.backdropClick.emit(),this._closeModalDrawersViaBackdrop()}_closeModalDrawersViaBackdrop(){[this._start,this._end].filter(t=>t&&!t.disableClose&&this._drawerHasBackdrop(t)).forEach(t=>t._closeViaBackdropClick())}_isShowingBackdrop(){return this._isDrawerOpen(this._start)&&this._drawerHasBackdrop(this._start)||this._isDrawerOpen(this._end)&&this._drawerHasBackdrop(this._end)}_isDrawerOpen(t){return t!=null&&t.opened}_drawerHasBackdrop(t){return this._backdropOverride==null?!!t&&t.mode!=="side":this._backdropOverride}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=$({type:o,selectors:[["mat-drawer-container"]],contentQueries:function(i,n,a){if(i&1&&(bi(a,Bn,5),bi(a,ba,5)),i&2){let s;Et(s=Lt())&&(n._content=s.first),Et(s=Lt())&&(n._allDrawers=s)}},viewQuery:function(i,n){if(i&1&&Wt(Bn,5),i&2){let a;Et(a=Lt())&&(n._userContent=a.first)}},hostAttrs:[1,"mat-drawer-container"],hostVars:2,hostBindings:function(i,n){i&2&&ot("mat-drawer-container-explicit-backdrop",n._backdropOverride)},inputs:{autosize:"autosize",hasBackdrop:"hasBackdrop"},outputs:{backdropClick:"backdropClick"},exportAs:["matDrawerContainer"],features:[ei([{provide:xa,useExisting:o}])],ngContentSelectors:jd,decls:4,vars:2,consts:[[1,"mat-drawer-backdrop",3,"mat-drawer-shown"],[1,"mat-drawer-backdrop",3,"click"]],template:function(i,n){i&1&&(ze(Ud),R(0,Hd,1,2,"div",0),Jt(1),Jt(2,1),R(3,qd,2,0,"mat-drawer-content")),i&2&&(_i(n.hasBackdrop?0:-1),_(3),_i(n._content?-1:3))},dependencies:[Bn],styles:[`.mat-drawer-container{position:relative;z-index:1;color:var(--mat-sidenav-content-text-color, var(--mat-sys-on-background));background-color:var(--mat-sidenav-content-background-color, var(--mat-sys-background));box-sizing:border-box;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible;background-color:var(--mat-sidenav-scrim-color, color-mix(in srgb, var(--mat-sys-neutral-variant20) 40%, transparent))}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}@media(forced-colors: active){.mat-drawer-backdrop{opacity:.5}}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-content.mat-drawer-content-hidden{opacity:0}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;color:var(--mat-sidenav-container-text-color, var(--mat-sys-on-surface-variant));box-shadow:var(--mat-sidenav-container-elevation-shadow, none);background-color:var(--mat-sidenav-container-background-color, var(--mat-sys-surface));border-top-right-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-bottom-right-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));width:var(--mat-sidenav-container-width, 360px);display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}@media(forced-colors: active){.mat-drawer,[dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}}@media(forced-colors: active){[dir=rtl] .mat-drawer,.mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0);border-top-left-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-bottom-left-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-top-right-radius:0;border-bottom-right-radius:0}[dir=rtl] .mat-drawer{border-top-left-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-bottom-left-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-top-right-radius:0;border-bottom-right-radius:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{border-top-right-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-bottom-right-radius:var(--mat-sidenav-container-shape, var(--mat-sys-corner-large));border-top-left-radius:0;border-bottom-left-radius:0;left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer-transition .mat-drawer{transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-drawer:not(.mat-drawer-opened):not(.mat-drawer-animating){visibility:hidden;box-shadow:none}.mat-drawer:not(.mat-drawer-opened):not(.mat-drawer-animating) .mat-drawer-inner-container{display:none}.mat-drawer.mat-drawer-opened.mat-drawer-opened{transform:none}.mat-drawer-side{box-shadow:none;border-right-color:var(--mat-sidenav-container-divider-color, transparent);border-right-width:1px;border-right-style:solid}.mat-drawer-side.mat-drawer-end{border-left-color:var(--mat-sidenav-container-divider-color, transparent);border-left-width:1px;border-left-style:solid;border-right:none}[dir=rtl] .mat-drawer-side{border-left-color:var(--mat-sidenav-container-divider-color, transparent);border-left-width:1px;border-left-style:solid;border-right:none}[dir=rtl] .mat-drawer-side.mat-drawer-end{border-right-color:var(--mat-sidenav-container-divider-color, transparent);border-right-width:1px;border-right-style:solid;border-left:none}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto}.mat-sidenav-fixed{position:fixed}
`],encapsulation:2,changeDetection:0})}return o})(),Vn=(()=>{class o extends Bn{static \u0275fac=(()=>{let t;return function(n){return(t||(t=le(o)))(n||o)}})();static \u0275cmp=$({type:o,selectors:[["mat-sidenav-content"]],hostAttrs:[1,"mat-drawer-content","mat-sidenav-content"],features:[ei([{provide:yi,useExisting:o}]),Zt],ngContentSelectors:zn,decls:1,vars:0,template:function(i,n){i&1&&(ze(),Jt(0))},encapsulation:2,changeDetection:0})}return o})(),va=(()=>{class o extends ba{get fixedInViewport(){return this._fixedInViewport}set fixedInViewport(t){this._fixedInViewport=ii(t)}_fixedInViewport=!1;get fixedTopGap(){return this._fixedTopGap}set fixedTopGap(t){this._fixedTopGap=fa(t)}_fixedTopGap=0;get fixedBottomGap(){return this._fixedBottomGap}set fixedBottomGap(t){this._fixedBottomGap=fa(t)}_fixedBottomGap=0;static \u0275fac=(()=>{let t;return function(n){return(t||(t=le(o)))(n||o)}})();static \u0275cmp=$({type:o,selectors:[["mat-sidenav"]],hostAttrs:[1,"mat-drawer","mat-sidenav"],hostVars:16,hostBindings:function(i,n){i&2&&(fi("tabIndex",n.mode!=="side"?"-1":null)("align",null),Ut("top",n.fixedInViewport?n.fixedTopGap:null,"px")("bottom",n.fixedInViewport?n.fixedBottomGap:null,"px"),ot("mat-drawer-end",n.position==="end")("mat-drawer-over",n.mode==="over")("mat-drawer-push",n.mode==="push")("mat-drawer-side",n.mode==="side")("mat-sidenav-fixed",n.fixedInViewport))},inputs:{fixedInViewport:"fixedInViewport",fixedTopGap:"fixedTopGap",fixedBottomGap:"fixedBottomGap"},exportAs:["matSidenav"],features:[ei([{provide:ba,useExisting:o}]),Zt],ngContentSelectors:zn,decls:3,vars:0,consts:[["content",""],["cdkScrollable","",1,"mat-drawer-inner-container"]],template:function(i,n){i&1&&(ze(),g(0,"div",1,0),Jt(2),u())},dependencies:[yi],encapsulation:2,changeDetection:0})}return o})(),Kr=(()=>{class o extends Ca{_allDrawers=void 0;_content=void 0;static \u0275fac=(()=>{let t;return function(n){return(t||(t=le(o)))(n||o)}})();static \u0275cmp=$({type:o,selectors:[["mat-sidenav-container"]],contentQueries:function(i,n,a){if(i&1&&(bi(a,Vn,5),bi(a,va,5)),i&2){let s;Et(s=Lt())&&(n._content=s.first),Et(s=Lt())&&(n._allDrawers=s)}},hostAttrs:[1,"mat-drawer-container","mat-sidenav-container"],hostVars:2,hostBindings:function(i,n){i&2&&ot("mat-drawer-container-explicit-backdrop",n._backdropOverride)},exportAs:["matSidenavContainer"],features:[ei([{provide:xa,useExisting:o},{provide:Ca,useExisting:o}]),Zt],ngContentSelectors:Yd,decls:4,vars:2,consts:[[1,"mat-drawer-backdrop",3,"mat-drawer-shown"],[1,"mat-drawer-backdrop",3,"click"]],template:function(i,n){i&1&&(ze(Wd),R(0,Xd,1,2,"div",0),Jt(1),Jt(2,1),R(3,$d,2,0,"mat-sidenav-content")),i&2&&(_i(n.hasBackdrop?0:-1),_(3),_i(n._content?-1:3))},dependencies:[Vn],styles:[Kd],encapsulation:2,changeDetection:0})}return o})(),Qr=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=ui({type:o});static \u0275inj=pi({imports:[tn,_a,_a,tn]})}return o})();var Zr=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=ui({type:o});static \u0275inj=pi({imports:[Qs,tn,ir,Sr,Lr]})}return o})();var ht=function(o){return o.Rectangle="RECTANGLE",o.Polygon="POLYGON",o.Ellipse="ELLIPSE",o.Brush="BRUSH",o.Polyline="POLYLINE",o.Classification="CLASSIFICATION",o}(ht||{});var el=(()=>{class o{constructor(t,i){this.http=t,this.configuration=i,this.actionUrl=this.configuration.ServerWithApiUrl+"landingai/predictions/"}generatePreAnnotations(t,i){return this.http.post(`${this.actionUrl}generate?imageId=${t}&projectId=${i}`,null).pipe(Bt(this.handleError))}getPredictionsByImageAndModel(t,i){return this.http.get(`${this.actionUrl}image/${t}/model/${i}`).pipe(Bt(this.handleError))}getStatus(){return this.http.get(`${this.actionUrl}status`).pipe(Bt(this.handleError))}handleError(t){let i="An error occurred";return t.error instanceof ErrorEvent?i=`Error: ${t.error.message}`:(i=`Error Code: ${t.status}
Message: ${t.message}`,t.error&&t.error.message&&(i=t.error.message)),console.error("ModelPredictionService Error:",i),hi(()=>new Error(i))}static{this.\u0275fac=function(i){return new(i||o)(Pe(Ci),Pe(xi))}}static{this.\u0275prov=gi({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function ih(o,e){if(o&1){let t=V();g(0,"button",19),T("click",function(){let n=k(t).$implicit,a=y();return S(a.selectColor(n))}),u()}if(o&2){let t=e.$implicit,i=y();Ut("background-color",t),ot("selected",i.colorCode.toUpperCase()===t),fi("aria-label","Select color "+t)}}function nh(o,e){if(o&1&&(g(0,"div",20)(1,"mat-icon"),x(2,"error"),u(),g(3,"span"),x(4),u()()),o&2){let t=y();_(4),G(t.errorMessage)}}function oh(o,e){o&1&&tt(0,"mat-spinner",21)}function ah(o,e){o&1&&(g(0,"span"),x(1,"Create"),u())}function sh(o,e){o&1&&(g(0,"span"),x(1,"Creating..."),u())}var Un=(()=>{class o{constructor(t,i,n){this.dialogRef=t,this.data=i,this.projectClassService=n,this.className="",this.colorCode="#FF0000",this.description="",this.isCreating=!1,this.errorMessage="",this.colorPalette=["#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#FFC0CB","#A52A2A","#808080","#000000"]}ngOnInit(){}onSubmit(){if(!this.className.trim()){this.errorMessage="Class name is required";return}if(!this.isValidHexColor(this.colorCode)){this.errorMessage="Invalid color code. Please use hex format (e.g., #FF0000)";return}this.errorMessage="",this.isCreating=!0;let t={className:this.className.trim(),colorCode:this.colorCode.toUpperCase(),description:this.description.trim()||void 0};this.projectClassService.createClass(this.data.projectId,t).subscribe({next:i=>{this.isCreating=!1,this.dialogRef.close(i)},error:i=>{this.isCreating=!1,this.errorMessage=i.message||"Failed to create class",console.error("Error creating class:",i)}})}onCancel(){this.dialogRef.close()}selectColor(t){this.colorCode=t}isValidHexColor(t){return/^#[0-9A-Fa-f]{6}$/.test(t)}static{this.\u0275fac=function(i){return new(i||o)(W(wi),W(Mi),W(Rn))}}static{this.\u0275cmp=$({type:o,selectors:[["app-class-creation-dialog"]],standalone:!1,decls:35,vars:13,consts:[["classForm","ngForm"],["mat-dialog-title",""],["appearance","fill",1,"full-width"],["matInput","","maxlength","100","name","className","placeholder","Enter class name","required","",3,"ngModelChange","ngModel"],[1,"color-palette"],[1,"palette-header"],[1,"palette-label"],[1,"selected-color-display"],[1,"color-preview-large"],[1,"color-code-text"],[1,"palette-colors"],["class","color-button","type","button",3,"selected","background-color","click",4,"ngFor","ngForOf"],["cdkAutosizeMaxRows","5","cdkAutosizeMinRows","3","cdkTextareaAutosize","","matInput","","maxlength","500","name","description","placeholder","Enter class description",3,"ngModelChange","ngModel"],["align","end"],["class","error-message",4,"ngIf"],["mat-button","",3,"click","disabled"],["color","primary","mat-raised-button","",3,"click","disabled"],["class","button-spinner","diameter","20",4,"ngIf"],[4,"ngIf"],["type","button",1,"color-button",3,"click"],[1,"error-message"],["diameter","20",1,"button-spinner"]],template:function(i,n){if(i&1){let a=V();g(0,"h2",1),x(1,"Create New Class"),u(),g(2,"mat-dialog-content")(3,"form",null,0)(5,"mat-form-field",2)(6,"mat-label"),x(7,"Class Name"),u(),g(8,"input",3),Ct("ngModelChange",function(r){return k(a),bt(n.className,r)||(n.className=r),S(r)}),u(),g(9,"mat-hint"),x(10,"Required"),u()(),g(11,"div",4)(12,"div",5)(13,"div",6),x(14,"Select Color:"),u(),g(15,"div",7),tt(16,"span",8),g(17,"span",9),x(18),u()()(),g(19,"div",10),R(20,ih,1,5,"button",11),u()(),g(21,"mat-form-field",2)(22,"mat-label"),x(23,"Description (Optional)"),u(),g(24,"textarea",12),Ct("ngModelChange",function(r){return k(a),bt(n.description,r)||(n.description=r),S(r)}),u(),g(25,"mat-hint",13),x(26),u()(),R(27,nh,5,1,"div",14),u()(),g(28,"mat-dialog-actions",13)(29,"button",15),T("click",function(){return k(a),S(n.onCancel())}),x(30," Cancel "),u(),g(31,"button",16),T("click",function(){return k(a),S(n.onSubmit())}),R(32,oh,1,0,"mat-spinner",17)(33,ah,2,0,"span",18)(34,sh,2,0,"span",18),u()()}if(i&2){let a=Ji(4);_(8),_t("ngModel",n.className),_(8),Ut("background-color",n.colorCode),_(2),G(n.colorCode),_(2),v("ngForOf",n.colorPalette),_(4),_t("ngModel",n.description),_(2),et("",n.description.length,"/500"),_(),v("ngIf",n.errorMessage),_(2),v("disabled",n.isCreating),_(2),v("disabled",!a.valid||n.isCreating),_(),v("ngIf",n.isCreating),_(),v("ngIf",!n.isCreating),_(),v("ngIf",n.isCreating)}},dependencies:[kt,St,fr,Ue,Yt,pr,An,_r,Xt,ur,te,Dt,ie,fe,En,je,Cr,Pi,ki,Oi,ue],styles:["[_nghost-%COMP%]{display:block}h2[mat-dialog-title][_ngcontent-%COMP%]{margin:0 0 20px;font-size:20px;font-weight:500}mat-dialog-content[_ngcontent-%COMP%]{min-width:350px;max-width:500px;padding:0 24px;overflow-y:auto}.full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}.full-width[_ngcontent-%COMP%]     .mat-mdc-text-field-wrapper{width:100%}.full-width[_ngcontent-%COMP%]     .mat-mdc-form-field-flex{align-items:center}.full-width[_ngcontent-%COMP%]     .mat-mdc-form-field-focus-overlay{background-color:#0000000a}.full-width[_ngcontent-%COMP%]     .mdc-text-field--filled{background-color:#0000000a;border-radius:4px 4px 0 0}.full-width[_ngcontent-%COMP%]     .mat-mdc-form-field-infix{min-height:56px;padding-top:20px;padding-bottom:4px}.full-width[_ngcontent-%COMP%]     .mat-mdc-floating-label{top:24px}.full-width[_ngcontent-%COMP%]     .mat-mdc-form-field-hint-wrapper, .full-width[_ngcontent-%COMP%]     .mat-mdc-form-field-error-wrapper{padding:0 16px}.full-width[_ngcontent-%COMP%]     .mat-mdc-form-field-subscript-wrapper .mat-mdc-form-field-hint-spacer{display:none}.full-width[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical;min-height:60px}.color-palette[_ngcontent-%COMP%]{margin-bottom:20px;padding:16px;background-color:#f5f5f5;border-radius:8px}.palette-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.palette-label[_ngcontent-%COMP%]{font-size:14px;color:#000000de;font-weight:500}.selected-color-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.color-preview-large[_ngcontent-%COMP%]{display:inline-block;width:32px;height:32px;border-radius:4px;border:2px solid rgba(0,0,0,.12);box-shadow:0 1px 3px #0003}.color-code-text[_ngcontent-%COMP%]{font-size:14px;font-family:monospace;color:#000000de;font-weight:500}.palette-colors[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.color-button[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:4px;border:2px solid transparent;cursor:pointer;transition:all .2s ease;padding:0;background:none;box-shadow:0 1px 3px #0003}.color-button[_ngcontent-%COMP%]:hover{transform:scale(1.1);box-shadow:0 2px 6px #0000004d}.color-button.selected[_ngcontent-%COMP%]{border-color:#1976d2;border-width:3px;transform:scale(1.15);box-shadow:0 3px 8px #1976d266}.color-button[_ngcontent-%COMP%]:focus{outline:2px solid #1976d2;outline-offset:2px}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#d32f2f;background-color:#ffebee;padding:12px;border-radius:4px;margin-top:8px}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.error-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;margin:0;min-height:52px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-left:0}.button-spinner[_ngcontent-%COMP%]{display:inline-block;margin-right:8px;vertical-align:middle}.button-spinner[_ngcontent-%COMP%]     circle{stroke:#fff}@media (max-width: 768px){mat-dialog-content[_ngcontent-%COMP%]{min-width:300px;max-width:400px;padding:0 16px}h2[mat-dialog-title][_ngcontent-%COMP%]{font-size:18px;margin-bottom:16px}.full-width[_ngcontent-%COMP%]{margin-bottom:12px}.color-palette[_ngcontent-%COMP%]{margin-bottom:16px;padding:12px}.palette-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:8px}.palette-label[_ngcontent-%COMP%]{font-size:13px}.color-preview-large[_ngcontent-%COMP%]{width:28px;height:28px}.color-code-text[_ngcontent-%COMP%]{font-size:13px}.palette-colors[_ngcontent-%COMP%]{gap:6px}.color-button[_ngcontent-%COMP%]{width:36px;height:36px}.error-message[_ngcontent-%COMP%]{padding:10px}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.error-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:13px}mat-dialog-actions[_ngcontent-%COMP%]{padding:12px 16px}}@media (max-width: 480px){mat-dialog-content[_ngcontent-%COMP%]{min-width:260px;max-width:320px;padding:0 12px}h2[mat-dialog-title][_ngcontent-%COMP%]{font-size:16px;margin-bottom:12px}.full-width[_ngcontent-%COMP%]{margin-bottom:10px}.full-width[_ngcontent-%COMP%]     .mat-mdc-form-field-infix{font-size:14px;min-height:48px;padding-top:12px}.full-width[_ngcontent-%COMP%]     .mat-mdc-floating-label{font-size:14px}.full-width[_ngcontent-%COMP%]     .mat-mdc-form-field-hint{font-size:11px}.color-palette[_ngcontent-%COMP%]{margin-bottom:12px;padding:10px}.palette-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:6px;margin-bottom:8px}.palette-label[_ngcontent-%COMP%]{font-size:12px}.color-preview-large[_ngcontent-%COMP%]{width:24px;height:24px}.color-code-text[_ngcontent-%COMP%]{font-size:12px}.palette-colors[_ngcontent-%COMP%]{gap:4px}.color-button[_ngcontent-%COMP%]{width:32px;height:32px}.error-message[_ngcontent-%COMP%]{padding:8px;gap:6px}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.error-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px}mat-dialog-actions[_ngcontent-%COMP%]{padding:8px 12px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:13px;padding:6px 12px;margin-left:6px}}"]})}}return o})();function lh(o,e){o&1&&(g(0,"mat-icon",27),x(1,"sync "),u())}function ch(o,e){o&1&&(g(0,"mat-icon",28),x(1,"check_circle "),u())}function dh(o,e){o&1&&(g(0,"mat-icon",29),x(1,"error "),u())}function hh(o,e){if(o&1&&(g(0,"div",22),R(1,lh,2,0,"mat-icon",23)(2,ch,2,0,"mat-icon",24)(3,dh,2,0,"mat-icon",25),g(4,"span",26),x(5),u()()),o&2){let t=y();_(),v("ngIf",t.saveStatus==="saving"),_(),v("ngIf",t.saveStatus==="saved"),_(),v("ngIf",t.saveStatus==="error"),_(2),G(t.saveStatusMessage)}}function mh(o,e){o&1&&(g(0,"div",30),tt(1,"mat-spinner",31),g(2,"span"),x(3,"Loading annotations..."),u()())}function gh(o,e){if(o&1){let t=V();g(0,"app-object-detection-canvas",32),T("annotationCreated",function(n){k(t);let a=y();return S(a.onAnnotationCreated(n))})("annotationDeleted",function(n){k(t);let a=y();return S(a.onAnnotationDeleted(n))})("annotationSelected",function(n){k(t);let a=y();return S(a.onAnnotationSelected(n))})("annotationUpdated",function(n){k(t);let a=y();return S(a.onAnnotationUpdated(n))})("zoomLevelChanged",function(n){k(t);let a=y();return S(a.onZoomLevelChanged(n))}),u()}if(o&2){let t=y();v("activeTool",t.activeTool)("annotations",t.state.annotations)("enhanceSettings",t.state.enhanceSettings)("hideAnnotations",t.hideAnnotations)("imageUrl",t.currentImageUrl)("image",t.currentImage)("isPanMode",t.isPanMode)("selectedAnnotation",t.state.selectedAnnotation)("selectedAnnotations",t.state.selectedAnnotations)("selectedClass",t.state.selectedClass)("showLabels",t.state.showLabels)("showLabelDetails",t.state.showLabelDetails)("showPredictions",t.state.showPredictions)("zoomLevel",t.zoomLevel)}}function ph(o,e){if(o&1){let t=V();g(0,"app-segmentation-canvas",32),T("annotationCreated",function(n){k(t);let a=y();return S(a.onAnnotationCreated(n))})("annotationDeleted",function(n){k(t);let a=y();return S(a.onAnnotationDeleted(n))})("annotationSelected",function(n){k(t);let a=y();return S(a.onAnnotationSelected(n))})("annotationUpdated",function(n){k(t);let a=y();return S(a.onAnnotationUpdated(n))})("zoomLevelChanged",function(n){k(t);let a=y();return S(a.onZoomLevelChanged(n))}),u()}if(o&2){let t=y();v("activeTool",t.activeTool)("annotations",t.state.annotations)("enhanceSettings",t.state.enhanceSettings)("hideAnnotations",t.hideAnnotations)("imageUrl",t.currentImageUrl)("image",t.currentImage)("isPanMode",t.isPanMode)("selectedAnnotation",t.state.selectedAnnotation)("selectedAnnotations",t.state.selectedAnnotations)("selectedClass",t.state.selectedClass)("showLabels",t.state.showLabels)("showLabelDetails",t.state.showLabelDetails)("showPredictions",t.state.showPredictions)("zoomLevel",t.zoomLevel)}}function uh(o,e){if(o&1){let t=V();g(0,"app-classification-canvas",32),T("annotationCreated",function(n){k(t);let a=y();return S(a.onAnnotationCreated(n))})("annotationDeleted",function(n){k(t);let a=y();return S(a.onAnnotationDeleted(n))})("annotationSelected",function(n){k(t);let a=y();return S(a.onAnnotationSelected(n))})("annotationUpdated",function(n){k(t);let a=y();return S(a.onAnnotationUpdated(n))})("zoomLevelChanged",function(n){k(t);let a=y();return S(a.onZoomLevelChanged(n))}),u()}if(o&2){let t=y();v("activeTool",t.activeTool)("annotations",t.state.annotations)("enhanceSettings",t.state.enhanceSettings)("hideAnnotations",t.hideAnnotations)("imageUrl",t.currentImageUrl)("image",t.currentImage)("isPanMode",t.isPanMode)("selectedAnnotation",t.state.selectedAnnotation)("selectedAnnotations",t.state.selectedAnnotations)("selectedClass",t.state.selectedClass)("showLabels",t.state.showLabels)("showLabelDetails",t.state.showLabelDetails)("showPredictions",t.state.showPredictions)("zoomLevel",t.zoomLevel)}}function fh(o,e){if(o&1){let t=V();g(0,"app-annotation-canvas",32),T("annotationCreated",function(n){k(t);let a=y();return S(a.onAnnotationCreated(n))})("annotationDeleted",function(n){k(t);let a=y();return S(a.onAnnotationDeleted(n))})("annotationSelected",function(n){k(t);let a=y();return S(a.onAnnotationSelected(n))})("annotationUpdated",function(n){k(t);let a=y();return S(a.onAnnotationUpdated(n))})("zoomLevelChanged",function(n){k(t);let a=y();return S(a.onZoomLevelChanged(n))}),u()}if(o&2){let t=y();v("activeTool",t.activeTool)("annotations",t.state.annotations)("enhanceSettings",t.state.enhanceSettings)("hideAnnotations",t.hideAnnotations)("imageUrl",t.currentImageUrl)("image",t.currentImage)("isPanMode",t.isPanMode)("selectedAnnotation",t.state.selectedAnnotation)("selectedAnnotations",t.state.selectedAnnotations)("selectedClass",t.state.selectedClass)("showLabels",t.state.showLabels)("showLabelDetails",t.state.showLabelDetails)("showPredictions",t.state.showPredictions)("zoomLevel",t.zoomLevel)}}function _h(o,e){o&1&&(g(0,"div",33)(1,"p"),x(2,"No image selected. Please select an image from the list."),u()())}function bh(o,e){if(o&1&&(g(0,"span",56),x(1),u()),o&2){let t=y().$implicit;_(),et(" ",t.confidenceRate,"% ")}}function Ch(o,e){if(o&1){let t=V();g(0,"div",47),T("click",function(){let n=k(t).$implicit,a=y(3);return S(a.onAnnotationSelected(n))}),g(1,"div",48)(2,"span",49),tt(3,"span",50),x(4),R(5,bh,2,1,"span",51),u()(),g(6,"div",52)(7,"button",53),T("click",function(n){let a=k(t).$implicit;return y(3).acceptPreAnnotation(a),S(n.stopPropagation())}),g(8,"mat-icon",54),x(9,"check"),u(),x(10," Accept "),u(),g(11,"button",55),T("click",function(n){let a=k(t).$implicit;return y(3).rejectPreAnnotation(a),S(n.stopPropagation())}),g(12,"mat-icon",54),x(13,"close"),u(),x(14," Reject "),u()()()}if(o&2){let t=e.$implicit;_(3),Ut("background-color",t.color),_(),et(" ",t.className," "),_(),v("ngIf",t.confidenceRate)}}function xh(o,e){if(o&1){let t=V();g(0,"div",40)(1,"p",41)(2,"strong"),x(3),u(),x(4," pre-annotation(s) available "),u(),g(5,"div",42)(6,"button",43),T("click",function(){k(t);let n=y(2);return S(n.acceptAllPreAnnotations())}),g(7,"mat-icon"),x(8,"check"),u(),x(9," Accept All "),u(),g(10,"button",44),T("click",function(){k(t);let n=y(2);return S(n.rejectAllPreAnnotations())}),g(11,"mat-icon"),x(12,"close"),u(),x(13," Reject All "),u()(),g(14,"div",45),R(15,Ch,15,4,"div",46),u()()}if(o&2){let t=y(2);_(3),G(t.preAnnotations.length),_(12),v("ngForOf",t.preAnnotations)}}function vh(o,e){o&1&&(g(0,"div",57)(1,"p",58),x(2,' No pre-annotations available. Click "Generate" to create predictions. '),u()())}function yh(o,e){if(o&1){let t=V();g(0,"mat-expansion-panel",16),T("opened",function(){k(t);let n=y();return S(n.onPanelOpened("preAnnotations"))}),g(1,"mat-expansion-panel-header")(2,"mat-panel-title"),x(3,"Pre-annotations"),u()(),g(4,"div",34)(5,"div",35),x(6,"Model Predictions"),u(),g(7,"div",36),x(8," Generate and manage AI-powered pre-annotations "),u(),g(9,"button",37),T("click",function(){k(t);let n=y();return S(n.generatePreAnnotations())}),g(10,"mat-icon"),x(11,"auto_fix_high"),u(),x(12),u(),R(13,xh,16,2,"div",38)(14,vh,3,0,"div",39),u()()}if(o&2){let t=y();v("expanded",t.expandedPanel==="preAnnotations"),_(9),v("disabled",t.isGeneratingPreAnnotations),_(3),et(" ",t.isGeneratingPreAnnotations?"Generating...":"Generate Pre-annotations"," "),_(),v("ngIf",t.preAnnotations.length>0),_(),v("ngIf",t.preAnnotations.length===0&&!t.isGeneratingPreAnnotations)}}var ya=(()=>{class o{constructor(t,i,n,a,s,r,l,c,d,h,m){this.imageService=t,this.projectService=i,this.projectClassService=n,this.labelService=a,this.modelPredictionService=s,this.modelService=r,this.route=l,this.router=c,this.dialog=d,this.store=h,this.authorizationService=m,this.project=null,this.currentImageUrl=null,this.state={annotations:[],selectedAnnotation:null,selectedAnnotations:[],selectedClass:null,enhanceSettings:{brightness:0,contrast:0},annotationHistory:[],historyIndex:-1,showLabels:!0,showPredictions:!0,showLabelDetails:!1},this.images=[],this.classes=[],this.toolbarButtons=[],this.isLoadingImages=!1,this.isLoadingClasses=!1,this.isLoadingAnnotations=!1,this.isGeneratingPreAnnotations=!1,this.saveStatus="idle",this.saveStatusMessage="",this.modelPredictionEnabled=!1,this.preAnnotations=[],this.selectedModelName="",this.isPanMode=!1,this.zoomLevel=1,this.hideAnnotations=!1,this.isLeftSidebarOpen=!0,this.isRightSidebarOpen=!0,this.expandedPanel="general",this.activeTool="none",this.currentUser=new Ws,this.role=kr.ADMINISTRATOR_SYSTEM,this.destroy$=new Nt,this.saveAnnotation$=new Nt,this.projectId=0,this.modelId=0,this.uploadPageQueryParams={},this.store.select(Xs).pipe(z(this.destroy$)).subscribe(p=>{p&&(this.currentUser=p)})}ngOnInit(){this.isPanMode=!1,this.activeTool="boundingBox",Ss([this.route.params,this.route.queryParams]).pipe(z(this.destroy$)).subscribe(([t,i])=>{this.projectId=+t.projectId;let n=+t.imageId;this.uploadPageQueryParams=$t({},i),i.modelId&&(this.modelId=+i.modelId),this.projectId&&n?la({project:this.projectService.getProjectById(this.projectId),image:this.imageService.getImageById(n)}).pipe(z(this.destroy$)).subscribe({next:({project:a,image:s})=>{this.project=a,this.currentImage=s,this.toolbarButtons=this.getToolbarButtons(a.type),this.loadImageFile(s.id),this.setupKeyboardListeners(),this.setupDebouncedSave(),this.loadImagesWithPagination(i),this.loadClasses(!0),this.checkModelPredictionStatus(),this.loadModelInfo()},error:a=>{console.error("Error loading project or image:",a),alert(`Failed to load: ${a.message}`)}}):console.error("Missing projectId or imageId in route parameters")})}ngOnDestroy(){this.currentImageUrl&&URL.revokeObjectURL(this.currentImageUrl),this.destroy$.next(),this.destroy$.complete()}isAuthorized(){return this.authorizationService.doesCurrentUserHaveRoleForCurrentLocation(0,"Administrator_System")}toggleLeftSidebar(){this.isLeftSidebarOpen=!this.isLeftSidebarOpen,this.triggerCanvasResize()}toggleRightSidebar(){this.isRightSidebarOpen=!this.isRightSidebarOpen,this.triggerCanvasResize()}onPanelOpened(t){this.expandedPanel=t}getToolbarButtons(t){switch(t){case"Object Detection":return[{id:"pan",label:"Pan",icon:"pan_tool",tooltip:"Pan mode"},{id:"boundingBox",label:"Bounding Box",icon:"crop_square",tooltip:"Draw bounding box"},{id:"undo",label:"Undo",icon:"undo",tooltip:"Undo last action"},{id:"redo",label:"Redo",icon:"redo",tooltip:"Redo last action"},{id:"clear",label:"Clear",icon:"delete_sweep",tooltip:"Clear all annotations"},{id:"zoomIn",label:"Zoom In",icon:"zoom_in",tooltip:"Zoom in"},{id:"zoomOut",label:"Zoom Out",icon:"zoom_out",tooltip:"Zoom out"},{id:"enhance",label:"Enhance",icon:"tune",tooltip:"Adjust brightness and contrast"},{id:"holdToHide",label:"Hold to Hide",icon:"visibility_off",tooltip:"Hold to hide annotations"}];case"Segmentation":return[{id:"pan",label:"Pan",icon:"pan_tool",tooltip:"Pan mode"},{id:"smartLabeling",label:"Smart Labeling",icon:"auto_fix_high",tooltip:"Smart labeling tool"},{id:"brush",label:"Brush",icon:"brush",tooltip:"Brush annotation"},{id:"polygon",label:"Polygon",icon:"polyline",tooltip:"Draw polygon"},{id:"polyline",label:"Polyline",icon:"timeline",tooltip:"Draw polyline"},{id:"undo",label:"Undo",icon:"undo",tooltip:"Undo last action"},{id:"redo",label:"Redo",icon:"redo",tooltip:"Redo last action"},{id:"clear",label:"Clear",icon:"delete_sweep",tooltip:"Clear all annotations"},{id:"zoomIn",label:"Zoom In",icon:"zoom_in",tooltip:"Zoom in"},{id:"zoomOut",label:"Zoom Out",icon:"zoom_out",tooltip:"Zoom out"},{id:"enhance",label:"Enhance",icon:"tune",tooltip:"Adjust brightness and contrast"},{id:"holdToHide",label:"Hold to Hide",icon:"visibility_off",tooltip:"Hold to hide annotations"}];case"Classification":return[{id:"zoomIn",label:"Zoom In",icon:"zoom_in",tooltip:"Zoom in"},{id:"zoomOut",label:"Zoom Out",icon:"zoom_out",tooltip:"Zoom out"},{id:"enhance",label:"Enhance",icon:"tune",tooltip:"Adjust brightness and contrast"}];default:return[]}}onImageSelected(t){this.selectImage(t)}getCurrentImageIndex(){if(!this.currentImage||this.images.length===0)return 0;let t=this.images.findIndex(i=>i.id===this.currentImage.id);return t>=0?t:0}onNavigateImage(t){let i=this.getCurrentImageIndex();t==="previous"&&i>0?this.selectImage(this.images[i-1]):t==="next"&&i<this.images.length-1&&this.selectImage(this.images[i+1])}onNavigateToProject(){this.project?.id&&this.router.navigate(["/landingai/projects",this.project.id],{queryParams:this.uploadPageQueryParams})}onBatchExport(t){if(t.length===0)return;let i=`Exporting ${t.length} image(s)...`;import("./chunk-W2FA72DO.js").then(n=>{let a=new n,s=a.folder("images"),r=a.folder("annotations");if(!s||!r){alert("Failed to create ZIP folders");return}let l=0,c=t.length*2;t.forEach(d=>{this.imageService.getImageFile(d.fileName).pipe(z(this.destroy$)).subscribe({next:h=>{s.file(d.fileName,h),l++,this.checkExportCompletion(l,c,a,t.length)},error:h=>{console.error(`Error fetching image ${d.fileName}:`,h),l++,this.checkExportCompletion(l,c,a,t.length)}}),this.labelService.getLabelsByImageId(d.id).pipe(z(this.destroy$)).subscribe({next:h=>{let m=h.map(b=>this.imageLabelToAnnotation(b)).filter(b=>b!==null),p={imageId:d.id,fileName:d.fileName,width:d.width,height:d.height,annotations:m.map(b=>({id:b.id,classId:b.classId,className:b.className,type:b.type,color:b.color,position:b.type==="RECTANGLE"?{x:b.x,y:b.y,width:b.width,height:b.height}:{points:b.points}}))},f=d.fileName.replace(/\.[^/.]+$/,".json");r.file(f,JSON.stringify(p,null,2)),l++,this.checkExportCompletion(l,c,a,t.length)},error:h=>{console.error(`Error fetching annotations for image ${d.id}:`,h);let m={imageId:d.id,fileName:d.fileName,width:d.width,height:d.height,annotations:[]},p=d.fileName.replace(/\.[^/.]+$/,".json");r.file(p,JSON.stringify(m,null,2)),l++,this.checkExportCompletion(l,c,a,t.length)}})})}).catch(n=>{console.error("Error loading JSZip:",n),alert("Failed to load export library. Please try again.")})}onBatchDelete(t){if(t.length===0||!confirm(`Are you sure you want to delete ${t.length} image(s) and all their annotations? This action cannot be undone.`))return;let n=t.map(a=>a.id);this.imageService.deleteImages(n).pipe(z(this.destroy$)).subscribe({next:()=>{this.images=this.images.filter(a=>!n.includes(a.id)),this.currentImage&&n.includes(this.currentImage.id)&&(this.images.length>0?this.selectImage(this.images[0]):(this.currentImage=null,this.state.annotations=[])),alert(`Successfully deleted ${t.length} image(s)`)},error:a=>{console.error("Error deleting images:",a),alert("Failed to delete images: "+a.message)}})}selectImage(t){this.state.annotations=[],this.state.selectedAnnotation=null,this.state.selectedAnnotations=[],this.currentImage=t,this.loadImageFile(t.id),this.state.enhanceSettings={brightness:0,contrast:0},this.state.annotationHistory=[],this.state.historyIndex=-1,this.loadAnnotationsForCurrentImage()}onToolbarButtonClick(t){switch(t){case"pan":this.togglePanMode();break;case"boundingBox":this.activateBoundingBoxTool();break;case"smartLabeling":this.activateSmartLabelingTool();break;case"brush":this.activateBrushTool();break;case"polygon":this.activatePolygonTool();break;case"polyline":this.activatePolylineTool();break;case"undo":this.undo();break;case"redo":this.redo();break;case"clear":this.clearAllAnnotations();break;case"zoomIn":this.zoomIn();break;case"zoomOut":this.zoomOut();break;case"holdToHideStart":this.hideAnnotations=!0;break;case"holdToHideEnd":this.hideAnnotations=!1;break;default:}}canUndo(){return this.state.historyIndex>0}canRedo(){return this.state.historyIndex<this.state.annotationHistory.length-1}onClassSelected(t){let i=this.state.selectedClass;this.state.selectedClass=t,this.project?.type==="Classification"&&this.handleClassificationClassChange(i,t)}compareClasses(t,i){return t&&i?t.id===i.id:t===i}updateAnnotationClass(t,i){t.classId=i.id,t.className=i.className,t.color=i.colorCode,t.label=i.className,this.addToHistory(),this.saveAnnotation$.next(t)}openClassCreationDialog(){if(!this.projectId||this.projectId===0)return;this.dialog.open(Un,{width:"400px",data:{projectId:this.projectId}}).afterClosed().pipe(z(this.destroy$)).subscribe(i=>{i&&this.onClassCreated(i)})}onClassCreated(t){this.classes.push(t),this.classes.sort((i,n)=>i.id-n.id),this.state.selectedClass=t}onEnhanceSettingsChanged(t){this.state.enhanceSettings=t}onNoObjectToLabelChanged(t){this.currentImage&&(this.state.annotations=this.state.annotations.filter(i=>i.isPrediction===!0),this.state.selectedAnnotation&&!this.state.selectedAnnotation.isPrediction&&(this.state.selectedAnnotation=null),this.state.selectedAnnotations=this.state.selectedAnnotations.filter(i=>i.isPrediction===!0),t&&(this.activeTool="pan",this.isPanMode=!0),this.imageService.updateIsNoClass(this.currentImage.id,t).pipe(z(this.destroy$)).subscribe({next:i=>{this.currentImage=i;let n=this.images.findIndex(a=>a.id===i.id);n!==-1&&(this.images[n]=i)},error:i=>{console.error("Error updating isNoClass flag:",i)}}))}onImageUpdated(t){let i=this.images.findIndex(n=>n.id===t.id);i!==-1&&(this.images[i]=t),this.currentImage?.id===t.id&&(this.currentImage=t)}onImageDeleted(t){this.images=this.images.filter(i=>i.id!==t),this.currentImage?.id===t&&(this.images.length>0?this.selectImage(this.images[0]):(this.currentImage=null,this.state.annotations=[]))}onImageExported(t){alert(`Export functionality for "${t.fileName}" will be implemented in subsequent tasks.`)}onAnnotationSelected(t){this.state.selectedAnnotation=t,t?(this.state.selectedAnnotations.length<=1||!this.state.selectedAnnotations.some(i=>i.id===t.id))&&(this.state.selectedAnnotations=[t]):this.state.selectedAnnotations=[]}onAnnotationsSelected(t){this.state.selectedAnnotations=t}onShowLabelsChanged(t){this.state.showLabels=t}onShowPredictionsChanged(t){this.state.showPredictions=t}onShowLabelDetailsChanged(t){this.state.showLabelDetails=t}onLabelAssistClicked(){this.generatePreAnnotations()}onAnnotationCreated(t){this.state.selectedClass?(t.classId=this.state.selectedClass.id,t.className=this.state.selectedClass.className,t.color=this.state.selectedClass.colorCode,t.label=this.state.selectedClass.className):(t.classId=0,t.className="Unlabeled",t.color="#FF0000",t.label="Unlabeled"),this.state.annotations=[...this.state.annotations,t],this.addToHistory(),this.saveAnnotation$.next(t)}onAnnotationUpdated(t){let i=this.state.annotations.findIndex(n=>n.id===t.id);i!==-1&&(this.state.annotations[i]=t,this.addToHistory(),this.saveAnnotation$.next(t))}onAnnotationDeleted(t){this.deleteAnnotation(t)}deleteAnnotation(t){this.state.annotations=this.state.annotations.filter(i=>i.id!==t.id),this.addToHistory(),this.state.selectedAnnotation?.id===t.id&&(this.state.selectedAnnotation=null),t.id>0&&this.deleteAnnotationFromDatabase(t.id)}generatePreAnnotations(){if(this.currentImage){if(!this.modelPredictionEnabled){alert("Model prediction is not enabled. Please configure the model prediction service.");return}this.project&&(this.isGeneratingPreAnnotations=!0,this.modelPredictionService.generatePreAnnotations(this.currentImage.id,this.project.id).pipe(z(this.destroy$)).subscribe({next:t=>{let i=t.map(n=>this.imageLabelToAnnotation(n)).filter(n=>n!==null);this.preAnnotations=i,this.state.annotations=[...this.state.annotations.filter(n=>!n.isPrediction),...i],this.isGeneratingPreAnnotations=!1,i.length===0?alert("No predictions were generated for this image."):alert(`Generated ${i.length} pre-annotation(s). You can now accept or reject them.`)},error:t=>{console.error("Error generating pre-annotations:",t),this.isGeneratingPreAnnotations=!1,alert("Failed to generate pre-annotations: "+t.message)}}))}}acceptPreAnnotation(t){t.isPrediction&&(t.annotationType="Ground Truth",t.isPrediction=!1,this.preAnnotations=this.preAnnotations.filter(i=>i.id!==t.id),this.saveAnnotation$.next(t))}rejectPreAnnotation(t){t.isPrediction&&(this.preAnnotations=this.preAnnotations.filter(i=>i.id!==t.id),this.deleteAnnotation(t))}acceptAllPreAnnotations(){if(this.preAnnotations.length===0||!confirm(`Accept all ${this.preAnnotations.length} pre-annotation(s)? They will be converted to manual annotations.`))return;let i=[...this.preAnnotations];i.forEach(n=>{this.acceptPreAnnotation(n)}),alert(`Accepted ${i.length} pre-annotation(s)`)}rejectAllPreAnnotations(){if(this.preAnnotations.length===0||!confirm(`Reject all ${this.preAnnotations.length} pre-annotation(s)? They will be deleted.`))return;let i=[...this.preAnnotations];i.forEach(n=>{this.rejectPreAnnotation(n)}),alert(`Rejected ${i.length} pre-annotation(s)`)}onZoomLevelChanged(t){this.zoomLevel=t}triggerCanvasResize(){setTimeout(()=>{window.dispatchEvent(new Event("resize"))},300)}checkExportCompletion(t,i,n,a){t===i&&n.generateAsync({type:"blob"}).then(s=>{let r=window.URL.createObjectURL(s),l=document.createElement("a");l.href=r,l.download=`export_${a}_images_${Date.now()}.zip`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(r),alert(`Successfully exported ${a} image(s) with annotations`)}).catch(s=>{console.error("Error generating ZIP:",s),alert("Failed to generate export file: "+s.message)})}handleClassificationClassChange(t,i){if(!this.currentImage)return;if(t&&this.state.annotations.length>0){let a=this.state.annotations[0];this.deleteAnnotation(a)}let n={id:0,classId:i.id,className:i.className,color:i.colorCode,label:i.className,type:"CLASSIFICATION",x:0,y:0,width:0,height:0,points:[],annotationType:"Ground truth"};this.state.annotations=[n],this.addToHistory(),this.saveAnnotation$.next(n)}deleteAnnotationFromDatabase(t){this.labelService.deleteLabel(t).pipe(z(this.destroy$)).subscribe({next:()=>{this.updateSaveStatus("saved","Deleted")},error:i=>{console.error("Error deleting annotation:",i),this.updateSaveStatus("error","Delete failed: "+i.message)}})}togglePanMode(){this.isPanMode?(this.isPanMode=!1,this.activeTool="none"):(this.isPanMode=!0,this.activeTool="pan")}activateBoundingBoxTool(){if(this.activeTool==="boundingBox"){this.activeTool="none";return}this.isPanMode=!1,this.activeTool="boundingBox",this.state.selectedClass||alert("Please select a class before drawing annotations.")}activateSmartLabelingTool(){this.isPanMode=!1,this.activeTool="none"}activateBrushTool(){this.isPanMode=!1,this.activeTool="brush"}activatePolygonTool(){this.isPanMode=!1,this.activeTool="polygon"}activatePolylineTool(){this.isPanMode=!1,this.activeTool="polyline"}undo(){this.canUndo()&&(this.state.historyIndex--,this.state.annotations=[...this.state.annotationHistory[this.state.historyIndex]])}redo(){this.canRedo()&&(this.state.historyIndex++,this.state.annotations=[...this.state.annotationHistory[this.state.historyIndex]])}clearAllAnnotations(){if(this.state.annotations.length===0)return;if(confirm("Are you sure you want to clear all annotations for this image?")){let i=this.currentImage?.id;this.state.annotations=[],this.state.selectedAnnotation=null,this.addToHistory(),i&&this.deleteAllAnnotationsFromDatabase(i)}}deleteAllAnnotationsFromDatabase(t){this.labelService.deleteLabelsByImageId(t).pipe(z(this.destroy$)).subscribe({next:()=>{},error:i=>{console.error("Error deleting all annotations:",i),alert("Failed to delete all annotations: "+i.message)}})}zoomIn(){this.zoomLevel=Math.min(this.zoomLevel+.1,3)}zoomOut(){this.zoomLevel=Math.max(this.zoomLevel-.1,.1)}addToHistory(){this.state.historyIndex<this.state.annotationHistory.length-1&&(this.state.annotationHistory=this.state.annotationHistory.slice(0,this.state.historyIndex+1)),this.state.annotationHistory.push([...this.state.annotations]),this.state.historyIndex=this.state.annotationHistory.length-1,this.state.annotationHistory.length>50&&(this.state.annotationHistory.shift(),this.state.historyIndex--)}setupKeyboardListeners(){document.addEventListener("keydown",t=>{if(t.key==="Delete"||t.key==="Backspace"){let i=t.target;if(i.tagName==="INPUT"||i.tagName==="TEXTAREA"||i.isContentEditable)return;if(this.state.selectedAnnotations.length>0){t.preventDefault();let a=this.state.selectedAnnotations.filter(s=>s.annotationType!=="Prediction");if(a.length===0)return;a.forEach(s=>{this.deleteAnnotation(s)}),this.state.selectedAnnotations=[];return}if(this.state.selectedAnnotation){if(this.state.selectedAnnotation.annotationType==="Prediction")return;t.preventDefault(),this.deleteAnnotation(this.state.selectedAnnotation)}}})}loadImageById(t,i){this.imageService.getImageById(t).pipe(z(this.destroy$)).subscribe({next:n=>{this.currentImage=n,this.loadImageFile(this.currentImage.id),this.setupKeyboardListeners(),this.setupDebouncedSave()},error:n=>{console.error("Error loading image:",n),alert(`Failed to load image: ${n.message}`)}})}loadProject(t){this.projectService.getProjectById(t).pipe(z(this.destroy$)).subscribe({next:i=>{this.project=i,this.toolbarButtons=this.getToolbarButtons(i.type),this.loadImages(),this.loadClasses(!0),this.checkModelPredictionStatus()},error:i=>{console.error("Error loading project:",i),alert("Failed to load project: "+i.message)}})}loadImagesWithPagination(t){if(!this.project)return;if(!t.page&&!t.size){this.loadImages();return}this.isLoadingImages=!0;let i=t.page?+t.page:0,n=t.size?+t.size:20,a=t.viewMode||"images",s=t.sortBy||"upload_time_desc",r={};t.mediaStatus&&(r.mediaStatus=t.mediaStatus.split(",")),t.groundTruthLabels&&(r.groundTruthLabels=t.groundTruthLabels.split(",").map(l=>+l)),t.predictionLabels&&(r.predictionLabels=t.predictionLabels.split(",").map(l=>+l)),t.split&&(r.split=t.split.split(",")),t.tags&&(r.tags=t.tags.split(",").map(l=>+l)),t.mediaName&&(r.mediaName=t.mediaName),t.labeler&&(r.labeler=t.labeler),t.mediaId&&(r.mediaId=t.mediaId),t.noClass!==void 0&&(r.noClass=t.noClass==="true"),t.predictionNoClass!==void 0&&(r.predictionNoClass=t.predictionNoClass==="true"),t.modelId&&(r.modelId=+t.modelId),t.annotationType&&(r.annotationType=t.annotationType),this.imageService.getImagesPageableByProjectId(this.project.id,i,n,a,r,s,!1).pipe(z(this.destroy$)).subscribe({next:l=>{this.images=l.content,this.isLoadingImages=!1},error:l=>{console.error("Error loading paginated images:",l),this.isLoadingImages=!1,this.loadImages()}})}loadImages(){this.project&&(this.isLoadingImages=!0,this.imageService.getImagesByProjectId(this.project.id).pipe(z(this.destroy$)).subscribe({next:t=>{this.images=t,this.isLoadingImages=!1},error:t=>{console.error("Error loading images:",t),this.isLoadingImages=!1}}))}loadClasses(t=!1){this.project&&(this.isLoadingClasses=!0,this.projectClassService.getClassesByProjectId(this.project.id).pipe(z(this.destroy$)).subscribe({next:i=>{if(i.length===0){this.isLoadingClasses=!1,alert("Please setup classes first before labeling images."),this.router.navigate(["/landingai/projects",this.project.id]);return}this.classes=[...i],this.isLoadingClasses=!1,this.classes.length>0&&!this.state.selectedClass&&(this.state.selectedClass=this.classes[0]),t&&this.loadAnnotationsForCurrentImage()},error:i=>{console.error("Error loading classes:",i),this.isLoadingClasses=!1,alert("Failed to load classes. Please setup classes first before labeling images."),this.project&&this.router.navigate(["/landingai/projects",this.project.id])}}))}annotationToImageLabel(t){let i=null;if(t.type==="RECTANGLE"){let n=this.currentImage?.width||1,a=this.currentImage?.height||1,s=(t.x+t.width/2)/n,r=(t.y+t.height/2)/a,l=t.width/n,c=t.height/a;i=JSON.stringify({type:"rectangle",x:s,y:r,width:l,height:c})}else(t.type==="POLYGON"||t.type==="BRUSH"||t.type==="POLYLINE")&&(i=JSON.stringify({type:t.type.toLowerCase(),points:t.points}));return{id:t.id>0?t.id:void 0,imageId:this.currentImage.id,classId:t.classId,position:i,annotationType:"Ground truth",createdBy:this.currentUser.wbi}}saveAnnotationToDatabase(t){if(!this.currentImage){console.error("Cannot save annotation: no current image"),this.updateSaveStatus("error","No current image");return}let i=this.annotationToImageLabel(t);this.updateSaveStatus("saving","Saving..."),i.id&&i.id>0&&i.id<1e9?this.labelService.updateLabel(i.id,i).pipe(z(this.destroy$)).subscribe({next:a=>{this.updateSaveStatus("saved","Saved")},error:a=>{console.error("Error saving annotation:",a),this.updateSaveStatus("error","Save failed: "+a.message)}}):this.labelService.saveLabel(i).pipe(z(this.destroy$)).subscribe({next:a=>{t.id=a.id,this.updateSaveStatus("saved","Saved")},error:a=>{console.error("Error creating annotation:",a),this.updateSaveStatus("error","Save failed: "+a.message)}})}setupDebouncedSave(){this.saveAnnotation$.pipe(On(500),z(this.destroy$)).subscribe(t=>{this.saveAnnotationToDatabase(t)})}updateSaveStatus(t,i=""){this.saveStatus=t,this.saveStatusMessage=i,t==="saved"&&setTimeout(()=>{this.saveStatus==="saved"&&(this.saveStatus="idle",this.saveStatusMessage="")},2e3)}loadAnnotationsForCurrentImage(){if(!this.currentImage){console.error("Cannot load annotations: no current image");return}this.isLoadingAnnotations=!0;let t=this.labelService.getLabelsByImageId(this.currentImage.id);this.modelId?la({groundTruth:t,predictions:this.modelPredictionService.getPredictionsByImageAndModel(this.currentImage.id,this.modelId)}).pipe(z(this.destroy$)).subscribe({next:({groundTruth:i,predictions:n})=>{let a=i.map(r=>this.imageLabelToAnnotation(r)).filter(r=>r!==null),s=n.map(r=>this.imageLabelToAnnotation(r)).filter(r=>r!==null);if(this.state.annotations=[...a,...s],this.state.annotationHistory=[this.state.annotations],this.state.historyIndex=0,this.project?.type==="Classification"){let r=a;if(r.length>0){let l=r[0],c=this.classes.find(d=>d.id===l.classId);c&&(this.state.selectedClass=c)}else this.state.selectedClass=null}this.isLoadingAnnotations=!1},error:i=>{console.error("Error loading annotations:",i),this.isLoadingAnnotations=!1,alert("Failed to load annotations: "+i.message)}}):t.pipe(z(this.destroy$)).subscribe({next:i=>{if(this.state.annotations=i.map(n=>this.imageLabelToAnnotation(n)).filter(n=>n!==null),this.state.annotationHistory=[this.state.annotations],this.state.historyIndex=0,this.project?.type==="Classification")if(this.state.annotations.length>0){let n=this.state.annotations[0],a=this.classes.find(s=>s.id===n.classId);a&&(this.state.selectedClass=a)}else this.state.selectedClass=null;this.isLoadingAnnotations=!1},error:i=>{console.error("Error loading annotations:",i),this.isLoadingAnnotations=!1,alert("Failed to load annotations: "+i.message)}})}imageLabelToAnnotation(t){try{let i=this.classes.find(h=>h.id===t.classId);if(!i)return null;let n=ht.Rectangle,a=0,s=0,r=0,l=0,c=[];if(t.position)try{let h=JSON.parse(t.position);if(h.type==="rectangle"){n=ht.Rectangle;let m=this.currentImage?.width||1,p=this.currentImage?.height||1,f=h.x||0,b=h.y||0,C=h.width||0,M=h.height||0;r=C*m,l=M*p,a=f*m-r/2,s=b*p-l/2}else h.type==="polygon"?(n=ht.Polygon,c=h.points||[]):h.type==="brush"?(n=ht.Brush,c=h.points||[]):h.type==="polyline"&&(n=ht.Polyline,c=h.points||[])}catch(h){return console.error(`Invalid JSON in position field for label ${t.id}:`,h),console.error(`Position value: ${t.position}`),null}else n=ht.Classification;return{id:t.id||0,classId:t.classId,className:i.className,color:i.colorCode,label:i.className,type:n,x:a,y:s,width:r,height:l,points:c,annotationType:t.annotationType,confidenceRate:t.confidenceRate,isPrediction:t.annotationType==="Prediction"}}catch(i){return console.error(`Error converting label ${t.id} to annotation:`,i),null}}checkModelPredictionStatus(){this.modelPredictionService.getStatus().pipe(z(this.destroy$)).subscribe({next:t=>{this.modelPredictionEnabled=t.enabled},error:t=>{console.error("Error checking model prediction status:",t),this.modelPredictionEnabled=!1}})}loadModelInfo(){this.modelId&&this.modelService.getModelById(this.modelId).pipe(z(this.destroy$)).subscribe({next:t=>{t&&(this.selectedModelName=t.modelAlias?`${t.modelAlias} (v${t.modelVersion||"?"})`:`Model #${t.id}`)},error:t=>{console.error("Error loading model info:",t),this.selectedModelName=`Model #${this.modelId}`}})}loadImageFile(t){if(!this.currentImage){console.error("Cannot load image file: no current image");return}this.currentImageUrl&&(URL.revokeObjectURL(this.currentImageUrl),this.currentImageUrl=null),this.imageService.getImageFileByImageId(t).pipe(z(this.destroy$)).subscribe({next:i=>{let a=(this.currentImage?.fileName||"").split(".").pop()?.toLowerCase()||"jpeg",r={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",bmp:"image/bmp",webp:"image/webp"}[a]||"image/jpeg",l=new Blob([i],{type:r});this.currentImageUrl=URL.createObjectURL(l)},error:i=>{console.error(`Error loading image file for imageId ${t}:`,i),alert(`Failed to load image file: ${i.message}`)}})}static{this.\u0275fac=function(i){return new(i||o)(W(Dn),W(Or),W(Rn),W($r),W(el),W(Wr),W(wr),W(Mr),W(Ge),W(Ys),W($s))}}static{this.\u0275cmp=$({type:o,selectors:[["app-image-labelling"]],standalone:!1,decls:48,vars:54,consts:[[1,"image-labelling-container"],[3,"buttonClick","classCreated","classSelected","enhanceSettingsChanged","navigateImage","navigateToProject","noObjectToLabelChanged","showLabelDetailsChanged","activeTool","buttons","canRedo","canUndo","classes","currentImage","currentImageIndex","enhanceSettings","isNoClass","isPanMode","projectId","projectName","selectedClass","showLabelDetails","totalImages","zoomLevel"],[1,"main-container"],["mode","side",1,"left-sidebar",3,"fixedInViewport","opened"],[3,"batchDelete","batchExport","imageSelected","currentImage","images","isLoadingImages","project"],[1,"center-content"],["mat-icon-button","",1,"sidebar-toggle-btn","left-toggle",3,"click","matTooltip"],["mat-icon-button","",1,"sidebar-toggle-btn","right-toggle",3,"click","matTooltip"],["class","save-status-indicator",4,"ngIf"],["class","loading-indicator",4,"ngIf"],[1,"image-preview-area",3,"ngSwitch"],[3,"activeTool","annotations","enhanceSettings","hideAnnotations","imageUrl","image","isPanMode","selectedAnnotation","selectedAnnotations","selectedClass","showLabels","showLabelDetails","showPredictions","zoomLevel","annotationCreated","annotationDeleted","annotationSelected","annotationUpdated","zoomLevelChanged",4,"ngSwitchCase"],[3,"activeTool","annotations","enhanceSettings","hideAnnotations","imageUrl","image","isPanMode","selectedAnnotation","selectedAnnotations","selectedClass","showLabels","showLabelDetails","showPredictions","zoomLevel","annotationCreated","annotationDeleted","annotationSelected","annotationUpdated","zoomLevelChanged",4,"ngSwitchDefault"],["class","no-image-message",4,"ngIf"],["mode","side","position","end",1,"right-sidebar",3,"fixedInViewport","opened"],[1,"sidebar-content"],[3,"opened","expanded"],[3,"imageDeleted","imageExported","imageUpdated","currentImage","project"],[3,"currentImage","project"],[3,"annotationSelected","annotationsSelected","showLabelsChanged","annotations","selectedAnnotation","selectedAnnotations"],[3,"annotationSelected","annotationsSelected","labelAssistClicked","showPredictionsChanged","annotations","selectedAnnotation","selectedAnnotations","selectedModel"],[3,"expanded","opened",4,"ngIf"],[1,"save-status-indicator"],["class","status-icon saving",4,"ngIf"],["class","status-icon saved",4,"ngIf"],["class","status-icon error",4,"ngIf"],[1,"status-message"],[1,"status-icon","saving"],[1,"status-icon","saved"],[1,"status-icon","error"],[1,"loading-indicator"],["diameter","40"],[3,"annotationCreated","annotationDeleted","annotationSelected","annotationUpdated","zoomLevelChanged","activeTool","annotations","enhanceSettings","hideAnnotations","imageUrl","image","isPanMode","selectedAnnotation","selectedAnnotations","selectedClass","showLabels","showLabelDetails","showPredictions","zoomLevel"],[1,"no-image-message"],[1,"pre-annotation-controls"],[1,"control-header"],[1,"control-info"],["color","primary","mat-raised-button","",2,"width","100%",3,"click","disabled"],["style","margin-top: 12px",4,"ngIf"],["style","margin-top: 8px",4,"ngIf"],[2,"margin-top","12px"],[2,"font-size","13px","margin","4px 0"],[1,"control-buttons"],["color","accent","mat-raised-button","",3,"click"],["color","warn","mat-raised-button","",3,"click"],[2,"margin-top","12px","max-height","200px","overflow-y","auto"],["class","annotation-list-item prediction","style",`
                    padding: 8px;
                    margin-bottom: 4px;
                    border-radius: 4px;
                    cursor: pointer;
                  `,3,"click",4,"ngFor","ngForOf"],[1,"annotation-list-item","prediction",2,"padding","8px","margin-bottom","4px","border-radius","4px","cursor","pointer",3,"click"],[2,"display","flex","align-items","center","justify-content","space-between"],[1,"annotation-label"],[1,"color-indicator"],["class","confidence-badge",4,"ngIf"],[1,"accept-reject-buttons"],["color","accent","mat-button","",3,"click"],[2,"font-size","16px"],["color","warn","mat-button","",3,"click"],[1,"confidence-badge"],[2,"margin-top","8px"],[2,"font-size","12px","color","#666","font-style","italic"]],template:function(i,n){i&1&&(g(0,"div",0)(1,"app-top-toolbar",1),T("buttonClick",function(s){return n.onToolbarButtonClick(s)})("classCreated",function(s){return n.onClassCreated(s)})("classSelected",function(s){return n.onClassSelected(s)})("enhanceSettingsChanged",function(s){return n.onEnhanceSettingsChanged(s)})("navigateImage",function(s){return n.onNavigateImage(s)})("navigateToProject",function(){return n.onNavigateToProject()})("noObjectToLabelChanged",function(s){return n.onNoObjectToLabelChanged(s)})("showLabelDetailsChanged",function(s){return n.onShowLabelDetailsChanged(s)}),u(),g(2,"mat-sidenav-container",2)(3,"mat-sidenav",3)(4,"app-left-toolbar",4),T("batchDelete",function(s){return n.onBatchDelete(s)})("batchExport",function(s){return n.onBatchExport(s)})("imageSelected",function(s){return n.onImageSelected(s)}),u()(),g(5,"mat-sidenav-content",5)(6,"button",6),T("click",function(){return n.toggleLeftSidebar()}),g(7,"mat-icon"),x(8),u()(),g(9,"button",7),T("click",function(){return n.toggleRightSidebar()}),g(10,"mat-icon"),x(11),u()(),R(12,hh,6,4,"div",8)(13,mh,4,0,"div",9),g(14,"div",10),R(15,gh,1,14,"app-object-detection-canvas",11)(16,ph,1,14,"app-segmentation-canvas",11)(17,uh,1,14,"app-classification-canvas",11)(18,fh,1,14,"app-annotation-canvas",12)(19,_h,3,0,"div",13),u()(),g(20,"mat-sidenav",14)(21,"div",15)(22,"mat-expansion-panel",16),T("opened",function(){return n.onPanelOpened("general")}),g(23,"mat-expansion-panel-header")(24,"mat-panel-title"),x(25,"General"),u()(),g(26,"app-general-block",17),T("imageDeleted",function(s){return n.onImageDeleted(s)})("imageExported",function(s){return n.onImageExported(s)})("imageUpdated",function(s){return n.onImageUpdated(s)}),u()(),g(27,"mat-expansion-panel",16),T("opened",function(){return n.onPanelOpened("tags")}),g(28,"mat-expansion-panel-header")(29,"mat-panel-title"),x(30,"Tags"),u()(),tt(31,"app-tags-block",18),u(),g(32,"mat-expansion-panel",16),T("opened",function(){return n.onPanelOpened("metadata")}),g(33,"mat-expansion-panel-header")(34,"mat-panel-title"),x(35,"Metadata"),u()(),tt(36,"app-metadata-block",18),u(),g(37,"mat-expansion-panel",16),T("opened",function(){return n.onPanelOpened("labels")}),g(38,"mat-expansion-panel-header")(39,"mat-panel-title"),x(40,"Labels"),u()(),g(41,"app-labels-block",19),T("annotationSelected",function(s){return n.onAnnotationSelected(s)})("annotationsSelected",function(s){return n.onAnnotationsSelected(s)})("showLabelsChanged",function(s){return n.onShowLabelsChanged(s)}),u()(),g(42,"mat-expansion-panel",16),T("opened",function(){return n.onPanelOpened("predictions")}),g(43,"mat-expansion-panel-header")(44,"mat-panel-title"),x(45,"Predictions"),u()(),g(46,"app-predictions-block",20),T("annotationSelected",function(s){return n.onAnnotationSelected(s)})("annotationsSelected",function(s){return n.onAnnotationsSelected(s)})("labelAssistClicked",function(){return n.onLabelAssistClicked()})("showPredictionsChanged",function(s){return n.onShowPredictionsChanged(s)}),u()(),R(47,yh,15,5,"mat-expansion-panel",21),u()()()()),i&2&&(_(),v("activeTool",n.activeTool)("buttons",n.toolbarButtons)("canRedo",n.canRedo())("canUndo",n.canUndo())("classes",n.classes)("currentImage",n.currentImage)("currentImageIndex",n.getCurrentImageIndex())("enhanceSettings",n.state.enhanceSettings)("isNoClass",n.currentImage.isNoClass||!1)("isPanMode",n.isPanMode)("projectId",(n.project==null?null:n.project.id)||0)("projectName",(n.project==null?null:n.project.name)||"")("selectedClass",n.state.selectedClass)("showLabelDetails",n.state.showLabelDetails)("totalImages",n.images.length)("zoomLevel",n.zoomLevel),_(2),v("fixedInViewport",!1)("opened",n.isLeftSidebarOpen),_(),v("currentImage",n.currentImage)("images",n.images)("isLoadingImages",n.isLoadingImages)("project",n.project),_(2),ua("matTooltip",n.isLeftSidebarOpen?"Hide Image List":"Show Image List"),_(2),et("",n.isLeftSidebarOpen?"chevron_left":"chevron_right"," "),_(),ua("matTooltip",n.isRightSidebarOpen?"Hide Properties":"Show Properties"),_(2),et("",n.isRightSidebarOpen?"chevron_right":"chevron_left"," "),_(),v("ngIf",n.saveStatus!=="idle"),_(),v("ngIf",n.isLoadingAnnotations),_(),v("ngSwitch",n.project==null?null:n.project.type),_(),v("ngSwitchCase","Object Detection"),_(),v("ngSwitchCase","Segmentation"),_(),v("ngSwitchCase","Classification"),_(2),v("ngIf",!n.currentImage),_(),v("fixedInViewport",!1)("opened",n.isRightSidebarOpen),_(2),v("expanded",n.expandedPanel==="general"),_(4),v("currentImage",n.currentImage)("project",n.project),_(),v("expanded",n.expandedPanel==="tags"),_(4),v("currentImage",n.currentImage)("project",n.project),_(),v("expanded",n.expandedPanel==="metadata"),_(4),v("currentImage",n.currentImage)("project",n.project),_(),v("expanded",n.expandedPanel==="labels"),_(4),v("annotations",n.state.annotations)("selectedAnnotation",n.state.selectedAnnotation)("selectedAnnotations",n.state.selectedAnnotations),_(),v("expanded",n.expandedPanel==="predictions"),_(4),v("annotations",n.state.annotations)("selectedAnnotation",n.state.selectedAnnotation)("selectedAnnotations",n.state.selectedAnnotations)("selectedModel",n.selectedModelName),_(),v("ngIf",n.modelPredictionEnabled&&n.currentImage))},styles:[".image-labelling-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;overflow:hidden}.top-toolbar[_ngcontent-%COMP%]{flex-shrink:0;z-index:2}.top-toolbar[_ngcontent-%COMP%]   .toolbar-title[_ngcontent-%COMP%]{font-size:18px;font-weight:500}.top-toolbar[_ngcontent-%COMP%]   .toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.top-toolbar[_ngcontent-%COMP%]   .toolbar-buttons[_ngcontent-%COMP%]{display:flex;gap:4px}.top-toolbar[_ngcontent-%COMP%]   .toolbar-buttons[_ngcontent-%COMP%]   .toolbar-button[_ngcontent-%COMP%]:hover{background-color:#ffffff1a}.top-toolbar[_ngcontent-%COMP%]   .toolbar-buttons[_ngcontent-%COMP%]   .toolbar-button.active[_ngcontent-%COMP%]{background-color:#fff3}.main-container[_ngcontent-%COMP%]{flex:1;min-height:0;overflow:hidden}.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%]{width:280px;border:none;box-shadow:0 2px 4px #0000001a;background-color:#e5f5e0}.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]{padding:16px;height:100%;overflow-y:auto;background-color:#e5f5e0}.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:16px 0 8px;font-size:16px;font-weight:500;color:#333}.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .project-status[_ngcontent-%COMP%]{padding:8px;background-color:#f5f5f5;border-radius:4px;margin-bottom:16px}.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .project-status[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0;font-size:14px}.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .image-list[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto;border:1px solid #e0e0e0;border-radius:4px;margin-bottom:16px}.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .image-list[_ngcontent-%COMP%]   mat-list[_ngcontent-%COMP%]{padding:0}.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .image-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{cursor:pointer;border-bottom:1px solid #f0f0f0;padding:8px 16px;display:flex;align-items:center}.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .image-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .image-list[_ngcontent-%COMP%]   mat-list-item.selected[_ngcontent-%COMP%]{background-color:#e3f2fd}.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .image-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   .image-checkbox[_ngcontent-%COMP%]{margin-right:8px}.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .image-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   .image-name[_ngcontent-%COMP%]{font-size:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .batch-operations[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .batch-operations[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .loading-indicator[_ngcontent-%COMP%]{padding:16px;text-align:center;color:#666;font-size:14px}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]{width:560px;border:none;box-shadow:0 2px 4px #0000001a;background-color:#e5f5e0}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]{padding:16px;height:100%;overflow-y:auto;background-color:#e5f5e0}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:16px 0 8px;font-size:16px;font-weight:500;color:#333}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   mat-expansion-panel[_ngcontent-%COMP%]{margin-bottom:8px;box-shadow:none;border:1px solid #e0e0e0}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   mat-expansion-panel[_ngcontent-%COMP%]:first-child{margin-top:0}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   mat-expansion-panel[disabled][_ngcontent-%COMP%]     .mat-expansion-panel-header-title{color:#000!important}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   mat-expansion-panel[_ngcontent-%COMP%]     .mat-expansion-panel-header{background-color:#f5f5f5;border-bottom:2px solid #bdbdbd;padding:12px 16px;height:auto;min-height:48px;transition:all .3s ease}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   mat-expansion-panel[_ngcontent-%COMP%]     .mat-expansion-panel-header:hover{background-color:#eee}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   mat-expansion-panel[_ngcontent-%COMP%]     .mat-expansion-panel-header .mat-expansion-panel-header-title{font-size:15px;font-weight:600;color:#424242}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   mat-expansion-panel[_ngcontent-%COMP%]     .mat-expansion-panel-header .mat-expansion-indicator{width:24px;height:24px;display:flex;align-items:center;justify-content:center;background-color:#2196f3;border-radius:50%;transition:all .3s ease}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   mat-expansion-panel[_ngcontent-%COMP%]     .mat-expansion-panel-header .mat-expansion-indicator:after{color:#fff!important;border-color:#fff!important;border-width:0 2px 2px 0;padding:3px;margin-top:-2px}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   mat-expansion-panel[_ngcontent-%COMP%]     .mat-expansion-panel-header:hover .mat-expansion-indicator{background-color:#1976d2;transform:scale(1.1)}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   mat-expansion-panel.mat-expanded[_ngcontent-%COMP%]     .mat-expansion-panel-header{background-color:#eee;border-bottom-color:#bdbdbd}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   mat-expansion-panel.mat-expanded[_ngcontent-%COMP%]     .mat-expansion-panel-header .mat-expansion-indicator{background-color:#1976d2}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .general-block[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .tags-block[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .metadata-block[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .labels-block[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .classes-block[_ngcontent-%COMP%]{padding:8px 0}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .general-block[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .tags-block[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .metadata-block[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .labels-block[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .classes-block[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0;font-size:14px}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .general-block[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .tags-block[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .metadata-block[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .labels-block[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .classes-block[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:4px 0;width:100%}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .general-block[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .tags-block[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .metadata-block[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .labels-block[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .classes-block[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%;margin:8px 0}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .general-block[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .tags-block[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .metadata-block[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .labels-block[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .classes-block[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin:8px 0}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .general-block[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .tags-block[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .metadata-block[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .labels-block[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .classes-block[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%]{color:#666;font-size:13px;font-style:italic}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .general-block[_ngcontent-%COMP%]   .color-indicator[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .tags-block[_ngcontent-%COMP%]   .color-indicator[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .metadata-block[_ngcontent-%COMP%]   .color-indicator[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .labels-block[_ngcontent-%COMP%]   .color-indicator[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   .classes-block[_ngcontent-%COMP%]   .color-indicator[_ngcontent-%COMP%]{display:inline-block;width:16px;height:16px;border-radius:50%;margin-right:8px;vertical-align:middle;border:1px solid #ccc}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]{background-color:#e0e0e0;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .sidebar-toggle-btn[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translateY(-50%);z-index:10;background:linear-gradient(180deg,#fffde7,#fff9c4,#fff59d);box-shadow:0 2px 4px #0003;width:32px;height:72px;border-radius:0 4px 4px 0}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .sidebar-toggle-btn.left-toggle[_ngcontent-%COMP%]{left:0}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .sidebar-toggle-btn.right-toggle[_ngcontent-%COMP%]{right:0;border-radius:4px 0 0 4px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .sidebar-toggle-btn[_ngcontent-%COMP%]:hover{background:linear-gradient(180deg,#fff9c4,#fff59d,#ffee58)}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .sidebar-toggle-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .save-status-indicator[_ngcontent-%COMP%]{position:absolute;top:16px;right:16px;background-color:#fff;padding:8px 16px;border-radius:4px;box-shadow:0 2px 8px #00000026;display:flex;align-items:center;gap:8px;z-index:10;animation:_ngcontent-%COMP%_fadeIn .3s ease-in}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .save-status-indicator[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .save-status-indicator[_ngcontent-%COMP%]   .status-icon.saving[_ngcontent-%COMP%]{color:#2196f3;animation:_ngcontent-%COMP%_rotate 1s linear infinite}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .save-status-indicator[_ngcontent-%COMP%]   .status-icon.saved[_ngcontent-%COMP%]{color:#4caf50}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .save-status-indicator[_ngcontent-%COMP%]   .status-icon.error[_ngcontent-%COMP%]{color:#f44336}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .save-status-indicator[_ngcontent-%COMP%]   .status-message[_ngcontent-%COMP%]{font-size:14px;font-weight:500}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .loading-indicator[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#fff;padding:24px;border-radius:8px;box-shadow:0 4px 12px #00000026;display:flex;flex-direction:column;align-items:center;gap:16px;z-index:100}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .loading-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;color:#666}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .image-preview-area[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:stretch;justify-content:stretch;position:relative}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .image-preview-area[_ngcontent-%COMP%]   app-annotation-canvas[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .image-preview-area[_ngcontent-%COMP%]   app-object-detection-canvas[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .image-preview-area[_ngcontent-%COMP%]   app-segmentation-canvas[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .image-preview-area[_ngcontent-%COMP%]   app-classification-canvas[_ngcontent-%COMP%]{width:100%;height:100%;display:block}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .image-preview-area[_ngcontent-%COMP%]   .no-image-message[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;color:#666;font-size:16px;background-color:#fff;padding:24px;border-radius:8px;box-shadow:0 2px 8px #0000001a}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_rotate{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.annotation.prediction[_ngcontent-%COMP%]{border-style:dashed!important;border-width:2px!important;opacity:.7;filter:drop-shadow(0 0 4px rgba(33,150,243,.5))}.annotation.ground-truth[_ngcontent-%COMP%]{border-style:solid!important;border-width:2px!important;opacity:1}.pre-annotation-controls[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-top:16px;padding:12px;background-color:#e3f2fd;border-radius:4px;border:1px solid #2196f3}.pre-annotation-controls[_ngcontent-%COMP%]   .control-header[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#1976d2;margin-bottom:4px}.pre-annotation-controls[_ngcontent-%COMP%]   .control-info[_ngcontent-%COMP%]{font-size:12px;color:#666;margin-bottom:8px}.pre-annotation-controls[_ngcontent-%COMP%]   .control-buttons[_ngcontent-%COMP%]{display:flex;gap:8px}.pre-annotation-controls[_ngcontent-%COMP%]   .control-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;font-size:13px}.pre-annotation-controls[_ngcontent-%COMP%]   .confidence-badge[_ngcontent-%COMP%]{display:inline-block;padding:2px 8px;border-radius:12px;font-size:11px;font-weight:500;background-color:#2196f3;color:#fff;margin-left:8px}.annotation-list-item.prediction[_ngcontent-%COMP%]{background-color:#e3f2fd;border-left:3px solid #2196f3}.annotation-list-item.prediction[_ngcontent-%COMP%]   .annotation-label[_ngcontent-%COMP%]{font-style:italic}.annotation-list-item[_ngcontent-%COMP%]   .accept-reject-buttons[_ngcontent-%COMP%]{display:flex;gap:4px;margin-top:4px}.annotation-list-item[_ngcontent-%COMP%]   .accept-reject-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:12px;padding:4px 8px;min-width:auto}@media (max-width: 1400px){.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]{width:480px}}@media (max-width: 1200px){.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%]{width:240px}.main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]{width:400px}}@media (max-width: 768px){.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]{width:200px}.top-toolbar[_ngcontent-%COMP%]   .toolbar-title[_ngcontent-%COMP%]{font-size:14px}.top-toolbar[_ngcontent-%COMP%]   .toolbar-buttons[_ngcontent-%COMP%]   .toolbar-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .save-status-indicator[_ngcontent-%COMP%]{top:8px;right:8px;padding:6px 12px;font-size:12px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .save-status-indicator[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .image-preview-area[_ngcontent-%COMP%]{padding:8px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .image-preview-area[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]{padding:16px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .image-preview-area[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]   .placeholder-text[_ngcontent-%COMP%]{font-size:16px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .image-preview-area[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%]{font-size:13px}.right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]{padding:12px}.right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:14px}}@media (max-width: 480px){.image-labelling-container[_ngcontent-%COMP%]{height:100%}.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]{width:100%;max-width:180px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .save-status-indicator[_ngcontent-%COMP%]{top:4px;right:4px;padding:4px 8px;font-size:11px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .save-status-indicator[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .save-status-indicator[_ngcontent-%COMP%]   .status-message[_ngcontent-%COMP%]{display:none}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .loading-indicator[_ngcontent-%COMP%]{padding:16px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .loading-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .image-preview-area[_ngcontent-%COMP%]{padding:4px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .image-preview-area[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]{padding:12px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .image-preview-area[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]   .placeholder-text[_ngcontent-%COMP%]{font-size:14px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .image-preview-area[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%]{font-size:12px}.main-container[_ngcontent-%COMP%]   .center-content[_ngcontent-%COMP%]   .image-preview-area[_ngcontent-%COMP%]   .no-image-message[_ngcontent-%COMP%]{font-size:14px}.right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]{padding:8px}.right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:13px;margin:12px 0 6px}.right-sidebar[_ngcontent-%COMP%]   .sidebar-content[_ngcontent-%COMP%]   mat-expansion-panel[_ngcontent-%COMP%]{margin-bottom:6px}.pre-annotation-controls[_ngcontent-%COMP%]{padding:8px}.pre-annotation-controls[_ngcontent-%COMP%]   .control-header[_ngcontent-%COMP%]{font-size:13px}.pre-annotation-controls[_ngcontent-%COMP%]   .control-info[_ngcontent-%COMP%]{font-size:11px}.pre-annotation-controls[_ngcontent-%COMP%]   .control-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:12px;padding:4px 8px}}@media (max-width: 768px) and (orientation: landscape){.main-container[_ngcontent-%COMP%]   .left-sidebar[_ngcontent-%COMP%], .main-container[_ngcontent-%COMP%]   .right-sidebar[_ngcontent-%COMP%]{width:180px}.view-mode-switcher[_ngcontent-%COMP%]{padding:4px 8px}.view-mode-switcher[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{padding:4px 8px;font-size:12px}}"]})}}return o})();function wh(o,e){o&1&&(g(0,"div",6),tt(1,"mat-spinner",7),g(2,"p"),x(3,"Loading images..."),u()())}function Mh(o,e){if(o&1&&(g(0,"span",17),x(1),u()),o&2){let t=y().$implicit,i=y(2);Rs("split-"+t.split.toLowerCase()),v("title",t.split),_(),et(" ",i.getSplitLabel(t.split)," ")}}function Ph(o,e){o&1&&(g(0,"span",18),x(1," No Object "),u())}function Oh(o,e){if(o&1){let t=V();g(0,"div",11),T("click",function(){let n=k(t).$implicit,a=y(2);return S(a.onImageClick(n))}),g(1,"div",12)(2,"div",13),x(3),u(),g(4,"div",14),R(5,Mh,2,4,"span",15)(6,Ph,2,0,"span",16),u()()()}if(o&2){let t=e.$implicit,i=y(2);ot("selected",i.isCurrentImage(t)),_(2),v("title",t.fileName),_(),et(" ",t.fileName," "),_(2),v("ngIf",t.split),_(),v("ngIf",t.isNoClass)}}function kh(o,e){o&1&&(g(0,"div",19)(1,"mat-icon"),x(2,"image_not_supported"),u(),g(3,"p"),x(4,"No images uploaded yet"),u()())}function Sh(o,e){if(o&1&&(g(0,"div",8),R(1,Oh,7,6,"div",9)(2,kh,5,0,"div",10),u()),o&2){let t=y();_(),v("ngForOf",t.images),_(),v("ngIf",t.images.length===0)}}var il=(()=>{class o{constructor(){this.project=null,this.images=[],this.currentImage=null,this.isLoadingImages=!1,this.imageSelected=new q,this.batchExport=new q,this.batchDelete=new q,this.selectedImages=new Set}get workflowSteps(){return["Upload","Label","Train","Predict"]}get currentStatusIndex(){return this.workflowSteps.indexOf(this.project?.status||"Upload")}get nextStatus(){let t=this.currentStatusIndex;return t>=0&&t<this.workflowSteps.length-1?this.workflowSteps[t+1]:null}get hasSelectedImages(){return this.selectedImages.size>0}get selectedImageCount(){return this.selectedImages.size}isImageSelected(t){return this.selectedImages.has(t)}toggleImageSelection(t,i){i.source._elementRef.nativeElement.blur(),this.selectedImages.has(t.id)?this.selectedImages.delete(t.id):this.selectedImages.add(t.id)}getSplitLabel(t){if(!t)return"";let i=t.toLowerCase();return i==="train"||i==="training"?"TRA":t}isCurrentImage(t){return this.currentImage?.id===t.id}onImageClick(t){this.imageSelected.emit(t)}getSelectedImages(){return this.images.filter(t=>this.selectedImages.has(t.id))}onBatchExport(){let t=this.getSelectedImages();t.length>0&&this.batchExport.emit(t)}onBatchDelete(){let t=this.getSelectedImages();t.length>0&&this.batchDelete.emit(t)}onCopyImageNames(){let t=this.getSelectedImages();if(t.length>0){let i=t.map(n=>n.fileName).join(`
`);navigator.clipboard.writeText(i).then(()=>{},n=>{console.error("Failed to copy image names:",n)})}}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=$({type:o,selectors:[["app-left-toolbar"]],inputs:{project:"project",images:"images",currentImage:"currentImage",isLoadingImages:"isLoadingImages"},outputs:{imageSelected:"imageSelected",batchExport:"batchExport",batchDelete:"batchDelete"},standalone:!1,decls:7,vars:3,consts:[[1,"left-toolbar"],[1,"image-list-section"],[1,"section-header"],[1,"section-title"],["class","loading-container",4,"ngIf"],["class","image-list",4,"ngIf"],[1,"loading-container"],["diameter","40"],[1,"image-list"],["class","image-item",3,"selected","click",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[1,"image-item",3,"click"],[1,"image-info"],[1,"image-name",3,"title"],[1,"image-meta"],["class","split-badge",3,"class","title",4,"ngIf"],["class","no-class-badge",4,"ngIf"],[1,"split-badge",3,"title"],[1,"no-class-badge"],[1,"empty-state"]],template:function(i,n){i&1&&(g(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),x(4),u()(),R(5,wh,4,0,"div",4)(6,Sh,3,2,"div",5),u()()),i&2&&(_(4),et("Images (",n.images.length,")"),_(),v("ngIf",n.isLoadingImages),_(),v("ngIf",!n.isLoadingImages))},dependencies:[kt,St,Dt,ue],styles:[".left-toolbar[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background-color:#fff3e0;border-right:1px solid #e0e0e0;overflow:hidden}.status-section[_ngcontent-%COMP%]{padding:16px;border-bottom:1px solid #e0e0e0;background-color:#fff3e0}.section-title[_ngcontent-%COMP%]{margin:0 0 12px;font-size:14px;font-weight:600;color:#616161;text-transform:uppercase;letter-spacing:.5px}.workflow-status[_ngcontent-%COMP%]   .status-info[_ngcontent-%COMP%]{padding:8px;background-color:#f5f5f5;border-radius:4px;font-size:12px}.workflow-status[_ngcontent-%COMP%]   .status-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0;color:#616161}.workflow-status[_ngcontent-%COMP%]   .status-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#212121}.workflow-status[_ngcontent-%COMP%]   .status-info[_ngcontent-%COMP%]   .current-status[_ngcontent-%COMP%]{margin-bottom:4px}.workflow-status[_ngcontent-%COMP%]   .status-info[_ngcontent-%COMP%]   .next-status[_ngcontent-%COMP%]{margin-top:4px}.image-list-section[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background-color:#fff3e0;border-bottom:1px solid #e0e0e0}.section-header[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{margin:0}.section-header[_ngcontent-%COMP%]   .batch-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.section-header[_ngcontent-%COMP%]   .batch-actions[_ngcontent-%COMP%]   .selected-count[_ngcontent-%COMP%]{font-size:12px;color:#757575;margin-left:4px}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px;gap:16px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#757575;font-size:13px}.image-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:8px}.image-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px;margin-bottom:1px;border-radius:4px;cursor:pointer;transition:background-color .2s ease}.image-item[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.image-item.selected[_ngcontent-%COMP%]{background-color:#e3f2fd;border-left:3px solid #2196f3}.image-item.checked[_ngcontent-%COMP%]{background-color:#fff3e0}.image-item[_ngcontent-%COMP%]   .image-info[_ngcontent-%COMP%]{flex:1;min-width:0;display:flex;align-items:center;gap:6px}.image-item[_ngcontent-%COMP%]   .image-name[_ngcontent-%COMP%]{font-size:13px;color:#212121;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0}.image-item[_ngcontent-%COMP%]   .image-meta[_ngcontent-%COMP%]{display:flex;gap:4px;flex-shrink:0}.image-item[_ngcontent-%COMP%]   .split-badge[_ngcontent-%COMP%], .image-item[_ngcontent-%COMP%]   .no-class-badge[_ngcontent-%COMP%]{font-size:11px;padding:2px 6px;border-radius:2px;font-weight:500;text-transform:uppercase}.image-item[_ngcontent-%COMP%]   .split-badge[_ngcontent-%COMP%]{background-color:#e0e0e0;color:#616161}.image-item[_ngcontent-%COMP%]   .split-badge.split-train[_ngcontent-%COMP%]{background-color:#c8e6c9;color:#2e7d32}.image-item[_ngcontent-%COMP%]   .split-badge.split-dev[_ngcontent-%COMP%]{background-color:#fff9c4;color:#f57f17}.image-item[_ngcontent-%COMP%]   .split-badge.split-test[_ngcontent-%COMP%]{background-color:#ffccbc;color:#d84315}.image-item[_ngcontent-%COMP%]   .split-badge.split-unassigned[_ngcontent-%COMP%]{background-color:#e0e0e0;color:#616161}.image-item[_ngcontent-%COMP%]   .no-class-badge[_ngcontent-%COMP%]{background-color:#ffebee;color:#d32f2f}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 16px;color:#9e9e9e}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}@media (max-width: 1200px){.left-toolbar[_ngcontent-%COMP%]{width:240px}.section-title[_ngcontent-%COMP%]{font-size:13px}.image-item[_ngcontent-%COMP%]{padding:6px}.image-item[_ngcontent-%COMP%]   .image-name[_ngcontent-%COMP%]{font-size:12px}}@media (max-width: 768px){.left-toolbar[_ngcontent-%COMP%]{width:200px}.status-section[_ngcontent-%COMP%]{padding:12px}.section-header[_ngcontent-%COMP%]{padding:8px 12px;flex-wrap:wrap}.section-header[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{flex:1 1 100%;margin-bottom:8px}.section-header[_ngcontent-%COMP%]   .batch-actions[_ngcontent-%COMP%]{flex:1 1 100%;justify-content:flex-start}.workflow-status[_ngcontent-%COMP%]   .status-info[_ngcontent-%COMP%]{font-size:11px}.image-item[_ngcontent-%COMP%]{padding:6px}.image-item[_ngcontent-%COMP%]   .image-name[_ngcontent-%COMP%]{font-size:12px}.image-item[_ngcontent-%COMP%]   .split-badge[_ngcontent-%COMP%], .image-item[_ngcontent-%COMP%]   .no-class-badge[_ngcontent-%COMP%]{font-size:9px;padding:1px 4px}}@media (max-width: 480px){.left-toolbar[_ngcontent-%COMP%]{width:100%;max-width:180px}.status-section[_ngcontent-%COMP%]{padding:8px}.section-header[_ngcontent-%COMP%]{padding:6px 8px}.section-title[_ngcontent-%COMP%]{font-size:12px}.workflow-status[_ngcontent-%COMP%]   .status-info[_ngcontent-%COMP%]{font-size:10px}.image-list[_ngcontent-%COMP%]{padding:4px}.image-item[_ngcontent-%COMP%]{padding:4px;margin-bottom:2px}.image-item[_ngcontent-%COMP%]   .image-name[_ngcontent-%COMP%]{font-size:11px}.image-item[_ngcontent-%COMP%]   .image-meta[_ngcontent-%COMP%]{gap:2px}.batch-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:4px;min-width:32px;width:32px;height:32px}.batch-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.batch-actions[_ngcontent-%COMP%]   .selected-count[_ngcontent-%COMP%]{font-size:11px}}"]})}}return o})();function Th(o,e){if(o&1&&(g(0,"div",5)(1,"span",6),x(2,"Project Name"),u(),g(3,"span",9),x(4),u()()),o&2){let t=y(2);_(4),G(t.project.name)}}function Ih(o,e){if(o&1&&(g(0,"div",5)(1,"span",6),x(2,"Project Type"),u(),g(3,"span",9),x(4),u()()),o&2){let t=y(2);_(4),G(t.project.type)}}function Ah(o,e){if(o&1&&(g(0,"div",5)(1,"span",6),x(2,"Project Status"),u(),g(3,"span",9),x(4),u()()),o&2){let t=y(2);_(4),G(t.project.status)}}function Eh(o,e){if(o&1&&(g(0,"mat-option",18),x(1),u()),o&2){let t=e.$implicit;v("value",t),_(),et(" ",t," ")}}function Lh(o,e){if(o&1){let t=V();g(0,"div",3)(1,"div",4)(2,"div",5)(3,"span",6),x(4,"File Name"),u(),g(5,"span",7),x(6),u()(),R(7,Th,5,1,"div",8)(8,Ih,5,1,"div",8)(9,Ah,5,1,"div",8),g(10,"div",5)(11,"span",6),x(12,"Image ID"),u(),g(13,"span",9),x(14),u()(),g(15,"div",5)(16,"span",6),x(17,"Dimensions"),u(),g(18,"span",9),x(19),u()(),g(20,"div",5)(21,"span",6),x(22,"Uploaded"),u(),g(23,"span",9),x(24),Bs(25,"date"),u()()(),g(26,"div",10)(27,"button",11),T("click",function(){k(t);let n=y();return S(n.copyFileName())}),g(28,"mat-icon"),x(29,"content_copy"),u(),x(30," Copy "),u(),g(31,"button",12),T("click",function(){k(t);let n=y();return S(n.onDownload())}),g(32,"mat-icon"),x(33,"download"),u(),x(34," Download "),u(),g(35,"button",13),T("click",function(){k(t);let n=y();return S(n.onDelete())}),g(36,"mat-icon"),x(37,"delete"),u(),x(38," Delete "),u()(),g(39,"mat-form-field",14)(40,"mat-label"),x(41,"Split"),u(),g(42,"mat-select",15),T("selectionChange",function(n){k(t);let a=y();return S(a.onSplitChange(n.value))}),Ct("valueChange",function(n){k(t);let a=y();return bt(a.selectedSplit,n)||(a.selectedSplit=n),S(n)}),R(43,Eh,2,2,"mat-option",16),u(),g(44,"mat-icon",17),x(45,"info"),u()()()}if(o&2){let t=y();_(5),v("title",t.currentImage.fileName),_(),G(t.currentImage.fileName),_(),v("ngIf",t.project),_(),v("ngIf",t.project),_(),v("ngIf",t.project),_(5),G(t.currentImage.id),_(5),Tn("",t.currentImage.width," x ",t.currentImage.height,""),_(5),G(Vs(25,16,t.currentImage.createdAt,"medium")),_(3),v("disabled",!t.currentImage),_(4),v("disabled",!t.currentImage),_(4),v("disabled",!t.currentImage),_(7),_t("value",t.selectedSplit),v("disabled",!t.currentImage||t.isUpdating),_(),v("ngForOf",t.splitOptions),_(),v("matTooltip",t.splitTooltip)}}function Dh(o,e){o&1&&(g(0,"div",19)(1,"p"),x(2,"No image selected"),u()())}var nl=(()=>{class o{constructor(t){this.imageService=t,this.currentImage=null,this.project=null,this.imageUpdated=new q,this.imageDeleted=new q,this.imageExported=new q,this.selectedSplit="Unassigned",this.isNoClass=!1,this.isUpdating=!1,this.splitOptions=["Unassigned","Train","Dev","Test"],this.splitTooltip="Split assignment determines how the image is used in model training. Train: Used for training the model. Dev: Used for validation during training. Test: Used for final model evaluation. Unassigned: Not yet assigned to a split."}ngOnChanges(t){if(t.currentImage&&this.currentImage){let i=this.currentImage.split;if(i){let n=i.charAt(0).toUpperCase()+i.slice(1).toLowerCase();n==="Training"?this.selectedSplit="Train":["Train","Dev","Test","Unassigned"].includes(n)?this.selectedSplit=n:this.selectedSplit="Unassigned"}else this.selectedSplit="Unassigned";this.isNoClass=this.currentImage.isNoClass||!1}}getLabelerNames(){return!this.currentImage?.labelers||this.currentImage.labelers.length===0?"-":this.currentImage.labelers.map(t=>t.name).join(", ")}getTimeSinceLastLabel(){if(!this.currentImage?.lastLabeledAt)return"-";let t=new Date(this.currentImage.lastLabeledAt),n=new Date().getTime()-t.getTime(),a=Math.floor(n/1e3),s=Math.floor(a/60),r=Math.floor(s/60),l=Math.floor(r/24),c=Math.floor(l/30),d=Math.floor(l/365);return d>0?d===1?"1 year ago":`${d} years ago`:c>0?c===1?"1 month ago":`${c} months ago`:l>0?l===1?"1 day ago":`${l} days ago`:r>0?r===1?"1 hour ago":`${r} hours ago`:s>0?s===1?"1 minute ago":`${s} minutes ago`:"Just now"}onSplitChange(t){!this.currentImage||this.isUpdating||(this.isUpdating=!0,this.imageService.updateSplit(this.currentImage.id,t).subscribe({next:i=>{this.selectedSplit=t,this.imageUpdated.emit(i),this.isUpdating=!1},error:i=>{console.error("Error updating split:",i),this.selectedSplit=this.currentImage.split||"Unassigned",this.isUpdating=!1}}))}onNoClassChange(t){!this.currentImage||this.isUpdating||(this.isUpdating=!0,this.imageService.updateIsNoClass(this.currentImage.id,t).subscribe({next:i=>{this.isNoClass=t,this.imageUpdated.emit(i),this.isUpdating=!1},error:i=>{console.error("Error updating isNoClass:",i),this.isNoClass=this.currentImage.isNoClass||!1,this.isUpdating=!1}}))}onDownload(){this.currentImage&&this.imageService.getImageFileByImageId(this.currentImage.id).subscribe({next:t=>{let i=window.URL.createObjectURL(t),n=document.createElement("a");n.href=i,n.download=this.currentImage.fileName,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(i)},error:t=>{console.error("Error downloading image:",t),alert("Failed to download image. Please try again.")}})}onDelete(){this.currentImage&&confirm(`Are you sure you want to delete "${this.currentImage.fileName}"? This action cannot be undone.`)&&this.imageService.deleteImage(this.currentImage.id).subscribe({next:()=>{this.imageDeleted.emit(this.currentImage.id)},error:t=>{console.error("Error deleting image:",t),alert("Failed to delete image. Please try again.")}})}copyFileName(){this.currentImage?.fileName&&navigator.clipboard.writeText(this.currentImage.fileName).then(()=>{},t=>{console.error("Failed to copy file name:",t),alert("Failed to copy file name to clipboard.")})}static{this.\u0275fac=function(i){return new(i||o)(W(Dn))}}static{this.\u0275cmp=$({type:o,selectors:[["app-general-block"]],inputs:{currentImage:"currentImage",project:"project"},outputs:{imageUpdated:"imageUpdated",imageDeleted:"imageDeleted",imageExported:"imageExported"},standalone:!1,features:[qt],decls:3,vars:2,consts:[[1,"general-block"],["class","general-content",4,"ngIf"],["class","no-image-message",4,"ngIf"],[1,"general-content"],[1,"combined-info-section"],[1,"info-row"],[1,"info-label"],[1,"info-value",3,"title"],["class","info-row",4,"ngIf"],[1,"info-value"],[1,"action-buttons"],["mat-raised-button","",1,"copy-button",3,"click","disabled"],["color","primary","mat-raised-button","",3,"click","disabled"],["color","warn","mat-raised-button","",3,"click","disabled"],["appearance","fill",1,"split-field"],[3,"selectionChange","valueChange","value","disabled"],[3,"value",4,"ngFor","ngForOf"],["matSuffix","",3,"matTooltip"],[3,"value"],[1,"no-image-message"]],template:function(i,n){i&1&&(g(0,"div",0),R(1,Lh,46,19,"div",1)(2,Dh,3,0,"div",2),u()),i&2&&(_(),v("ngIf",n.currentImage),_(),v("ngIf",!n.currentImage))},dependencies:[kt,St,te,Dt,ie,fe,Ln,He,_e,ee,Hs],styles:[".general-block[_ngcontent-%COMP%]{padding:16px}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .file-name-header[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#212121;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-bottom:8px;border-bottom:1px solid #f0f0f0}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .combined-info-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;background-color:#e3f2fd;padding:8px;border-radius:4px;border-left:4px solid #2196f3}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .combined-info-section[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:2px 0}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .combined-info-section[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%]{font-size:12px;color:#0009;flex-shrink:0}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .combined-info-section[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-value[_ngcontent-%COMP%]{font-size:12px;color:#212121;font-weight:500;text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:60%}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;gap:8px}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;min-width:0}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:4px}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button.copy-button[_ngcontent-%COMP%]{background-color:#ff9800;color:#fff}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button.copy-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f57c00}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button.copy-button[_ngcontent-%COMP%]:disabled{background-color:#ffcc80;color:#ffffff80}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[color=warn][_ngcontent-%COMP%]{background-color:#4caf50!important;color:#fff!important}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[color=warn][_ngcontent-%COMP%]:hover:not(:disabled){background-color:#2e7d32!important}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[color=warn][_ngcontent-%COMP%]:disabled{background-color:#a5d6a7!important;color:#ffffff80!important}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .split-field[_ngcontent-%COMP%]{width:100%}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .split-field[_ngcontent-%COMP%]   mat-icon[matSuffix][_ngcontent-%COMP%]{cursor:help;color:#0009}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .no-class-checkbox[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{width:100%}.general-block[_ngcontent-%COMP%]   .no-image-message[_ngcontent-%COMP%]{text-align:center;color:#0009;padding:16px}@media (max-width: 768px){.general-block[_ngcontent-%COMP%]{padding:12px}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]{gap:12px}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .file-name-header[_ngcontent-%COMP%]{font-size:13px}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .combined-info-section[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%], .general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .combined-info-section[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .info-value[_ngcontent-%COMP%]{font-size:11px}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{gap:6px}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:13px}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}}@media (max-width: 480px){.general-block[_ngcontent-%COMP%]{padding:8px}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]{gap:8px}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{flex-direction:column;gap:4px}.general-block[_ngcontent-%COMP%]   .general-content[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}"]})}}return o})();var ol=(()=>{class o{constructor(t,i){this.http=t,this.configuration=i,this.baseUrl=this.configuration.ServerWithApiUrl+"landingai/images",this.projectTagUrl=this.configuration.ServerWithApiUrl+"landingai/project-tags"}getTagsByProjectId(t){return this.http.get(`${this.projectTagUrl}/project/${t}`).pipe(Bt(this.handleError))}getTagsByImageId(t){return this.http.get(`${this.baseUrl}/${t}/tags`).pipe(Bt(this.handleError))}addImageTag(t,i){return this.http.post(`${this.baseUrl}/${t}/tags`,{tagId:i}).pipe(Bt(this.handleError))}removeImageTag(t,i){return this.http.delete(`${this.baseUrl}/${t}/tags/${i}`).pipe(Bt(this.handleError))}updateImageTags(t,i){return this.http.put(`${this.baseUrl}/${t}/tags`,{tagIds:i}).pipe(Bt(this.handleError))}addTag(t){return this.addImageTag(t.imageId,t.tagId||t.projectTagId)}deleteTag(t,i){return this.removeImageTag(t,i)}handleError(t){let i="An error occurred";return t.error instanceof ErrorEvent?i=`Error: ${t.error.message}`:(i=`Error Code: ${t.status}
Message: ${t.message}`,t.error&&t.error.message&&(i=t.error.message)),console.error("TagService Error:",i),hi(()=>new Error(i))}static{this.\u0275fac=function(i){return new(i||o)(Pe(Ci),Pe(xi))}}static{this.\u0275prov=gi({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function Rh(o,e){if(o&1&&(g(0,"mat-option",14),x(1),u()),o&2){let t=e.$implicit;v("value",t.name),_(),et(" ",t.name," ")}}function Nh(o,e){if(o&1&&(g(0,"mat-option",15)(1,"em"),x(2),u()()),o&2){let t=y(2);v("value",t.tagInputValue),_(2),et('Press Enter to create "',t.tagInputValue,'"')}}function Bh(o,e){o&1&&(g(0,"div",16),tt(1,"mat-spinner",17),g(2,"span"),x(3,"Loading tags..."),u()())}function Vh(o,e){if(o&1){let t=V();g(0,"mat-chip-option",21),x(1),g(2,"button",22),T("click",function(){let n=k(t).$implicit,a=y(3);return S(a.onDeleteTag(n))}),g(3,"mat-icon"),x(4,"cancel"),u()()()}if(o&2){let t=e.$implicit;v("removable",!0),_(),et(" ",t.projectTag.name," ")}}function zh(o,e){if(o&1&&(g(0,"div",18)(1,"mat-chip-listbox",19),R(2,Vh,5,2,"mat-chip-option",20),u()()),o&2){let t=y(2);_(2),v("ngForOf",t.tags)}}function Gh(o,e){o&1&&(g(0,"div",23)(1,"p"),x(2,"No tags yet. Type a tag name and press Enter to add one."),u()())}function Uh(o,e){if(o&1){let t=V();g(0,"div",4)(1,"mat-form-field",5)(2,"mat-label"),x(3,"Add Tag"),u(),g(4,"input",6),Ct("ngModelChange",function(n){k(t);let a=y();return bt(a.tagInputValue,n)||(a.tagInputValue=n),S(n)}),T("keydown.enter",function(){k(t);let n=y();return S(n.onAddTag())})("input",function(){k(t);let n=y();return S(n.onInputChange())}),u(),g(5,"mat-autocomplete",7,0),T("optionSelected",function(n){k(t);let a=y();return S(a.onTagSelected(n))}),R(7,Rh,2,2,"mat-option",8)(8,Nh,3,2,"mat-option",9),u(),g(9,"mat-icon",10),x(10,"label"),u()(),R(11,Bh,4,0,"div",11)(12,zh,3,1,"div",12)(13,Gh,3,0,"div",13),u()}if(o&2){let t=Ji(6),i=y();_(4),_t("ngModel",i.tagInputValue),v("matAutocomplete",t)("disabled",!i.currentImage||i.isLoadingProjectTags||i.isAddingTag),_(3),v("ngForOf",i.filteredTags),_(),v("ngIf",i.filteredTags.length===0&&i.tagInputValue.trim()),_(3),v("ngIf",i.isLoadingTags||i.isLoadingProjectTags),_(),v("ngIf",!i.isLoadingTags&&i.tags.length>0),_(),v("ngIf",!i.isLoadingTags&&i.tags.length===0)}}function jh(o,e){o&1&&(g(0,"div",24)(1,"p"),x(2,"No image selected"),u()())}var al=(()=>{class o{constructor(t,i,n){this.tagService=t,this.projectTagService=i,this.dialog=n,this.currentImage=null,this.project=null,this.tags=[],this.projectTags=[],this.filteredTags=[],this.isLoadingTags=!1,this.isLoadingProjectTags=!1,this.isAddingTag=!1,this.tagInputValue="",this.destroy$=new Nt}ngOnChanges(t){t.project&&this.project&&this.loadProjectTags(),t.currentImage&&(this.currentImage?this.loadTags():this.tags=[],this.tagInputValue="",this.updateFilteredTags())}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onInputChange(){this.updateFilteredTags()}updateFilteredTags(){let t=this.getAvailableProjectTags();if(!this.tagInputValue||this.tagInputValue.trim()==="")this.filteredTags=[...t];else{let i=this.tagInputValue.toLowerCase();this.filteredTags=t.filter(n=>n.name.toLowerCase().includes(i))}}getAvailableProjectTags(){let t=new Set(this.tags.map(i=>i.projectTag.id));return this.projectTags.filter(i=>!t.has(i.id))}onTagSelected(t){this.tagInputValue=t.option.value,this.onAddTag()}onAddTag(){if(!this.currentImage||!this.tagInputValue.trim()||this.isAddingTag)return;let t=this.tagInputValue.trim(),i=this.projectTags.find(n=>n.name.toLowerCase()===t.toLowerCase());if(i){if(this.tags.some(a=>a.projectTag.id===i.id)){alert(`Tag "${t}" is already added to this image.`),this.tagInputValue="";return}i.id?this.addImageTag(i.id):console.error("Existing tag has no ID")}else this.createProjectTagAndAddToImage(t)}createProjectTagAndAddToImage(t){if(!this.project||!this.currentImage){console.error("Missing project or currentImage");return}let i=this.projectTags.find(a=>a.name.toLowerCase()===t.toLowerCase());if(i){alert(`Tag "${i.name}" already exists in this project. Please select it from the list.`),this.tagInputValue="";return}this.isAddingTag=!0;let n={name:t};this.projectTagService.createTag(this.project.id,n).pipe(z(this.destroy$)).subscribe({next:a=>{let s={id:a.id,name:a.name,createdAt:a.createdAt,createdBy:a.createdBy};this.projectTags.push(s),this.updateFilteredTags(),a.id?this.addImageTag(a.id):(console.error("Created tag has no ID"),this.isAddingTag=!1)},error:a=>{console.error("Error creating project tag:",a),a.status===400&&a.error?.message?.includes("already exists")?alert(`Tag "${t}" already exists in this project.`):alert("Failed to create tag. Please try again."),this.isAddingTag=!1}})}addImageTag(t){if(!this.currentImage){console.error("No current image");return}this.isAddingTag=!0,this.tagService.addImageTag(this.currentImage.id,t).pipe(z(this.destroy$)).subscribe({next:i=>{this.tags.push(i),this.tagInputValue="",this.isAddingTag=!1,this.updateFilteredTags(),this.autocompleteTrigger&&this.autocompleteTrigger.panelOpen&&this.autocompleteTrigger.closePanel()},error:i=>{console.error("Error adding tag to image:",i),i.status===400&&i.error?.message?.includes("already exists")?alert("This tag is already added to the image."):alert("Failed to add tag to image. Please try again."),this.isAddingTag=!1}})}onDeleteTag(t){!this.currentImage||!t.id||confirm(`Are you sure you want to delete the tag "${t.projectTag.name}"?`)&&this.tagService.removeImageTag(this.currentImage.id,t.id).pipe(z(this.destroy$)).subscribe({next:()=>{this.tags=this.tags.filter(i=>i.id!==t.id),this.updateFilteredTags()},error:i=>{console.error("Error deleting tag:",i),alert("Failed to delete tag. Please try again.")}})}loadProjectTags(){this.project&&(this.isLoadingProjectTags=!0,this.tagService.getTagsByProjectId(this.project.id).pipe(z(this.destroy$)).subscribe({next:t=>{this.projectTags=t,this.isLoadingProjectTags=!1,this.updateFilteredTags()},error:t=>{console.error("Error loading project tags:",t),this.projectTags=[],this.isLoadingProjectTags=!1,this.updateFilteredTags()}}))}loadTags(){this.currentImage&&(this.isLoadingTags=!0,this.tagService.getTagsByImageId(this.currentImage.id).pipe(z(this.destroy$)).subscribe({next:t=>{this.tags=t,this.isLoadingTags=!1,this.updateFilteredTags()},error:t=>{console.error("Error loading tags:",t),this.tags=[],this.isLoadingTags=!1,this.updateFilteredTags()}}))}static{this.\u0275fac=function(i){return new(i||o)(W(ol),W(Xr),W(Ge))}}static{this.\u0275cmp=$({type:o,selectors:[["app-tags-block"]],viewQuery:function(i,n){if(i&1&&Wt(Fn,5),i&2){let a;Et(a=Lt())&&(n.autocompleteTrigger=a.first)}},inputs:{currentImage:"currentImage",project:"project"},standalone:!1,features:[qt],decls:3,vars:2,consts:[["auto","matAutocomplete"],[1,"tags-block"],["class","tags-content",4,"ngIf"],["class","no-image-message",4,"ngIf"],[1,"tags-content"],["appearance","fill",1,"tag-input-field"],["type","text","matInput","","placeholder","Type tag name and press Enter",3,"ngModelChange","keydown.enter","input","ngModel","matAutocomplete","disabled"],[3,"optionSelected"],[3,"value",4,"ngFor","ngForOf"],["disabled","",3,"value",4,"ngIf"],["matSuffix",""],["class","loading-indicator",4,"ngIf"],["class","tags-list",4,"ngIf"],["class","no-tags-message",4,"ngIf"],[3,"value"],["disabled","",3,"value"],[1,"loading-indicator"],["diameter","30"],[1,"tags-list"],["aria-label","Image tags"],["class","tag-chip",3,"removable",4,"ngFor","ngForOf"],[1,"tag-chip",3,"removable"],["matChipRemove","",3,"click"],[1,"no-tags-message"],[1,"no-image-message"]],template:function(i,n){i&1&&(g(0,"div",1),R(1,Uh,14,8,"div",2)(2,jh,3,0,"div",3),u()),i&2&&(_(),v("ngIf",n.currentImage),_(),v("ngIf",!n.currentImage))},dependencies:[kt,St,Ue,Yt,Xt,Dt,ie,fe,Ln,_e,je,Vr,Br,Nr,ue,Fr,Fn],styles:[".tags-block[_ngcontent-%COMP%]{padding:16px}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tag-input-field[_ngcontent-%COMP%]{width:100%}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tag-input-field[_ngcontent-%COMP%]   mat-icon[matSuffix][_ngcontent-%COMP%]{color:#0009}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tag-input-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;animation:_ngcontent-%COMP%_fadeIn .3s ease-in}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tag-input-container[_ngcontent-%COMP%]   .tag-input-field[_ngcontent-%COMP%]{width:100%}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tag-input-container[_ngcontent-%COMP%]   .tag-input-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tag-input-container[_ngcontent-%COMP%]   .tag-input-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;transition:background-color .2s ease,transform .15s ease;cursor:pointer;position:relative;overflow:hidden}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tag-input-container[_ngcontent-%COMP%]   .tag-input-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f5f5f5}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tag-input-container[_ngcontent-%COMP%]   .tag-input-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tag-input-container[_ngcontent-%COMP%]   .tag-input-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active:not(:disabled){transform:scale(.98);transition:transform .15s ease}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tag-input-container[_ngcontent-%COMP%]   .tag-input-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:4px}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .loading-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:8px;color:#0009}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .loading-indicator[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{flex-shrink:0}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tags-list[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-in}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tags-list[_ngcontent-%COMP%]   mat-chip-listbox[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tags-list[_ngcontent-%COMP%]   .tag-chip[_ngcontent-%COMP%]{transition:all .2s ease ease}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tags-list[_ngcontent-%COMP%]   .tag-chip[_ngcontent-%COMP%]:hover{box-shadow:0 2px 4px #0000001a;transform:translateY(-1px)}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tags-list[_ngcontent-%COMP%]   .tag-chip[_ngcontent-%COMP%]   button[matChipRemove][_ngcontent-%COMP%]{opacity:.6;transition:opacity .2s ease}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tags-list[_ngcontent-%COMP%]   .tag-chip[_ngcontent-%COMP%]   button[matChipRemove][_ngcontent-%COMP%]:hover{opacity:1;color:#f44336}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .tags-list[_ngcontent-%COMP%]   .tag-chip[_ngcontent-%COMP%]   button[matChipRemove][_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.tags-block[_ngcontent-%COMP%]   .tags-content[_ngcontent-%COMP%]   .no-tags-message[_ngcontent-%COMP%]{text-align:center;color:#0009;padding:16px;font-size:14px}.tags-block[_ngcontent-%COMP%]   .no-image-message[_ngcontent-%COMP%]{text-align:center;color:#0009;padding:16px}"]})}}return o})();var sl=(()=>{class o{constructor(t,i){this.http=t,this.configuration=i,this.baseUrl=this.configuration.ServerWithApiUrl+"landingai/images",this.projectMetadataUrl=this.configuration.ServerWithApiUrl+"landingai/project-metadata"}getMetadataByProjectId(t){return this.http.get(`${this.projectMetadataUrl}/project/${t}`).pipe(Bt(this.handleError))}getMetadataByImageId(t){return this.http.get(`${this.baseUrl}/${t}/metadata`).pipe(Bt(this.handleError))}addImageMetadata(t,i,n){return this.http.post(`${this.baseUrl}/${t}/metadata`,{metadataId:i,value:n}).pipe(Bt(this.handleError))}updateImageMetadata(t,i,n){return this.http.put(`${this.baseUrl}/${t}/metadata/${i}`,{value:n}).pipe(Bt(this.handleError))}deleteImageMetadata(t,i){return this.http.delete(`${this.baseUrl}/${t}/metadata/${i}`).pipe(Bt(this.handleError))}updateImageMetadataBatch(t,i){return this.http.put(`${this.baseUrl}/${t}/metadata`,{metadataList:i}).pipe(Bt(this.handleError))}saveMetadataValue(t){return t.id?this.updateImageMetadata(t.imageId,t.id,t.value):this.addImageMetadata(t.imageId,t.metadataId,t.value)}handleError(t){let i="An error occurred";return t.error instanceof ErrorEvent?i=`Error: ${t.error.message}`:(i=`Error Code: ${t.status}
Message: ${t.message}`,t.error&&t.error.message&&(i=t.error.message)),console.error("MetadataService Error:",i),hi(()=>new Error(i))}static{this.\u0275fac=function(i){return new(i||o)(Pe(Ci),Pe(xi))}}static{this.\u0275prov=gi({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var wa=[{id:-1,name:"Location",type:"text",valueFrom:"INPUT"},{id:-2,name:"Inspector",type:"text",valueFrom:"INPUT"},{id:-3,name:"Severity",type:"dropdown",valueFrom:"PREDEFINED",predefinedValues:"Low,Medium,High,Critical",multipleValues:!1},{id:-4,name:"Date",type:"text",valueFrom:"INPUT"}];function qh(o,e){if(o&1&&(g(0,"mat-option",11),x(1),u()),o&2){let t=e.$implicit;v("value",t),_(),et(" ",t.name," ")}}function Wh(o,e){o&1&&(g(0,"div",13)(1,"span",14),x(2,"Multiple Values:"),u(),g(3,"span",15),x(4,"Yes"),u()())}function Yh(o,e){if(o&1&&(g(0,"div",12)(1,"div",13)(2,"span",14),x(3,"Type:"),u(),g(4,"span",15),x(5),u()(),g(6,"div",13)(7,"span",14),x(8,"Value From:"),u(),g(9,"span",15),x(10),u()(),R(11,Wh,5,0,"div",16),u()),o&2){let t=y();_(5),G(t.selectedMetadata.type||"TEXT"),_(5),G(t.usesPredefinedValues()?"Predefined (Dropdown)":"Input"),_(),v("ngIf",t.selectedMetadata.multipleValues)}}function Xh(o,e){if(o&1){let t=V();g(0,"mat-form-field",2)(1,"mat-label"),x(2,"Value"),u(),g(3,"mat-select",19),Ct("ngModelChange",function(n){k(t);let a=y(2);return bt(a.metadataValue,n)||(a.metadataValue=n),S(n)}),g(4,"mat-option",20),x(5,"True"),u(),g(6,"mat-option",21),x(7,"False"),u()()()}if(o&2){let t=y(2);_(3),_t("ngModel",t.metadataValue)}}function $h(o,e){if(o&1&&(g(0,"mat-option",11),x(1),u()),o&2){let t=e.$implicit;v("value",t),_(),et(" ",t," ")}}function Kh(o,e){if(o&1){let t=V();g(0,"mat-form-field",2)(1,"mat-label"),x(2,"Select Values (Multiple)"),u(),g(3,"mat-select",22),Ct("ngModelChange",function(n){k(t);let a=y(2);return bt(a.selectedValues,n)||(a.selectedValues=n),S(n)}),R(4,$h,2,2,"mat-option",4),u(),g(5,"mat-hint"),x(6,"You can select multiple values"),u()()}if(o&2){let t=y(2);_(3),_t("ngModel",t.selectedValues),_(),v("ngForOf",t.getPredefinedValues())}}function Qh(o,e){if(o&1&&(g(0,"mat-option",11),x(1),u()),o&2){let t=e.$implicit;v("value",t),_(),et(" ",t," ")}}function Zh(o,e){if(o&1){let t=V();g(0,"mat-form-field",2)(1,"mat-label"),x(2,"Select Value"),u(),g(3,"mat-select",19),Ct("ngModelChange",function(n){k(t);let a=y(2);return bt(a.metadataValue,n)||(a.metadataValue=n),S(n)}),R(4,Qh,2,2,"mat-option",4),u()()}if(o&2){let t=y(2);_(3),_t("ngModel",t.metadataValue),_(),v("ngForOf",t.getPredefinedValues())}}function Jh(o,e){if(o&1){let t=V();g(0,"mat-form-field",2)(1,"mat-label"),x(2,"Value"),u(),g(3,"input",23),Ct("ngModelChange",function(n){k(t);let a=y(2);return bt(a.metadataValue,n)||(a.metadataValue=n),S(n)}),u()()}if(o&2){let t=y(2);_(3),_t("ngModel",t.metadataValue),v("type",t.getInputType())}}function tm(o,e){if(o&1&&(g(0,"div",17)(1,"h3"),x(2,"Enter Value"),u(),R(3,Xh,8,1,"mat-form-field",18)(4,Kh,7,2,"mat-form-field",18)(5,Zh,5,2,"mat-form-field",18)(6,Jh,4,2,"mat-form-field",18),u()),o&2){let t=y();_(3),v("ngIf",t.isBooleanType()&&!t.usesPredefinedValues()),_(),v("ngIf",t.usesPredefinedValues()&&t.allowsMultipleValues()),_(),v("ngIf",t.usesPredefinedValues()&&!t.allowsMultipleValues()),_(),v("ngIf",!t.usesPredefinedValues()&&!t.isBooleanType())}}function em(o,e){o&1&&(g(0,"div",24)(1,"mat-icon"),x(2,"info"),u(),g(3,"p"),x(4,"All available metadata fields have been added."),u()())}var rl=(()=>{class o{constructor(t,i){this.dialogRef=t,this.data=i,this.selectedMetadata=null,this.metadataValue="",this.selectedValues=[]}ngOnInit(){this.data.availableMetadata.length===1&&(this.selectedMetadata=this.data.availableMetadata[0])}getPredefinedValues(){return this.selectedMetadata?.predefinedValues?this.selectedMetadata.predefinedValues.split(",").map(t=>t.trim()):[]}isValid(){return this.selectedMetadata?this.usesPredefinedValues()&&this.allowsMultipleValues()?this.selectedValues.length>0:this.metadataValue!==null&&this.metadataValue!==void 0&&this.metadataValue.toString().trim().length>0:!1}onMetadataChange(){this.metadataValue="",this.selectedValues=[]}onSave(){if(!this.isValid()||!this.selectedMetadata)return;let t=this.metadataValue;this.usesPredefinedValues()&&this.allowsMultipleValues()&&(t=this.selectedValues.join(", "));let i={metadata:this.selectedMetadata,value:t};this.dialogRef.close(i)}onCancel(){this.dialogRef.close()}getInputType(){if(!this.selectedMetadata)return"text";switch(this.selectedMetadata.type?.toLowerCase()){case"number":return"number";case"boolean":return"text";default:return"text"}}usesPredefinedValues(){return this.selectedMetadata?this.selectedMetadata.valueFrom?.toLowerCase()==="predefined"||!!this.selectedMetadata.predefinedValues:!1}allowsMultipleValues(){return this.selectedMetadata?.multipleValues===!0}isBooleanType(){return this.selectedMetadata?.type?.toLowerCase()==="boolean"}static{this.\u0275fac=function(i){return new(i||o)(W(wi),W(Mi))}}static{this.\u0275cmp=$({type:o,selectors:[["app-add-metadata-dialog"]],standalone:!1,decls:17,vars:6,consts:[["mat-dialog-title",""],[1,"dialog-content"],["appearance","fill",1,"full-width"],["required","",3,"ngModelChange","selectionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["class","metadata-details",4,"ngIf"],["class","value-section",4,"ngIf"],["class","no-metadata",4,"ngIf"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],[3,"value"],[1,"metadata-details"],[1,"detail-row"],[1,"label"],[1,"value"],["class","detail-row",4,"ngIf"],[1,"value-section"],["appearance","fill","class","full-width",4,"ngIf"],["required","",3,"ngModelChange","ngModel"],["value","true"],["value","false"],["multiple","","required","",3,"ngModelChange","ngModel"],["matInput","","required","","placeholder","Enter value",3,"ngModelChange","ngModel","type"],[1,"no-metadata"]],template:function(i,n){i&1&&(g(0,"h2",0),x(1,"Add Metadata"),u(),g(2,"mat-dialog-content")(3,"div",1)(4,"mat-form-field",2)(5,"mat-label"),x(6,"Select Metadata Field"),u(),g(7,"mat-select",3),Ct("ngModelChange",function(s){return bt(n.selectedMetadata,s)||(n.selectedMetadata=s),s}),T("selectionChange",function(){return n.onMetadataChange()}),R(8,qh,2,2,"mat-option",4),u()(),R(9,Yh,12,3,"div",5)(10,tm,7,4,"div",6)(11,em,5,0,"div",7),u()(),g(12,"mat-dialog-actions",8)(13,"button",9),T("click",function(){return n.onCancel()}),x(14,"Cancel"),u(),g(15,"button",10),T("click",function(){return n.onSave()}),x(16," Add "),u()()),i&2&&(_(7),_t("ngModel",n.selectedMetadata),_(),v("ngForOf",n.data.availableMetadata),_(),v("ngIf",n.selectedMetadata),_(),v("ngIf",n.selectedMetadata),_(),v("ngIf",n.data.availableMetadata.length===0),_(4),v("disabled",!n.isValid()))},dependencies:[kt,St,Ue,Yt,An,Xt,te,Dt,ie,fe,En,He,_e,je,Pi,ki,Oi],styles:[".dialog-content[_ngcontent-%COMP%]{min-width:400px;padding:16px 0}.dialog-content[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.dialog-content[_ngcontent-%COMP%]   .metadata-details[_ngcontent-%COMP%]{background-color:#f5f5f5;border-radius:4px;padding:12px;margin:16px 0}.dialog-content[_ngcontent-%COMP%]   .metadata-details[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:4px 0;font-size:14px}.dialog-content[_ngcontent-%COMP%]   .metadata-details[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500;color:#0009}.dialog-content[_ngcontent-%COMP%]   .metadata-details[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#000000de}.dialog-content[_ngcontent-%COMP%]   .value-section[_ngcontent-%COMP%]{margin-top:24px}.dialog-content[_ngcontent-%COMP%]   .value-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:16px;font-weight:500;margin:0 0 16px;color:#000000de}.dialog-content[_ngcontent-%COMP%]   .no-metadata[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:32px 16px;color:#0000008a}.dialog-content[_ngcontent-%COMP%]   .no-metadata[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px}.dialog-content[_ngcontent-%COMP%]   .no-metadata[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;text-align:center}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;margin:0}"]})}}return o})();function im(o,e){o&1&&(g(0,"div",9),tt(1,"mat-spinner",10),g(2,"span"),x(3,"Loading metadata..."),u()())}function nm(o,e){if(o&1){let t=V();g(0,"mat-form-field",19)(1,"input",20),T("blur",function(n){k(t);let a=y().$implicit,s=y(3);return S(s.onMetadataValueChange(a,n.target.value))})("keydown.enter",function(n){k(t);let a=y().$implicit,s=y(3);return S(s.onMetadataValueChange(a,n.target.value))}),u()()}if(o&2){let t=y().$implicit,i=y(3);_(),v("disabled",i.isSaving)("value",t.cachedValue)}}function om(o,e){if(o&1){let t=V();g(0,"mat-form-field",19)(1,"input",21),T("blur",function(n){k(t);let a=y().$implicit,s=y(3);return S(s.onMetadataValueChange(a,n.target.value))})("keydown.enter",function(n){k(t);let a=y().$implicit,s=y(3);return S(s.onMetadataValueChange(a,n.target.value))}),u()()}if(o&2){let t=y().$implicit,i=y(3);_(),v("disabled",i.isSaving)("value",t.cachedValue)}}function am(o,e){if(o&1&&(g(0,"mat-option",24),x(1),u()),o&2){let t=e.$implicit;v("value",t),_(),et(" ",t," ")}}function sm(o,e){if(o&1){let t=V();g(0,"mat-form-field",19)(1,"mat-select",22),T("selectionChange",function(n){k(t);let a=y().$implicit,s=y(3);return S(s.onMetadataValueChange(a,n.value))}),R(2,am,2,2,"mat-option",23),u()()}if(o&2){let t=y().$implicit,i=y(3);_(),v("disabled",i.isSaving)("value",t.cachedValue),_(),v("ngForOf",t.cachedPredefinedValues)}}function rm(o,e){if(o&1&&(g(0,"mat-option",24),x(1),u()),o&2){let t=e.$implicit;v("value",t),_(),et(" ",t," ")}}function lm(o,e){if(o&1){let t=V();g(0,"mat-form-field",19)(1,"mat-select",25),T("selectionChange",function(n){k(t);let a=y().$implicit,s=y(3);return S(s.onMetadataValueChange(a,n.value.join(", ")))}),R(2,rm,2,2,"mat-option",23),u()()}if(o&2){let t=y().$implicit,i=y(3);_(),v("disabled",i.isSaving)("value",t.cachedValueArray),_(),v("ngForOf",t.cachedPredefinedValues)}}function cm(o,e){if(o&1){let t=V();g(0,"div",13)(1,"div",14)(2,"div",15)(3,"span",16),x(4),u(),g(5,"button",17),T("click",function(){let n=k(t).$implicit,a=y(3);return S(a.onRemoveMetadata(n))}),g(6,"mat-icon"),x(7,"close"),u()()(),R(8,nm,2,2,"mat-form-field",18)(9,om,2,2,"mat-form-field",18)(10,sm,3,3,"mat-form-field",18)(11,lm,3,3,"mat-form-field",18),u()()}if(o&2){let t=e.$implicit;_(4),G(t.name),_(4),v("ngIf",t.showTextInput),_(),v("ngIf",t.showNumberInput),_(),v("ngIf",t.showDropdown&&!t.isMultiple),_(),v("ngIf",t.showDropdown&&t.isMultiple)}}function dm(o,e){if(o&1&&(g(0,"div",11),R(1,cm,12,5,"div",12),u()),o&2){let t=y(2);_(),v("ngForOf",t.displayedMetadataFields)}}function hm(o,e){o&1&&(g(0,"div",26)(1,"p"),x(2,"No metadata added yet. Click the + button to add metadata fields."),u()())}function mm(o,e){if(o&1){let t=V();g(0,"div",3)(1,"div",4)(2,"h4"),x(3,"Metadata"),u(),g(4,"button",5),T("click",function(){k(t);let n=y();return S(n.onAddMetadata())}),g(5,"mat-icon"),x(6,"add"),u()()(),R(7,im,4,0,"div",6)(8,dm,2,1,"div",7)(9,hm,3,0,"div",8),u()}if(o&2){let t=y();_(4),v("disabled",t.isLoadingFields||!t.hasAvailableFields),_(3),v("ngIf",t.isLoadingFields||t.isLoadingValues),_(),v("ngIf",!t.isLoadingFields&&!t.isLoadingValues&&t.displayedMetadataFields.length>0),_(),v("ngIf",!t.isLoadingFields&&!t.isLoadingValues&&t.displayedMetadataFields.length===0)}}function gm(o,e){o&1&&(g(0,"div",27)(1,"p"),x(2,"No image selected"),u()())}var ll=(()=>{class o{constructor(t,i,n,a){this.metadataService=t,this.dialog=i,this.snackBar=n,this.cdr=a,this.currentImage=null,this.project=null,this.metadataFields=[],this.displayedMetadataFields=[],this.metadataValues=new Map,this.isLoadingFields=!1,this.isLoadingValues=!1,this.isSaving=!1,this.hasAvailableFields=!1,this.hasLoadedValuesForCurrentImage=!1,this.destroy$=new Nt}ngOnChanges(t){t.project&&this.project&&this.loadMetadataFields(),t.currentImage&&(this.hasLoadedValuesForCurrentImage=!1,this.currentImage?this.metadataFields.length>0&&this.loadMetadataValues():(this.metadataValues.clear(),this.displayedMetadataFields=[],this.updateAvailableCount()))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}updateAvailableCount(){let t=new Set(this.displayedMetadataFields.map(i=>i.id));this.hasAvailableFields=this.metadataFields.some(i=>!t.has(i.id))}onAddMetadata(){let t=new Set(this.displayedMetadataFields.map(a=>a.id)),i=this.metadataFields.filter(a=>!t.has(a.id));if(i.length===0)return;this.dialog.open(rl,{width:"500px",data:{availableMetadata:i}}).afterClosed().subscribe(a=>{if(a&&a.metadata&&a.value!==void 0&&a.value!==null){let s=this.buildDisplayField(a.metadata,a.value);this.displayedMetadataFields=[...this.displayedMetadataFields,s],this.updateAvailableCount(),this.cdr.markForCheck(),this.currentImage&&a.metadata.id&&(this.isSaving=!0,this.cdr.markForCheck(),this.metadataService.addImageMetadata(this.currentImage.id,a.metadata.id,a.value).pipe(z(this.destroy$)).subscribe({next:r=>{let l=r.projectMetadata?.id||a.metadata.id;this.metadataValues.set(l,r),this.refreshFieldCache(l),this.isSaving=!1,this.snackBar.open("Metadata saved successfully","OK",{duration:2e3}),this.cdr.markForCheck()},error:r=>{console.error("Error saving metadata value:",r),alert("Failed to save metadata value."),this.isSaving=!1,this.displayedMetadataFields=this.displayedMetadataFields.filter(l=>l.id!==a.metadata.id),this.updateAvailableCount(),this.cdr.markForCheck()}}))}})}onRemoveMetadata(t){this.displayedMetadataFields=this.displayedMetadataFields.filter(n=>n.id!==t.id),this.updateAvailableCount(),this.cdr.markForCheck();let i=this.metadataValues.get(t.id);i?.id&&this.currentImage&&confirm(`Remove "${t.name}" value from this image?`)&&this.metadataService.deleteImageMetadata(this.currentImage.id,i.id).pipe(z(this.destroy$)).subscribe({next:()=>{this.metadataValues.delete(t.id),this.cdr.markForCheck()},error:n=>console.error("Error deleting metadata:",n)})}onMetadataValueChange(t,i){if(!this.currentImage||!t.id||this.isSaving)return;let n=this.metadataValues.get(t.id);this.isSaving=!0,this.cdr.markForCheck(),(n?.id?this.metadataService.updateImageMetadata(this.currentImage.id,n.id,i):this.metadataService.addImageMetadata(this.currentImage.id,t.id,i)).pipe(z(this.destroy$)).subscribe({next:s=>{this.metadataValues.set(t.id,s),this.refreshFieldCache(t.id),this.isSaving=!1,this.snackBar.open("Metadata saved successfully","OK",{duration:2e3}),this.cdr.markForCheck()},error:s=>{console.error("Error saving metadata value:",s),alert("Failed to save metadata value."),this.isSaving=!1,this.cdr.markForCheck()}})}buildDisplayField(t,i){let n=t.valueFrom?.toLowerCase()==="predefined",a=(t.type||"").toLowerCase(),s=i||"",r=t.predefinedValues?t.predefinedValues.split(",").map(l=>l.trim()):[];return{id:t.id,name:t.name,type:t.type,valueFrom:t.valueFrom,predefinedValues:t.predefinedValues,multipleValues:t.multipleValues,showTextInput:!n&&(a==="text"||!a&&a!=="number"&&a!=="dropdown"||a!=="number"&&a!=="dropdown"),showNumberInput:!n&&a==="number",showDropdown:a==="dropdown"||n,isMultiple:t.multipleValues===!0,cachedValue:s,cachedValueArray:s?s.split(",").map(l=>l.trim()).filter(l=>l.length>0):[],cachedPredefinedValues:r}}refreshFieldCache(t){let i=this.displayedMetadataFields.findIndex(s=>s.id===t);if(i===-1)return;let a=this.metadataValues.get(t)?.value||"";this.displayedMetadataFields[i].cachedValue=a,this.displayedMetadataFields[i].cachedValueArray=a?a.split(",").map(s=>s.trim()).filter(s=>s.length>0):[]}loadMetadataFields(){this.project&&(this.isLoadingFields=!0,this.cdr.markForCheck(),this.metadataService.getMetadataByProjectId(this.project.id).pipe(z(this.destroy$)).subscribe({next:t=>{this.metadataFields=t.length===0?wa:t,this.isLoadingFields=!1,this.updateAvailableCount(),this.currentImage&&!this.hasLoadedValuesForCurrentImage&&this.loadMetadataValues(),this.cdr.markForCheck()},error:t=>{console.error("Error loading metadata fields:",t),this.metadataFields=wa,this.isLoadingFields=!1,this.updateAvailableCount(),this.cdr.markForCheck()}}))}loadMetadataValues(){!this.currentImage||this.hasLoadedValuesForCurrentImage||(this.hasLoadedValuesForCurrentImage=!0,this.isLoadingValues=!0,this.cdr.markForCheck(),this.metadataService.getMetadataByImageId(this.currentImage.id).pipe(z(this.destroy$)).subscribe({next:t=>{this.metadataValues.clear();let i=[];t.forEach(n=>{let a=n.projectMetadata.id;this.metadataValues.set(a,n);let s=this.metadataFields.find(r=>r.id===a);s&&!i.find(r=>r.id===s.id)&&i.push(this.buildDisplayField(s,n.value))}),this.displayedMetadataFields=i,this.updateAvailableCount(),this.isLoadingValues=!1,this.cdr.markForCheck()},error:t=>{console.error("Error loading metadata values:",t),this.metadataValues.clear(),this.displayedMetadataFields=[],this.isLoadingValues=!1,this.hasLoadedValuesForCurrentImage=!1,this.updateAvailableCount(),this.cdr.markForCheck()}}))}static{this.\u0275fac=function(i){return new(i||o)(W(sl),W(Ge),W(sr),W(pe))}}static{this.\u0275cmp=$({type:o,selectors:[["app-metadata-block"]],inputs:{currentImage:"currentImage",project:"project"},standalone:!1,features:[qt],decls:3,vars:2,consts:[[1,"metadata-block"],["class","metadata-content",4,"ngIf"],["class","no-image-message",4,"ngIf"],[1,"metadata-content"],[1,"metadata-header"],["color","primary","mat-icon-button","","matTooltip","Add metadata field",3,"click","disabled"],["class","loading-indicator",4,"ngIf"],["class","metadata-fields",4,"ngIf"],["class","no-metadata-message",4,"ngIf"],[1,"loading-indicator"],["diameter","30"],[1,"metadata-fields"],["class","metadata-field",4,"ngFor","ngForOf"],[1,"metadata-field"],[1,"field-content"],[1,"field-header"],[1,"field-label"],["mat-icon-button","","matTooltip","Remove this metadata",1,"remove-button",3,"click"],["appearance","fill","class","metadata-input",4,"ngIf"],["appearance","fill",1,"metadata-input"],["matInput","","type","text","placeholder","Enter value",3,"blur","keydown.enter","disabled","value"],["matInput","","type","number","placeholder","Enter value",3,"blur","keydown.enter","disabled","value"],["placeholder","Select value",3,"selectionChange","disabled","value"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["placeholder","Select values","multiple","",3,"selectionChange","disabled","value"],[1,"no-metadata-message"],[1,"no-image-message"]],template:function(i,n){i&1&&(g(0,"div",0),R(1,mm,10,4,"div",1)(2,gm,3,0,"div",2),u()),i&2&&(_(),v("ngIf",n.currentImage&&n.project),_(),v("ngIf",!n.currentImage||!n.project))},dependencies:[kt,St,vi,Dt,ie,He,_e,je,ee,ue],styles:[".metadata-block[_ngcontent-%COMP%]{padding:16px}.metadata-block[_ngcontent-%COMP%]   .metadata-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.metadata-block[_ngcontent-%COMP%]   .metadata-content[_ngcontent-%COMP%]   .metadata-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}.metadata-block[_ngcontent-%COMP%]   .metadata-content[_ngcontent-%COMP%]   .metadata-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:16px;font-weight:500}.metadata-block[_ngcontent-%COMP%]   .metadata-content[_ngcontent-%COMP%]   .loading-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:8px;color:#0000008a}.metadata-block[_ngcontent-%COMP%]   .metadata-content[_ngcontent-%COMP%]   .loading-indicator[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{flex-shrink:0}.metadata-block[_ngcontent-%COMP%]   .metadata-content[_ngcontent-%COMP%]   .metadata-fields[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.metadata-block[_ngcontent-%COMP%]   .metadata-content[_ngcontent-%COMP%]   .metadata-fields[_ngcontent-%COMP%]   .metadata-field[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:4px;padding:12px;background-color:#fafafa;position:relative}.metadata-block[_ngcontent-%COMP%]   .metadata-content[_ngcontent-%COMP%]   .metadata-fields[_ngcontent-%COMP%]   .metadata-field[_ngcontent-%COMP%]   .field-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.metadata-block[_ngcontent-%COMP%]   .metadata-content[_ngcontent-%COMP%]   .metadata-fields[_ngcontent-%COMP%]   .metadata-field[_ngcontent-%COMP%]   .field-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:8px}.metadata-block[_ngcontent-%COMP%]   .metadata-content[_ngcontent-%COMP%]   .metadata-fields[_ngcontent-%COMP%]   .metadata-field[_ngcontent-%COMP%]   .field-header[_ngcontent-%COMP%]   .field-label[_ngcontent-%COMP%]{font-weight:500;font-size:14px;color:#000000de;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.metadata-block[_ngcontent-%COMP%]   .metadata-content[_ngcontent-%COMP%]   .metadata-fields[_ngcontent-%COMP%]   .metadata-field[_ngcontent-%COMP%]   .field-header[_ngcontent-%COMP%]   .remove-button[_ngcontent-%COMP%]{width:32px;height:32px;flex-shrink:0;padding:0;min-width:32px}.metadata-block[_ngcontent-%COMP%]   .metadata-content[_ngcontent-%COMP%]   .metadata-fields[_ngcontent-%COMP%]   .metadata-field[_ngcontent-%COMP%]   .field-header[_ngcontent-%COMP%]   .remove-button[_ngcontent-%COMP%]     .mat-icon{font-size:18px;width:18px;height:18px;line-height:18px}.metadata-block[_ngcontent-%COMP%]   .metadata-content[_ngcontent-%COMP%]   .metadata-fields[_ngcontent-%COMP%]   .metadata-field[_ngcontent-%COMP%]   .metadata-input[_ngcontent-%COMP%]{width:100%;margin:0}.metadata-block[_ngcontent-%COMP%]   .metadata-content[_ngcontent-%COMP%]   .no-metadata-message[_ngcontent-%COMP%]{text-align:center;color:#0000008a;padding:24px 16px;font-size:14px;background-color:#f5f5f5;border-radius:4px}.metadata-block[_ngcontent-%COMP%]   .no-image-message[_ngcontent-%COMP%]{text-align:center;color:#0000008a;padding:16px}"],changeDetection:0})}}return o})();function pm(o,e){o&1&&(g(0,"div",8)(1,"p"),x(2,"No annotations yet. Start annotating to see labels here."),u()())}function um(o,e){if(o&1){let t=V();g(0,"div",19),T("click",function(n){let a=k(t).$implicit,s=y(3);return S(s.onAnnotationClick(a,n))}),g(1,"div",20)(2,"span",21),x(3),u(),g(4,"span",22),x(5),u()(),g(6,"div",23),x(7),u()()}if(o&2){let t=e.$implicit,i=y(3);ot("selected",i.isAnnotationSelected(t)),_(3),G(t.id),_(2),G(t.type),_(2),et(" ",i.getCoordinateInfo(t)," ")}}function fm(o,e){if(o&1&&(g(0,"mat-expansion-panel",12)(1,"mat-expansion-panel-header")(2,"mat-panel-title",13),tt(3,"span",14),g(4,"span",15),x(5),u(),g(6,"span",16),x(7),u()()(),g(8,"div",17),R(9,um,8,5,"div",18),u()()),o&2){let t=e.$implicit;v("expanded",t.expanded),_(3),Ut("background-color",t.color),_(2),G(t.className),_(2),et("(",t.annotations.length,")"),_(2),v("ngForOf",t.annotations)}}function _m(o,e){if(o&1&&(g(0,"div",9)(1,"mat-accordion",10),R(2,fm,10,6,"mat-expansion-panel",11),u()()),o&2){let t=y();ot("hidden-labels",!t.showLabels),_(2),v("ngForOf",t.annotationGroups)}}function bm(o,e){if(o&1&&(g(0,"div",24),x(1),u()),o&2){let t=y();_(),et(" ",t.selectedAnnotations.length," labels selected ")}}var hl=(()=>{class o{constructor(t){this.cdr=t,this.annotations=[],this.selectedAnnotation=null,this.selectedAnnotations=[],this.annotationSelected=new q,this.annotationsSelected=new q,this.showLabelsChanged=new q,this.annotationGroups=[],this.showLabels=!0,this.filteredAnnotations=[]}ngOnChanges(t){t.annotations&&this.applyFilter(),(t.selectedAnnotation||t.selectedAnnotations)&&this.cdr.markForCheck()}onShowLabelsChange(){this.showLabelsChanged.emit(this.showLabels)}toggleGroup(t){t.expanded=!t.expanded}onAnnotationClick(t,i){if(i.ctrlKey||i.metaKey){let n=this.selectedAnnotations.findIndex(s=>s.id===t.id),a;n>-1?a=this.selectedAnnotations.filter(s=>s.id!==t.id):a=[...this.selectedAnnotations,t],this.annotationsSelected.emit(a),a.length>0?this.annotationSelected.emit(a[a.length-1]):this.annotationSelected.emit(null)}else this.annotationsSelected.emit([t]),this.annotationSelected.emit(t)}isAnnotationSelected(t){return this.selectedAnnotations.length>0?this.selectedAnnotations.some(i=>i.id===t.id):this.selectedAnnotation!==null&&this.selectedAnnotation.id===t.id}getCoordinateInfo(t){switch(t.type){case"RECTANGLE":return`x: ${Math.round(t.x)}, y: ${Math.round(t.y)}, w: ${Math.round(t.width)}, h: ${Math.round(t.height)}`;case"POLYGON":case"POLYLINE":return t.points&&t.points.length>0?`${t.points.length} points`:"No points";case"ELLIPSE":return`x: ${Math.round(t.x)}, y: ${Math.round(t.y)}, rx: ${Math.round(t.width/2)}, ry: ${Math.round(t.height/2)}`;case"BRUSH":return"Brush annotation";default:return"Unknown type"}}applyFilter(){this.filteredAnnotations=this.annotations.filter(t=>t.annotationType==="Ground Truth"||t.annotationType==="Ground truth").sort((t,i)=>{let n=typeof t.id=="number"?t.id:parseInt(t.id,10)||0,a=typeof i.id=="number"?i.id:parseInt(i.id,10)||0;return n-a}),this.groupAnnotationsByClass()}groupAnnotationsByClass(){let t=new Map;this.filteredAnnotations.forEach(i=>{let n=i.className||"Unclassified",a=i.color||"#808080";t.has(n)||t.set(n,{className:n,color:a,annotations:[],expanded:!0}),t.get(n).annotations.push(i)}),this.annotationGroups=Array.from(t.values()).sort((i,n)=>i.className.localeCompare(n.className))}static{this.\u0275fac=function(i){return new(i||o)(W(pe))}}static{this.\u0275cmp=$({type:o,selectors:[["app-labels-block"]],inputs:{annotations:"annotations",selectedAnnotation:"selectedAnnotation",selectedAnnotations:"selectedAnnotations"},outputs:{annotationSelected:"annotationSelected",annotationsSelected:"annotationsSelected",showLabelsChanged:"showLabelsChanged"},standalone:!1,features:[qt],decls:10,vars:5,consts:[[1,"labels-block"],[1,"labels-header"],[1,"labels-title"],[1,"labels-count"],["matTooltip","Show/Hide labels on canvas",1,"labels-toggle",3,"change","ngModelChange","ngModel"],["class","no-annotations-message",4,"ngIf"],["class","annotation-groups",3,"hidden-labels",4,"ngIf"],["class","selection-count",4,"ngIf"],[1,"no-annotations-message"],[1,"annotation-groups"],["multi",""],["class","annotation-group",3,"expanded",4,"ngFor","ngForOf"],[1,"annotation-group",3,"expanded"],[1,"group-title"],[1,"color-indicator"],[1,"class-name"],[1,"annotation-count"],[1,"annotations-list"],["class","annotation-item",3,"selected","click",4,"ngFor","ngForOf"],[1,"annotation-item",3,"click"],[1,"annotation-header"],[1,"annotation-label"],[1,"annotation-type"],[1,"annotation-coordinates"],[1,"selection-count"]],template:function(i,n){i&1&&(g(0,"div",0)(1,"div",1)(2,"span",2),x(3,"Labels"),u(),g(4,"span",3),x(5),u(),g(6,"mat-slide-toggle",4),T("change",function(){return n.onShowLabelsChange()}),Ct("ngModelChange",function(s){return bt(n.showLabels,s)||(n.showLabels=s),s}),u()(),R(7,pm,3,0,"div",5)(8,_m,3,3,"div",6)(9,bm,2,1,"div",7),u()),i&2&&(_(5),et("(",n.filteredAnnotations.length,")"),_(),_t("ngModel",n.showLabels),_(),v("ngIf",n.filteredAnnotations.length===0),_(),v("ngIf",n.filteredAnnotations.length>0),_(),v("ngIf",n.selectedAnnotations.length>1))},dependencies:[kt,St,Yt,Xt,Si,ee,Nn,Ti,Ii,Ai],styles:[".labels-block[_ngcontent-%COMP%]{padding:16px}.labels-block[_ngcontent-%COMP%]   .labels-header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 16px;background-color:#e3f2fd;border-left:3px solid #1976d2;border-radius:2px;margin-bottom:8px}.labels-block[_ngcontent-%COMP%]   .labels-header[_ngcontent-%COMP%]   .labels-title[_ngcontent-%COMP%]{font-weight:600;font-size:14px;color:#212121}.labels-block[_ngcontent-%COMP%]   .labels-header[_ngcontent-%COMP%]   .labels-count[_ngcontent-%COMP%]{color:#0009;font-size:12px;margin-left:8px}.labels-block[_ngcontent-%COMP%]   .labels-header[_ngcontent-%COMP%]   .labels-toggle[_ngcontent-%COMP%]{margin-left:auto;transform:scale(.8)}.labels-block[_ngcontent-%COMP%]   .no-annotations-message[_ngcontent-%COMP%]{text-align:center;color:#0009;padding:16px;font-size:14px}.labels-block[_ngcontent-%COMP%]   .hidden-labels[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.labels-block[_ngcontent-%COMP%]   .selection-count[_ngcontent-%COMP%]{text-align:center;color:#1976d2;padding:8px 16px;font-size:12px;font-weight:500;background-color:#e3f2fd;border-radius:2px;margin-top:8px}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   mat-accordion[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]{transition:all .2s ease ease;border-left:3px solid #1976d2}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]:hover{box-shadow:0 2px 4px #0000001a}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .group-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .group-title[_ngcontent-%COMP%]   .color-indicator[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:2px;flex-shrink:0;border:1px solid #f0f0f0;transition:transform .2s ease ease}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .group-title[_ngcontent-%COMP%]   .color-indicator[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .group-title[_ngcontent-%COMP%]   .class-name[_ngcontent-%COMP%]{font-weight:500;flex:1}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .group-title[_ngcontent-%COMP%]   .annotation-count[_ngcontent-%COMP%]{color:#0009;font-size:12px;display:inline-block;padding:2px 8px;border-radius:2px;font-size:11px;font-weight:500;text-transform:uppercase;background-color:#f5f5f5;color:#616161}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;padding-top:8px}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]{padding:8px;border-radius:4px;border:1px solid #f0f0f0;background-color:#fafafa;transition:background-color .2s ease,transform .15s ease;cursor:pointer;position:relative;overflow:hidden;transition:all .2s ease ease}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f5f5f5}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]:active:not(:disabled){transform:scale(.98);transition:transform .15s ease}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]:hover{box-shadow:0 2px 4px #0000001a;transform:translate(4px)}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item.selected[_ngcontent-%COMP%]{background-color:#e3f2fd;border-left:3px solid #2196f3;box-shadow:0 2px 4px #0000001a;animation:_ngcontent-%COMP%_highlight .6s ease}@keyframes _ngcontent-%COMP%_highlight{0%{background-color:transparent}50%{background-color:#e3f2fd}to{background-color:transparent}}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]   .annotation-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;flex-wrap:wrap;gap:4px}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]   .annotation-header[_ngcontent-%COMP%]   .annotation-label[_ngcontent-%COMP%]{font-weight:500;font-size:14px;color:#212121}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]   .annotation-header[_ngcontent-%COMP%]   .annotation-type[_ngcontent-%COMP%]{display:inline-block;padding:2px 8px;border-radius:2px;font-size:11px;font-weight:500;text-transform:uppercase;background-color:#f5f5f5;color:#616161}.labels-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]   .annotation-coordinates[_ngcontent-%COMP%]{font-size:12px;color:#0009;font-family:monospace}"],changeDetection:0})}}return o})();function Cm(o,e){o&1&&(g(0,"div",10)(1,"p"),x(2,"No predictions available."),u()())}function xm(o,e){if(o&1&&(g(0,"span",28),x(1),u()),o&2){let t=y().$implicit;_(),G(t.confidenceRate)}}function vm(o,e){if(o&1){let t=V();g(0,"div",21),T("click",function(n){let a=k(t).$implicit,s=y(3);return S(s.onAnnotationClick(a,n))}),g(1,"div",22)(2,"span",23),x(3),u(),g(4,"span",24),x(5,"Prediction"),u(),R(6,xm,2,1,"span",25),g(7,"span",26),x(8),u()(),g(9,"div",27),x(10),u()()}if(o&2){let t=e.$implicit,i=y(3);ot("selected",i.isAnnotationSelected(t)),_(3),G(t.id),_(3),v("ngIf",t.confidenceRate!==void 0),_(2),G(t.type),_(2),et(" ",i.getCoordinateInfo(t)," ")}}function ym(o,e){if(o&1&&(g(0,"mat-expansion-panel",14)(1,"mat-expansion-panel-header")(2,"mat-panel-title",15),tt(3,"span",16),g(4,"span",17),x(5),u(),g(6,"span",18),x(7),u()()(),g(8,"div",19),R(9,vm,11,6,"div",20),u()()),o&2){let t=e.$implicit;v("expanded",t.expanded),_(3),Ut("background-color",t.color),_(2),G(t.className),_(2),et("(",t.annotations.length,")"),_(2),v("ngForOf",t.annotations)}}function wm(o,e){if(o&1&&(g(0,"div",11)(1,"mat-accordion",12),R(2,ym,10,6,"mat-expansion-panel",13),u()()),o&2){let t=y();ot("hidden-predictions",!t.showPredictions),_(2),v("ngForOf",t.predictionGroups)}}var ml=(()=>{class o{constructor(t){this.cdr=t,this.annotations=[],this.selectedAnnotation=null,this.selectedAnnotations=[],this.selectedModel="",this.annotationSelected=new q,this.annotationsSelected=new q,this.showPredictionsChanged=new q,this.labelAssistClicked=new q,this.predictionGroups=[],this.showPredictions=!0,this.predictionAnnotations=[]}ngOnChanges(t){t.annotations&&this.filterPredictions(),(t.selectedAnnotation||t.selectedAnnotations)&&this.cdr.markForCheck()}onShowPredictionsChange(){this.showPredictionsChanged.emit(this.showPredictions)}onLabelAssistClick(){this.labelAssistClicked.emit()}onAnnotationClick(t,i){if(i.ctrlKey||i.metaKey){let n=this.selectedAnnotations.findIndex(s=>s.id===t.id),a;n>-1?a=this.selectedAnnotations.filter(s=>s.id!==t.id):a=[...this.selectedAnnotations,t],this.annotationsSelected.emit(a),a.length>0?this.annotationSelected.emit(a[a.length-1]):this.annotationSelected.emit(null)}else this.annotationsSelected.emit([t]),this.annotationSelected.emit(t)}isAnnotationSelected(t){return this.selectedAnnotations.length>0?this.selectedAnnotations.some(i=>i.id===t.id):this.selectedAnnotation!==null&&this.selectedAnnotation.id===t.id}getCoordinateInfo(t){switch(t.type){case"RECTANGLE":return`x: ${Math.round(t.x)}, y: ${Math.round(t.y)}, w: ${Math.round(t.width)}, h: ${Math.round(t.height)}`;case"POLYGON":case"POLYLINE":return t.points&&t.points.length>0?`${t.points.length} points`:"No points";case"ELLIPSE":return`x: ${Math.round(t.x)}, y: ${Math.round(t.y)}, rx: ${Math.round(t.width/2)}, ry: ${Math.round(t.height/2)}`;case"BRUSH":return"Brush annotation";default:return"Unknown type"}}filterPredictions(){this.predictionAnnotations=this.annotations.filter(t=>t.annotationType==="Prediction").sort((t,i)=>{let n=typeof t.id=="number"?t.id:parseInt(t.id,10)||0,a=typeof i.id=="number"?i.id:parseInt(i.id,10)||0;return n-a}),this.groupPredictionsByClass()}groupPredictionsByClass(){let t=new Map;this.predictionAnnotations.forEach(i=>{let n=i.className||"Unclassified",a=i.color||"#808080";t.has(n)||t.set(n,{className:n,color:a,annotations:[],expanded:!0}),t.get(n).annotations.push(i)}),this.predictionGroups=Array.from(t.values()).sort((i,n)=>i.className.localeCompare(n.className))}static{this.\u0275fac=function(i){return new(i||o)(W(pe))}}static{this.\u0275cmp=$({type:o,selectors:[["app-predictions-block"]],inputs:{annotations:"annotations",selectedAnnotation:"selectedAnnotation",selectedAnnotations:"selectedAnnotations",selectedModel:"selectedModel"},outputs:{annotationSelected:"annotationSelected",annotationsSelected:"annotationsSelected",showPredictionsChanged:"showPredictionsChanged",labelAssistClicked:"labelAssistClicked"},standalone:!1,features:[qt],decls:14,vars:5,consts:[[1,"predictions-block"],[1,"predictions-header"],[1,"predictions-title"],[1,"predictions-count"],["matTooltip","Show/Hide predictions on canvas.",1,"predictions-toggle",3,"change","ngModelChange","ngModel"],[1,"model-selection"],[1,"model-name"],["color","primary","mat-stroked-button","","matTooltip","By enabling label assist, you can accept model predictions as ground truth labels.",1,"label-assist-btn",3,"click"],["class","no-predictions-message",4,"ngIf"],["class","annotation-groups",3,"hidden-predictions",4,"ngIf"],[1,"no-predictions-message"],[1,"annotation-groups"],["multi",""],["class","annotation-group",3,"expanded",4,"ngFor","ngForOf"],[1,"annotation-group",3,"expanded"],[1,"group-title"],[1,"color-indicator"],[1,"class-name"],[1,"annotation-count"],[1,"annotations-list"],["class","annotation-item prediction",3,"selected","click",4,"ngFor","ngForOf"],[1,"annotation-item","prediction",3,"click"],[1,"annotation-header"],[1,"annotation-label"],[1,"prediction-badge"],["class","confidence-rate",4,"ngIf"],[1,"annotation-type"],[1,"annotation-coordinates"],[1,"confidence-rate"]],template:function(i,n){i&1&&(g(0,"div",0)(1,"div",1)(2,"span",2),x(3,"Predictions"),u(),g(4,"span",3),x(5),u(),g(6,"mat-slide-toggle",4),T("change",function(){return n.onShowPredictionsChange()}),Ct("ngModelChange",function(s){return bt(n.showPredictions,s)||(n.showPredictions=s),s}),u()(),g(7,"div",5)(8,"span",6),x(9),u(),g(10,"button",7),T("click",function(){return n.onLabelAssistClick()}),x(11," Label Assist "),u()(),R(12,Cm,3,0,"div",8)(13,wm,3,3,"div",9),u()),i&2&&(_(5),et("(",n.predictionAnnotations.length,")"),_(),_t("ngModel",n.showPredictions),_(3),G(n.selectedModel||"No model selected"),_(3),v("ngIf",n.predictionAnnotations.length===0),_(),v("ngIf",n.predictionAnnotations.length>0))},dependencies:[kt,St,Yt,Xt,te,Si,ee,Nn,Ti,Ii,Ai],styles:[".predictions-block[_ngcontent-%COMP%]{padding:16px}.predictions-block[_ngcontent-%COMP%]   .predictions-header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 16px;background-color:#fff3e0;border-left:3px solid #ff9800;border-radius:2px;margin-bottom:8px}.predictions-block[_ngcontent-%COMP%]   .predictions-header[_ngcontent-%COMP%]   .predictions-title[_ngcontent-%COMP%]{font-weight:600;font-size:14px;color:#212121}.predictions-block[_ngcontent-%COMP%]   .predictions-header[_ngcontent-%COMP%]   .predictions-count[_ngcontent-%COMP%]{color:#0009;font-size:12px;margin-left:8px}.predictions-block[_ngcontent-%COMP%]   .predictions-header[_ngcontent-%COMP%]   .predictions-toggle[_ngcontent-%COMP%]{margin-left:auto;transform:scale(.8)}.predictions-block[_ngcontent-%COMP%]   .model-selection[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;background-color:#fafafa;border-radius:2px;margin-bottom:8px}.predictions-block[_ngcontent-%COMP%]   .model-selection[_ngcontent-%COMP%]   .model-name[_ngcontent-%COMP%]{font-size:12px;color:#212121;font-weight:500}.predictions-block[_ngcontent-%COMP%]   .model-selection[_ngcontent-%COMP%]   .label-assist-btn[_ngcontent-%COMP%]{font-size:12px;padding:0 12px;height:28px;line-height:28px}.predictions-block[_ngcontent-%COMP%]   .no-predictions-message[_ngcontent-%COMP%]{text-align:center;color:#0009;padding:16px;font-size:14px}.predictions-block[_ngcontent-%COMP%]   .hidden-predictions[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   mat-accordion[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]{transition:all .2s ease ease;border-left:3px solid #ff9800}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]:hover{box-shadow:0 2px 4px #0000001a}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .group-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .group-title[_ngcontent-%COMP%]   .color-indicator[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:2px;flex-shrink:0;border:1px solid #f0f0f0;transition:transform .2s ease ease}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .group-title[_ngcontent-%COMP%]   .color-indicator[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .group-title[_ngcontent-%COMP%]   .class-name[_ngcontent-%COMP%]{font-weight:500;flex:1}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .group-title[_ngcontent-%COMP%]   .annotation-count[_ngcontent-%COMP%]{color:#0009;font-size:12px;display:inline-block;padding:2px 8px;border-radius:2px;font-size:11px;font-weight:500;text-transform:uppercase;background-color:#f5f5f5;color:#616161}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;padding-top:8px}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]{padding:8px;border-radius:4px;border:1px dashed #f0f0f0;background-color:#fafafa;transition:background-color .2s ease,transform .15s ease;cursor:pointer;position:relative;overflow:hidden;transition:all .2s ease ease}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f5f5f5}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]:active:not(:disabled){transform:scale(.98);transition:transform .15s ease}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]:hover{box-shadow:0 2px 4px #0000001a;transform:translate(4px)}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item.selected[_ngcontent-%COMP%]{background-color:#e3f2fd;border-left:3px solid #2196f3;box-shadow:0 2px 4px #0000001a;animation:_ngcontent-%COMP%_highlight .6s ease}@keyframes _ngcontent-%COMP%_highlight{0%{background-color:transparent}50%{background-color:#e3f2fd}to{background-color:transparent}}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]   .annotation-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;flex-wrap:wrap;gap:4px}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]   .annotation-header[_ngcontent-%COMP%]   .annotation-label[_ngcontent-%COMP%]{font-weight:500;font-size:14px;color:#212121}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]   .annotation-header[_ngcontent-%COMP%]   .prediction-badge[_ngcontent-%COMP%]{font-size:10px;padding:2px 6px;background-color:#ff9800;color:#fff;border-radius:10px}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]   .annotation-header[_ngcontent-%COMP%]   .confidence-rate[_ngcontent-%COMP%]{font-size:11px;padding:2px 6px;background-color:#4caf50;color:#fff;border-radius:10px;margin-right:auto}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]   .annotation-header[_ngcontent-%COMP%]   .annotation-type[_ngcontent-%COMP%]{display:inline-block;padding:2px 8px;border-radius:2px;font-size:11px;font-weight:500;text-transform:uppercase;background-color:#f5f5f5;color:#616161}.predictions-block[_ngcontent-%COMP%]   .annotation-groups[_ngcontent-%COMP%]   .annotation-group[_ngcontent-%COMP%]   .annotations-list[_ngcontent-%COMP%]   .annotation-item[_ngcontent-%COMP%]   .annotation-coordinates[_ngcontent-%COMP%]{font-size:12px;color:#0009;font-family:monospace}"],changeDetection:0})}}return o})();var gl=(()=>{class o{constructor(t,i){this.dialogRef=t,this.data=i,this.brightness=i.brightness,this.contrast=i.contrast,this.originalBrightness=i.brightness,this.originalContrast=i.contrast}ngOnInit(){}onBrightnessChange(){}onContrastChange(){}onReset(){this.brightness=this.originalBrightness,this.contrast=this.originalContrast}onResetToDefault(){this.brightness=0,this.contrast=0}onApply(){let t={brightness:this.brightness,contrast:this.contrast};this.dialogRef.close(t)}onCancel(){let t={brightness:this.originalBrightness,contrast:this.originalContrast};this.dialogRef.close(t)}formatSliderValue(t){return t>0?`+${t}`:t.toString()}static{this.\u0275fac=function(i){return new(i||o)(W(wi),W(Mi))}}static{this.\u0275cmp=$({type:o,selectors:[["app-enhance-dialog"]],standalone:!1,decls:49,vars:4,consts:[["mat-dialog-title",""],[1,"enhance-controls"],[1,"control-group"],[1,"control-header"],[1,"control-label"],[1,"control-value"],["discrete","","max","100","min","-100","showTickMarks","","step","1",1,"full-width-slider"],["matSliderThumb","",3,"input","ngModelChange","ngModel"],[1,"slider-labels"],[1,"info-message"],["align","end"],["mat-button","",1,"reset-button",3,"click"],[1,"spacer"],["mat-button","",3,"click"],["color","primary","mat-raised-button","",3,"click"]],template:function(i,n){i&1&&(g(0,"h2",0),x(1,"Enhance Image"),u(),g(2,"mat-dialog-content")(3,"div",1)(4,"div",2)(5,"div",3)(6,"label",4),x(7,"Brightness"),u(),g(8,"span",5),x(9),u()(),g(10,"mat-slider",6)(11,"input",7),T("input",function(){return n.onBrightnessChange()}),Ct("ngModelChange",function(s){return bt(n.brightness,s)||(n.brightness=s),s}),u()(),g(12,"div",8)(13,"span"),x(14,"-100"),u(),g(15,"span"),x(16,"0"),u(),g(17,"span"),x(18,"+100"),u()()(),g(19,"div",2)(20,"div",3)(21,"label",4),x(22,"Contrast"),u(),g(23,"span",5),x(24),u()(),g(25,"mat-slider",6)(26,"input",7),T("input",function(){return n.onContrastChange()}),Ct("ngModelChange",function(s){return bt(n.contrast,s)||(n.contrast=s),s}),u()(),g(27,"div",8)(28,"span"),x(29,"-100"),u(),g(30,"span"),x(31,"0"),u(),g(32,"span"),x(33,"+100"),u()()(),g(34,"div",9)(35,"mat-icon"),x(36,"info"),u(),g(37,"span"),x(38,"Adjustments are non-destructive and only affect the display. The original image file remains unchanged."),u()()()(),g(39,"mat-dialog-actions",10)(40,"button",11),T("click",function(){return n.onResetToDefault()}),g(41,"mat-icon"),x(42,"refresh"),u(),x(43," Reset to Default "),u(),tt(44,"div",12),g(45,"button",13),T("click",function(){return n.onCancel()}),x(46,"Cancel"),u(),g(47,"button",14),T("click",function(){return n.onApply()}),x(48,"Apply"),u()()),i&2&&(_(9),G(n.formatSliderValue(n.brightness)),_(2),_t("ngModel",n.brightness),_(13),G(n.formatSliderValue(n.contrast)),_(2),_t("ngModel",n.contrast))},dependencies:[Ue,Yt,Xt,te,Dt,Ur,jr,Pi,ki,Oi],styles:["mat-dialog-content[_ngcontent-%COMP%]{min-width:400px;max-width:500px;padding:24px}.enhance-controls[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:32px}.control-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.control-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.control-label[_ngcontent-%COMP%]{font-size:16px;font-weight:500;color:#000000de}.control-value[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#1976d2;min-width:50px;text-align:right}.full-width-slider[_ngcontent-%COMP%]{width:100%}.slider-labels[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;color:#0009;margin-top:4px}.info-message[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:8px;padding:12px;background-color:#e3f2fd;border-radius:4px;color:#000000de}.info-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;color:#1976d2;flex-shrink:0}.info-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;line-height:1.5}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 24px;display:flex;align-items:center}mat-dialog-actions[_ngcontent-%COMP%]   .reset-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}mat-dialog-actions[_ngcontent-%COMP%]   .reset-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}mat-dialog-actions[_ngcontent-%COMP%]   .spacer[_ngcontent-%COMP%]{flex:1}  .mat-mdc-slider .mdc-slider__track--active_fill{border-color:#1976d2}  .mat-mdc-slider .mdc-slider__thumb-knob{background-color:#1976d2;border-color:#1976d2}@media (max-width: 768px){mat-dialog-content[_ngcontent-%COMP%]{min-width:320px;max-width:400px;padding:20px}.enhance-controls[_ngcontent-%COMP%]{gap:24px}.control-label[_ngcontent-%COMP%], .control-value[_ngcontent-%COMP%]{font-size:15px}.info-message[_ngcontent-%COMP%]{padding:10px}.info-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.info-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:13px}mat-dialog-actions[_ngcontent-%COMP%]{padding:12px 16px}mat-dialog-actions[_ngcontent-%COMP%]   .reset-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}}@media (max-width: 480px){mat-dialog-content[_ngcontent-%COMP%]{min-width:280px;max-width:320px;padding:16px}.enhance-controls[_ngcontent-%COMP%]{gap:20px}.control-group[_ngcontent-%COMP%]{gap:6px}.control-header[_ngcontent-%COMP%]{margin-bottom:6px}.control-label[_ngcontent-%COMP%]{font-size:14px}.control-value[_ngcontent-%COMP%]{font-size:14px;min-width:40px}.slider-labels[_ngcontent-%COMP%]{font-size:11px}.info-message[_ngcontent-%COMP%]{padding:8px;gap:6px}.info-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.info-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px}mat-dialog-actions[_ngcontent-%COMP%]{padding:8px 12px;flex-wrap:wrap}mat-dialog-actions[_ngcontent-%COMP%]   .reset-button[_ngcontent-%COMP%]{font-size:13px;padding:6px 12px}mat-dialog-actions[_ngcontent-%COMP%]   .reset-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:13px;padding:6px 12px}}"]})}}return o})();function Mm(o,e){if(o&1){let t=V();g(0,"button",21),T("click",function(){k(t);let n=y();return S(n.onButtonClick("pan"))}),g(1,"mat-icon"),x(2),u()()}if(o&2){let t,i,n=y();ot("active",n.isButtonActive("pan")),v("matTooltip",((t=n.getButton("pan"))==null?null:t.tooltip)||""),_(2),G((i=n.getButton("pan"))==null?null:i.icon)}}function Pm(o,e){if(o&1){let t=V();g(0,"button",22),T("click",function(){k(t);let n=y();return S(n.onButtonClick("boundingBox"))}),g(1,"mat-icon"),x(2),u()()}if(o&2){let t,i,n=y();ot("active",n.isButtonActive("boundingBox")),v("disabled",n.isNoClass)("matTooltip",((t=n.getButton("boundingBox"))==null?null:t.tooltip)||""),_(2),G((i=n.getButton("boundingBox"))==null?null:i.icon)}}function Om(o,e){if(o&1&&(g(0,"mat-select-trigger")(1,"span",27),tt(2,"span",28),g(3,"span",29),x(4),u()()()),o&2){let t=y(2);_(2),Ut("background-color",t.selectedClass.colorCode),_(2),G(t.selectedClass.className)}}function km(o,e){if(o&1&&(g(0,"mat-option",30)(1,"span",27),tt(2,"span",28),g(3,"span",31),x(4),u()()()),o&2){let t=e.$implicit;v("value",t),_(2),Ut("background-color",t.colorCode),_(2),G(t.className)}}function Sm(o,e){if(o&1){let t=V();g(0,"mat-form-field",23)(1,"mat-label"),x(2,"Class"),u(),g(3,"mat-select",24),T("selectionChange",function(n){k(t);let a=y();return S(a.onClassSelected(n.value))}),Ct("valueChange",function(n){k(t);let a=y();return bt(a.selectedClass,n)||(a.selectedClass=n),S(n)}),R(4,Om,5,3,"mat-select-trigger",25)(5,km,5,4,"mat-option",26),u()()}if(o&2){let t=y();_(3),_t("value",t.selectedClass),_(),v("ngIf",t.selectedClass),_(),v("ngForOf",t.classes)}}function Tm(o,e){if(o&1){let t=V();g(0,"mat-slide-toggle",32),T("change",function(n){k(t);let a=y();return S(a.onNoClassChange(n.checked))}),x(1," No Class "),u()}if(o&2){let t=y();v("checked",t.isNoClass)("disabled",!t.currentImage)}}function Im(o,e){if(o&1){let t=V();g(0,"button",21),T("click",function(){k(t);let n=y();return S(n.onButtonClick("smartLabeling"))}),g(1,"mat-icon"),x(2),u()()}if(o&2){let t,i,n=y();v("matTooltip",((t=n.getButton("smartLabeling"))==null?null:t.tooltip)||""),_(2),G((i=n.getButton("smartLabeling"))==null?null:i.icon)}}function Am(o,e){if(o&1){let t=V();g(0,"button",21),T("click",function(){k(t);let n=y();return S(n.onButtonClick("brush"))}),g(1,"mat-icon"),x(2),u()()}if(o&2){let t,i,n=y();v("matTooltip",((t=n.getButton("brush"))==null?null:t.tooltip)||""),_(2),G((i=n.getButton("brush"))==null?null:i.icon)}}function Em(o,e){if(o&1){let t=V();g(0,"button",21),T("click",function(){k(t);let n=y();return S(n.onButtonClick("polygon"))}),g(1,"mat-icon"),x(2),u()()}if(o&2){let t,i,n=y();v("matTooltip",((t=n.getButton("polygon"))==null?null:t.tooltip)||""),_(2),G((i=n.getButton("polygon"))==null?null:i.icon)}}function Lm(o,e){if(o&1){let t=V();g(0,"button",21),T("click",function(){k(t);let n=y();return S(n.onButtonClick("polyline"))}),g(1,"mat-icon"),x(2),u()()}if(o&2){let t,i,n=y();v("matTooltip",((t=n.getButton("polyline"))==null?null:t.tooltip)||""),_(2),G((i=n.getButton("polyline"))==null?null:i.icon)}}function Dm(o,e){o&1&&tt(0,"span",13)}function Fm(o,e){if(o&1){let t=V();g(0,"button",22),T("click",function(){k(t);let n=y();return S(n.onButtonClick("undo"))}),g(1,"mat-icon"),x(2),u()()}if(o&2){let t,i,n=y();v("disabled",!n.canUndo)("matTooltip",((t=n.getButton("undo"))==null?null:t.tooltip)||""),_(2),G((i=n.getButton("undo"))==null?null:i.icon)}}function Rm(o,e){if(o&1){let t=V();g(0,"button",22),T("click",function(){k(t);let n=y();return S(n.onButtonClick("redo"))}),g(1,"mat-icon"),x(2),u()()}if(o&2){let t,i,n=y();v("disabled",!n.canRedo)("matTooltip",((t=n.getButton("redo"))==null?null:t.tooltip)||""),_(2),G((i=n.getButton("redo"))==null?null:i.icon)}}function Nm(o,e){if(o&1){let t=V();g(0,"button",21),T("click",function(){k(t);let n=y();return S(n.onButtonClick("clear"))}),g(1,"mat-icon"),x(2),u()()}if(o&2){let t,i,n=y();v("matTooltip",((t=n.getButton("clear"))==null?null:t.tooltip)||""),_(2),G((i=n.getButton("clear"))==null?null:i.icon)}}function Bm(o,e){if(o&1&&(g(0,"span",33),x(1),u()),o&2){let t=y();_(),G(t.projectName)}}function Vm(o,e){if(o&1){let t=V();g(0,"button",21),T("click",function(){k(t);let n=y();return S(n.onButtonClick("zoomIn"))}),g(1,"mat-icon"),x(2),u()()}if(o&2){let t,i,n=y();v("matTooltip",((t=n.getButton("zoomIn"))==null?null:t.tooltip)||""),_(2),G((i=n.getButton("zoomIn"))==null?null:i.icon)}}function zm(o,e){if(o&1&&(g(0,"span",34),x(1),u()),o&2){let t=y();_(),et(" ",t.getZoomPercentage()," ")}}function Gm(o,e){if(o&1){let t=V();g(0,"button",21),T("click",function(){k(t);let n=y();return S(n.onButtonClick("zoomOut"))}),g(1,"mat-icon"),x(2),u()()}if(o&2){let t,i,n=y();v("matTooltip",((t=n.getButton("zoomOut"))==null?null:t.tooltip)||""),_(2),G((i=n.getButton("zoomOut"))==null?null:i.icon)}}function Um(o,e){o&1&&tt(0,"span",13)}function jm(o,e){if(o&1){let t=V();g(0,"button",21),T("click",function(){k(t);let n=y();return S(n.onButtonClick("enhance"))}),g(1,"mat-icon"),x(2),u()()}if(o&2){let t,i,n=y();v("matTooltip",((t=n.getButton("enhance"))==null?null:t.tooltip)||""),_(2),G((i=n.getButton("enhance"))==null?null:i.icon)}}function Hm(o,e){if(o&1){let t=V();g(0,"button",35),T("mousedown",function(){k(t);let n=y();return S(n.onHoldToHideMouseDown())})("mouseleave",function(){k(t);let n=y();return S(n.onHoldToHideMouseLeave())})("mouseup",function(){k(t);let n=y();return S(n.onHoldToHideMouseUp())}),g(1,"mat-icon"),x(2),u()()}if(o&2){let t,i,n=y();ot("holding",n.isHoldingHide),v("matTooltip",((t=n.getButton("holdToHide"))==null?null:t.tooltip)||""),_(2),G((i=n.getButton("holdToHide"))==null?null:i.icon)}}var pl=(()=>{class o{constructor(t){this.dialog=t,this.buttons=[],this.classes=[],this.selectedClass=null,this.projectId=0,this.projectName="",this.projectType="",this.enhanceSettings={brightness:0,contrast:0},this.isPanMode=!1,this.activeTool="none",this.canUndo=!1,this.canRedo=!1,this.zoomLevel=1,this.currentImageIndex=0,this.totalImages=0,this.isNoClass=!1,this.currentImage=null,this.showLabelDetails=!0,this.buttonClick=new q,this.classSelected=new q,this.classCreated=new q,this.enhanceSettingsChanged=new q,this.navigateImage=new q,this.navigateToProject=new q,this.noObjectToLabelChanged=new q,this.showLabelDetailsChanged=new q,this.isHoldingHide=!1,this.destroy$=new Nt}ngOnInit(){}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}hasButton(t){return this.buttons.some(i=>i.id===t)}onButtonClick(t){switch(t){case"enhance":this.openEnhanceDialog();return;case"holdToHide":return;default:this.buttonClick.emit(t)}}onClassSelected(t){this.classSelected.emit(t)}onNoClassChange(t){this.noObjectToLabelChanged.emit(t),!t&&this.hasButton("boundingBox")&&this.buttonClick.emit("boundingBox")}onPreviousImage(){this.canGoPrevious()&&this.navigateImage.emit("previous")}onNextImage(){this.canGoNext()&&this.navigateImage.emit("next")}onNavigateToProject(){this.navigateToProject.emit()}canGoPrevious(){return this.currentImageIndex>0}canGoNext(){return this.currentImageIndex<this.totalImages-1}openClassCreationDialog(){if(!this.projectId||this.projectId===0){console.warn("Cannot create class: project not loaded");return}this.dialog.open(Un,{width:"400px",data:{projectId:this.projectId}}).afterClosed().pipe(z(this.destroy$)).subscribe(i=>{i&&this.classCreated.emit(i)})}openEnhanceDialog(){this.dialog.open(gl,{width:"400px",data:{brightness:this.enhanceSettings.brightness,contrast:this.enhanceSettings.contrast}}).afterClosed().pipe(z(this.destroy$)).subscribe(i=>{i&&this.enhanceSettingsChanged.emit(i)})}onHoldToHideMouseDown(){this.isHoldingHide=!0,this.buttonClick.emit("holdToHideStart")}onHoldToHideMouseUp(){this.isHoldingHide=!1,this.buttonClick.emit("holdToHideEnd")}onHoldToHideMouseLeave(){this.isHoldingHide&&(this.isHoldingHide=!1,this.buttonClick.emit("holdToHideEnd"))}getButton(t){return this.buttons.find(i=>i.id===t)}isButtonActive(t){return t==="pan"?this.isPanMode:t==="boundingBox"?this.activeTool==="boundingBox":!1}getZoomPercentage(){return Math.round(this.zoomLevel*100)+"%"}onShowLabelDetailsChange(t){this.showLabelDetailsChanged.emit(t)}static{this.\u0275fac=function(i){return new(i||o)(W(Ge))}}static{this.\u0275cmp=$({type:o,selectors:[["app-top-toolbar"]],inputs:{buttons:"buttons",classes:"classes",selectedClass:"selectedClass",projectId:"projectId",projectName:"projectName",projectType:"projectType",enhanceSettings:"enhanceSettings",isPanMode:"isPanMode",activeTool:"activeTool",canUndo:"canUndo",canRedo:"canRedo",zoomLevel:"zoomLevel",currentImageIndex:"currentImageIndex",totalImages:"totalImages",isNoClass:"isNoClass",currentImage:"currentImage",showLabelDetails:"showLabelDetails"},outputs:{buttonClick:"buttonClick",classSelected:"classSelected",classCreated:"classCreated",enhanceSettingsChanged:"enhanceSettingsChanged",navigateImage:"navigateImage",navigateToProject:"navigateToProject",noObjectToLabelChanged:"noObjectToLabelChanged",showLabelDetailsChanged:"showLabelDetailsChanged"},standalone:!1,decls:39,vars:24,consts:[[1,"top-toolbar"],[1,"toolbar-content"],[1,"toolbar-section","toolbar-left"],["mat-icon-button","",3,"active","matTooltip","click",4,"ngIf"],["mat-icon-button","",3,"active","disabled","matTooltip","click",4,"ngIf"],["appearance","fill","class","classes-dropdown",4,"ngIf"],["class","no-class-toggle","matTooltip","Mark image as having no objects to label",3,"checked","disabled","change",4,"ngIf"],["mat-icon-button","",3,"matTooltip","click",4,"ngIf"],["class","toolbar-divider",4,"ngIf"],["mat-icon-button","",3,"disabled","matTooltip","click",4,"ngIf"],[1,"toolbar-section","toolbar-center"],["mat-icon-button","","matTooltip","Back to project",3,"click"],["class","project-name",4,"ngIf"],[1,"toolbar-divider"],["mat-icon-button","","matTooltip","Previous image",3,"click","disabled"],[1,"image-index"],["mat-icon-button","","matTooltip","Next image",3,"click","disabled"],[1,"toolbar-section","toolbar-right"],["class","zoom-percentage",4,"ngIf"],["mat-icon-button","",3,"holding","matTooltip","mousedown","mouseleave","mouseup",4,"ngIf"],["matTooltip","Show/Hide label class names and confidence rates on canvas",1,"label-details-toggle",3,"change","ngModelChange","ngModel"],["mat-icon-button","",3,"click","matTooltip"],["mat-icon-button","",3,"click","disabled","matTooltip"],["appearance","fill",1,"classes-dropdown"],["panelClass","class-dropdown-panel",3,"selectionChange","valueChange","value"],[4,"ngIf"],["class","colored-option",3,"value",4,"ngFor","ngForOf"],[1,"class-option-item"],[1,"class-color-swatch"],[1,"selected-class-name"],[1,"colored-option",3,"value"],[1,"class-name"],["matTooltip","Mark image as having no objects to label",1,"no-class-toggle",3,"change","checked","disabled"],[1,"project-name"],[1,"zoom-percentage"],["mat-icon-button","",3,"mousedown","mouseleave","mouseup","matTooltip"]],template:function(i,n){i&1&&(g(0,"mat-toolbar",0)(1,"div",1)(2,"div",2),R(3,Mm,3,4,"button",3)(4,Pm,3,5,"button",4)(5,Sm,6,3,"mat-form-field",5)(6,Tm,2,2,"mat-slide-toggle",6)(7,Im,3,2,"button",7)(8,Am,3,2,"button",7)(9,Em,3,2,"button",7)(10,Lm,3,2,"button",7)(11,Dm,1,0,"span",8)(12,Fm,3,3,"button",9)(13,Rm,3,3,"button",9)(14,Nm,3,2,"button",7),u(),g(15,"div",10)(16,"button",11),T("click",function(){return n.onNavigateToProject()}),g(17,"mat-icon"),x(18,"arrow_back"),u()(),R(19,Bm,2,1,"span",12),tt(20,"span",13),g(21,"button",14),T("click",function(){return n.onPreviousImage()}),g(22,"mat-icon"),x(23,"chevron_left"),u()(),g(24,"span",15),x(25),u(),g(26,"button",16),T("click",function(){return n.onNextImage()}),g(27,"mat-icon"),x(28,"chevron_right"),u()()(),g(29,"div",17),R(30,Vm,3,2,"button",7)(31,zm,2,1,"span",18)(32,Gm,3,2,"button",7)(33,Um,1,0,"span",8)(34,jm,3,2,"button",7)(35,Hm,3,4,"button",19),tt(36,"span",13),g(37,"mat-slide-toggle",20),T("change",function(s){return n.onShowLabelDetailsChange(s.checked)}),Ct("ngModelChange",function(s){return bt(n.showLabelDetails,s)||(n.showLabelDetails=s),s}),x(38," Label Details "),u()()()()),i&2&&(_(3),v("ngIf",n.hasButton("pan")),_(),v("ngIf",n.hasButton("boundingBox")),_(),v("ngIf",n.classes.length>0&&!n.isNoClass),_(),v("ngIf",n.hasButton("boundingBox")&&n.projectType!=="Classification"),_(),v("ngIf",n.hasButton("smartLabeling")),_(),v("ngIf",n.hasButton("brush")),_(),v("ngIf",n.hasButton("polygon")),_(),v("ngIf",n.hasButton("polyline")),_(),v("ngIf",n.hasButton("undo")),_(),v("ngIf",n.hasButton("undo")),_(),v("ngIf",n.hasButton("redo")),_(),v("ngIf",n.hasButton("clear")),_(5),v("ngIf",n.projectName),_(2),v("disabled",!n.canGoPrevious()),_(4),Tn("",n.currentImageIndex+1," / ",n.totalImages,""),_(),v("disabled",!n.canGoNext()),_(4),v("ngIf",n.hasButton("zoomIn")),_(),v("ngIf",n.hasButton("zoomIn")||n.hasButton("zoomOut")),_(),v("ngIf",n.hasButton("zoomOut")),_(),v("ngIf",n.hasButton("enhance")),_(),v("ngIf",n.hasButton("enhance")),_(),v("ngIf",n.hasButton("holdToHide")),_(2),_t("ngModel",n.showLabelDetails))},dependencies:[kt,St,Yt,Xt,vi,Dt,hr,ie,fe,He,Tr,_e,Si,ee],styles:[".top-toolbar[_ngcontent-%COMP%]{background-color:#f5f5f5;border-bottom:1px solid #e0e0e0;padding:0 16px;height:64px;min-height:64px}.toolbar-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%;height:100%}.toolbar-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.toolbar-left[_ngcontent-%COMP%]{flex:1;justify-content:flex-start}.toolbar-center[_ngcontent-%COMP%]{position:absolute;left:50%;transform:translate(-50%);display:flex;align-items:center;gap:4px;background-color:#fafafa;padding:4px 8px;border-radius:4px;border:1px solid #f0f0f0}.toolbar-right[_ngcontent-%COMP%]{flex:1;justify-content:flex-end}.toolbar-divider[_ngcontent-%COMP%]{width:1px;height:32px;background-color:#e0e0e0;margin:0 8px}.image-index[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;min-width:70px;padding:0 8px;font-size:14px;font-weight:500;color:#212121;-webkit-user-select:none;user-select:none}.project-name[_ngcontent-%COMP%]{display:inline-flex;align-items:center;font-size:14px;font-weight:500;color:#212121;-webkit-user-select:none;user-select:none;max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}button[_ngcontent-%COMP%]{transition:background-color .2s ease}button.active[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2}button.holding[_ngcontent-%COMP%]{background-color:#ffebee;color:#d32f2f}button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f5f5f5}button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.zoom-percentage[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;min-width:50px;padding:0 8px;font-size:14px;font-weight:500;color:#212121;-webkit-user-select:none;user-select:none;background-color:#fafafa;border-radius:2px;border:1px solid #f0f0f0}.classes-dropdown[_ngcontent-%COMP%]{width:180px;margin-left:8px;position:relative}.classes-dropdown[_ngcontent-%COMP%]     .mat-mdc-form-field-infix{padding-top:16px;padding-bottom:4px;min-height:48px;position:relative}.classes-dropdown[_ngcontent-%COMP%]     .mat-mdc-text-field-wrapper{padding-bottom:0;position:relative}.classes-dropdown[_ngcontent-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}.classes-dropdown[_ngcontent-%COMP%]     .mat-mdc-floating-label{top:24px;z-index:3;padding-left:8px}.classes-dropdown[_ngcontent-%COMP%]     .mat-mdc-form-field-flex{align-items:center}.classes-dropdown[_ngcontent-%COMP%]     .mat-mdc-select-value{display:flex;align-items:center;position:relative;z-index:2;padding-left:8px}.classes-dropdown[_ngcontent-%COMP%]     .mat-mdc-select-trigger{width:100%;position:relative;z-index:2}.classes-dropdown[_ngcontent-%COMP%]     .mat-mdc-select-arrow-wrapper{z-index:3;padding-right:8px}.classes-dropdown[_ngcontent-%COMP%]   .selected-class-name[_ngcontent-%COMP%]{color:#000000de;font-size:14px}.class-option-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.class-color-swatch[_ngcontent-%COMP%]{display:inline-block;width:14px;height:14px;border-radius:2px;flex-shrink:0;border:1px solid rgba(0,0,0,.15)}  .class-dropdown-panel .mat-mdc-option.colored-option{padding:10px 16px!important;min-height:40px}  .class-dropdown-panel .mat-mdc-option.colored-option:hover{background-color:#0000000a}  .class-dropdown-panel .mat-mdc-option.colored-option .mdc-list-item__primary-text{width:100%;color:#000000de!important}  .class-dropdown-panel .mat-mdc-option.colored-option .class-name{color:#000000de!important;font-weight:500;font-size:14px}.no-class-toggle[_ngcontent-%COMP%]{margin-left:16px;display:flex;align-items:center}.no-class-toggle[_ngcontent-%COMP%]     .mdc-form-field{font-size:14px;display:flex;align-items:center;vertical-align:middle}.no-class-toggle[_ngcontent-%COMP%]     .mdc-label{display:flex;align-items:center;line-height:1;vertical-align:middle;padding-top:0;padding-bottom:0;margin-top:0;margin-bottom:0;margin-left:8px}.no-class-toggle[_ngcontent-%COMP%]     .mat-mdc-slide-toggle{display:flex;align-items:center}.label-details-toggle[_ngcontent-%COMP%]{margin-left:8px;display:flex;align-items:center}.label-details-toggle[_ngcontent-%COMP%]     .mdc-form-field{font-size:14px;display:flex;align-items:center;vertical-align:middle}.label-details-toggle[_ngcontent-%COMP%]     .mdc-label{display:flex;align-items:center;line-height:1;vertical-align:middle;padding-top:0;padding-bottom:0;margin-top:0;margin-bottom:0;margin-left:8px}.label-details-toggle[_ngcontent-%COMP%]     .mat-mdc-slide-toggle{display:flex;align-items:center}@media (max-width: 1200px){.toolbar-content[_ngcontent-%COMP%], .toolbar-section[_ngcontent-%COMP%]{gap:4px}.toolbar-center[_ngcontent-%COMP%]{padding:3px 6px}.image-index[_ngcontent-%COMP%]{min-width:60px;font-size:13px}.zoom-percentage[_ngcontent-%COMP%]{min-width:45px;font-size:13px;padding:0 6px}}@media (max-width: 768px){.top-toolbar[_ngcontent-%COMP%]{height:auto;min-height:56px;padding:0 8px}.toolbar-content[_ngcontent-%COMP%]{flex-wrap:wrap;height:auto;gap:4px;position:relative}.toolbar-section[_ngcontent-%COMP%]{flex-wrap:wrap;gap:2px}.toolbar-left[_ngcontent-%COMP%], .toolbar-right[_ngcontent-%COMP%]{flex:1 1 45%;justify-content:center}.toolbar-center[_ngcontent-%COMP%]{position:relative;left:auto;transform:none;order:-1;flex:1 1 100%;justify-content:center;margin-bottom:4px}.toolbar-divider[_ngcontent-%COMP%]{display:none}button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.image-index[_ngcontent-%COMP%]{min-width:55px;font-size:12px}.zoom-percentage[_ngcontent-%COMP%]{min-width:40px;font-size:12px;padding:0 4px}}@media (max-width: 480px){.top-toolbar[_ngcontent-%COMP%]{padding:0 4px}.toolbar-section[_ngcontent-%COMP%]{gap:0}.toolbar-center[_ngcontent-%COMP%]{padding:2px 4px}button[_ngcontent-%COMP%]{padding:4px;min-width:36px;width:36px;height:36px}button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.image-index[_ngcontent-%COMP%]{min-width:50px;font-size:11px}.zoom-percentage[_ngcontent-%COMP%]{min-width:35px;font-size:11px;padding:0 3px}}"]})}}return o})();var pt=Zi(Ki());var qf=["canvasContainer"],Rd=(()=>{class o{constructor(){this.image=null,this.imageUrl=null,this.annotations=[],this.selectedAnnotation=null,this.selectedAnnotations=[],this.selectedClass=null,this.activeTool="none",this.zoomLevel=1,this.isPanMode=!1,this.hideAnnotations=!1,this.enhanceSettings={brightness:0,contrast:0},this.showLabels=!0,this.showPredictions=!0,this.showLabelDetails=!0,this.annotationCreated=new q,this.annotationUpdated=new q,this.annotationDeleted=new q,this.annotationSelected=new q,this.zoomLevelChanged=new q,this.stage=null,this.imageLayer=null,this.annotationLayer=null,this.konvaImage=null,this.htmlImage=null,this.isDrawing=!1,this.currentShape=null,this.polygonPoints=[],this.brushPoints=[],this.polylinePoints=[],this.isPanning=!1,this.lastPanPosition=null}ngOnInit(){}ngAfterViewInit(){setTimeout(()=>{this.initializeStage(),this.imageUrl&&this.image&&this.loadImage()},0)}ngOnChanges(t){t.image&&this.image&&this.loadImage(),t.imageUrl&&this.imageUrl&&this.loadImage(),t.annotations&&this.renderAnnotations(),t.selectedAnnotation&&this.highlightSelectedAnnotation(),t.zoomLevel&&this.applyZoom(),t.hideAnnotations&&this.toggleAnnotationsVisibility(),t.enhanceSettings&&this.applyEnhanceSettings(),(t.showLabels||t.showPredictions)&&(this.renderAnnotations(),this.highlightSelectedAnnotation()),t.showLabelDetails&&(this.renderAnnotations(),this.highlightSelectedAnnotation())}ngOnDestroy(){this.stage&&this.stage.destroy()}initializeStage(){let t=this.canvasContainer.nativeElement,i=t.clientWidth||800,n=t.clientHeight||600;this.stage&&this.stage.destroy(),this.stage=new pt.default.Stage({container:t,width:i,height:n}),this.imageLayer=new pt.default.Layer,this.annotationLayer=new pt.default.Layer,this.stage.add(this.imageLayer),this.stage.add(this.annotationLayer),this.setupEventHandlers()}setupEventHandlers(){if(!this.stage){console.error("Cannot setup event handlers: stage is null");return}this.stage.on("mousedown",t=>{this.isPanMode?this.startPan(t):this.handleMouseDown(t)}),this.stage.on("mousemove",t=>{this.isPanning?this.handlePan(t):this.isDrawing&&this.handleMouseMove(t)}),this.stage.on("mouseup",t=>{this.isPanning?this.endPan():this.isDrawing&&this.handleMouseUp(t)}),this.stage.on("wheel",t=>{t.evt.preventDefault(),this.handleMouseWheel(t)}),this.stage.on("dblclick",()=>{this.activeTool==="polygon"&&this.polygonPoints.length>=3?this.completePolygon():this.activeTool==="polyline"&&this.polylinePoints.length>=2&&this.completePolyline()}),this.stage.on("click",t=>{t.target===this.stage&&this.annotationSelected.emit(null)})}loadImage(){if(!this.image||!this.imageLayer){this.imageLayer||setTimeout(()=>{this.image&&this.imageLayer?this.loadImage():console.error("Failed to load image: imageLayer still not initialized after retry")},50);return}this.imageUrl&&(this.konvaImage&&this.konvaImage.destroy(),this.stage&&(this.stage.position({x:0,y:0}),this.stage.scale({x:1,y:1})),this.htmlImage=new window.Image,this.htmlImage.crossOrigin="Anonymous",this.htmlImage.onload=()=>{if(!this.htmlImage||!this.imageLayer||!this.stage){console.error("Image loaded but required objects are null");return}this.konvaImage=new pt.default.Image({image:this.htmlImage,x:0,y:0});let t=this.stage.width()/this.htmlImage.width,i=this.stage.height()/this.htmlImage.height,n=Math.min(t,i,1);this.konvaImage.scale({x:n,y:n});let a=(this.stage.width()-this.htmlImage.width*n)/2,s=(this.stage.height()-this.htmlImage.height*n)/2;this.konvaImage.position({x:a,y:s}),this.imageLayer.add(this.konvaImage),this.imageLayer.batchDraw(),this.applyEnhanceSettings(),this.renderAnnotations()},this.htmlImage.onerror=t=>{console.error("Error loading image:",t),console.error("Image URL:",this.imageUrl),console.error("Image object:",this.image)},this.htmlImage.src=this.imageUrl)}renderAnnotations(){if(!this.annotationLayer)return;this.annotationLayer.destroyChildren();let t=[];if(this.showLabels){let i=this.annotations.filter(n=>n.annotationType==="Ground Truth"||n.annotationType==="Ground truth");t=t.concat(i)}if(this.showPredictions){let i=this.annotations.filter(n=>n.annotationType==="Prediction");t=t.concat(i)}t.forEach(i=>{this.renderAnnotation(i)}),this.annotationLayer.batchDraw()}renderAnnotation(t){if(!this.annotationLayer)return;let i=null;switch(t.type){case ht.Rectangle:i=this.createRectangle(t);break;case ht.Polygon:i=this.createPolygon(t);break;case ht.Brush:i=this.createBrush(t);break;case ht.Polyline:i=this.createPolyline(t);break}i&&(i.setAttr("annotation",t),i.on("click",()=>{this.annotationSelected.emit(t)}),this.annotationLayer.add(i))}createRectangle(t){let i=new pt.default.Group({draggable:!0}),n=new pt.default.Rect({x:t.x,y:t.y,width:t.width,height:t.height,stroke:t.color,strokeWidth:2,fill:t.color+"20"}),a=new pt.default.Text({x:t.x,y:t.y-22,text:t.label||t.className||"Unlabeled",fontSize:14,fontFamily:"Arial",fill:"#ffffff",padding:4}),s=new pt.default.Rect({x:t.x,y:t.y-22,width:a.width(),height:a.height(),fill:t.color,opacity:.9,cornerRadius:3}),r=this.stage?.scaleX()||1,l=10,c=1,d=l/r,h=c/r,m=c/r,p=new pt.default.Transformer({nodes:[n],enabledAnchors:["top-left","top-right","bottom-left","bottom-right","top-center","middle-right","middle-left","bottom-center"],rotateEnabled:!1,anchorSize:d,anchorStrokeWidth:0,borderStrokeWidth:m,anchorFill:"transparent",anchorStroke:"transparent",borderStroke:"#1890ff",anchorCornerRadius:d/4,ignoreStroke:!0,boundBoxFunc:(b,C)=>C.width<10||C.height<10?b:C}),f=this.selectedAnnotation?.id===t.id||this.selectedAnnotations.some(b=>b.id===t.id);return p.visible(f),p.find(".top-left, .top-center, .top-right, .middle-left, .middle-right, .bottom-left, .bottom-center, .bottom-right").forEach(b=>{b.visible(!1)}),i.add(n),this.showLabelDetails&&(i.add(s),i.add(a)),i.add(p),i.on("click",()=>{p.visible(!0),p.find(".top-left, .top-center, .top-right, .middle-left, .middle-right, .bottom-left, .bottom-center, .bottom-right").forEach(b=>{b.visible(!1)}),this.annotationLayer?.batchDraw()}),this.showLabelDetails&&a.on("dblclick",()=>{this.editAnnotationLabel(t,a,s)}),i.on("dragend",()=>{let b=i.position();t.x=n.x()+b.x,t.y=n.y()+b.y,n.x(t.x),n.y(t.y),a.x(t.x),a.y(t.y-22),s.x(t.x),s.y(t.y-22),i.position({x:0,y:0}),this.annotationLayer?.batchDraw(),this.annotationUpdated.emit(t)}),n.on("transformend",()=>{let b=i.position(),C=n.scaleX(),M=n.scaleY();t.x=n.x()+b.x,t.y=n.y()+b.y,t.width=n.width()*C,t.height=n.height()*M,n.x(t.x),n.y(t.y),n.width(t.width),n.height(t.height),n.scaleX(1),n.scaleY(1),a.x(t.x),a.y(t.y-22),s.x(t.x),s.y(t.y-22),s.width(a.width()),s.height(a.height()),i.position({x:0,y:0}),this.annotationLayer?.batchDraw(),this.annotationUpdated.emit(t)}),i}createPolygon(t){let i=new pt.default.Group({draggable:!0}),n=[];t.points.forEach(m=>{n.push(m.x,m.y)});let a=new pt.default.Line({points:n,stroke:t.color,strokeWidth:2,fill:t.color+"20",closed:!0});i.add(a);let s=a.getClientRect(),r=s.x+s.width/2-30,l=s.y-22,c=new pt.default.Text({x:r,y:l,text:t.label||t.className||"Unlabeled",fontSize:14,fontFamily:"Arial",fill:"#ffffff",padding:4}),d=new pt.default.Rect({x:r,y:l,width:c.width(),height:c.height(),fill:t.color,opacity:.9,cornerRadius:3});this.showLabelDetails&&(i.add(d),i.add(c));let h=[];return t.points.forEach((m,p)=>{let f=new pt.default.Circle({x:m.x,y:m.y,radius:5,fill:t.color,stroke:"#ffffff",strokeWidth:2,draggable:!0,visible:!1});f.on("dragmove",()=>{let b=[...n];b[p*2]=f.x(),b[p*2+1]=f.y(),a.points(b),this.annotationLayer?.batchDraw()}),f.on("dragend",()=>{let b=[],C=a.points();for(let M=0;M<C.length;M+=2)b.push({x:C[M],y:C[M+1]});t.points=b,this.annotationUpdated.emit(t)}),h.push(f),i.add(f)}),i.on("click",()=>{h.forEach(m=>m.visible(!0)),this.annotationLayer?.batchDraw()}),i.on("dragend",()=>{let m=i.x(),p=i.y(),f=t.points.map(C=>({x:C.x+m,y:C.y+p}));t.points=f;let b=[];f.forEach(C=>{b.push(C.x,C.y)}),a.points(b),h.forEach((C,M)=>{C.x(f[M].x),C.y(f[M].y)}),i.position({x:0,y:0}),this.annotationUpdated.emit(t)}),i}createBrush(t){let i=[];t.points.forEach(a=>{i.push(a.x,a.y)});let n=new pt.default.Line({points:i,stroke:t.color,strokeWidth:5,lineCap:"round",lineJoin:"round",draggable:!0});return n.on("dragend",()=>{let a=n.x(),s=n.y(),r=t.points.map(l=>({x:l.x+a,y:l.y+s}));t.points=r,n.position({x:0,y:0}),this.annotationUpdated.emit(t)}),n}createPolyline(t){let i=[];t.points.forEach(a=>{i.push(a.x,a.y)});let n=new pt.default.Line({points:i,stroke:t.color,strokeWidth:2,lineCap:"round",lineJoin:"round",draggable:!0});return n.on("dragend",()=>{let a=n.x(),s=n.y(),r=t.points.map(l=>({x:l.x+a,y:l.y+s}));t.points=r,n.position({x:0,y:0}),this.annotationUpdated.emit(t)}),n}getRelativePointerPosition(){if(!this.stage)return null;let t=this.stage.getAbsoluteTransform().copy();t.invert();let i=this.stage.getPointerPosition();return i?t.point(i):null}handleMouseDown(t){if(!this.stage){console.error("Stage not initialized");return}if(!this.selectedClass)return;let i=this.getRelativePointerPosition();if(!i){console.error("Could not get pointer position");return}switch(this.activeTool){case"boundingBox":this.startBoundingBox(i);break;case"polygon":this.addPolygonPoint(i);break;case"brush":this.startBrush(i);break;case"polyline":this.addPolylinePoint(i);break}}handleMouseMove(t){if(!this.stage||!this.isDrawing)return;let i=this.getRelativePointerPosition();if(i)switch(this.activeTool){case"boundingBox":this.updateBoundingBox(i);break;case"brush":this.updateBrush(i);break}}handleMouseUp(t){if(this.isDrawing)switch(this.activeTool){case"boundingBox":this.completeBoundingBox();break;case"brush":this.completeBrush();break}}startBoundingBox(t){if(!this.annotationLayer||!this.selectedClass){console.error("Cannot start bounding box: annotationLayer or selectedClass is null");return}this.isDrawing=!0,this.currentShape=new pt.default.Rect({x:t.x,y:t.y,width:0,height:0,stroke:this.selectedClass.colorCode,strokeWidth:2,fill:this.selectedClass.colorCode+"20"}),this.annotationLayer.add(this.currentShape),this.annotationLayer.batchDraw()}updateBoundingBox(t){if(!this.currentShape||!(this.currentShape instanceof pt.default.Rect))return;let i=this.currentShape.x(),n=this.currentShape.y(),a=t.x-i,s=t.y-n;this.currentShape.width(a),this.currentShape.height(s),this.annotationLayer?.batchDraw()}completeBoundingBox(){if(!this.currentShape||!(this.currentShape instanceof pt.default.Rect)||!this.selectedClass){this.isDrawing=!1;return}let t=this.currentShape.width(),i=this.currentShape.height();if(Math.abs(t)<10||Math.abs(i)<10){this.currentShape.destroy(),this.annotationLayer?.batchDraw(),this.isDrawing=!1;return}let n=this.currentShape.x(),a=this.currentShape.y(),s=t,r=i;t<0&&(n=n+t,s=Math.abs(t)),i<0&&(a=a+i,r=Math.abs(i));let l={id:0,label:this.selectedClass.className,type:ht.Rectangle,color:this.selectedClass.colorCode,x:n,y:a,width:s,height:r,points:[],classId:this.selectedClass.id,className:this.selectedClass.className};this.annotationCreated.emit(l),this.currentShape.destroy(),this.currentShape=null,this.isDrawing=!1,this.annotationLayer?.batchDraw()}addPolygonPoint(t){this.polygonPoints.push({x:t.x,y:t.y}),this.drawTemporaryPolygon()}drawTemporaryPolygon(){if(!this.annotationLayer||!this.selectedClass||(this.currentShape&&this.currentShape.destroy(),this.polygonPoints.length<2))return;let t=[];this.polygonPoints.forEach(i=>{t.push(i.x,i.y)}),this.currentShape=new pt.default.Line({points:t,stroke:this.selectedClass.colorCode,strokeWidth:2,fill:this.selectedClass.colorCode+"20",closed:!1}),this.annotationLayer.add(this.currentShape),this.annotationLayer.batchDraw()}completePolygon(){if(this.polygonPoints.length<3||!this.selectedClass)return;let t={id:0,label:this.selectedClass.className,type:ht.Polygon,color:this.selectedClass.colorCode,x:0,y:0,width:0,height:0,points:[...this.polygonPoints],classId:this.selectedClass.id,className:this.selectedClass.className};this.annotationCreated.emit(t),this.currentShape&&(this.currentShape.destroy(),this.currentShape=null),this.polygonPoints=[],this.annotationLayer?.batchDraw()}startBrush(t){!this.annotationLayer||!this.selectedClass||(this.isDrawing=!0,this.brushPoints=[{x:t.x,y:t.y}],this.currentShape=new pt.default.Line({points:[t.x,t.y],stroke:this.selectedClass.colorCode,strokeWidth:5,lineCap:"round",lineJoin:"round"}),this.annotationLayer.add(this.currentShape))}updateBrush(t){if(!this.currentShape||!(this.currentShape instanceof pt.default.Line))return;this.brushPoints.push({x:t.x,y:t.y});let i=[];this.brushPoints.forEach(n=>{i.push(n.x,n.y)}),this.currentShape.points(i),this.annotationLayer?.batchDraw()}completeBrush(){if(!this.selectedClass||this.brushPoints.length<2){this.isDrawing=!1;return}let t={id:0,label:this.selectedClass.className,type:ht.Brush,color:this.selectedClass.colorCode,x:0,y:0,width:0,height:0,points:[...this.brushPoints],classId:this.selectedClass.id,className:this.selectedClass.className};this.annotationCreated.emit(t),this.currentShape=null,this.brushPoints=[],this.isDrawing=!1}addPolylinePoint(t){this.polylinePoints.push({x:t.x,y:t.y}),this.drawTemporaryPolyline()}drawTemporaryPolyline(){if(!this.annotationLayer||!this.selectedClass||(this.currentShape&&this.currentShape.destroy(),this.polylinePoints.length<2))return;let t=[];this.polylinePoints.forEach(i=>{t.push(i.x,i.y)}),this.currentShape=new pt.default.Line({points:t,stroke:this.selectedClass.colorCode,strokeWidth:2,lineCap:"round",lineJoin:"round",closed:!1}),this.annotationLayer.add(this.currentShape),this.annotationLayer.batchDraw()}completePolyline(){if(this.polylinePoints.length<2||!this.selectedClass)return;let t={id:0,label:this.selectedClass.className,type:ht.Polyline,color:this.selectedClass.colorCode,x:0,y:0,width:0,height:0,points:[...this.polylinePoints],classId:this.selectedClass.id,className:this.selectedClass.className};this.annotationCreated.emit(t),this.currentShape&&(this.currentShape.destroy(),this.currentShape=null),this.polylinePoints=[],this.annotationLayer?.batchDraw()}startPan(t){this.isPanning=!0;let i=this.stage?.getPointerPosition();i&&(this.lastPanPosition={x:i.x,y:i.y})}handlePan(t){if(!this.stage||!this.lastPanPosition)return;let i=this.stage.getPointerPosition();if(!i)return;let n=i.x-this.lastPanPosition.x,a=i.y-this.lastPanPosition.y;this.stage.x(this.stage.x()+n),this.stage.y(this.stage.y()+a),this.lastPanPosition={x:i.x,y:i.y},this.stage.batchDraw()}endPan(){this.isPanning=!1,this.lastPanPosition=null}handleMouseWheel(t){if(!this.stage)return;let i=this.stage.scaleX(),n=this.stage.getPointerPosition();if(!n)return;let a=1.05,r=(t.evt.deltaY>0?-1:1)>0?i*a:i/a;r=Math.max(.1,Math.min(3,r));let l={x:(n.x-this.stage.x())/i,y:(n.y-this.stage.y())/i};this.stage.scale({x:r,y:r});let c={x:n.x-l.x*r,y:n.y-l.y*r};this.stage.position(c),this.stage.batchDraw(),this.renderAnnotations(),this.zoomLevelChanged.emit(r)}highlightSelectedAnnotation(){}applyZoom(){if(!this.stage)return;let t=this.stage.width()/2,i=this.stage.height()/2,n=this.stage.scaleX(),a={x:(t-this.stage.x())/n,y:(i-this.stage.y())/n};this.stage.scale({x:this.zoomLevel,y:this.zoomLevel});let s={x:t-a.x*this.zoomLevel,y:i-a.y*this.zoomLevel};this.stage.position(s),this.stage.batchDraw(),this.renderAnnotations()}toggleAnnotationsVisibility(){this.annotationLayer&&(this.annotationLayer.visible(!this.hideAnnotations),this.annotationLayer.batchDraw())}editAnnotationLabel(t,i,n){i.hide(),n.hide();let a=i.getAbsolutePosition(),s=this.stage.container().getBoundingClientRect(),r=document.createElement("input");r.type="text",r.value=t.label,r.style.position="absolute",r.style.top=s.top+a.y+"px",r.style.left=s.left+a.x+"px",r.style.width=i.width()+"px",r.style.fontSize="14px",r.style.border="2px solid "+t.color,r.style.padding="4px",r.style.margin="0px",r.style.overflow="hidden",r.style.background="white",r.style.outline="none",r.style.resize="none",r.style.lineHeight=i.lineHeight().toString(),r.style.fontFamily=i.fontFamily(),r.style.transformOrigin="left top",r.style.textAlign=i.align(),r.style.color=t.color;let l=i.rotation(),c="";l&&(c+="rotateZ("+l+"deg)"),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(c+="translateY(-"+0+"px)"),r.style.transform=c,document.body.appendChild(r),r.focus(),r.select();let m=()=>{r.parentNode?.removeChild(r),i.show(),n.show(),this.annotationLayer?.batchDraw()},p=()=>{let f=r.value.trim();f&&f!==t.label&&(t.label=f,i.text(f),n.width(i.width()),this.annotationUpdated.emit(t)),m()};r.addEventListener("keydown",f=>{f.key==="Enter"?p():f.key==="Escape"&&m()}),r.addEventListener("blur",()=>{p()})}applyEnhanceSettings(){if(!this.konvaImage)return;this.konvaImage.cache(),this.konvaImage.filters([pt.default.Filters.Brighten,pt.default.Filters.Contrast]);let t=this.enhanceSettings.brightness/100;this.konvaImage.brightness(t),this.konvaImage.contrast(this.enhanceSettings.contrast),this.imageLayer?.batchDraw()}updateTransformerSizes(){this.renderAnnotations()}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=$({type:o,selectors:[["app-annotation-canvas"]],viewQuery:function(i,n){if(i&1&&Wt(qf,7),i&2){let a;Et(a=Lt())&&(n.canvasContainer=a.first)}},inputs:{image:"image",imageUrl:"imageUrl",annotations:"annotations",selectedAnnotation:"selectedAnnotation",selectedAnnotations:"selectedAnnotations",selectedClass:"selectedClass",activeTool:"activeTool",zoomLevel:"zoomLevel",isPanMode:"isPanMode",hideAnnotations:"hideAnnotations",enhanceSettings:"enhanceSettings",showLabels:"showLabels",showPredictions:"showPredictions",showLabelDetails:"showLabelDetails"},outputs:{annotationCreated:"annotationCreated",annotationUpdated:"annotationUpdated",annotationDeleted:"annotationDeleted",annotationSelected:"annotationSelected",zoomLevelChanged:"zoomLevelChanged"},standalone:!1,features:[qt],decls:2,vars:2,consts:[["canvasContainer",""],[1,"canvas-container"]],template:function(i,n){i&1&&tt(0,"div",1,0),i&2&&ot("pan-mode",n.isPanMode)},styles:[".canvas-container[_ngcontent-%COMP%]{width:100%;height:100%;min-height:400px;background-color:#f5f5f5;position:relative;overflow:hidden;cursor:crosshair;display:block}.canvas-container.pan-mode[_ngcontent-%COMP%]{cursor:grab}.canvas-container.pan-mode[_ngcontent-%COMP%]:active{cursor:grabbing}.canvas-container.zoom-mode[_ngcontent-%COMP%]{cursor:zoom-in}.canvas-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{display:block}"]})}}return o})();var Ve=Zi(Ki());var di=Zi(Ki());var Qi=(()=>{class o{constructor(){this.image=null,this.imageUrl=null,this.annotations=[],this.selectedAnnotation=null,this.selectedAnnotations=[],this.selectedClass=null,this.activeTool="none",this.zoomLevel=1,this.isPanMode=!1,this.hideAnnotations=!1,this.enhanceSettings={brightness:0,contrast:0},this.showLabels=!0,this.showPredictions=!0,this.showLabelDetails=!0,this.annotationCreated=new q,this.annotationUpdated=new q,this.annotationDeleted=new q,this.annotationSelected=new q,this.zoomLevelChanged=new q,this.stage=null,this.imageLayer=null,this.annotationLayer=null,this.konvaImage=null,this.htmlImage=null,this.imageScale=1,this.imageOffsetX=0,this.imageOffsetY=0,this.isPanning=!1,this.lastPanPosition=null,this._loadingImageUrl=null}onWindowResize(){this.resizeStage()}ngAfterViewInit(){setTimeout(()=>{this.initializeStage(),this.imageUrl&&this.image&&this.loadImage()},100)}ngOnChanges(t){t.imageUrl&&this.imageUrl&&this.image?this._loadingImageUrl!==this.imageUrl&&(this._loadingImageUrl=this.imageUrl,this.loadImage()):t.image&&this.image&&this.imageUrl&&!t.imageUrl&&this.loadImage(),t.annotations&&this.renderAnnotations(),t.selectedAnnotation&&this.highlightSelectedAnnotation(),t.selectedAnnotations&&this.highlightSelectedAnnotations(),t.zoomLevel&&this.applyZoom(),t.hideAnnotations&&this.toggleAnnotationsVisibility(),t.enhanceSettings&&this.applyEnhanceSettings(),(t.showLabels||t.showPredictions)&&(this.renderAnnotations(),this.highlightSelectedAnnotations()),t.showLabelDetails&&(this.renderAnnotations(),this.highlightSelectedAnnotations())}ngOnDestroy(){this.konvaImage&&(this.konvaImage.destroy(),this.konvaImage=null),this.htmlImage&&(this.htmlImage.onload=null,this.htmlImage.onerror=null,this.htmlImage.src="",this.htmlImage=null),this.stage&&(this.stage.destroy(),this.stage=null),this.imageLayer=null,this.annotationLayer=null}initializeStage(){let t=this.canvasContainer.nativeElement,i=t.clientWidth||800,n=t.clientHeight||600;this.stage&&this.stage.destroy(),this.stage=new di.default.Stage({container:t,width:i,height:n}),this.imageLayer=new di.default.Layer,this.annotationLayer=new di.default.Layer,this.stage.add(this.imageLayer),this.stage.add(this.annotationLayer),this.setupEventHandlers()}resizeStage(){if(!this.stage||!this.canvasContainer)return;let t=this.canvasContainer.nativeElement,i=t.clientWidth||800,n=t.clientHeight||600,a=this.stage.scaleX(),s=this.stage.position();this.stage.width(i),this.stage.height(n),this.stage.scale({x:a,y:a}),this.stage.position(s),this.stage.batchDraw(),this.updateTransformerSizes()}setupEventHandlers(){this.stage&&(this.stage.on("mousedown",t=>{this.isPanMode?this.startPan(t):this.handleMouseDown(t)}),this.stage.on("mousemove",t=>{this.isPanning?this.handlePan(t):this.handleMouseMove(t)}),this.stage.on("mouseup",t=>{this.isPanning?this.endPan():this.handleMouseUp(t)}),this.stage.on("wheel",t=>{t.evt.preventDefault(),this.handleMouseWheel(t)}),this.stage.on("click",t=>{t.target===this.stage&&this.annotationSelected.emit(null)}))}loadImage(){if(!this.image||!this.imageLayer){this.imageLayer||setTimeout(()=>{this.image&&this.imageLayer&&this.loadImage()},50);return}this.imageUrl&&(this.konvaImage&&(this.konvaImage.destroy(),this.konvaImage=null),this.htmlImage&&(this.htmlImage.onload=null,this.htmlImage.onerror=null,this.htmlImage.src="",this.htmlImage=null),this.stage&&(this.stage.position({x:0,y:0}),this.stage.scale({x:1,y:1})),this.htmlImage=new window.Image,this.htmlImage.crossOrigin="Anonymous",this.htmlImage.onload=()=>{if(!this.htmlImage||!this.imageLayer||!this.stage)return;this.konvaImage=new di.default.Image({image:this.htmlImage,x:0,y:0});let t=this.stage.width()/this.htmlImage.width,i=this.stage.height()/this.htmlImage.height,n=Math.min(t,i,1);this.imageScale=n,this.imageOffsetX=(this.stage.width()-this.htmlImage.width*n)/2,this.imageOffsetY=(this.stage.height()-this.htmlImage.height*n)/2,this.konvaImage.scale({x:n,y:n}),this.konvaImage.position({x:this.imageOffsetX,y:this.imageOffsetY}),this.imageLayer.add(this.konvaImage),this.imageLayer.batchDraw(),this.applyEnhanceSettings(),this.renderAnnotations()},this.htmlImage.onerror=t=>{console.error("Error loading image:",t)},this.htmlImage.src=this.imageUrl)}imageToCanvasCoords(t,i){return{x:t*this.imageScale+this.imageOffsetX,y:i*this.imageScale+this.imageOffsetY}}canvasToImageCoords(t,i){return{x:(t-this.imageOffsetX)/this.imageScale,y:(i-this.imageOffsetY)/this.imageScale}}scaleToCanvas(t){return t*this.imageScale}scaleToImage(t){return t/this.imageScale}getRelativePointerPosition(){if(!this.stage)return null;let t=this.stage.getAbsoluteTransform().copy();t.invert();let i=this.stage.getPointerPosition();return i?t.point(i):null}startPan(t){this.isPanning=!0;let i=this.stage?.getPointerPosition();i&&(this.lastPanPosition={x:i.x,y:i.y})}handlePan(t){if(!this.isPanning||!this.lastPanPosition||!this.stage)return;let i=this.stage.getPointerPosition();if(!i)return;let n=i.x-this.lastPanPosition.x,a=i.y-this.lastPanPosition.y,s=this.stage.position();this.stage.position({x:s.x+n,y:s.y+a}),this.lastPanPosition={x:i.x,y:i.y},this.stage.batchDraw()}endPan(){this.isPanning=!1,this.lastPanPosition=null}handleMouseWheel(t){if(!this.stage)return;let i=this.stage.scaleX(),n=this.stage.getPointerPosition();if(!n)return;let a=1.1,s=t.evt.deltaY<0?i*a:i/a;if(s<.1||s>10)return;let r={x:(n.x-this.stage.x())/i,y:(n.y-this.stage.y())/i};this.stage.scale({x:s,y:s});let l={x:n.x-r.x*s,y:n.y-r.y*s};this.stage.position(l),this.stage.batchDraw(),this.renderAnnotations(),this.highlightSelectedAnnotations(),this.zoomLevelChanged.emit(s)}getFilteredAnnotations(){let t=[];if(this.showLabels){let i=this.annotations.filter(n=>n.annotationType==="Ground Truth"||n.annotationType==="Ground truth");t=t.concat(i)}if(this.showPredictions){let i=this.annotations.filter(n=>n.annotationType==="Prediction");t=t.concat(i)}return t}highlightSelectedAnnotation(){}highlightSelectedAnnotations(){}applyZoom(){this.stage&&(this.stage.scale({x:this.zoomLevel,y:this.zoomLevel}),this.stage.batchDraw(),this.renderAnnotations(),this.highlightSelectedAnnotations())}updateTransformerSizes(){this.renderAnnotations(),this.highlightSelectedAnnotations()}toggleAnnotationsVisibility(){this.annotationLayer&&(this.annotationLayer.visible(!this.hideAnnotations),this.annotationLayer.batchDraw())}applyEnhanceSettings(){if(this.konvaImage){if(this.enhanceSettings.brightness===0&&this.enhanceSettings.contrast===0){this.konvaImage.clearCache(),this.konvaImage.filters([]),this.imageLayer?.batchDraw();return}this.konvaImage.cache(),this.konvaImage.filters([di.default.Filters.Brighten,di.default.Filters.Contrast]),this.konvaImage.brightness(this.enhanceSettings.brightness/100),this.konvaImage.contrast(this.enhanceSettings.contrast),this.imageLayer?.batchDraw()}}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275dir=pa({type:o,hostBindings:function(i,n){i&1&&T("resize",function(){return n.onWindowResize()},!1,Ds)},inputs:{image:"image",imageUrl:"imageUrl",annotations:"annotations",selectedAnnotation:"selectedAnnotation",selectedAnnotations:"selectedAnnotations",selectedClass:"selectedClass",activeTool:"activeTool",zoomLevel:"zoomLevel",isPanMode:"isPanMode",hideAnnotations:"hideAnnotations",enhanceSettings:"enhanceSettings",showLabels:"showLabels",showPredictions:"showPredictions",showLabelDetails:"showLabelDetails"},outputs:{annotationCreated:"annotationCreated",annotationUpdated:"annotationUpdated",annotationDeleted:"annotationDeleted",annotationSelected:"annotationSelected",zoomLevelChanged:"zoomLevelChanged"},features:[qt]})}}return o})();var Wf=["canvasContainer"],Nd=(()=>{class o extends Qi{constructor(){super(...arguments),this.isDrawing=!1,this.currentShape=null}setupEventHandlers(){super.setupEventHandlers(),this.stage&&this.stage.on("dblclick",t=>{let i=t.target;if(i&&i!==this.stage){let n=i.getAttr("annotation");n&&n.annotationType!=="Prediction"&&this.annotationDeleted.emit(n)}})}handleMouseDown(t){if(this.activeTool!=="boundingBox"||!this.selectedClass)return;let i=this.getRelativePointerPosition();if(!i||!this.annotationLayer)return;this.isDrawing=!0;let n=this.stage?.scaleX()||1;this.currentShape=new Ve.default.Rect({x:i.x,y:i.y,width:0,height:0,stroke:this.selectedClass.colorCode,strokeWidth:2/n,fill:this.selectedClass.colorCode+"20"}),this.annotationLayer.add(this.currentShape),this.annotationLayer.batchDraw()}handleMouseMove(t){if(!this.isDrawing||!this.currentShape)return;let i=this.getRelativePointerPosition();if(!i)return;let n=this.currentShape.x(),a=this.currentShape.y();this.currentShape.width(i.x-n),this.currentShape.height(i.y-a),this.annotationLayer?.batchDraw()}handleMouseUp(t){if(!this.isDrawing||!this.currentShape||!this.selectedClass){this.isDrawing=!1;return}let i=this.currentShape.width(),n=this.currentShape.height();if(Math.abs(i)<10||Math.abs(n)<10){this.currentShape.destroy(),this.annotationLayer?.batchDraw(),this.isDrawing=!1;return}let a=this.currentShape.x(),s=this.currentShape.y(),r=i,l=n;i<0&&(a=a+i,r=Math.abs(i)),n<0&&(s=s+n,l=Math.abs(n));let c=this.canvasToImageCoords(a,s),d={id:0,label:this.selectedClass.className,type:ht.Rectangle,color:this.selectedClass.colorCode,x:c.x,y:c.y,width:this.scaleToImage(r),height:this.scaleToImage(l),points:[],classId:this.selectedClass.id,className:this.selectedClass.className,annotationType:"Ground truth"};this.annotationCreated.emit(d),this.currentShape.destroy(),this.currentShape=null,this.isDrawing=!1,this.annotationLayer?.batchDraw()}renderAnnotations(){this.annotationLayer&&(this.annotationLayer.destroyChildren(),this.getFilteredAnnotations().forEach(t=>{t.type===ht.Rectangle&&this.renderRectangle(t)}),this.annotationLayer.batchDraw())}highlightSelectedAnnotation(){if(!this.annotationLayer||!this.stage)return;let t=this.stage.scaleX(),i=10,n=1,a=i/t;this.annotationLayer.children.forEach(s=>{if(s instanceof Ve.default.Group){let r=s.findOne("Transformer"),l=s.findOne("Rect"),c=s.getAttr("annotation");if(c){let d=this.selectedAnnotation?.id===c.id,h=c.annotationType==="Prediction";if(r&&!h&&(r.visible(d),d&&(r.anchorSize(a),r.anchorStrokeWidth(0),r.borderStrokeWidth(n/t),r.anchorCornerRadius(a/4),r.find(".top-left, .top-center, .top-right, .middle-left, .middle-right, .bottom-left, .bottom-center, .bottom-right").forEach(f=>{f.visible(!1)}),r.forceUpdate())),l){let f=d?3:2;l.strokeWidth(f/t)}let m=s.findOne(".labelBg"),p=s.findOne(".labelText");m&&m.visible(this.showLabelDetails||d),p&&p.visible(this.showLabelDetails||d)}}}),this.annotationLayer.batchDraw()}highlightSelectedAnnotations(){if(!this.annotationLayer||!this.stage)return;let t=this.selectedAnnotations.map(r=>r.id),i=this.stage.scaleX(),n=10,a=1,s=n/i;this.annotationLayer.children.forEach(r=>{if(r instanceof Ve.default.Group){let l=r.findOne("Transformer"),c=r.findOne("Rect"),d=r.getAttr("annotation");if(d){let h=t.includes(d.id),m=d.annotationType==="Prediction";if(l&&!m&&(l.visible(h),h&&(l.anchorSize(s),l.anchorStrokeWidth(0),l.borderStrokeWidth(a/i),l.anchorCornerRadius(s/4),l.find(".top-left, .top-center, .top-right, .middle-left, .middle-right, .bottom-left, .bottom-center, .bottom-right").forEach(b=>{b.visible(!1)}),l.forceUpdate())),c){let b=h?3:2;if(c.strokeWidth(b/i),!m){let C=8/i,M=4/i;c.dash(h?[C,M]:[])}c.shadowEnabled(h),h&&(c.shadowColor("#ffffff"),c.shadowBlur(10/i),c.shadowOpacity(.8))}let p=r.findOne(".labelBg"),f=r.findOne(".labelText");p&&p.visible(this.showLabelDetails||h),f&&f.visible(this.showLabelDetails||h)}}}),this.annotationLayer.batchDraw()}updateTransformerSizes(){this.renderAnnotations(),this.highlightSelectedAnnotations()}renderRectangle(t){if(!this.annotationLayer)return;let i=this.imageToCanvasCoords(t.x,t.y),n=this.scaleToCanvas(t.width),a=this.scaleToCanvas(t.height),s=t.annotationType==="Prediction",r=new Ve.default.Group({draggable:!s,dragBoundFunc:s?void 0:O=>{let E=this.getImageBoundsInCanvas(),A=p.scaleX(),D=p.scaleY(),H=p.width()*A,nt=p.height()*D,B=this.stage?.scaleX()||1,X=this.stage?.position()||{x:0,y:0},F=(O.x-X.x)/B,j=(O.y-X.y)/B,st=E.x-p.x(),rt=E.x+E.width-H-p.x(),ut=E.y-p.y(),zt=E.y+E.height-nt-p.y(),Q=Math.max(st,Math.min(rt,F)),ct=Math.max(ut,Math.min(zt,j));return{x:Q*B+X.x,y:ct*B+X.y}}}),l=this.stage?.scaleX()||1,d=2/l,h=8/l,m=4/l,p=new Ve.default.Rect({x:i.x,y:i.y,width:n,height:a,stroke:t.color,strokeWidth:d,fill:t.color+"20",dash:s?[h,m]:[],dashEnabled:s}),f=t.label||t.className||"Unlabeled";s&&t.confidenceRate!==void 0&&(f+=` (${t.confidenceRate})`);let b=new Ve.default.Text({text:f,fontSize:14,fontFamily:"Arial",fill:"#ffffff",padding:4}),C,M;s?(C=i.x+n-b.width(),M=i.y+a+2):(C=i.x,M=i.y-b.height()-2),b.x(C),b.y(M);let w=new Ve.default.Rect({x:C,y:M,width:b.width(),height:b.height(),fill:t.color,opacity:.9,cornerRadius:3});r.add(p);let P=this.selectedAnnotation?.id===t.id||this.selectedAnnotations.some(O=>O.id===t.id);if(w.name("labelBg"),b.name("labelText"),w.visible(this.showLabelDetails||P),b.visible(this.showLabelDetails||P),r.add(w),r.add(b),s)r.on("click",()=>{this.annotationSelected.emit(t)});else{let O=this.stage?.scaleX()||1,E=10,A=1,D=E/O,H=A/O,nt=A/O,B=new Ve.default.Transformer({nodes:[p],enabledAnchors:["top-left","top-right","bottom-left","bottom-right","top-center","middle-right","middle-left","bottom-center"],rotateEnabled:!1,anchorSize:D,anchorStrokeWidth:0,borderStrokeWidth:nt,anchorFill:"transparent",anchorStroke:"transparent",borderStroke:"#1890ff",anchorCornerRadius:D/4,ignoreStroke:!0,boundBoxFunc:(F,j)=>{if(j.width<10||j.height<10)return F;let st=this.getImageBoundsInCanvas(),rt=r.position(),ut=j.x+rt.x,zt=j.y+rt.y;return ut<st.x||zt<st.y||ut+j.width>st.x+st.width||zt+j.height>st.y+st.height?F:j}}),X=this.selectedAnnotation?.id===t.id||this.selectedAnnotations.some(F=>F.id===t.id);B.visible(X),B.find(".top-left, .top-center, .top-right, .middle-left, .middle-right, .bottom-left, .bottom-center, .bottom-right").forEach(F=>{F.visible(!1)}),r.add(B),p.on("mouseenter",()=>{this.isPanMode||this.isDrawing||this.annotationLayer?.batchDraw()}),p.on("mouseleave",()=>{let F=r.findOne("Transformer");F&&(F.find(".top-left, .top-center, .top-right, .middle-left, .middle-right, .bottom-left, .bottom-center, .bottom-right").forEach(j=>{j.visible(!1)}),this.annotationLayer?.batchDraw())}),r.on("click",()=>{B.visible(!0),this.annotationLayer?.batchDraw(),this.annotationSelected.emit(t)}),r.on("dragend",()=>{let F=r.position(),j=p.x()+F.x,st=p.y()+F.y,rt=this.canvasToImageCoords(j,st);t.x=rt.x,t.y=rt.y,p.x(j),p.y(st);let ut=j,zt=st-b.height()-2;b.x(ut),b.y(zt),w.x(ut),w.y(zt),r.position({x:0,y:0}),this.annotationLayer?.batchDraw(),this.annotationUpdated.emit(t)}),p.on("transformend",()=>{let F=r.position(),j=p.scaleX(),st=p.scaleY(),rt=p.x()+F.x,ut=p.y()+F.y,zt=p.width()*j,Q=p.height()*st,ct=this.canvasToImageCoords(rt,ut);t.x=ct.x,t.y=ct.y,t.width=this.scaleToImage(zt),t.height=this.scaleToImage(Q),p.x(rt),p.y(ut),p.width(zt),p.height(Q),p.scaleX(1),p.scaleY(1);let Rt=rt,Gt=ut-b.height()-2;b.x(Rt),b.y(Gt),w.x(Rt),w.y(Gt),r.position({x:0,y:0}),this.annotationLayer?.batchDraw(),this.annotationUpdated.emit(t)})}r.setAttr("annotation",t),this.annotationLayer.add(r)}getImageBoundsInCanvas(){return this.htmlImage?{x:this.imageOffsetX,y:this.imageOffsetY,width:this.htmlImage.width*this.imageScale,height:this.htmlImage.height*this.imageScale}:{x:0,y:0,width:0,height:0}}getImageBoundsInStageCoords(){if(!this.htmlImage||!this.stage)return{x:0,y:0,width:0,height:0};let t=this.stage.scaleX(),i=this.stage.position();return{x:this.imageOffsetX*t+i.x,y:this.imageOffsetY*t+i.y,width:this.htmlImage.width*this.imageScale*t,height:this.htmlImage.height*this.imageScale*t}}static{this.\u0275fac=(()=>{let t;return function(n){return(t||(t=le(o)))(n||o)}})()}static{this.\u0275cmp=$({type:o,selectors:[["app-object-detection-canvas"]],viewQuery:function(i,n){if(i&1&&Wt(Wf,7),i&2){let a;Et(a=Lt())&&(n.canvasContainer=a.first)}},standalone:!1,features:[Zt],decls:2,vars:2,consts:[["canvasContainer",""],[1,"canvas-container"]],template:function(i,n){i&1&&tt(0,"div",1,0),i&2&&ot("pan-mode",n.isPanMode)},styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}.canvas-container[_ngcontent-%COMP%]{width:100%;height:100%;min-height:400px;background-color:#f5f5f5;position:relative;overflow:hidden;cursor:crosshair;display:block}.canvas-container.pan-mode[_ngcontent-%COMP%]{cursor:grab}.canvas-container.pan-mode[_ngcontent-%COMP%]:active{cursor:grabbing}.canvas-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{display:block}"]})}}return o})();var se=Zi(Ki());var Yf=["canvasContainer"],Bd=(()=>{class o extends Qi{constructor(){super(...arguments),this.isDrawing=!1,this.currentShape=null,this.polygonPoints=[],this.brushPoints=[],this.polylinePoints=[]}setupEventHandlers(){super.setupEventHandlers(),this.stage&&this.stage.on("dblclick",()=>{this.activeTool==="polygon"&&this.polygonPoints.length>=3?this.completePolygon():this.activeTool==="polyline"&&this.polylinePoints.length>=2&&this.completePolyline()})}handleMouseDown(t){if(!this.selectedClass)return;let i=this.getRelativePointerPosition();if(i)switch(this.activeTool){case"polygon":this.addPolygonPoint(i);break;case"brush":this.startBrush(i);break;case"polyline":this.addPolylinePoint(i);break}}handleMouseMove(t){if(!this.isDrawing)return;let i=this.getRelativePointerPosition();i&&this.activeTool==="brush"&&this.updateBrush(i)}handleMouseUp(t){this.activeTool==="brush"&&this.isDrawing&&this.completeBrush()}renderAnnotations(){this.annotationLayer&&(this.annotationLayer.destroyChildren(),this.getFilteredAnnotations().forEach(t=>{switch(t.type){case ht.Polygon:this.renderPolygon(t);break;case ht.Brush:this.renderBrush(t);break;case ht.Polyline:this.renderPolyline(t);break}}),this.annotationLayer.batchDraw())}addPolygonPoint(t){this.polygonPoints.push({x:t.x,y:t.y}),this.drawTemporaryPolygon()}drawTemporaryPolygon(){if(!this.annotationLayer||!this.selectedClass||(this.currentShape&&this.currentShape.destroy(),this.polygonPoints.length<2))return;let t=[];this.polygonPoints.forEach(i=>{t.push(i.x,i.y)}),this.currentShape=new se.default.Line({points:t,stroke:this.selectedClass.colorCode,strokeWidth:2,fill:this.selectedClass.colorCode+"20",closed:!1}),this.annotationLayer.add(this.currentShape),this.annotationLayer.batchDraw()}completePolygon(){if(this.polygonPoints.length<3||!this.selectedClass)return;let t=this.polygonPoints.map(n=>this.canvasToImageCoords(n.x,n.y)),i={id:0,label:this.selectedClass.className,type:ht.Polygon,color:this.selectedClass.colorCode,x:0,y:0,width:0,height:0,points:t,classId:this.selectedClass.id,className:this.selectedClass.className,annotationType:"Ground truth"};this.annotationCreated.emit(i),this.currentShape&&(this.currentShape.destroy(),this.currentShape=null),this.polygonPoints=[],this.annotationLayer?.batchDraw()}startBrush(t){!this.annotationLayer||!this.selectedClass||(this.isDrawing=!0,this.brushPoints=[{x:t.x,y:t.y}],this.currentShape=new se.default.Line({points:[t.x,t.y],stroke:this.selectedClass.colorCode,strokeWidth:5,lineCap:"round",lineJoin:"round"}),this.annotationLayer.add(this.currentShape))}updateBrush(t){if(!this.currentShape||!(this.currentShape instanceof se.default.Line))return;this.brushPoints.push({x:t.x,y:t.y});let i=[];this.brushPoints.forEach(n=>{i.push(n.x,n.y)}),this.currentShape.points(i),this.annotationLayer?.batchDraw()}completeBrush(){if(this.brushPoints.length<2||!this.selectedClass){this.currentShape&&(this.currentShape.destroy(),this.currentShape=null),this.isDrawing=!1;return}let t=this.brushPoints.map(n=>this.canvasToImageCoords(n.x,n.y)),i={id:0,label:this.selectedClass.className,type:ht.Brush,color:this.selectedClass.colorCode,x:0,y:0,width:0,height:0,points:t,classId:this.selectedClass.id,className:this.selectedClass.className,annotationType:"Ground truth"};this.annotationCreated.emit(i),this.currentShape&&(this.currentShape.destroy(),this.currentShape=null),this.brushPoints=[],this.isDrawing=!1,this.annotationLayer?.batchDraw()}addPolylinePoint(t){this.polylinePoints.push({x:t.x,y:t.y}),this.drawTemporaryPolyline()}drawTemporaryPolyline(){if(!this.annotationLayer||!this.selectedClass||(this.currentShape&&this.currentShape.destroy(),this.polylinePoints.length<2))return;let t=[];this.polylinePoints.forEach(i=>{t.push(i.x,i.y)}),this.currentShape=new se.default.Line({points:t,stroke:this.selectedClass.colorCode,strokeWidth:2,lineCap:"round",lineJoin:"round"}),this.annotationLayer.add(this.currentShape),this.annotationLayer.batchDraw()}completePolyline(){if(this.polylinePoints.length<2||!this.selectedClass)return;let t=this.polylinePoints.map(n=>this.canvasToImageCoords(n.x,n.y)),i={id:0,label:this.selectedClass.className,type:ht.Polyline,color:this.selectedClass.colorCode,x:0,y:0,width:0,height:0,points:t,classId:this.selectedClass.id,className:this.selectedClass.className,annotationType:"Ground truth"};this.annotationCreated.emit(i),this.currentShape&&(this.currentShape.destroy(),this.currentShape=null),this.polylinePoints=[],this.annotationLayer?.batchDraw()}renderPolygon(t){if(!this.annotationLayer)return;let i=new se.default.Group({draggable:!0}),n=[];t.points.forEach(m=>{let p=this.imageToCanvasCoords(m.x,m.y);n.push(p.x,p.y)});let a=new se.default.Line({points:n,stroke:t.color,strokeWidth:2,fill:t.color+"20",closed:!0});i.add(a);let s=a.getClientRect(),r=s.x+s.width/2-30,l=s.y-22,c=new se.default.Text({x:r,y:l,text:t.label||t.className||"Unlabeled",fontSize:14,fontFamily:"Arial",fill:"#ffffff",padding:4}),d=new se.default.Rect({x:r,y:l,width:c.width(),height:c.height(),fill:t.color,opacity:.9,cornerRadius:3});i.add(d),i.add(c);let h=[];t.points.forEach((m,p)=>{let f=this.imageToCanvasCoords(m.x,m.y),b=new se.default.Circle({x:f.x,y:f.y,radius:5,fill:t.color,stroke:"#ffffff",strokeWidth:2,draggable:!0,visible:!1});b.on("dragmove",()=>{let C=[...n];C[p*2]=b.x(),C[p*2+1]=b.y(),a.points(C),this.annotationLayer?.batchDraw()}),b.on("dragend",()=>{let C=[],M=a.points();for(let w=0;w<M.length;w+=2){let P=this.canvasToImageCoords(M[w],M[w+1]);C.push(P)}t.points=C,this.annotationUpdated.emit(t)}),h.push(b),i.add(b)}),i.setAttr("annotation",t),i.on("click",()=>{h.forEach(m=>m.visible(!0)),this.annotationLayer?.batchDraw(),this.annotationSelected.emit(t)}),i.on("dragend",()=>{let m=i.x(),p=i.y(),f=this.scaleToImage(m),b=this.scaleToImage(p),C=t.points.map(w=>({x:w.x+f,y:w.y+b}));t.points=C;let M=[];C.forEach(w=>{let P=this.imageToCanvasCoords(w.x,w.y);M.push(P.x,P.y)}),a.points(M),h.forEach((w,P)=>{let O=this.imageToCanvasCoords(C[P].x,C[P].y);w.x(O.x),w.y(O.y)}),i.position({x:0,y:0}),this.annotationUpdated.emit(t)}),this.annotationLayer.add(i)}renderBrush(t){if(!this.annotationLayer)return;let i=[];t.points.forEach(a=>{let s=this.imageToCanvasCoords(a.x,a.y);i.push(s.x,s.y)});let n=new se.default.Line({points:i,stroke:t.color,strokeWidth:5,lineCap:"round",lineJoin:"round",draggable:!0});n.setAttr("annotation",t),n.on("click",()=>{this.annotationSelected.emit(t)}),n.on("dragend",()=>{let a=n.x(),s=n.y(),r=this.scaleToImage(a),l=this.scaleToImage(s),c=t.points.map(d=>({x:d.x+r,y:d.y+l}));t.points=c,n.position({x:0,y:0}),this.annotationUpdated.emit(t)}),this.annotationLayer.add(n)}renderPolyline(t){if(!this.annotationLayer)return;let i=[];t.points.forEach(a=>{let s=this.imageToCanvasCoords(a.x,a.y);i.push(s.x,s.y)});let n=new se.default.Line({points:i,stroke:t.color,strokeWidth:2,lineCap:"round",lineJoin:"round",draggable:!0});n.setAttr("annotation",t),n.on("click",()=>{this.annotationSelected.emit(t)}),n.on("dragend",()=>{let a=n.x(),s=n.y(),r=this.scaleToImage(a),l=this.scaleToImage(s),c=t.points.map(d=>({x:d.x+r,y:d.y+l}));t.points=c,n.position({x:0,y:0}),this.annotationUpdated.emit(t)}),this.annotationLayer.add(n)}static{this.\u0275fac=(()=>{let t;return function(n){return(t||(t=le(o)))(n||o)}})()}static{this.\u0275cmp=$({type:o,selectors:[["app-segmentation-canvas"]],viewQuery:function(i,n){if(i&1&&Wt(Yf,7),i&2){let a;Et(a=Lt())&&(n.canvasContainer=a.first)}},standalone:!1,features:[Zt],decls:2,vars:2,consts:[["canvasContainer",""],[1,"canvas-container"]],template:function(i,n){i&1&&tt(0,"div",1,0),i&2&&ot("pan-mode",n.isPanMode)},styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}.canvas-container[_ngcontent-%COMP%]{width:100%;height:100%;min-height:400px;background-color:#f5f5f5;position:relative;overflow:hidden;cursor:crosshair;display:block}.canvas-container.pan-mode[_ngcontent-%COMP%]{cursor:grab}.canvas-container.pan-mode[_ngcontent-%COMP%]:active{cursor:grabbing}.canvas-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{display:block}"]})}}return o})();var Ps=Zi(Ki());var Xf=["canvasContainer"],Vd=(()=>{class o extends Qi{handleMouseDown(t){}handleMouseMove(t){}handleMouseUp(t){}renderAnnotations(){this.annotationLayer&&(this.annotationLayer.destroyChildren(),this.annotationLayer.batchDraw())}setupEventHandlers(){super.setupEventHandlers(),this.canvasContainer&&(this.canvasContainer.nativeElement.style.cursor="default")}renderClassificationLabel(t){if(!this.annotationLayer||!this.stage)return;let i=new Ps.default.Text({x:10,y:10,text:`Class: ${t.className||t.label||"Unlabeled"}`,fontSize:18,fontFamily:"Arial",fill:"#ffffff",padding:8}),n=new Ps.default.Rect({x:10,y:10,width:i.width(),height:i.height(),fill:t.color||"#2196F3",opacity:.9,cornerRadius:5});n.setAttr("annotation",t),i.setAttr("annotation",t),this.annotationLayer.add(n),this.annotationLayer.add(i)}static{this.\u0275fac=(()=>{let t;return function(n){return(t||(t=le(o)))(n||o)}})()}static{this.\u0275cmp=$({type:o,selectors:[["app-classification-canvas"]],viewQuery:function(i,n){if(i&1&&Wt(Xf,7),i&2){let a;Et(a=Lt())&&(n.canvasContainer=a.first)}},standalone:!1,features:[Zt],decls:2,vars:2,consts:[["canvasContainer",""],[1,"canvas-container","classification-mode"]],template:function(i,n){i&1&&tt(0,"div",1,0),i&2&&ot("pan-mode",n.isPanMode)},styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}.canvas-container[_ngcontent-%COMP%]{width:100%;height:100%;min-height:400px;background-color:#f5f5f5;position:relative;overflow:hidden;display:block}.canvas-container.classification-mode[_ngcontent-%COMP%]{cursor:default}.canvas-container.pan-mode[_ngcontent-%COMP%]{cursor:grab}.canvas-container.pan-mode[_ngcontent-%COMP%]:active{cursor:grabbing}.canvas-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{display:block}"]})}}return o})();var $f=[{path:":projectId/:imageId",component:ya}],qC=(()=>{class o{static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275mod=ui({type:o})}static{this.\u0275inj=pi({imports:[qs,br,Pr.forChild($f),Dr,nr,gr,mr,Qr,Zr,Ar,Er,Ir,vr,yr,Hr,qr,lr,dr,zr,Yr,cr,Gr,Rr,rr,xr]})}}return o})();Ns(ya,function(){return[kt,St,Gs,Us,js,te,vi,Dt,va,Kr,Vn,ee,Ti,Ii,Ai,ue,il,nl,al,ll,hl,ml,pl,Rd,Nd,Bd,Vd]},[]);export{qC as LabellingModule};
