import{a as b,b as we}from"./chunk-WTJO3YM5.js";import{b as ui}from"./chunk-AEZOZC6Z.js";import{b as He,c as qe,d as Xt}from"./chunk-PRQOG5TK.js";import{b as Xe}from"./chunk-VB7LVLZV.js";import{$b as fi,$c as Mi,C as si,F as li,J as Qe,Qb as Je,Sb as ve,Tb as lt,Ub as ci,Yc as mt,Zc as fe,_c as _i,a as Ut,ad as Te,b as Z,bd as E,c as Ot,cd as yi,d as Yt,dd as ct,e as jt,ed as dt,f as B,fd as pt,g as Ht,gd as bi,hd as vi,i as ee,id as xi,j as je,jd as Ei,l as oe,m as re,mc as Si,n as Gt,o as ge,od as Di,p as se,pd as Ti,q as Qt,r as $e,rd as ut,sd as wi}from"./chunk-BAOJ77MB.js";import{$a as w,Aa as p,Ae as ii,Bb as A,Cb as ue,Da as F,Db as Ve,Df as Ee,Ea as Lt,Eb as Ue,Ee as G,Fc as x,Fe as be,Ff as di,Ga as Pt,Ge,Gf as De,Ha as U,Hf as pi,Ia as d,Ie as We,If as hi,Ka as c,Kf as Ci,Le as W,Mf as gi,Ob as O,Oe as ni,Pb as N,Pd as j,Pe as $,Qe as ai,Rd as ie,Td as Ce,U as kt,V as It,Va as o,Vb as Oe,Ve as oi,Wa as a,Wd as ne,X as vt,Xa as C,Xb as Ye,Xd as ae,Ya as M,Yd as zt,Za as y,_d as Wt,ac as Bt,ae as Se,bb as h,be as $t,ca as S,cb as v,ce as I,cf as de,da as _,de as Jt,df as ri,fb as Vt,ga as At,ge as H,hf as Ke,ib as L,ie as q,if as Ze,jb as P,jf as et,kb as V,kc as Rt,kf as tt,lb as Re,le as z,lf as it,mb as s,me as le,mf as nt,ne as Kt,nf as at,o as D,ob as f,od as te,oe as Zt,of as ot,pe as ze,pf as rt,qb as Nt,qe as me,qf as st,rf as mi,se as ei,sf as pe,tb as J,td as Y,te as _e,ub as X,ue as Me,vb as K,vd as he,wa as m,we as ce,xd as qt,yb as Pe,ye,yf as xe,zc as k,ze as ti}from"./chunk-NJA2VFCC.js";import{a as wt,b as Ft}from"./chunk-TSRGIXR5.js";var ft=(()=>{class t{constructor(e,n){this.http=e,this.configuration=n,this.api=n.ServerWithApiUrl+"location"}saveLocation(e){return D(this.http.post(this.api+"/create",e))}deleteLocation(e){return D(this.http.delete(this.api+"/"+e))}saveManufacturerCode(e){return D(this.http.post(this.api+"/saveManufacturerCode",e))}deleteManufacturerCode(e){return D(this.http.delete(`${this.api}/deleteManufacturerCode/${e}`))}static{this.\u0275fac=function(n){return new(n||t)(vt(Rt),vt(jt))}}static{this.\u0275prov=kt({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Yi(t,r){t&1&&(o(0,"mat-error"),s(1," This field is "),o(2,"strong"),s(3,"required"),a()())}function ji(t,r){if(t&1&&(o(0,"mat-option",19),s(1),a()),t&2){let e=r.$implicit;c("value",e),m(),f(" ",e," ")}}function Hi(t,r){t&1&&(o(0,"mat-error"),s(1," This field is "),o(2,"strong"),s(3,"required"),a()())}function qi(t,r){t&1&&(o(0,"mat-error"),s(1," This field is "),o(2,"strong"),s(3,"required"),a()())}var St=(()=>{class t extends we{constructor(e,n,i,l,u,g,T){super(e,n,i,l),this.formBuilder=u,this.confirmDialogService=g,this.locationMaintenance=T,this.selectedLocation=new Ut,this.sapPlantCodes=[],this.store.dispatch(si()),this.store.select(li).subscribe(bt=>this.sapPlantCodes=bt)}ngOnInit(){this.fillForm()}create(){this.assignValuesToSite(),this.save()}delete(){this.selectedLocation.id&&(this.isLoading=!0,this.locationMaintenance.deleteLocation(this.selectedLocation.id).then(e=>this.saveConfirm("is successfully deleted")).catch(e=>this.saveFailed(e)).finally(()=>this.isLoading=!1))}update(){this.assignValuesToSite(),this.save()}fillForm(){this.inputForm=this.formBuilder.group({acronym:["",q.required],planningEngine:[""],country:[""],city:[""],sapCode:[""],extendedSuffix:[""],tmdbCode:[""],menuGrouping:[""],isSubContractor:[!1,q.required],vendorCode:[""]}),this.inputForm.get("isSubContractor")?.valueChanges.subscribe(e=>{this.configureVendorCodeInputField(e)}),this.crudAction===b.UPDATE?this.setValuesToExistingLocation():this.crudAction==b.DELETE&&(this.setValuesToExistingLocation(),this.inputForm.controls.acronym.disable(),this.inputForm.controls.tmdbCode.disable(),this.inputForm.controls.city.disable(),this.inputForm.controls.sapCode.disable(),this.inputForm.controls.planningEngine.disable(),this.inputForm.controls.country.disable(),this.inputForm.controls.extendedSuffix.disable(),this.inputForm.controls.menuGrouping.disable(),this.inputForm.controls.isSubContractor.disable(),this.inputForm.controls.vendorCode.disable())}handleSubConSelectionChange(e){if(e.value){let i=this.confirmDialogService.openDialog("Warning!","You are about to create a Subcon site. Capacity will be handled differently. Are you sure you want to create a <strong>Subcon Site</strong>?");D(i.afterClosed()).then(l=>{this.inputForm.controls.isSubContractor.setValue(l)})}}submit(){switch(this.crudAction){case b.CREATE:this.inputForm.valid&&this.create();break;case b.DELETE:this.delete();break;case b.UPDATE:this.inputForm.valid&&this.update();break}}isConditionalRequiredForVendorCode(){return!!(this.inputForm.get("isSubContractor")&&this.inputForm.get("vendorCode")?.hasError("required"))}save(){this.isLoading=!0,this.locationMaintenance.saveLocation(this.selectedLocation).then(e=>this.saveConfirm("is successfully saved")).catch(e=>this.saveFailed(e)).finally(()=>this.isLoading=!1)}saveConfirm(e){x.displaySuccessMsg(this.snackBar,`Location ${this.selectedLocation.acronym} ${e}`),this.closeDialog()}saveFailed(e){x.displayServerErrorMsg(this.snackBar,e.error)}configureVendorCodeInputField(e){e?(this.inputForm.controls.vendorCode.enable(),this.inputForm.controls.vendorCode.setValidators(q.required)):(this.inputForm.controls.vendorCode.setValue(null),this.inputForm.controls.vendorCode.disable(),this.inputForm.controls.vendorCode.setValidators(null)),this.inputForm.controls.vendorCode.updateValueAndValidity()}assignValuesToSite(){this.selectedLocation.acronym=this.inputForm.get("acronym")?.value?.trim(),this.selectedLocation.tmdbCode=this.inputForm.get("tmdbCode")?.value?.trim(),this.selectedLocation.city=this.inputForm.get("city")?.value?.trim(),this.selectedLocation.sapCode=this.inputForm.get("sapCode")?.value,this.selectedLocation.planningEngine=this.inputForm.get("planningEngine")?.value,this.selectedLocation.country=this.inputForm.get("country")?.value?.trim(),this.selectedLocation.extendedSuffix=this.inputForm.get("extendedSuffix")?.value?.trim(),this.selectedLocation.menuGrouping=this.inputForm.get("menuGrouping")?.value?.trim().toUpperCase(),this.selectedLocation.isSubContractor=this.inputForm.get("isSubContractor")?.value,this.selectedLocation.vendorCode=this.inputForm.get("vendorCode")?.value}setValuesToExistingLocation(){this.inputForm.controls.acronym.setValue(this.selectedLocation.acronym),this.inputForm.controls.tmdbCode.setValue(this.selectedLocation.tmdbCode),this.inputForm.controls.city.setValue(this.selectedLocation.city),this.inputForm.controls.sapCode.setValue(this.selectedLocation.sapCode),this.inputForm.controls.planningEngine.setValue(this.selectedLocation.planningEngine),this.inputForm.controls.country.setValue(this.selectedLocation.country),this.inputForm.controls.extendedSuffix.setValue(this.selectedLocation.extendedSuffix),this.inputForm.controls.menuGrouping.setValue(this.selectedLocation.menuGrouping?.toUpperCase()),this.inputForm.controls.isSubContractor.setValue(this.selectedLocation.isSubContractor),this.inputForm.controls.isSubContractor.disable(),this.inputForm.controls.vendorCode.setValue(this.selectedLocation.vendorCode),this.selectedLocation.isSubContractor?this.inputForm.controls.vendorCode.setValidators(q.required):this.inputForm.controls.vendorCode.disable()}static{this.\u0275fac=function(n){return new(n||t)(p(ie),p(B),p(j),p(k),p(ye),p(ui),p(ft))}}static{this.\u0275cmp=F({type:t,selectors:[["app-location-crud"]],inputs:{selectedLocation:"selectedLocation"},standalone:!1,features:[U],decls:69,vars:10,consts:[["crudForm",""],["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane"],["cdkDragHandle","","color","primary",1,"justify-between"],[1,"text-lg"],["mat-icon-button","",1,"ml-2",3,"click"],[1,"grid","grid-cols-3","gap-4",3,"formGroup"],["formControlName","acronym","matInput","","required",""],[4,"ngIf"],["formControlName","tmdbCode","matInput",""],["formControlName","city","matInput",""],["formControlName","country","matInput",""],["formControlName","sapCode"],[3,"value",4,"ngFor","ngForOf"],["formControlName","planningEngine"],["value","I2"],["value","TMDB"],["formControlName","extendedSuffix","matInput",""],["formControlName","menuGrouping","matInput",""],["formControlName","isSubContractor","required","",3,"selectionChange"],[3,"value"],["formControlName","vendorCode","matInput",""],["align","center"],["color","accent","mat-flat-button","","type","submit",1,"mr-2",3,"click","disabled"],["mat-stroked-button","",3,"click"]],template:function(n,i){if(n&1){let l=w();o(0,"div",1)(1,"mat-toolbar",2)(2,"h2",3),s(3),a(),o(4,"button",4),h("click",function(){return S(l),_(i.closeDialog())}),o(5,"mat-icon"),s(6,"close"),a()()(),o(7,"mat-dialog-content")(8,"form",5,0)(10,"mat-form-field")(11,"mat-label"),s(12,"Site"),a(),C(13,"input",6),d(14,Yi,4,0,"mat-error",7),a(),o(15,"mat-form-field")(16,"mat-label"),s(17,"TMDB Code"),a(),C(18,"input",8),a(),o(19,"mat-form-field")(20,"mat-label"),s(21,"City"),a(),C(22,"input",9),a(),o(23,"mat-form-field")(24,"mat-label"),s(25,"Country"),a(),C(26,"input",10),a(),o(27,"mat-form-field")(28,"mat-label"),s(29,"Plant Code"),a(),o(30,"mat-select",11),d(31,ji,2,2,"mat-option",12),a()(),o(32,"mat-form-field")(33,"mat-label"),s(34,"Planning Engine"),a(),o(35,"mat-select",13)(36,"mat-option",14),s(37,"JDA"),a(),o(38,"mat-option",15),s(39,"TMDB"),a(),o(40,"mat-option"),s(41,"NONE"),a()()(),o(42,"mat-form-field")(43,"mat-label"),s(44,"Extended Suffix"),a(),C(45,"input",16),a(),o(46,"mat-form-field")(47,"mat-label"),s(48,"Menu Grouping"),a(),C(49,"input",17),a(),o(50,"mat-form-field")(51,"mat-label"),s(52,"Subcon"),a(),o(53,"mat-select",18),h("selectionChange",function(g){return S(l),_(i.handleSubConSelectionChange(g))}),o(54,"mat-option",19),s(55,"Yes"),a(),o(56,"mat-option",19),s(57,"No"),a()(),d(58,Hi,4,0,"mat-error",7),a(),o(59,"mat-form-field")(60,"mat-label"),s(61,"Vendor Code"),a(),C(62,"input",20),d(63,qi,4,0,"mat-error",7),a()()(),o(64,"mat-dialog-actions",21)(65,"button",22),h("click",function(){return S(l),_(i.submit())}),s(66),a(),o(67,"button",23),h("click",function(){return S(l),_(i.closeDialog())}),s(68,"Close"),a()()()}if(n&2){let l,u;m(3),f("",i.crudActionToText()," Location"),m(5),c("formGroup",i.inputForm),m(6),c("ngIf",(l=i.inputForm.get("acronym"))==null?null:l.hasError("required")),m(17),c("ngForOf",i.sapPlantCodes),m(23),c("value",!0),m(2),c("value",!1),m(2),c("ngIf",(u=i.inputForm.get("isSubContractor"))==null?null:u.hasError("required")),m(5),c("ngIf",i.isConditionalRequiredForVendorCode()),m(2),c("disabled",i.inputForm.invalid||i.isLoading),m(),f(" ",i.getSubmitLabel()," ")}},dependencies:[O,N,me,H,z,le,ce,_e,Me,re,oe,I,W,G,be,$,se,ae,ne,Y,te,Ee,xe],encapsulation:2})}}return t})();function zi(t,r){t&1&&(o(0,"mat-error"),s(1," This field is "),o(2,"strong"),s(3,"required"),a()())}function Gi(t,r){if(t&1&&(o(0,"mat-option",14),s(1),a()),t&2){let e=r.$implicit;c("value",e),m(),f(" ",e.acronym," ")}}function Wi(t,r){t&1&&(o(0,"mat-error"),s(1," This field is "),o(2,"strong"),s(3,"required"),a()())}var Mt=(()=>{class t extends we{constructor(e,n,i,l,u,g){super(e,n,i,l),this.formBuilder=u,this.locationMaintenance=g,this.selectedManufacturer=new Ot,this.siteFilterControl=new Zt(""),this.filteredLocations=[],this.locations=[],this.store.select(de).subscribe(T=>{this.locations=T})}ngOnInit(){this.fillForm(),this.filteredLocations=this.locations,this.siteFilterControl.valueChanges.subscribe(e=>{this.filterLocations(e)})}fillForm(){this.inputForm=this.formBuilder.group({manufacturerCode:["",q.required],siteFilter:"",location:[null,q.required]}),this.crudAction===b.UPDATE?(this.setValuesToExistingManufacturerCode(),this.inputForm.get("manufacturerCode")?.disable()):this.crudAction==b.DELETE&&(this.setValuesToExistingManufacturerCode(),this.inputForm.get("manufacturerCode")?.disable(),this.inputForm.get("location")?.disable())}create(){this.assignValuesToManufacturerCode(),this.save()}delete(){this.selectedManufacturer.manufacturerCode&&(this.isLoading=!0,this.locationMaintenance.deleteManufacturerCode(this.selectedManufacturer.manufacturerCode).then(e=>this.saveConfirm("is successfully deleted")).catch(e=>this.saveFailed(e)).finally(()=>this.isLoading=!1))}update(){this.assignValuesToManufacturerCode(),this.save()}submit(){switch(this.crudAction){case b.CREATE:this.inputForm.valid&&this.create();break;case b.DELETE:this.delete();break;case b.UPDATE:this.inputForm.valid&&this.update();break}}setValuesToExistingManufacturerCode(){this.inputForm.get("manufacturerCode")?.setValue(this.selectedManufacturer.manufacturerCode),this.inputForm.get("location")?.setValue(this.locations.find(e=>this.selectedManufacturer.locationId===e.id))}save(){this.isLoading=!0,this.locationMaintenance.saveManufacturerCode(this.selectedManufacturer).then(e=>this.saveConfirm("is successfully saved")).catch(e=>this.saveFailed(e)).finally(()=>this.isLoading=!1)}saveConfirm(e){x.displaySuccessMsg(this.snackBar,`Manufacturer Code ${this.selectedManufacturer.manufacturerCode} ${e}`),this.closeDialog()}saveFailed(e){x.displayServerErrorMsg(this.snackBar,e.error)}assignValuesToManufacturerCode(){this.selectedManufacturer.manufacturerCode=this.inputForm.get("manufacturerCode")?.value?.trim(),this.selectedManufacturer.locationId=this.inputForm.get("location")?.value?.id}filterLocations(e){this.locations&&(e?this.filteredLocations=this.locations.filter(n=>n.acronym.toLowerCase().indexOf(e.toLowerCase())>-1):this.filteredLocations=this.locations)}static{this.\u0275fac=function(n){return new(n||t)(p(ie),p(B),p(j),p(k),p(ye),p(ft))}}static{this.\u0275cmp=F({type:t,selectors:[["app-manufacturer-crud"]],inputs:{selectedManufacturer:"selectedManufacturer"},standalone:!1,features:[U],decls:27,vars:8,consts:[["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane"],["cdkDragHandle","","color","primary",1,"justify-between"],[1,"text-lg"],["mat-icon-button","",1,"ml-2",3,"click"],[1,"grid","grid-cols-3","gap-4",3,"formGroup"],["formControlName","manufacturerCode","matInput","","required",""],[4,"ngIf"],["formControlName","location","required",""],[1,"bg-white"],["noEntriesFoundLabel","No matching Site found","placeholderLabel","Site",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["align","center"],["color","accent","mat-flat-button","","type","submit",1,"mr-2",3,"click","disabled"],["mat-stroked-button","",3,"click"],[3,"value"]],template:function(n,i){if(n&1&&(o(0,"div",0)(1,"mat-toolbar",1)(2,"h2",2),s(3),a(),o(4,"button",3),h("click",function(){return i.closeDialog()}),o(5,"mat-icon"),s(6,"close"),a()()(),o(7,"mat-dialog-content")(8,"form",4)(9,"mat-form-field")(10,"mat-label"),s(11,"Manufacturer Code"),a(),C(12,"input",5),d(13,zi,4,0,"mat-error",6),a(),o(14,"mat-form-field")(15,"mat-label"),s(16,"Site"),a(),o(17,"mat-select",7)(18,"mat-option",8),C(19,"ngx-mat-select-search",9),a(),d(20,Gi,2,2,"mat-option",10),a(),d(21,Wi,4,0,"mat-error",6),a()()(),o(22,"mat-dialog-actions",11)(23,"button",12),h("click",function(){return i.submit()}),s(24),a(),o(25,"button",13),h("click",function(){return i.closeDialog()}),s(26,"Close"),a()()()),n&2){let l,u;m(3),f("",i.crudActionToText()," Manufacturer Code"),m(5),c("formGroup",i.inputForm),m(5),c("ngIf",(l=i.inputForm.get("manufacturerCode"))==null?null:l.hasError("required")),m(6),c("formControl",i.siteFilterControl),m(),c("ngForOf",i.filteredLocations),m(),c("ngIf",(u=i.inputForm.get("location"))==null?null:u.hasError("required")),m(2),c("disabled",i.inputForm.invalid||i.isLoading),m(),f(" ",i.getSubmitLabel()," ")}},dependencies:[O,N,me,H,z,le,ce,ei,_e,Me,re,oe,I,W,G,be,$,se,ae,ne,Y,te,Ee,xe,Di],encapsulation:2})}}return t})();var Ii=(()=>{class t{constructor(e){this.store=e,this.allLocations=[],this.store.select(de).subscribe(n=>{this.allLocations=n})}transform(e){return this.allLocations.find(n=>e===n.id)?.acronym??"Unknown"}static{this.\u0275fac=function(n){return new(n||t)(p(k,16))}}static{this.\u0275pipe=Pt({name:"locationAcronym",type:t,pure:!0,standalone:!1})}}return t})();var an=["paginatorSites"],on=["paginatorManufacturerCodes"],Ai=()=>[25,50,100,250];function rn(t,r){t&1&&(o(0,"th",39),s(1,"Site"),a())}function sn(t,r){if(t&1&&(o(0,"td",40),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.acronym," ")}}function ln(t,r){t&1&&(o(0,"th",39),s(1," Subcon "),a())}function mn(t,r){if(t&1&&(o(0,"td",40),s(1),A(2,"booleanInterpreter"),a()),t&2){let e=r.$implicit;m(),f(" ",ue(2,1,e.isSubContractor)," ")}}function cn(t,r){t&1&&(o(0,"th",39),s(1," TMDB Code "),a())}function dn(t,r){if(t&1&&(o(0,"td",40),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.tmdbCode," ")}}function pn(t,r){t&1&&(o(0,"th",39),s(1,"Name"),a())}function un(t,r){if(t&1&&(o(0,"td",40),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.name," ")}}function fn(t,r){t&1&&(o(0,"th",39),s(1,"City"),a())}function hn(t,r){if(t&1&&(o(0,"td",40),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.city," ")}}function Cn(t,r){t&1&&(o(0,"th",39),s(1," Country "),a())}function gn(t,r){if(t&1&&(o(0,"td",40),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.country," ")}}function Sn(t,r){t&1&&(o(0,"th",41),s(1," Plant Code "),a())}function _n(t,r){if(t&1&&(o(0,"td",40),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.sapCode," ")}}function Mn(t,r){t&1&&(o(0,"th",42),s(1," Vendor Code "),a())}function yn(t,r){if(t&1&&(o(0,"td",40),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.vendorCode," ")}}function bn(t,r){t&1&&(o(0,"th",39),s(1," Planning Engine "),a())}function vn(t,r){if(t&1&&(o(0,"td",40),s(1),a()),t&2){let e=r.$implicit,n=v();m(),f(" ",n.convertPlanningEngine(e.planningEngine)," ")}}function xn(t,r){t&1&&(o(0,"th",39),s(1," Menu Grouping "),a())}function En(t,r){if(t&1&&(o(0,"td",40),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.menuGrouping==null?null:e.menuGrouping.toUpperCase()," ")}}function Dn(t,r){t&1&&(o(0,"th",39),s(1," Extended suffix "),a())}function Tn(t,r){if(t&1&&(o(0,"td",40),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.extendedSuffix," ")}}function wn(t,r){t&1&&(o(0,"th",39),s(1," Last updated "),a())}function Fn(t,r){if(t&1&&(o(0,"td",40),s(1),A(2,"date"),a()),t&2){let e=r.$implicit;m(),f(" ",Ve(2,1,e.lastUpdated,"yyyy-MM-dd")," ")}}function kn(t,r){t&1&&(o(0,"th",39),s(1," Updated by "),a())}function In(t,r){if(t&1&&(o(0,"td",40),s(1),A(2,"async"),a()),t&2){let e=r.$implicit,n=v();m(),f(" ",ue(2,1,n.getUsernameByWbi(e.updatedBy))," ")}}function An(t,r){t&1&&C(0,"th",43)}function Ln(t,r){if(t&1){let e=w();o(0,"td",40)(1,"div",44)(2,"button",45),A(3,"authorization"),h("click",function(){let i=S(e).$implicit,l=v();return _(l.editLocation(i))}),a(),o(4,"button",46),h("click",function(){let i=S(e).$implicit,l=v();return _(l.deleteSite(i))}),a()()()}if(t&2){let e=r.$implicit,n=v();m(2),c("disabled",Ue(3,3,e.id,n.role,!0)),m(2),c("disabled",!n.isAuthorized()||!n.isSiteDeletable(e))("matTooltip",n.deleteTooltip(e))}}function Pn(t,r){if(t&1){let e=w();o(0,"th",43)(1,"app-generic-search",48),h("emitSearchTrigger",function(i){S(e);let l=v(2);return _(l.searchFieldTriggered(i))}),a()()}if(t&2){let e=v().$implicit,n=v();m(),c("booleanValues",n.booleanSearchValues)("searchField",e.sortField)}}function Vn(t,r){if(t&1&&(M(0,47),d(1,Pn,2,2,"th",30),y()),t&2){let e=r.$implicit;c("matColumnDef",e.sortField)("stickyEnd",e.stickyEnd)("sticky",e.sticky)}}function Nn(t,r){t&1&&C(0,"tr",49)}function Bn(t,r){t&1&&C(0,"tr",49)}function Rn(t,r){t&1&&C(0,"tr",50)}function Un(t,r){t&1&&(o(0,"th",39),s(1,"Site"),a())}function On(t,r){if(t&1&&(o(0,"td",40),s(1),A(2,"locationAcronym"),a()),t&2){let e=r.$implicit;m(),f(" ",ue(2,1,e.locationId)," ")}}function Yn(t,r){t&1&&(o(0,"th",39),s(1," Manufacturer Code "),a())}function jn(t,r){if(t&1&&(o(0,"td",40),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.manufacturerCode," ")}}function Hn(t,r){t&1&&(o(0,"th",39),s(1," Last updated "),a())}function qn(t,r){if(t&1&&(o(0,"td",40),s(1),A(2,"date"),a()),t&2){let e=r.$implicit;m(),f(" ",Ve(2,1,e.lastUpdated,"yyyy-MM-dd")," ")}}function zn(t,r){t&1&&(o(0,"th",39),s(1," Updated by "),a())}function Gn(t,r){if(t&1&&(o(0,"td",40),s(1),A(2,"async"),a()),t&2){let e=r.$implicit,n=v();m(),f(" ",ue(2,1,n.getUsernameByWbi(e.updatedBy))," ")}}function Wn(t,r){t&1&&C(0,"th",43)}function $n(t,r){if(t&1){let e=w();o(0,"td",40)(1,"div",44)(2,"button",45),A(3,"authorization"),h("click",function(){let i=S(e).$implicit,l=v();return _(l.editManufacturerCode(i))}),a(),o(4,"button",51),h("click",function(){let i=S(e).$implicit,l=v();return _(l.deleteManufacturerCode(i))}),a()()()}if(t&2){let e=r.$implicit,n=v();m(2),c("disabled",Ue(3,2,e.id,n.role,!0)),m(2),c("disabled",!n.isAuthorized())}}function Qn(t,r){if(t&1){let e=w();o(0,"th",43)(1,"app-generic-search",48),h("emitSearchTrigger",function(i){S(e);let l=v(2);return _(l.searchFieldTriggered(i))}),a()()}if(t&2){let e=v().$implicit,n=v();m(),c("booleanValues",n.booleanSearchValues)("searchField",e.sortField)}}function Jn(t,r){if(t&1&&(M(0,47),d(1,Qn,2,2,"th",30),y()),t&2){let e=r.$implicit;c("matColumnDef",e.sortField)("stickyEnd",e.stickyEnd)("sticky",e.sticky)}}function Xn(t,r){t&1&&C(0,"tr",49)}function Kn(t,r){t&1&&C(0,"tr",49)}function Zn(t,r){t&1&&C(0,"tr",50)}function ea(t,r){t&1&&C(0,"app-spinner")}var Vi=(()=>{class t{constructor(e,n,i,l,u,g){this.dialogService=e,this.authorizationService=n,this.dataUpdateService=i,this.dataService=l,this.genericSearchUtils=u,this.store=g,this.role=Xe.ADMINISTRATOR_SYSTEM,this.tabIndex=0,this.booleanSearchValues=[!0,!1,void 0],this.displayedColumnsSites=["acronym","isSubContractor","tmdbCode","city","country","sapCode","vendorCode","planningEngine","menuGrouping","extendedSuffix","lastUpdated","updater.name","actions"],this.displayedColumnsManufacturerCodes=["location","manufacturerCode","lastUpdated","updater.name","actions"],this.isLoading=!1,this.searchColumnsSites=[{sortField:E.LOC_ACRONYM,sticky:!0},{sortField:E.LOC_SUBCON},{sortField:E.LOC_TMDBCODE},{sortField:E.LOC_CITY},{sortField:E.LOC_COUNTRY},{sortField:E.LOC_SAPCODE},{sortField:E.LOC_VENDOR_CODE},{sortField:E.LOC_PLANNINGENGINE},{sortField:E.LOC_MENUGROUPING},{sortField:E.LOC_EXTENDEDSUFFIX},{sortField:E.LOC_LASTUPDATED},{sortField:E.LOC_UPDATEDBY},{sortField:E.EMPTY,stickyEnd:!0}],this.searchColumnsManufacturerCodes=[{sortField:E.MC_SITE},{sortField:E.MC_MANUFACTURER_CODE},{sortField:E.MC_LASTUPDATED},{sortField:E.MC_UPDATEDBY},{sortField:E.EMPTY,stickyEnd:!0}],this.searchColumnsSitesNames=this.searchColumnsSites.map(T=>T.sortField),this.searchColumnsManufacturerCodesNames=this.searchColumnsManufacturerCodes.map(T=>T.sortField),this.selectedLocation=new Z,this.sitesDataSource=new pe([]),this.manufacturerCodesDataSource=new pe([]),this.searchArgumentsLocations=new Te,this.searchArgumentsManufacturerCodes=new Te}convertPlanningEngine(e){let n=e?.toLowerCase();return n?.includes("i2")?n.replaceAll("i2","JDA"):e}deleteTooltip(e){let n="The global site cannot be removed",i="You are not authorized to remove this site",l=`Current site has '${e.activeEquipmentCount}' equipment installed, and therefore cannot be removed`,u=`Current site has '${e.activeEventsCount}' active events, and therefore cannot be removed.`,g="Site cannot be removed, because of an unknown cause";return e.id===0?n:this.isAuthorized()&&this.isSiteDeletable(e)?"":this.isAuthorized()?e.activeEquipmentCount>0?l:e.activeEventsCount>0?u:g:i}isAuthorized(){return this.authorizationService.doesCurrentUserHaveRoleForCurrentLocation(0,"Administrator_System")}isSiteDeletable(e){return e.activeEquipmentCount===0&&e.activeEventsCount===0&&e.id!==0}ngAfterViewInit(){this.getLocations(),this.watchForUpdate()}ngOnInit(){this.initializeSearchArguments()}attachPaginator(e){this.getPages()}addSite(){let e=this.dialogService.open(St,{disableClose:!0});e.componentInstance.crudAction=b.CREATE,e.afterClosed().subscribe(()=>{this.getLocations()})}addManufacturer(){let e=this.dialogService.open(Mt,{disableClose:!0});e.componentInstance.crudAction=b.CREATE,e.afterClosed().subscribe(()=>{this.getManufacturers()})}add(){switch(this.tabIndex){case 0:this.addSite();break;case 1:this.addManufacturer();break}}addButtonTooltip(){switch(this.tabIndex){case 0:return"Add a new Location";case 1:return"Add a new Manufacturer Code";default:return""}}initializeSearchArguments(){this.searchArgumentsLocations=new Te,this.searchArgumentsManufacturerCodes=new Te,this.searchArgumentsLocations.searchArgs.push(new _i(E.LOC_STATUS,"ACTIVE")),this.searchArgumentsManufacturerCodes.sortArgs.push(new Mi(E.MC_SITE,!1))}deleteSite(e){if(this.isSiteDeletable(e)){let n=this.createLocationCopy(e),i=this.dialogService.open(St,{disableClose:!0});i.componentInstance.selectedLocation=n,i.componentInstance.crudAction=b.DELETE,D(i.afterClosed()).then(()=>this.getLocations())}}deleteManufacturerCode(e){let n=this.createManufacturerCodeCopy(e),i=this.dialogService.open(Mt,{disableClose:!0});i.componentInstance.selectedManufacturer=n,i.componentInstance.crudAction=b.DELETE,D(i.afterClosed()).then(()=>this.getManufacturers())}resetFilters(){this.initializeSearchArguments(),this.resetPaginator(),this.getPages(),this.dataUpdateService.triggerReset(this.searchArgumentsLocations)}searchFieldTriggered(e){switch(this.tabIndex){case 0:this.searchLocations(e);break;case 1:this.searchManufacturerCode(e);break}}editLocation(e){let n=this.createLocationCopy(e),i=this.dialogService.open(St,{disableClose:!0});i.componentInstance.selectedLocation=n,i.componentInstance.crudAction=b.UPDATE,D(i.afterClosed()).then(()=>this.getLocations())}editManufacturerCode(e){let n=this.createManufacturerCodeCopy(e),i=this.dialogService.open(Mt,{disableClose:!0});i.componentInstance.selectedManufacturer=n,i.componentInstance.crudAction=b.UPDATE,D(i.afterClosed()).then(()=>this.getManufacturers())}getPages(){switch(this.tabIndex){case 0:this.getLocations();break;case 1:this.getManufacturers();break}}sortData(e){let n=new Te;switch(this.tabIndex){case 0:n=this.searchArgumentsLocations;break;case 1:n=this.searchArgumentsManufacturerCodes;break}this.genericSearchUtils.sortData(e.active,e.direction,n)&&(this.resetPaginator(),this.getPages())}getUsernameByWbi(e){return this.store.select(Qe(e))}createLocationCopy(e){return Object.assign({},e)}createManufacturerCodeCopy(e){return Object.assign({},e)}getLocations(){this.isLoading=!0,this.dataService.searchLocations(this.searchArgumentsLocations,this.paginatorSites.pageIndex,this.paginatorSites.pageSize).then(e=>{this.sitesDataSource=new pe(e.content),this.paginatorSites.length=e.totalElements}).finally(()=>this.isLoading=!1)}getManufacturers(){this.isLoading=!0,this.dataService.searchManufacturerCodes(this.searchArgumentsManufacturerCodes,this.paginatorManufacturerCodes.pageIndex,this.paginatorManufacturerCodes.pageSize).pipe().subscribe(e=>{this.manufacturerCodesDataSource=new pe(e.content),this.paginatorManufacturerCodes.length=e.totalElements,this.isLoading=!1})}searchLocations(e){let n=this.searchArgumentsLocations.getSearchField(e.field);n?n.value=e.value:this.searchArgumentsLocations.searchArgs.push(e),this.resetPaginator(),this.getLocations()}searchManufacturerCode(e){let n=this.searchArgumentsManufacturerCodes.getSearchField(e.field);n?n.value=e.value:this.searchArgumentsManufacturerCodes.searchArgs.push(e),this.resetPaginator(),this.getManufacturers()}resetPaginator(){switch(this.tabIndex){case 0:this.paginatorSites.firstPage();break;case 1:this.paginatorManufacturerCodes.firstPage();break}}watchForUpdate(){this.dataUpdateService.updateEmitter.subscribe(e=>{e.updatedType===$e.LOCATION&&this.getLocations()})}static{this.\u0275fac=function(n){return new(n||t)(p(Ce),p(ee),p(Je),p(B),p(yi),p(k))}}static{this.\u0275cmp=F({type:t,selectors:[["app-site-management"]],viewQuery:function(n,i){if(n&1&&(L(an,5),L(on,5)),n&2){let l;P(l=V())&&(i.paginatorSites=l.first),P(l=V())&&(i.paginatorManufacturerCodes=l.first)}},standalone:!1,decls:91,vars:26,consts:[["paginatorSites",""],["paginatorManufacturerCodes",""],[1,"flex","max-h-full","flex-col"],[1,"flex","flex-wrap","items-center","justify-between","gap-4","px-4","py-2"],[1,"flex","items-center","gap-4"],["color","primary","mat-button","",3,"click"],["color","accent","mat-mini-fab","",3,"click","disabled","matTooltip"],[1,"flex","min-h-0","flex-col"],["mat-stretch-tabs","false",1,"overflow-auto",3,"selectedTabChange","selectedIndexChange","selectedIndex"],["label","Sites"],[1,"overflow-auto"],["mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","acronym","sticky",""],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","isSubContractor"],["matColumnDef","tmdbCode"],["matColumnDef","name"],["matColumnDef","city"],["matColumnDef","country"],["matColumnDef","sapCode"],["mat-header-cell","","mat-sort-header","","matTooltip","Plant Code in SAP system",4,"matHeaderCellDef"],["matColumnDef","vendorCode"],["mat-header-cell","","mat-sort-header","","matTooltip","Vendor Code in SAP system",4,"matHeaderCellDef"],["matColumnDef","planningEngine"],["matColumnDef","menuGrouping"],["matColumnDef","extendedSuffix"],["matColumnDef","lastUpdated"],["matColumnDef","updater.name"],["matColumnDef","actions","stickyEnd",""],["mat-header-cell","",4,"matHeaderCellDef"],[3,"matColumnDef","stickyEnd","sticky",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["class","hover:!bg-table-row-hover","mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"page","pageSizeOptions"],["label","Manufacturer Codes"],["matColumnDef","location"],["matColumnDef","manufacturerCode"],[4,"ngIf"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell","","mat-sort-header","","matTooltip","Plant Code in SAP system"],["mat-header-cell","","mat-sort-header","","matTooltip","Vendor Code in SAP system"],["mat-header-cell",""],[1,"flex","items-center","gap-1"],["matIcon","edit","table-icon-button","",3,"click","disabled"],["matIcon","delete","table-icon-button","",3,"click","disabled","matTooltip"],[3,"matColumnDef","stickyEnd","sticky"],[3,"emitSearchTrigger","booleanValues","searchField"],["mat-header-row",""],["mat-row","",1,"hover:!bg-table-row-hover"],["matIcon","delete","table-icon-button","",3,"click","disabled"]],template:function(n,i){if(n&1){let l=w();o(0,"div",2)(1,"div",3)(2,"app-page-title"),s(3,"Location Management"),a(),o(4,"div",4)(5,"button",5),h("click",function(){return S(l),_(i.resetFilters())}),s(6," Reset filters "),a(),o(7,"button",6),A(8,"authorization"),h("click",function(){return S(l),_(i.add())}),o(9,"mat-icon"),s(10,"add"),a()()()(),o(11,"div",7)(12,"mat-tab-group",8),h("selectedTabChange",function(g){return S(l),_(i.attachPaginator(g))}),K("selectedIndexChange",function(g){return S(l),X(i.tabIndex,g)||(i.tabIndex=g),_(g)}),o(13,"mat-tab",9)(14,"div",2)(15,"div",10)(16,"table",11),h("matSortChange",function(g){return S(l),_(i.sortData(g))}),M(17,12),d(18,rn,2,0,"th",13)(19,sn,2,1,"td",14),y(),M(20,15),d(21,ln,2,0,"th",13)(22,mn,3,3,"td",14),y(),M(23,16),d(24,cn,2,0,"th",13)(25,dn,2,1,"td",14),y(),M(26,17),d(27,pn,2,0,"th",13)(28,un,2,1,"td",14),y(),M(29,18),d(30,fn,2,0,"th",13)(31,hn,2,1,"td",14),y(),M(32,19),d(33,Cn,2,0,"th",13)(34,gn,2,1,"td",14),y(),M(35,20),d(36,Sn,2,0,"th",21)(37,_n,2,1,"td",14),y(),M(38,22),d(39,Mn,2,0,"th",23)(40,yn,2,1,"td",14),y(),M(41,24),d(42,bn,2,0,"th",13)(43,vn,2,1,"td",14),y(),M(44,25),d(45,xn,2,0,"th",13)(46,En,2,1,"td",14),y(),M(47,26),d(48,Dn,2,0,"th",13)(49,Tn,2,1,"td",14),y(),M(50,27),d(51,wn,2,0,"th",13)(52,Fn,3,4,"td",14),y(),M(53,28),d(54,kn,2,0,"th",13)(55,In,3,3,"td",14),y(),M(56,29),d(57,An,1,0,"th",30)(58,Ln,5,7,"td",14),y(),d(59,Vn,2,3,"ng-container",31)(60,Nn,1,0,"tr",32)(61,Bn,1,0,"tr",32)(62,Rn,1,0,"tr",33),a()(),o(63,"mat-paginator",34,0),h("page",function(){return S(l),_(i.getPages())}),a()()(),o(65,"mat-tab",35)(66,"div",2)(67,"div",10)(68,"table",11),h("matSortChange",function(g){return S(l),_(i.sortData(g))}),M(69,36),d(70,Un,2,0,"th",13)(71,On,3,3,"td",14),y(),M(72,37),d(73,Yn,2,0,"th",13)(74,jn,2,1,"td",14),y(),M(75,27),d(76,Hn,2,0,"th",13)(77,qn,3,4,"td",14),y(),M(78,28),d(79,zn,2,0,"th",13)(80,Gn,3,3,"td",14),y(),M(81,29),d(82,Wn,1,0,"th",30)(83,$n,5,6,"td",14),y(),d(84,Jn,2,3,"ng-container",31)(85,Xn,1,0,"tr",32)(86,Kn,1,0,"tr",32)(87,Zn,1,0,"tr",33),a()(),o(88,"mat-paginator",34,1),h("page",function(){return S(l),_(i.getPages())}),a()()()(),d(90,ea,1,0,"app-spinner",38),a()()}n&2&&(m(7),Vt("matTooltip",i.addButtonTooltip()),c("disabled",Ue(8,20,0,i.role,!0)),m(5),J("selectedIndex",i.tabIndex),m(4),c("dataSource",i.sitesDataSource),m(43),c("ngForOf",i.searchColumnsSites),m(),c("matHeaderRowDef",i.displayedColumnsSites)("matHeaderRowDefSticky",!0),m(),c("matHeaderRowDef",i.searchColumnsSitesNames)("matHeaderRowDefSticky",!0),m(),c("matRowDefColumns",i.displayedColumnsSites),m(),c("pageSizeOptions",Pe(24,Ai)),m(5),c("dataSource",i.manufacturerCodesDataSource),m(16),c("ngForOf",i.searchColumnsManufacturerCodes),m(),c("matHeaderRowDef",i.displayedColumnsManufacturerCodes)("matHeaderRowDefSticky",!0),m(),c("matHeaderRowDef",i.searchColumnsManufacturerCodesNames)("matHeaderRowDefSticky",!0),m(),c("matRowDefColumns",i.displayedColumnsManufacturerCodes),m(),c("pageSizeOptions",Pe(25,Ai)),m(2),c("ngIf",i.isLoading))},dependencies:[O,N,mt,ge,vi,ut,I,Ke,et,at,tt,Ze,ot,it,nt,rt,st,Se,De,ve,lt,He,qe,Y,he,Oe,Ye,xi,Ei,Ii],encapsulation:2})}}return t})();var R=class{constructor(){this.plantCode="",this.enoviaAcronym="",this.city="",this.country="",this.state="",this.managedBy=new Z,this.lastUpdated=new Date,this.updatedBy=""}};function ta(t,r){t&1&&C(0,"app-spinner")}function ia(t,r){t&1&&(o(0,"mat-error"),s(1," This field is "),o(2,"strong"),s(3,"required"),a()())}function na(t,r){if(t&1&&(o(0,"mat-option",14),s(1),a()),t&2){let e=r.$implicit;c("value",e),m(),Nt(" ",e.acronym," (",e.city,", ",e.country,") ")}}var yt=(()=>{class t extends we{constructor(e,n,i,l,u,g){super(e,n,i,l),this.formBuilder=u,this.authorizationService=g,this.selectedSapCode=new R,this.loading=!0,this.alreadySubmitted=!1,this.au=new fi,this.allLocations=[],this.allSapCodes=[],this.store.select(de).subscribe(T=>{this.allLocations=T.filter(bt=>bt.id!==0)})}set inputSapCode(e){this.selectedSapCode=e||new R}ngOnInit(){this.getAllSapCodes(),this.loading=!1,this.fillForm()}update(){this.assignValuesToSapCode(),this.save()}save(){this.loading=!0,this.alreadySubmitted=!0,this.sapCodeAlreadyExists()&&this.crudAction===b.CREATE?(x.displayErrorMsg(this.snackBar,"This SAP Plant Code already exists"),this.loading=!1,this.alreadySubmitted=!1):D(this.dataService.saveSapCode(this.selectedSapCode)).then(()=>{x.displaySuccessMsg(this.snackBar,"The SAP Plant Code has been successfully saved"),this.closeDialog()}).catch(e=>x.displayErrorMsg(this.snackBar,e)).finally(()=>this.loading=!1)}fillForm(){this.inputForm=this.formBuilder.group({plantCode:["",q.required],city:[""],country:[""],managedBy:[""]}),this.inputForm.controls.plantCode.setValue(this.selectedSapCode.plantCode),this.inputForm.controls.city.setValue(this.selectedSapCode.city),this.inputForm.controls.country.setValue(this.selectedSapCode.country),this.inputForm.controls.managedBy.setValue(this.selectedSapCode.managedBy),this.crudAction==b.DELETE&&(this.inputForm.controls.plantCode.disable(),this.inputForm.controls.city.disable(),this.inputForm.controls.country.disable(),this.inputForm.controls.managedBy.disable())}submit(){try{switch(this.crudAction){case b.CREATE:this.inputForm.valid&&this.create();break;case b.DELETE:this.delete();break;case b.UPDATE:this.update();break}}catch(e){x.displayErrorMsg(this.snackBar,e)}}create(){this.assignValuesToSapCode(),this.save()}delete(){this.alreadySubmitted=!0,D(this.dataService.deleteSapCode(this.selectedSapCode)).then(()=>{x.displaySuccessMsg(this.snackBar,"The SAP Plant Code has been successfully deleted"),this.closeDialog()}).catch(e=>x.displayErrorMsg(this.snackBar,e))}isDelete(){return this.crudAction===b.DELETE}sapCodeAlreadyExists(){let e=this.selectedSapCode.plantCode.trim().toUpperCase();return this.allSapCodes.find(n=>n.plantCode===e)}compareLocation(e,n){return e.id===n.id}getAllSapCodes(){this.dataService.getAllSapCodes().subscribe(e=>{this.allSapCodes=e,this.allSapCodes.sort((n,i)=>n.plantCode>i.plantCode?1:i.plantCode>n.plantCode?-1:0)})}assignValuesToSapCode(){this.selectedSapCode.plantCode=this.inputForm.get("plantCode")?.value.toUpperCase().trim(),this.selectedSapCode.city=this.inputForm.get("city")?.value,this.selectedSapCode.country=this.inputForm.get("country")?.value,this.selectedSapCode.managedBy=this.inputForm.get("managedBy")?.value}static{this.\u0275fac=function(n){return new(n||t)(p(ie),p(B),p(j),p(k),p(ye),p(ee))}}static{this.\u0275cmp=F({type:t,selectors:[["app-sap-code-crud"]],inputs:{selectedSapCode:"selectedSapCode",inputSapCode:"inputSapCode"},standalone:!1,features:[U],decls:33,vars:8,consts:[["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane"],["cdkDragHandle","","color","primary",1,"justify-between"],[1,"text-lg"],["mat-icon-button","",1,"ml-2",3,"click"],[4,"ngIf"],[1,"grid","grid-cols-2","gap-4",3,"formGroup"],["formControlName","plantCode","matInput","","required","",1,"!uppercase"],["formControlName","managedBy",3,"compareWith"],[3,"value",4,"ngFor","ngForOf"],["formControlName","city","matInput",""],["formControlName","country","matInput",""],["align","center"],["color","accent","mat-flat-button","","type","submit",1,"mr-2",3,"click","disabled"],["mat-stroked-button","",3,"click"],[3,"value"]],template:function(n,i){if(n&1&&(o(0,"div",0)(1,"mat-toolbar",1)(2,"h2",2),s(3),a(),o(4,"button",3),h("click",function(){return i.closeDialog()}),o(5,"mat-icon"),s(6,"close"),a()()(),o(7,"mat-dialog-content"),d(8,ta,1,0,"app-spinner",4),o(9,"form",5)(10,"mat-form-field")(11,"mat-label"),s(12,"SAP Plant Code"),a(),C(13,"input",6),d(14,ia,4,0,"mat-error",4),a(),o(15,"mat-form-field")(16,"mat-label"),s(17,"Managed By"),a(),o(18,"mat-select",7),d(19,na,2,4,"mat-option",8),a()(),o(20,"mat-form-field")(21,"mat-label"),s(22,"City"),a(),C(23,"input",9),a(),o(24,"mat-form-field")(25,"mat-label"),s(26,"Country"),a(),C(27,"input",10),a()()(),o(28,"mat-dialog-actions",11)(29,"button",12),h("click",function(){return i.submit()}),s(30),a(),o(31,"button",13),h("click",function(){return i.closeDialog()}),s(32,"Close"),a()()()),n&2){let l;m(3),f("",i.crudActionToText()," Location"),m(5),c("ngIf",i.loading),m(),c("formGroup",i.inputForm),m(5),c("ngIf",(l=i.inputForm.get("plantCode"))==null?null:l.hasError("required")),m(4),c("compareWith",i.compareLocation),m(),c("ngForOf",i.allLocations),m(10),c("disabled",i.inputForm.invalid||i.isLoading),m(),f(" ",i.isDelete()?"Delete":"Save"," ")}},dependencies:[O,N,me,H,z,le,ce,_e,Me,ge,re,oe,I,W,G,be,$,se,ae,ne,Y,te,Ee,xe],encapsulation:2})}}return t})();var Ni=["SapCodeTable"],aa=["SiteTable"],oa=()=>[25,50,100,250];function ra(t,r){if(t&1){let e=w();o(0,"button",30),h("click",function(){S(e);let i=v();return _(i.openAddSapCode())}),o(1,"mat-icon"),s(2,"add"),a()()}}function sa(t,r){t&1&&(o(0,"th",31),s(1," SAP Plant Code "),a())}function la(t,r){if(t&1&&(o(0,"td",32),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.plantCode," ")}}function ma(t,r){t&1&&(o(0,"th",31),s(1,"City"),a())}function ca(t,r){if(t&1&&(o(0,"td",32),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.city," ")}}function da(t,r){t&1&&(o(0,"th",31),s(1,"Country"),a())}function pa(t,r){if(t&1&&(o(0,"td",32),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.country," ")}}function ua(t,r){t&1&&(o(0,"th",31),s(1," Managed by "),a())}function fa(t,r){if(t&1&&(o(0,"td",32),s(1),a()),t&2){let e=r.$implicit,n=v();m(),f(" ",n.locationAcronym(e)," ")}}function ha(t,r){t&1&&(o(0,"th",31),s(1," Last updated "),a())}function Ca(t,r){if(t&1&&(o(0,"td",32),s(1),A(2,"date"),a()),t&2){let e=r.$implicit;m(),f(" ",Ve(2,1,e.lastUpdated,"yyyy-MM-dd")," ")}}function ga(t,r){t&1&&(o(0,"th",31),s(1," Updated by "),a())}function Sa(t,r){if(t&1&&(o(0,"td",32),s(1),A(2,"async"),a()),t&2){let e=r.$implicit,n=v();m(),f(" ",ue(2,1,n.getUsernameByWbi(e.updatedBy))," ")}}function _a(t,r){t&1&&C(0,"th",33)}function Ma(t,r){if(t&1){let e=w();o(0,"td",34)(1,"div",35)(2,"button",36),h("click",function(){let i=S(e).$implicit,l=v();return _(l.selectForEdit(i))}),a(),o(3,"button",37),h("click",function(){let i=S(e).$implicit,l=v();return _(l.deleteSapCode(i))}),a()()()}if(t&2){let e=v();m(2),c("disabled",!e.isAuthorized()),m(),c("disabled",!e.isAuthorized())}}function ya(t,r){t&1&&C(0,"tr",38)}function ba(t,r){t&1&&C(0,"tr",39)}function va(t,r){t&1&&(o(0,"th",40),s(1,"Acronym"),a())}function xa(t,r){if(t&1&&(o(0,"td",32),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.location.acronym," ")}}function Ea(t,r){t&1&&(o(0,"th",40),s(1,"City"),a())}function Da(t,r){if(t&1&&(o(0,"td",32),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.location.city," ")}}function Ta(t,r){t&1&&(o(0,"th",40),s(1,"Country"),a())}function wa(t,r){if(t&1&&(o(0,"td",32),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.location.country," ")}}function Fa(t,r){t&1&&(o(0,"th",40),s(1,"Manages"),a())}function ka(t,r){if(t&1&&(o(0,"td",32),s(1),a()),t&2){let e=r.$implicit;m(),f(" ",e.manages," ")}}function Ia(t,r){t&1&&C(0,"tr",38)}function Aa(t,r){t&1&&C(0,"tr",39)}var Bi=(()=>{class t extends je{constructor(e,n,i,l,u,g){super(e,n,i,l),this.dialogService=u,this.authorizationService=g,this.sapSort=new ve,this.sapCode=new R,this.allSapCodes=[],this.allLocations=[],this.wrappedLocations=[],this.selectedSapCode=new R,this.originalSapCode=new R,this.selectManagedById=-1,this.originalManagedById=-1,this.newSapCode=!1,this.displaySapCodeColumns=["plantCode","city","country","managedBy","lastUpdated","updatedBy","actions"],this.displaySiteColumns=["location.acronym","location.city","location.country","manages"],this.store.select(de).subscribe(T=>{this.allLocations=T})}ngOnInit(){this.getAllSapCodes()}selectForEdit(e){if(this.isAuthorized()){this.updateSelectedSapCode(e),this.newSapCode=!1;let n=this.dialogService.open(yt,{disableClose:!0});n.componentInstance.selectedSapCode=e,n.componentInstance.crudAction=b.UPDATE,n.afterClosed().subscribe(()=>{this.getAllSapCodes()})}}isAuthorized(){return this.authorizationService.doesCurrentUserHaveRoleForCurrentLocation(0,"Manager_PlanningGroups_Global")}locationAcronym(e){return e&&e.managedBy?e.managedBy.acronym:"N/A"}deleteSapCode(e){if(this.isAuthorized()){let n=this.dialogService.open(yt,{disableClose:!0});n.componentInstance.selectedSapCode=e,n.componentInstance.crudAction=b.DELETE,n.afterClosed().subscribe(()=>{this.getAllSapCodes()})}}ngOnDestroy(){this.sapCodeSubscription!=null&&this.sapCodeSubscription.unsubscribe(),this.locationsSubscription!=null&&this.locationsSubscription.unsubscribe()}openAddSapCode(){let e=new R,n=this.dialogService.open(yt,{disableClose:!0});n.componentInstance.selectedSapCode=e,n.componentInstance.crudAction=b.CREATE,n.afterClosed().subscribe(()=>{this.getAllSapCodes()})}attachPaginator(e){e.index===0?this.sapCodeDataSource.paginator=this.paginator:this.siteDataSource.paginator=this.paginator}getUsernameByWbi(e){return this.store.select(Qe(e))}getAllSapCodes(){this.sapCodeSubscription=this.dataService.getAllSapCodes().subscribe(e=>{this.allSapCodes=e,this.allSapCodes.sort((n,i)=>n.plantCode>i.plantCode?1:-1),this.sapCodeDataSource=new pe(this.allSapCodes),this.sapCodeDataSource.paginator=this.paginator,this.sapCodeDataSource.sort=this.sapSort,this.wrapLocations()})}wrapLocations(){this.allLocations=this.allLocations.filter(e=>e.id>0),this.allLocations.push(this.buildNotManagedLocation()),this.allLocations.forEach(e=>this.addToWrapperArray(e)),this.siteDataSource=new pe(this.wrappedLocations)}buildNotManagedLocation(){let e=new Z;return e.id=-2,e.acronym="Not managed",e}addToWrapperArray(e){let n=new Tt;n.location=e,this.allSapCodes.filter(u=>this.isManagedByLocation(u,e)).forEach(u=>n.manages+=u.plantCode+", ");let l=n.manages?.length;l!=null&&l>0&&(n.manages=n.manages.substring(0,l-2)),this.wrappedLocations.push(n)}isManagedByLocation(e,n){return e.managedBy&&e.managedBy.id===n.id}updateSelectedSapCode(e){this.selectedSapCode=e,this.selectedSapCode.managedBy?this.selectManagedById=this.selectedSapCode.managedBy.id:this.selectManagedById=-1,this.originalSapCode=new R,this.originalSapCode.city=this.selectedSapCode.city,this.originalSapCode.country=this.selectedSapCode.country,this.originalSapCode.plantCode=this.selectedSapCode.plantCode,this.originalManagedById=this.selectManagedById}static{this.\u0275fac=function(n){return new(n||t)(p(ie),p(B),p(j),p(k),p(Ce),p(ee))}}static{this.\u0275cmp=F({type:t,selectors:[["app-sapcode-management"]],viewQuery:function(n,i){if(n&1&&(L(De,5),L(Ni,5),L(Ni,5),L(aa,5)),n&2){let l;P(l=V())&&(i.paginator=l.first),P(l=V())&&(i.sapSort=l.first),P(l=V())&&(i.sapCodeTable=l.first),P(l=V())&&(i.siteTable=l.first)}},standalone:!1,features:[U],decls:51,vars:11,consts:[["SapCodeTable","matSort"],["SiteTable",""],[1,"flex","max-h-full","flex-col"],[1,"flex","flex-wrap","items-center","justify-between","gap-4","px-4","py-2"],["color","accent","mat-mini-fab","","matTooltip","Add new SAP Plant Code",3,"click",4,"ngIf"],[1,"flex","min-h-0","flex-col"],["mat-stretch-tabs","false",1,"overflow-auto",3,"selectedTabChange"],["label","SAP Plant Codes"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","plantCode","sticky",""],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","city"],["matColumnDef","country"],["matColumnDef","managedBy"],["matColumnDef","lastUpdated"],["matColumnDef","updatedBy"],["matColumnDef","actions","stickyEnd",""],["class","w-0","mat-header-cell","",4,"matHeaderCellDef"],["class","w-0","mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["class","hover:!bg-table-row-hover","mat-row","",4,"matRowDef","matRowDefColumns"],["label","Site Manages"],["mat-table","",3,"dataSource"],["matColumnDef","location.acronym","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","location.city"],["matColumnDef","location.country"],["matColumnDef","manages"],["showFirstLastButtons","",3,"pageSizeOptions"],["color","accent","mat-mini-fab","","matTooltip","Add new SAP Plant Code",3,"click"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell","",1,"w-0"],["mat-cell","",1,"w-0"],[1,"flex","items-center","gap-1"],["matIcon","edit","matTooltip","Edit this SAP Plant code","table-icon-button","",3,"click","disabled"],["matIcon","delete","matTooltip","Delete this SAP Plant code","table-icon-button","",3,"click","disabled"],["mat-header-row",""],["mat-row","",1,"hover:!bg-table-row-hover"],["mat-header-cell",""]],template:function(n,i){if(n&1){let l=w();o(0,"div",2)(1,"div",3)(2,"app-page-title"),s(3,"SAP Plant Code Management"),a(),d(4,ra,3,0,"button",4),a(),o(5,"div",5)(6,"mat-tab-group",6),h("selectedTabChange",function(g){return S(l),_(i.attachPaginator(g))}),o(7,"mat-tab",7)(8,"table",8,0),M(10,9),d(11,sa,2,0,"th",10)(12,la,2,1,"td",11),y(),M(13,12),d(14,ma,2,0,"th",10)(15,ca,2,1,"td",11),y(),M(16,13),d(17,da,2,0,"th",10)(18,pa,2,1,"td",11),y(),M(19,14),d(20,ua,2,0,"th",10)(21,fa,2,1,"td",11),y(),M(22,15),d(23,ha,2,0,"th",10)(24,Ca,3,4,"td",11),y(),M(25,16),d(26,ga,2,0,"th",10)(27,Sa,3,3,"td",11),y(),M(28,17),d(29,_a,1,0,"th",18)(30,Ma,4,2,"td",19),y(),d(31,ya,1,0,"tr",20)(32,ba,1,0,"tr",21),a()(),o(33,"mat-tab",22)(34,"table",23,1),M(36,24),d(37,va,2,0,"th",25)(38,xa,2,1,"td",11),y(),M(39,26),d(40,Ea,2,0,"th",25)(41,Da,2,1,"td",11),y(),M(42,27),d(43,Ta,2,0,"th",25)(44,wa,2,1,"td",11),y(),M(45,28),d(46,Fa,2,0,"th",25)(47,ka,2,1,"td",11),y(),d(48,Ia,1,0,"tr",20)(49,Aa,1,0,"tr",21),a()()()(),C(50,"mat-paginator",29),a()}n&2&&(m(4),c("ngIf",i.authorizationService.doesCurrentUserHaveRoleForCurrentLocation(0,"Manager_PlanningGroups_Global")),m(4),c("dataSource",i.sapCodeDataSource),m(23),c("matHeaderRowDef",i.displaySapCodeColumns)("matHeaderRowDefSticky",!0),m(),c("matRowDefColumns",i.displaySapCodeColumns),m(2),c("dataSource",i.siteDataSource),m(14),c("matHeaderRowDef",i.displaySiteColumns)("matHeaderRowDefSticky",!0),m(),c("matRowDefColumns",i.displaySiteColumns),m(),c("pageSizeOptions",Pe(10,oa)))},dependencies:[N,mt,ut,I,Ke,et,at,tt,Ze,ot,it,nt,rt,st,Se,De,ve,lt,He,qe,he,Oe,Ye],encapsulation:2})}}return t})(),Tt=class{constructor(){this.manages=""}};var Ri=new fe,Le=class t{constructor(){this.year=0,this.startDate=new Date}static clone(r){let e=new t;return e.startDate=Ri.toDate(r.startDate),e.endDate=Ri.toDate(r.endDate),e.year=r.year,e}toJSON(){let r=new fe;return JSON.stringify(Ft(wt({},this),{startDate:r.toJSON(this.startDate),endDate:void 0}))}};var Ui=(()=>{class t extends je{constructor(){super(...arguments),this.nxpProdYear=new Le,this.du=new fe,this.datepickerStartDate=new Date,this.nxpProdWeeks=[]}ngOnInit(){this.getAllNxpProdWeeks()}submitNewYear(e){e.startDate&&D(this.dataService.submitNxpProductionYear(e)).then(n=>this.saveOk(n)).catch(n=>this.saveFailed(n)).finally(()=>{this.getAllNxpProdWeeks(),this.close()})}getAllNxpProdWeeks(){this.dataService.getNxpProductionYearForAllYears().subscribe(e=>{this.nxpProdWeeks=e,this.nxpProdYear.startDate=new Date,this.nxpProdWeeks.sort((n,i)=>i.year-n.year),this.nxpProdYear.year=this.nxpProdWeeks[0].year+1,this.datepickerStartDate=new Date(this.nxpProdYear.year,0,1),this.nxpProdYear.startDate=this.datepickerStartDate})}saveOk(e){x.displaySuccessMsg(this.snackBar,"Successfully saved Production year"),this.getAllNxpProdWeeks()}saveFailed(e){x.displayServerErrorMsg(this.snackBar,e.error)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=At(t)))(i||t)}})()}static{this.\u0275cmp=F({type:t,selectors:[["app-add-nxp-production-year-dialog"]],standalone:!1,features:[U],decls:27,vars:6,consts:[["picker",""],["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane"],["cdkDragHandle","","color","primary",1,"justify-between"],[1,"text-lg"],["mat-icon-button","",1,"ml-2",3,"click"],[1,"flex","flex-wrap","items-center","gap-4"],["matInput","","name","year","readonly","","required","",3,"ngModelChange","ngModel"],["matInput","","name","date",3,"ngModelChange","ngModel","matDatepickerFilter","matDatepicker"],["matSuffix","",3,"for"],[3,"startAt"],["align","center"],["color","accent","mat-flat-button","",3,"click"],["mat-stroked-button","",3,"click"]],template:function(n,i){if(n&1){let l=w();o(0,"div",1)(1,"mat-toolbar",2)(2,"h2",3),s(3,"Add NXP production year"),a(),o(4,"button",4),h("click",function(){return S(l),_(i.close())}),o(5,"mat-icon"),s(6,"close"),a()()(),o(7,"mat-dialog-content")(8,"form",5)(9,"mat-form-field")(10,"mat-label"),s(11,"Year"),a(),o(12,"input",6),K("ngModelChange",function(g){return S(l),X(i.nxpProdYear.year,g)||(i.nxpProdYear.year=g),_(g)}),a()(),o(13,"mat-form-field")(14,"mat-label"),s(15,"Start date"),a(),o(16,"input",7),K("ngModelChange",function(g){return S(l),X(i.nxpProdYear.startDate,g)||(i.nxpProdYear.startDate=g),_(g)}),a(),o(17,"mat-hint"),s(18,"YYYY-MM-DD"),a(),C(19,"mat-datepicker-toggle",8)(20,"mat-datepicker",9,0),a()()(),o(22,"mat-dialog-actions",10)(23,"button",11),h("click",function(){return S(l),_(i.submitNewYear(i.nxpProdYear))}),s(24," Save "),a(),o(25,"button",12),h("click",function(){return S(l),_(i.close())}),s(26,"Close"),a()()()}if(n&2){let l=Re(21);m(12),J("ngModel",i.nxpProdYear.year),m(4),J("ngModel",i.nxpProdYear.startDate),c("matDatepickerFilter",i.du.isMonday)("matDatepicker",l),m(3),c("for",l),m(),c("startAt",i.datepickerStartDate)}},dependencies:[me,H,z,le,ce,ze,Kt,re,oe,I,W,G,Ge,We,$,ct,dt,pt,se,ae,ne,Y,te],encapsulation:2})}}return t})();var Pa=["resourceGroupUpload"],Va=["equipmentCodeUpload"],Na=["equipmentUpload"];function Ba(t,r){if(t&1){let e=w();o(0,"button",13),h("click",function(){S(e);let i=v().$implicit,l=v();return _(l.submitNewYear(i))}),o(1,"mat-icon"),s(2,"save"),a()()}if(t&2){let e=v().$implicit,n=v();c("disabled",n.isPastProductionYear(e))}}function Ra(t,r){if(t&1){let e=w();o(0,"div",8)(1,"mat-form-field")(2,"mat-label"),s(3,"Year"),a(),o(4,"input",9),K("ngModelChange",function(i){let l=S(e).$implicit;return X(l.year,i)||(l.year=i),_(i)}),a()(),o(5,"mat-form-field")(6,"mat-label"),s(7,"Start date"),a(),o(8,"input",10),K("ngModelChange",function(i){let l=S(e).$implicit;return X(l.startDate,i)||(l.startDate=i),_(i)}),a(),o(9,"mat-hint"),s(10,"YYYY-MM-DD"),a(),C(11,"mat-datepicker-toggle",11)(12,"mat-datepicker",null,0),a(),d(14,Ba,3,1,"button",12),a()}if(t&2){let e=r.$implicit,n=Re(13),i=v();m(4),J("ngModel",e.year),m(4),J("ngModel",e.startDate),c("disabled",i.isPastProductionYear(e))("matDatepickerFilter",i.du.isMonday)("matDatepicker",n),m(3),c("for",n),m(3),c("ngIf",i.authorizationService.doesCurrentUserHaveRoleForCurrentLocation(i.location.id,"Manager_Planning_Site"))}}function Ua(t,r){t&1&&C(0,"app-spinner")}var Oi=(()=>{class t{constructor(e,n,i,l,u,g){this.dialogService=e,this.snackBar=n,this.dataService=i,this.authorizationService=l,this.dataUpdateService=u,this.store=g,this.currentUser=new Yt,this.location=new Z,this.du=new fe,this.nxpProdWeeks=[],this.isLoadingResults=!1,this.isAuthorized=!1,this.store.select(Ht).subscribe(T=>{T&&(this.currentUser=T)}),this.store.select(ri).subscribe(T=>{T&&(this.location=T)})}ngOnInit(){this.getAllNxpProdWeeks(),this.checkIfAuthorized(),this.watchForUpdate()}openAddProdYear(){this.dialogService.open(Ui).beforeClosed().subscribe(()=>{this.getAllNxpProdWeeks()})}getAllNxpProdWeeks(){this.dataService.getNxpProductionYearForAllYears().subscribe(e=>this.nxpProdWeeks=e)}isPastProductionYear(e){return new Date(e.startDate).getTime()-new Date().getTime()<0}submitNewYear(e){if(e.startDate){let n=Le.clone(e);D(this.dataService.submitNxpProductionYear(n)).then(i=>this.saveOk(i)).catch(i=>this.saveFailed(i)).finally(()=>{this.getAllNxpProdWeeks()})}}saveOk(e){x.displaySuccessMsg(this.snackBar,"Successfully saved Production year"),this.getAllNxpProdWeeks()}saveFailed(e){x.displayServerErrorMsg(this.snackBar,e.error)}checkIfAuthorized(){this.isAuthorized=this.authorizationService.doesUserHaveRoleForSite(Xe.ADMINISTRATOR_SYSTEM,this.location.acronym),this.isAuthorized||x.displayWarningMsg(this.snackBar,"You are not authorized to upload Excel file")}watchForUpdate(){this.dataUpdateService.updateEmitter.subscribe(e=>{e.updatedType==$e.USER_ALERT&&e.userWbi===this.currentUser.wbi&&x.displayWarningMsg(this.snackBar,e.updateData)})}static{this.\u0275fac=function(n){return new(n||t)(p(Ce),p(j),p(B),p(ee),p(Je),p(k))}}static{this.\u0275cmp=F({type:t,selectors:[["app-sys-admin"]],viewQuery:function(n,i){if(n&1&&(L(Pa,5),L(Va,5),L(Na,5)),n&2){let l;P(l=V())&&(i.resourceGroupUpload=l.first),P(l=V())&&(i.equipmentCodeUpload=l.first),P(l=V())&&(i.equipmentUpload=l.first)}},standalone:!1,decls:11,vars:2,consts:[["picker",""],[1,"flex","max-h-full","gap-4","p-2"],[1,"flex","items-center","justify-between","gap-4","p-4"],[1,"text-2xl"],["color","accent","mat-mini-fab","","matTooltip","Add production year",3,"click"],[1,"overflow-auto"],["class","flex gap-2",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"flex","gap-2"],["matInput","","readonly","",3,"ngModelChange","ngModel"],["matInput","",3,"ngModelChange","ngModel","disabled","matDatepickerFilter","matDatepicker"],["matSuffix","",3,"for"],["class","mt-2","mat-mini-fab","","matTooltip","Save",3,"disabled","click",4,"ngIf"],["mat-mini-fab","","matTooltip","Save",1,"mt-2",3,"click","disabled"]],template:function(n,i){n&1&&(o(0,"div",1)(1,"mat-card")(2,"div",2)(3,"h1",3),s(4,"NXP Production Years"),a(),o(5,"button",4),h("click",function(){return i.openAddProdYear()}),o(6,"mat-icon"),s(7,"add"),a()()(),o(8,"mat-card-content",5),d(9,Ra,15,7,"div",6),a()()(),d(10,Ua,1,0,"app-spinner",7)),n&2&&(m(9),c("ngForOf",i.nxpProdWeeks),m(),c("ngIf",i.isLoadingResults))},dependencies:[O,N,H,z,ze,ge,I,Se,hi,Ci,W,G,Ge,We,$,ct,dt,pt,he],encapsulation:2})}}return t})();var Oa=[{path:"sites",component:Vi},{path:"plant-codes",component:Bi},{path:"production-years",component:Oi}],Ds=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=Lt({type:t})}static{this.\u0275inj=It({imports:[Bt,ti,ii,oi.forChild(Oa),wi,Gt,Jt,mi,$t,pi,ci,Xt,gi,ni,ai,bi,Qt,zt,qt,Si,Wt,di,Ti]})}}return t})();export{Ds as AdminModule};
