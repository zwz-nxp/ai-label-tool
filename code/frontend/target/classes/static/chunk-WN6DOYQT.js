import{b as we,c as ve,d as ye}from"./chunk-PRQOG5TK.js";import{c as Je}from"./chunk-FMKU7UOR.js";import{J as ke,Qb as Re,Rb as Pe,Sb as X,Tb as Ae,Ub as Fe,ad as qe,bd as _,cd as ze,d as fe,f as V,g as W,hd as Ye,i as pe,n as he,o as Se,q as _e,r as ie,sd as $e,u as Ee}from"./chunk-BAOJ77MB.js";import{$a as k,Aa as c,Bb as A,Da as E,Db as F,Df as Ve,Ea as re,Ee as Me,Fc as ee,Ff as Le,Gf as We,Hf as Oe,Ia as d,If as He,Jf as Be,Ka as f,Kf as je,Le as be,Lf as Ge,Mf as Qe,Ob as se,Oe as De,Pb as me,Pd as O,Qe as te,Re as Ie,Td as H,V as ae,Va as a,Ve as xe,Wa as r,Xa as w,Xb as U,Ya as u,Yd as ue,Za as h,ac as ce,bb as v,be as Ce,ca as T,cb as C,da as M,de as ge,gb as ne,hf as B,ib as R,if as j,jb as N,jf as G,kb as P,kf as Q,lf as q,mb as n,mf as z,nb as Z,nf as Y,ob as S,of as $,pf as J,qf as K,rf as Ne,sf as y,tb as b,ub as D,vb as I,wa as s,xd as de,yb as le,yf as Ue,zc as L,ze as Te}from"./chunk-NJA2VFCC.js";import"./chunk-TSRGIXR5.js";var x=class{constructor(){this.user=new fe,this.key="",this.value=""}};function st(t,l){t&1&&(a(0,"th",22),n(1,"Role name"),r())}function mt(t,l){if(t&1&&(a(0,"td",23),n(1),r()),t&2){let e=l.$implicit;s(),S(" ",e.role.roleName," ")}}function ct(t,l){t&1&&(a(0,"th",22),n(1,"For Site(s)"),r())}function ft(t,l){if(t&1&&(a(0,"td",23),n(1),r()),t&2){let e=l.$implicit;s(),S(" ",e.site," ")}}function pt(t,l){t&1&&(a(0,"th",22),n(1,"For SapCode(s)"),r())}function dt(t,l){if(t&1&&(a(0,"td",23),n(1),r()),t&2){let e=l.$implicit,i=C();s(),S(" ",i.forSapCodes(e)," ")}}function ut(t,l){t&1&&w(0,"tr",24)}function ht(t,l){t&1&&w(0,"tr",25)}var Xe=(()=>{class t{constructor(e,i,o,m,p){this.dataService=e,this.dialogService=i,this.authorizationService=o,this.snackBar=m,this.store=p,this.rolesAllowed=[],this.settingsForSelectedUser=[],this.notificationMailReceive="false",this.debounceTime="0",this.rolesDataSource=new y([]),this.displayColumns=["roleName","forSites","forSapCodes"],this.delegateColumns=["delegateWbi","startDate","endDate","actions"],this.store.select(W).subscribe(g=>{g&&(this.currentUser=g)})}ngOnInit(){this.getAllSettingsForUser(),this.getAllRolesForUser()}forSapCodes(e){let i="";return e.sapCodes.forEach(o=>i+=o+", "),i.length>4&&(i=i.substring(0,i.length-2)),i}setNotificationMail(){let e=new x;e.user=this.currentUser,e.key="notificationmail",e.value=this.notificationMailReceive,this.saveUserSetting(e)}setDebounceTime(){let e=new x;e.user=this.currentUser,e.key="debouncetime",e.value=this.debounceTime,this.saveUserSetting(e)}getUsernameByWbi(e){return this.store.select(ke(e))}getAllSettingsForUser(){this.dataService.getAllUserSettings().subscribe(e=>{this.settingsForSelectedUser=e;for(let i of e)i.key.toLowerCase()=="notificationmail"&&(this.notificationMailReceive=i.value),i.key.toLowerCase()=="debouncetime"&&(this.debounceTime=i.value)})}getAllRolesForUser(){this.dataService.getAllRolesAllowed(this.currentUser).subscribe(e=>{this.processRolesAllowed(e)})}processRolesAllowed(e){this.rolesAllowed=e,this.rolesDataSource=new y(this.rolesAllowed)}saveUserSetting(e){this.dataService.saveUserSetting(e).subscribe({next:i=>this.saveOk(),error:i=>this.saveFailed(i)})}saveOk(){ee.displaySuccessMsg(this.snackBar,"Successfully saved user settings"),this.store.dispatch(Ee({user:this.currentUser}))}saveFailed(e){ee.displayServerErrorMsg(this.snackBar,e.message)}static{this.\u0275fac=function(i){return new(i||t)(c(V),c(H),c(pe),c(O),c(L))}}static{this.\u0275cmp=E({type:t,selectors:[["app-profile-page"]],standalone:!1,decls:57,vars:12,consts:[[1,"flex"],[1,"inline-block","columns-1","p-4"],[1,"mb-4"],[1,"flex","justify-between","p-3"],[1,"flex","gap-4"],["mat-table","",3,"dataSource"],["matColumnDef","roleName"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","forSites"],["matColumnDef","forSapCodes"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["class","hover:!bg-table-row-hover","mat-row","",4,"matRowDef","matRowDefColumns"],[1,"my-4","flex","flex-col","gap-4"],["subscriptSizing","dynamic",1,"w-full","!min-w-80"],[3,"selectionChange","valueChange","value"],["value","true"],["value","false"],["value","400"],["value","200"],["value","100"],["value","50"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"hover:!bg-table-row-hover"]],template:function(i,o){i&1&&(a(0,"div",0)(1,"div",1)(2,"mat-card",2)(3,"div",3)(4,"p")(5,"b"),n(6),r(),n(7),A(8,"date"),r(),a(9,"p"),n(10," Your primary site is "),a(11,"b"),n(12),r()()()(),a(13,"div",4)(14,"mat-card")(15,"mat-card-header")(16,"mat-card-title"),n(17,"My Rights"),r()(),a(18,"mat-card-content")(19,"table",5),u(20,6),d(21,st,2,0,"th",7)(22,mt,2,1,"td",8),h(),u(23,9),d(24,ct,2,0,"th",7)(25,ft,2,1,"td",8),h(),u(26,10),d(27,pt,2,0,"th",7)(28,dt,2,1,"td",8),h(),d(29,ut,1,0,"tr",11)(30,ht,1,0,"tr",12),r()()(),a(31,"mat-card")(32,"mat-card-header")(33,"mat-card-title"),n(34," User settings"),r()(),a(35,"mat-card-content")(36,"div",13)(37,"mat-form-field",14)(38,"mat-label"),n(39," Would you like to receive notification e-mails? "),r(),a(40,"mat-select",15),v("selectionChange",function(){return o.setNotificationMail()}),I("valueChange",function(p){return D(o.notificationMailReceive,p)||(o.notificationMailReceive=p),p}),a(41,"mat-option",16),n(42,"Yes"),r(),a(43,"mat-option",17),n(44,"No"),r()()(),a(45,"mat-form-field",14)(46,"mat-label"),n(47,"How is your internet connection?"),r(),a(48,"mat-select",15),v("selectionChange",function(){return o.setDebounceTime()}),I("valueChange",function(p){return D(o.debounceTime,p)||(o.debounceTime=p),p}),a(49,"mat-option",18),n(50,"Bad"),r(),a(51,"mat-option",19),n(52,"Fair"),r(),a(53,"mat-option",20),n(54,"Good"),r(),a(55,"mat-option",21),n(56,"Excellent"),r()()()()()()()()()),i&2&&(s(6),Z(o.currentUser.name),s(),S(" Your previous log on was at ",F(8,9,o.currentUser.lastLogin,"yyyy-MM-dd hh:mm")," "),s(5),Z(o.currentUser.primaryLocation.acronym),s(7),f("dataSource",o.rolesDataSource),s(10),f("matHeaderRowDef",o.displayColumns)("matHeaderRowDefSticky",!0),s(),f("matRowDefColumns",o.displayColumns),s(10),b("value",o.notificationMailReceive),s(8),b("value",o.debounceTime))},dependencies:[He,je,Ge,Be,B,G,Y,Q,j,$,q,z,J,K,be,Me,Ve,Ue,U],encapsulation:2})}}return t})();var St=["NotificationsTable"],Ct=["NotificationsPaginator"],_t=()=>[25,50,100];function gt(t,l){t&1&&(a(0,"th",21),n(1," Date Received "),r())}function wt(t,l){if(t&1&&(a(0,"td",22),n(1),A(2,"date"),r()),t&2){let e=l.$implicit;s(),S(" ",F(2,1,e.timestamp,"yyyy-MM-dd")," ")}}function vt(t,l){t&1&&(a(0,"th",21),n(1,"Type"),r())}function yt(t,l){if(t&1&&(a(0,"td",23),n(1),r()),t&2){let e=l.$implicit,i=C();s(),S(" ",i.getLevel(e)," ")}}function Tt(t,l){t&1&&(a(0,"th",21),n(1,"Title"),r())}function Mt(t,l){if(t&1&&(a(0,"td",22),n(1),r()),t&2){let e=l.$implicit,i=C();s(),S(" ",i.getTitle(e)," ")}}function bt(t,l){t&1&&(a(0,"th",21),n(1,"Status"),r())}function Dt(t,l){if(t&1&&(a(0,"td",22),n(1),r()),t&2){let e=l.$implicit,i=C();s(),S(" ",i.isRead(e.read)," ")}}function It(t,l){if(t&1){let e=k();a(0,"th",26)(1,"app-generic-search",27),v("emitSearchTrigger",function(o){T(e);let m=C(2);return M(m.notificationSearchFieldTriggered(o))}),r()()}if(t&2){let e=C().$implicit;s(),f("searchField",e)}}function xt(t,l){if(t&1&&(u(0,24),d(1,It,2,1,"th",25),h()),t&2){let e=l.$implicit;f("matColumnDef",e)}}function Et(t,l){t&1&&w(0,"tr",28)}function kt(t,l){t&1&&w(0,"tr",28)}function Rt(t,l){if(t&1){let e=k();a(0,"tr",29),v("click",function(){let o=T(e).$implicit,m=C();return M(m.openNotification(o.id))}),r()}}function Nt(t,l){t&1&&w(0,"app-spinner")}var Ze=(()=>{class t{constructor(e,i,o,m,p,g,et){this.route=e,this.dialogService=i,this.dataService=o,this.snackbar=m,this.dataUpdateService=p,this.store=g,this.genericSearchUtils=et,this.displayedColumnsNotifications=["timestamp","severityLevel","message","read"],this.notificationsDataSource=new y,this.notifications=[],this.notificationSearchArguments=new qe,this.notificationSearchColumns=[_.NOTIFICATION_TIMESTAMP,_.NOTIFICATION_SEVERITYLEVEL,_.NOTIFICATION_TITLE,_.NOTIFICATION_READ],this.filterValues={},this.isLoading=!1,this.activeTab=0,this.viewRequestCountForLabel=0,this.approveRequestCountForLabel=0,this.store.select(W).subscribe(oe=>{oe&&(this.currentUser=oe)})}ngOnInit(){this.getAllNotifications(),this.route.url.subscribe(e=>{e.forEach(i=>{(i.path.toLowerCase()==="request"||i.path.toLowerCase()==="approval")&&(this.deepLinkRoute=i.path.toLowerCase())})}),this.watchForUpdates()}ngAfterViewInit(){}watchForUpdates(){this.dataUpdateService.updateEmitter.subscribe(e=>{(e.updatedType==ie.PLANNING||e.updatedType==ie.APPROVAL)&&this.getAllNotifications()})}getAllNotifications(){this.dataService.getAllNotifications().subscribe(e=>{this.notifications=e,this.notificationsDataSource=new y(this.notifications),this.notificationsDataSource.paginator=this.notificationPaginator,this.notificationsDataSource.sort=this.notificationSort,this.isLoading=!1})}openNotification(e){let i=this.notifications.find(o=>o.id===e);if(i){let o=this.dialogService.open(Pe);o.componentInstance.selectedNotification=i,o.componentInstance.unreadNotifications=this.notifications;let m=o.componentInstance.updateNotificationsEmitter.subscribe(()=>this.getAllNotifications());o.afterClosed().subscribe(()=>{m.unsubscribe()})}}getLevel(e){return typeof e.severityLevel<"u"?e.severityLevel.replace("_"," "):typeof e.errorOccurred<"u"&&e.errorOccurred?"WARNING":"INFORMATION"}getTitle(e){return typeof e.title<"u"?e.title:typeof e.message<"u"?e.message:""}isRead(e){return e?"Closed":"Open"}notificationSearchFieldTriggered(e){let i=this.notificationSearchArguments.getSearchField(e.field);i?i.value=e.value:this.notificationSearchArguments.searchArgs.push(e),this.notificationPaginator.firstPage(),this.applyFilterToNotificationDataSource()}applyFilterToNotificationDataSource(){let e=this.notificationSearchArguments;this.notificationsDataSource.filterPredicate=i=>this.genericSearchUtils.isBetween(i.timestamp,e,_.NOTIFICATION_TIMESTAMP)&&this.genericSearchUtils.isLike(this.isRead(i.read),e,_.NOTIFICATION_READ)&&this.genericSearchUtils.isLike(i.title,e,_.NOTIFICATION_TITLE)&&this.genericSearchUtils.isLike(i.severityLevel,e,_.NOTIFICATION_SEVERITYLEVEL),this.notificationsDataSource.filter=JSON.stringify(this.filterValues)}updateTableStickyStyles(){this.notificationsTable.updateStickyColumnStyles(),this.notificationsTable.updateStickyHeaderRowStyles(),this.notificationsTable.updateStickyFooterRowStyles()}static{this.\u0275fac=function(i){return new(i||t)(c(Ie),c(H),c(V),c(O),c(Re),c(L),c(ze))}}static{this.\u0275cmp=E({type:t,selectors:[["app-workflow-view"]],viewQuery:function(i,o){if(i&1&&(R(St,5),R(Ct,5),R(X,5)),i&2){let m;N(m=P())&&(o.notificationsTable=m.first),N(m=P())&&(o.notificationPaginator=m.first),N(m=P())&&(o.notificationSort=m.first)}},standalone:!1,decls:27,vars:13,consts:[["tabs",""],["NotificationsTable",""],["NotificationsPaginator",""],[1,"flex","max-h-full","min-h-0","flex-col"],["mat-stretch-tabs","false",1,"overflow-auto",3,"selectedTabChange","selectedIndexChange","selectedIndex"],[3,"label"],[1,"flex","max-h-full","flex-col"],[1,"overflow-auto"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","timestamp"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","nowrap","",4,"matCellDef"],["matColumnDef","severityLevel"],["mat-cell","",4,"matCellDef"],["matColumnDef","message"],["matColumnDef","read"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["class","cursor-pointer hover:!bg-table-row-hover","mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],[4,"ngIf"],["mat-header-cell","","mat-sort-header",""],["mat-cell","","nowrap",""],["mat-cell",""],[3,"matColumnDef"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-cell",""],[3,"emitSearchTrigger","searchField"],["mat-header-row",""],["mat-row","",1,"cursor-pointer","hover:!bg-table-row-hover",3,"click"]],template:function(i,o){if(i&1){let m=k();a(0,"div",3)(1,"mat-tab-group",4,0),v("selectedTabChange",function(){return T(m),M(o.updateTableStickyStyles())}),I("selectedIndexChange",function(g){return T(m),D(o.activeTab,g)||(o.activeTab=g),M(g)}),a(3,"mat-tab",5)(4,"div",6)(5,"div",7)(6,"table",8,1),u(8,9),d(9,gt,2,0,"th",10)(10,wt,3,4,"td",11),h(),u(11,12),d(12,vt,2,0,"th",10)(13,yt,2,1,"td",13),h(),u(14,14),d(15,Tt,2,0,"th",10)(16,Mt,2,1,"td",11),h(),u(17,15),d(18,bt,2,0,"th",10)(19,Dt,2,1,"td",11),h(),d(20,xt,2,1,"ng-container",16)(21,Et,1,0,"tr",17)(22,kt,1,0,"tr",17)(23,Rt,1,0,"tr",18),r()(),w(24,"mat-paginator",19,2),r()()(),d(26,Nt,1,0,"app-spinner",20),r()}i&2&&(s(),b("selectedIndex",o.activeTab),s(2),ne("label","Notifications (",o.notifications.length,")"),s(3),f("dataSource",o.notificationsDataSource),s(14),f("ngForOf",o.notificationSearchColumns),s(),f("matHeaderRowDef",o.displayedColumnsNotifications)("matHeaderRowDefSticky",!0),s(),f("matHeaderRowDef",o.notificationSearchColumns)("matHeaderRowDefSticky",!0),s(),f("matRowDefColumns",o.displayedColumnsNotifications),s(),f("pageSizeOptions",le(12,_t)),s(2),f("ngIf",o.isLoading))},dependencies:[se,me,Se,Ye,B,G,Y,Q,j,$,q,z,J,K,X,Ae,We,we,ve,U],encapsulation:2})}}return t})();var Pt=[{path:"my-profile",component:Xe},{path:"worklist",component:Ze}],Vi=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=re({type:t})}static{this.\u0275inj=ae({imports:[ce,Te,xe.forChild(Pt),$e,he,Qe,Ne,De,te,Le,ge,ue,Je,te,de,Fe,Ce,Oe,ye,_e]})}}return t})();export{Vi as ProfileModule};
